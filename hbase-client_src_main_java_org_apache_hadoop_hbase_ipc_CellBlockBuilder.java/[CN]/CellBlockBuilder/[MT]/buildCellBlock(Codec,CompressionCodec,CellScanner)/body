{
  if (cellScanner == null) {
    return null;
  }
  if (codec == null) {
    throw new CellScannerButNoCodecException();
  }
  int bufferSize=this.cellBlockBuildingInitialBufferSize;
  ByteBufferOutputStream baos=new ByteBufferOutputStream(bufferSize);
  encodeCellsTo(baos,cellScanner,codec,compressor);
  if (LOG.isTraceEnabled()) {
    if (bufferSize < baos.size()) {
      LOG.trace("Buffer grew from initial bufferSize=" + bufferSize + " to "+ baos.size()+ "; up hbase.ipc.cellblock.building.initial.buffersize?");
    }
  }
  ByteBuffer bb=baos.getByteBuffer();
  if (!bb.hasRemaining())   return null;
  return bb;
}
