{
  byte[] tableName=Bytes.toBytes("TestSplit");
  byte[] familyName=Bytes.toBytes("fam");
  HTable ht=TEST_UTIL.createTable(tableName,familyName);
  TEST_UTIL.loadTable(ht,familyName);
  ht.close();
  HRegionServer server=TEST_UTIL.getHBaseCluster().getRegionServer(0);
  byte[] firstRow=Bytes.toBytes("aaa");
  byte[] splitRow=Bytes.toBytes("lll");
  byte[] lastRow=Bytes.toBytes("zzz");
  HConnection con=HConnectionManager.getConnection(TEST_UTIL.getConfiguration());
  byte[] regionName=con.locateRegion(tableName,splitRow).getRegionInfo().getRegionName();
  HRegion region=server.getRegion(regionName);
  SplitTransaction split=new SplitTransaction(region,splitRow);
  split.prepare();
  PairOfSameType<HRegion> regions=split.createDaughters(server,server);
  assertFalse(test(con,tableName,firstRow,server));
  assertFalse(test(con,tableName,lastRow,server));
  split.openDaughters(server,null,regions.getFirst(),regions.getSecond());
  assertFalse(test(con,tableName,firstRow,server));
  assertFalse(test(con,tableName,lastRow,server));
  server.postOpenDeployTasks(regions.getSecond(),server.getCatalogTracker(),true);
  server.addToOnlineRegions(regions.getSecond());
  assertFalse(test(con,tableName,firstRow,server));
  assertTrue(test(con,tableName,lastRow,server));
  server.postOpenDeployTasks(regions.getFirst(),server.getCatalogTracker(),true);
  server.addToOnlineRegions(regions.getFirst());
  assertTrue(test(con,tableName,firstRow,server));
  assertTrue(test(con,tableName,lastRow,server));
  split.transitionZKNode(server,regions.getFirst(),regions.getSecond());
  assertTrue(test(con,tableName,firstRow,server));
  assertTrue(test(con,tableName,lastRow,server));
}
