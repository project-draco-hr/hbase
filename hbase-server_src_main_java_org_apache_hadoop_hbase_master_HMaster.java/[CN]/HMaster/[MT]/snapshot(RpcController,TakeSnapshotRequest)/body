{
  try {
    this.snapshotManager.checkSnapshotSupport();
  }
 catch (  UnsupportedOperationException e) {
    throw new ServiceException(e);
  }
  LOG.debug("Submitting snapshot request for:" + ClientSnapshotDescriptionUtils.toString(request.getSnapshot()));
  SnapshotDescription snapshot=SnapshotDescriptionUtils.validate(request.getSnapshot(),this.conf);
  try {
    snapshotManager.takeSnapshot(snapshot);
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
  long waitTime=SnapshotDescriptionUtils.getMaxMasterTimeout(conf,snapshot.getType(),SnapshotDescriptionUtils.DEFAULT_MAX_WAIT_TIME);
  return TakeSnapshotResponse.newBuilder().setExpectedTimeout(waitTime).build();
}
