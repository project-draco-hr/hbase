{
  boolean oldValue=this.balanceSwitch;
  boolean newValue=b;
  try {
    if (this.cpHost != null) {
      newValue=this.cpHost.preBalanceSwitch(newValue);
    }
    if (mode == BalanceSwitchMode.SYNC) {
synchronized (this.balancer) {
        this.balanceSwitch=newValue;
      }
    }
 else {
      this.balanceSwitch=newValue;
    }
    LOG.info("BalanceSwitch=" + newValue);
    if (this.cpHost != null) {
      this.cpHost.postBalanceSwitch(oldValue,newValue);
    }
  }
 catch (  IOException ioe) {
    LOG.warn("Error flipping balance switch",ioe);
  }
  return oldValue;
}
