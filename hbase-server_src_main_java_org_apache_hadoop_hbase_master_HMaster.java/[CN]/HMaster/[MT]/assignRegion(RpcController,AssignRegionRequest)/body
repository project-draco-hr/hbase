{
  try {
    final byte[] regionName=req.getRegion().getValue().toByteArray();
    RegionSpecifierType type=req.getRegion().getType();
    AssignRegionResponse arr=AssignRegionResponse.newBuilder().build();
    checkInitialized();
    if (type != RegionSpecifierType.REGION_NAME) {
      LOG.warn("assignRegion specifier type: expected: " + RegionSpecifierType.REGION_NAME + " actual: "+ type);
    }
    RegionStates regionStates=assignmentManager.getRegionStates();
    HRegionInfo regionInfo=regionStates.getRegionInfo(regionName);
    if (regionInfo == null)     throw new UnknownRegionException(Bytes.toString(regionName));
    RegionState regionState=regionStates.getRegionState(regionInfo);
    if (regionState != null && !regionState.isOffline()) {
      throw new IOException("Region " + regionInfo + " is not offline");
    }
    if (cpHost != null) {
      if (cpHost.preAssign(regionInfo)) {
        return arr;
      }
    }
    assignRegion(regionInfo);
    if (cpHost != null) {
      cpHost.postAssign(regionInfo);
    }
    return arr;
  }
 catch (  IOException ioe) {
    throw new ServiceException(ioe);
  }
}
