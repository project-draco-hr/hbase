{
  try {
    SnapshotDescription snapshot=request.getSnapshot();
    SnapshotSentinel sentinel=this.snapshotManager.getRestoreSnapshotSentinel(snapshot.getTable());
    IsRestoreSnapshotDoneResponse.Builder builder=IsRestoreSnapshotDoneResponse.newBuilder();
    LOG.debug("Verify snapshot=" + snapshot.getName() + " against="+ sentinel.getSnapshot().getName()+ " table="+ snapshot.getTable());
    if (sentinel != null && sentinel.getSnapshot().getName().equals(snapshot.getName())) {
      HBaseSnapshotException e=sentinel.getExceptionIfFailed();
      if (e != null)       throw e;
      if (sentinel.isFinished()) {
        LOG.debug("Restore snapshot=" + snapshot + " has completed. Notifying the client.");
      }
 else {
        builder.setDone(false);
        if (LOG.isDebugEnabled()) {
          LOG.debug("Sentinel is not yet finished with restoring snapshot=" + snapshot);
        }
      }
    }
    return builder.build();
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
}
