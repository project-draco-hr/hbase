{
  LruBlockCache cache=new LruBlockCache(1000000,10000);
  Block[] blocks=generateRandomBlocks(10,10000);
  long emptyCacheSize=cache.heapSize();
  long expectedCacheSize=emptyCacheSize;
  for (  Block block : blocks) {
    assertTrue(cache.getBlock(block.blockName) == null);
  }
  for (  Block block : blocks) {
    cache.cacheBlock(block.blockName,block.buf);
    expectedCacheSize+=block.heapSize();
  }
  assertEquals(expectedCacheSize,cache.heapSize());
  for (  Block block : blocks) {
    ByteBuffer buf=cache.getBlock(block.blockName);
    assertTrue(buf != null);
    assertEquals(buf.capacity(),block.buf.capacity());
  }
  for (  Block block : blocks) {
    try {
      cache.cacheBlock(block.blockName,block.buf);
      assertTrue("Cache should not allow re-caching a block",false);
    }
 catch (    RuntimeException re) {
    }
  }
  assertEquals(expectedCacheSize,cache.heapSize());
  for (  Block block : blocks) {
    ByteBuffer buf=cache.getBlock(block.blockName);
    assertTrue(buf != null);
    assertEquals(buf.capacity(),block.buf.capacity());
  }
}
