{
  boolean userToFlatten=compactingMemStore.getConfiguration().getBoolean(MEMSTORE_COMPACTOR_FLATTENING,MEMSTORE_COMPACTOR_FLATTENING_DEFAULT);
  if (userToFlatten == false) {
    LOG.debug("In-Memory shrink is doing compaction, as user asked to avoid flattening");
    return false;
  }
  int numOfSegments=versionedList.getNumOfSegments();
  if (numOfSegments > 3) {
    LOG.debug("In-Memory shrink is doing compaction, as there already are " + numOfSegments + " segments in the compaction pipeline");
    return false;
  }
  boolean avoidSpeculativeScan=compactingMemStore.getConfiguration().getBoolean(MEMSTORE_COMPACTOR_AVOID_SPECULATIVE_SCAN,MEMSTORE_COMPACTOR_AVOID_SPECULATIVE_SCAN_DEFAULT);
  if (avoidSpeculativeScan == true) {
    LOG.debug("In-Memory shrink is doing flattening, as user asked to avoid compaction " + "evaluation");
    return true;
  }
  try {
    immutCellsNum=countCellsForCompaction();
    if (immutCellsNum > fraction * versionedList.getNumOfCells()) {
      return true;
    }
  }
 catch (  Exception e) {
    return true;
  }
  return false;
}
