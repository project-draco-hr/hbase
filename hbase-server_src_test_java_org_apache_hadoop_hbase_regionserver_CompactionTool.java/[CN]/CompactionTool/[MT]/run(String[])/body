{
  if (args.length == 0)   return usage(-1);
  FileSystem fs=FileSystem.get(getConf());
  final Path inputdir=new Path(args[0]);
  final Path tmpdir=new Path(getConf().get("hbase.tmp.dir"));
  int errCode=checkdir(fs,inputdir);
  if (errCode != 0)   return errCode;
  errCode=checkdir(fs,tmpdir);
  if (errCode != 0)   return errCode;
  HStore store=getStore(fs,inputdir,tmpdir);
  try {
    CompactionRequest cr=store.requestCompaction();
    StoreFile sf=store.compact(cr);
    if (sf != null) {
      sf.closeReader(true);
      if (conf.getBoolean("hbase.compactiontool.delete",true)) {
        if (!fs.delete(sf.getPath(),false)) {
          throw new IOException("Failed delete of " + sf.getPath());
        }
      }
    }
  }
  finally {
    store.close();
  }
  return 0;
}
