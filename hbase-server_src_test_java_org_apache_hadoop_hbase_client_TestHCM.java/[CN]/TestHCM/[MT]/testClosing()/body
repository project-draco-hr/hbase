{
  Configuration configuration=new Configuration(TEST_UTIL.getConfiguration());
  configuration.set(HConstants.HBASE_CLIENT_INSTANCE_ID,String.valueOf(_randy.nextInt()));
  Connection c1=ConnectionFactory.createConnection(configuration);
  Connection c2=ConnectionFactory.createConnection(configuration);
  Connection c3=HConnectionManager.getConnection(configuration);
  Connection c4=HConnectionManager.getConnection(configuration);
  assertTrue(c3 == c4);
  c1.close();
  assertTrue(c1.isClosed());
  assertFalse(c2.isClosed());
  assertFalse(c3.isClosed());
  c3.close();
  assertFalse(c3.isClosed());
  c3.close();
  assertTrue(c3.isClosed());
  Connection c5=HConnectionManager.getConnection(configuration);
  assertTrue(c5 != c3);
  assertFalse(c2.isClosed());
  c2.close();
  assertTrue(c2.isClosed());
  c5.close();
  assertTrue(c5.isClosed());
}
