{
  while (!this.server.isStopRequested() && this.server.isInSafeMode()) {
    try {
      Thread.sleep(threadWakeFrequency);
    }
 catch (    InterruptedException ex) {
      continue;
    }
  }
  while (!server.isStopRequested()) {
    HRegion r=null;
    try {
      r=flushQueue.poll(threadWakeFrequency,TimeUnit.MILLISECONDS);
      if (r == null) {
        continue;
      }
      if (!flushRegion(r,false)) {
        break;
      }
    }
 catch (    InterruptedException ex) {
      continue;
    }
catch (    ConcurrentModificationException ex) {
      continue;
    }
catch (    Exception ex) {
      LOG.error("Cache flush failed" + (r != null ? (" for region " + r.getRegionName()) : ""),ex);
      if (!server.checkFileSystem()) {
        break;
      }
    }
  }
  regionsInQueue.clear();
  flushQueue.clear();
  LOG.info(getName() + " exiting");
}
