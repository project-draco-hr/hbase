{
  HServerInfo info=new HServerInfo(serverInfo);
  String serverName=HServerInfo.getServerName(info);
  if (serversToServerInfo.containsKey(serverName) || deadServers.contains(serverName)) {
    LOG.debug("Server start was rejected: " + serverInfo);
    LOG.debug("serversToServerInfo.containsKey: " + serversToServerInfo.containsKey(serverName));
    LOG.debug("deadServers.contains: " + deadServers.contains(serverName));
    throw new Leases.LeaseStillHeldException(serverName);
  }
  Watcher watcher=new ServerExpirer(serverName,info.getServerAddress());
  zooKeeperWrapper.updateRSLocationGetWatch(info,watcher);
  LOG.info("Received start message from: " + serverName);
  HServerLoad load=serversToLoad.remove(serverName);
  if (load != null) {
synchronized (loadToServers) {
      Set<String> servers=loadToServers.get(load);
      if (servers != null) {
        servers.remove(serverName);
        loadToServers.put(load,servers);
      }
    }
  }
  HServerInfo storedInfo=serversToServerInfo.remove(serverName);
  if (storedInfo != null && !master.closed.get()) {
    HServerAddress root=master.getRootRegionLocation();
    boolean rootServer=false;
    if (root != null && root.equals(storedInfo.getServerAddress())) {
      master.regionManager.unsetRootRegion();
      rootServer=true;
    }
    try {
      master.toDoQueue.put(new ProcessServerShutdown(master,storedInfo,rootServer));
    }
 catch (    InterruptedException e) {
      LOG.error("Insertion into toDoQueue was interrupted",e);
    }
  }
  load=new HServerLoad();
  info.setLoad(load);
  serversToServerInfo.put(serverName,info);
  serverAddressToServerInfo.put(info.getServerAddress(),info);
  serversToLoad.put(serverName,load);
synchronized (loadToServers) {
    Set<String> servers=loadToServers.get(load);
    if (servers == null) {
      servers=new HashSet<String>();
    }
    servers.add(serverName);
    loadToServers.put(load,servers);
  }
}
