{
  InternalScanner scanner=null;
  AggregateResponse response=null;
  T max=null;
  try {
    ColumnInterpreter<T,S> ci=constructColumnInterpreterFromRequest(request);
    T temp;
    Scan scan=ProtobufUtil.toScan(request.getScan());
    scanner=env.getRegion().getScanner(scan);
    List<KeyValue> results=new ArrayList<KeyValue>();
    byte[] colFamily=scan.getFamilies()[0];
    NavigableSet<byte[]> qualifiers=scan.getFamilyMap().get(colFamily);
    byte[] qualifier=null;
    if (qualifiers != null && !qualifiers.isEmpty()) {
      qualifier=qualifiers.pollFirst();
    }
    boolean hasMoreRows=false;
    do {
      hasMoreRows=scanner.next(results);
      for (      KeyValue kv : results) {
        temp=ci.getValue(colFamily,qualifier,kv);
        max=(max == null || (temp != null && ci.compare(temp,max) > 0)) ? temp : max;
      }
      results.clear();
    }
 while (hasMoreRows);
    if (max != null) {
      AggregateResponse.Builder builder=AggregateResponse.newBuilder();
      builder.addFirstPart(ci.getProtoForCellType(max));
      response=builder.build();
    }
  }
 catch (  IOException e) {
    ResponseConverter.setControllerException(controller,e);
  }
 finally {
    if (scanner != null) {
      try {
        scanner.close();
      }
 catch (      IOException ignored) {
      }
    }
  }
  log.info("Maximum from this region is " + env.getRegion().getRegionNameAsString() + ": "+ max);
  done.run(response);
}
