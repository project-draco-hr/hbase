{
  this.env=(RegionCoprocessorEnvironment)env;
  random=new SecureRandom();
  conf=env.getConfiguration();
  baseStagingDir=SecureBulkLoadUtil.getBaseStagingDir(conf);
  try {
    fs=FileSystem.get(conf);
    fs.mkdirs(baseStagingDir,PERM_HIDDEN);
    fs.setPermission(baseStagingDir,PERM_HIDDEN);
    fs.mkdirs(new Path(baseStagingDir,"DONOTERASE"),PERM_HIDDEN);
    FileStatus status=fs.getFileStatus(baseStagingDir);
    if (status == null) {
      throw new IllegalStateException("Failed to create staging directory");
    }
    if (!status.getPermission().equals(PERM_HIDDEN)) {
      throw new IllegalStateException("Directory already exists but permissions aren't set to '-rwx--x--x' ");
    }
  }
 catch (  IOException e) {
    throw new IllegalStateException("Failed to get FileSystem instance",e);
  }
}
