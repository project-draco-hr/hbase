{
  InputStream is=in.markSupported() ? in : new BufferedInputStream(in);
  int pblen=ProtobufUtil.lengthOfPBMagic();
  is.mark(pblen);
  byte[] pbuf=new byte[pblen];
  int read=is.read(pbuf);
  if (read != pblen)   throw new IOException("read=" + read + ", wanted="+ pblen);
  if (ProtobufUtil.isPBMagicPrefix(pbuf)) {
    return convert(HBaseProtos.RegionInfo.parseDelimitedFrom(is));
  }
 else {
    in.reset();
    HRegionInfo hri=new HRegionInfo();
    hri.readFields(in);
    return hri;
  }
}
