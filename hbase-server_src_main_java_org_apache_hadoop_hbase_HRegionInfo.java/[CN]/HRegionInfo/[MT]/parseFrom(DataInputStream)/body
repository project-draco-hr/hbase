{
  int pblen=ProtobufUtil.lengthOfPBMagic();
  byte[] pbuf=new byte[pblen];
  if (in.markSupported()) {
    in.mark(pblen);
  }
  int read=in.read(pbuf);
  if (read != pblen)   throw new IOException("read=" + read + ", wanted="+ pblen);
  if (ProtobufUtil.isPBMagicPrefix(pbuf)) {
    return convert(HBaseProtos.RegionInfo.parseDelimitedFrom(in));
  }
 else {
    if (in.markSupported()) {
      in.reset();
      HRegionInfo hri=new HRegionInfo();
      hri.readFields(in);
      return hri;
    }
 else {
      ByteArrayInputStream bais=new ByteArrayInputStream(pbuf);
      SequenceInputStream sis=new SequenceInputStream(bais,in);
      HRegionInfo hri=new HRegionInfo();
      hri.readFields(new DataInputStream(sis));
      return hri;
    }
  }
}
