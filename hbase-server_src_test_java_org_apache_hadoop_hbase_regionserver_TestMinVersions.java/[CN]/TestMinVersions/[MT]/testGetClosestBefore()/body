{
  HTableDescriptor htd=createTableDescriptor(getName(),1,1000,1,false);
  HRegion region=createNewHRegion(htd,null,null);
  try {
    long ts=EnvironmentEdgeManager.currentTimeMillis() - 2000;
    Put p=new Put(T1,ts);
    p.add(c0,c0,T1);
    region.put(p);
    p=new Put(T1,ts + 1);
    p.add(c0,c0,T4);
    region.put(p);
    p=new Put(T3,ts);
    p.add(c0,c0,T3);
    region.put(p);
    Result r=region.getClosestRowBefore(T1,c0);
    checkResult(r,c0,T4);
    r=region.getClosestRowBefore(T2,c0);
    checkResult(r,c0,T4);
    region.flushcache();
    region.compactStores(true);
    r=region.getClosestRowBefore(T1,c0);
    checkResult(r,c0,T4);
    r=region.getClosestRowBefore(T2,c0);
    checkResult(r,c0,T4);
  }
  finally {
    region.close();
    region.getLog().closeAndDelete();
  }
}
