{
  HTableDescriptor htd=hbu.createTableDescriptor(name.getMethodName(),2,1000,1,false);
  HRegion region=hbu.createLocalHRegion(htd,null,null);
  final byte[] c1=COLUMNS[1];
  long ts=EnvironmentEdgeManager.currentTimeMillis() - 2000;
  try {
    Put p=new Put(T1,ts - 3);
    p.add(c0,c0,T0);
    p.add(c1,c1,T0);
    region.put(p);
    p=new Put(T1,ts - 2);
    p.add(c0,c0,T1);
    p.add(c1,c1,T1);
    region.put(p);
    p=new Put(T1,ts - 1);
    p.add(c0,c0,T2);
    p.add(c1,c1,T2);
    region.put(p);
    p=new Put(T1,ts);
    p.add(c0,c0,T3);
    p.add(c1,c1,T3);
    region.put(p);
    List<Long> tss=new ArrayList<Long>();
    tss.add(ts - 1);
    tss.add(ts - 2);
    Get g=new Get(T1);
    g.addColumn(c1,c1);
    g.setFilter(new TimestampsFilter(tss));
    g.setMaxVersions();
    Result r=region.get(g);
    checkResult(r,c1,T2,T1);
    g=new Get(T1);
    g.addColumn(c0,c0);
    g.setFilter(new TimestampsFilter(tss));
    g.setMaxVersions();
    r=region.get(g);
    checkResult(r,c0,T2,T1);
    region.flushcache();
    region.compactStores(true);
    g=new Get(T1);
    g.addColumn(c1,c1);
    g.setFilter(new TimestampsFilter(tss));
    g.setMaxVersions();
    r=region.get(g);
    checkResult(r,c1,T2);
    g=new Get(T1);
    g.addColumn(c0,c0);
    g.setFilter(new TimestampsFilter(tss));
    g.setMaxVersions();
    r=region.get(g);
    checkResult(r,c0,T2);
  }
  finally {
    HRegion.closeHRegion(region);
  }
}
