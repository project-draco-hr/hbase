{
  this.assignmentManager.getTableStateManager().setTableState(this.tableName,ZooKeeperProtos.Table.State.ENABLING);
  boolean done=false;
  ServerManager serverManager=((HMaster)this.server).getServerManager();
  List<Pair<HRegionInfo,ServerName>> tableRegionsAndLocations=MetaReader.getTableRegionsAndLocations(this.catalogTracker,tableName,true);
  int countOfRegionsInTable=tableRegionsAndLocations.size();
  Map<HRegionInfo,ServerName> regionsToAssign=regionsToAssignWithServerName(tableRegionsAndLocations);
  if (services != null) {
    List<HRegionInfo> unrecordedReplicas=AssignmentManager.replicaRegionsNotRecordedInMeta(new HashSet<HRegionInfo>(regionsToAssign.keySet()),services);
    for (    HRegionInfo h : unrecordedReplicas) {
      regionsToAssign.put(h,this.assignmentManager.getBalancer().randomAssignment(h,serverManager.getOnlineServersList()));
    }
  }
  int regionsCount=regionsToAssign.size();
  if (regionsCount == 0) {
    done=true;
  }
  LOG.info("Table '" + this.tableName + "' has "+ countOfRegionsInTable+ " regions, of which "+ regionsCount+ " are offline.");
  List<ServerName> onlineServers=serverManager.createDestinationServersList();
  Map<ServerName,List<HRegionInfo>> bulkPlan=this.assignmentManager.getBalancer().retainAssignment(regionsToAssign,onlineServers);
  LOG.info("Bulk assigning " + regionsCount + " region(s) across "+ bulkPlan.size()+ " server(s), retainAssignment=true");
  BulkAssigner ba=new GeneralBulkAssigner(this.server,bulkPlan,this.assignmentManager,true);
  try {
    if (ba.bulkAssign()) {
      done=true;
    }
  }
 catch (  InterruptedException e) {
    LOG.warn("Enable operation was interrupted when enabling table '" + this.tableName + "'");
    Thread.currentThread().interrupt();
  }
  if (done) {
    this.assignmentManager.getTableStateManager().setTableState(this.tableName,ZooKeeperProtos.Table.State.ENABLED);
    LOG.info("Table '" + this.tableName + "' was successfully enabled. Status: done="+ done);
  }
 else {
    LOG.warn("Table '" + this.tableName + "' wasn't successfully enabled. Status: done="+ done);
  }
}
