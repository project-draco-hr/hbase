{
  AccessControlProtos.Permission.Builder ret=AccessControlProtos.Permission.newBuilder();
  if (perm instanceof TablePermission) {
    TablePermission tablePerm=(TablePermission)perm;
    if (tablePerm.hasNamespace()) {
      ret.setType(AccessControlProtos.Permission.Type.Namespace);
      AccessControlProtos.NamespacePermission.Builder builder=AccessControlProtos.NamespacePermission.newBuilder();
      builder.setNamespaceName(ByteString.copyFromUtf8(tablePerm.getNamespace()));
      for (      Permission.Action a : perm.getActions()) {
        builder.addAction(toPermissionAction(a));
      }
      ret.setNamespacePermission(builder);
    }
 else     if (tablePerm.hasTable()) {
      ret.setType(AccessControlProtos.Permission.Type.Table);
      AccessControlProtos.TablePermission.Builder builder=AccessControlProtos.TablePermission.newBuilder();
      builder.setTableName(ProtobufUtil.toProtoTableName(tablePerm.getTableName()));
      if (tablePerm.hasFamily()) {
        builder.setFamily(ByteString.copyFrom(tablePerm.getFamily()));
      }
      if (tablePerm.hasQualifier()) {
        builder.setQualifier(ByteString.copyFrom(tablePerm.getQualifier()));
      }
      for (      Permission.Action a : perm.getActions()) {
        builder.addAction(toPermissionAction(a));
      }
      ret.setTablePermission(builder);
    }
  }
 else {
    ret.setType(AccessControlProtos.Permission.Type.Global);
    AccessControlProtos.GlobalPermission.Builder builder=AccessControlProtos.GlobalPermission.newBuilder();
    for (    Permission.Action a : perm.getActions()) {
      builder.addAction(toPermissionAction(a));
    }
    ret.setGlobalPermission(builder);
  }
  return ret.build();
}
