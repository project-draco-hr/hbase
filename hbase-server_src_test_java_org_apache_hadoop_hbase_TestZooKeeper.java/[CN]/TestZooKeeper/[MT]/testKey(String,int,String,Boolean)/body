{
  Configuration conf=new Configuration();
  String key=ensemble + ":" + port+ ":"+ znode;
  String ensemble2=null;
  ZKUtil.ZKClusterKey zkClusterKey=ZKUtil.transformClusterKey(key);
  if (multiplePortSupport) {
    ensemble2=ZKUtil.standardizeQuorumServerString(ensemble,Integer.toString(port));
    assertEquals(ensemble2,zkClusterKey.quorumString);
  }
 else {
    assertEquals(ensemble,zkClusterKey.quorumString);
  }
  assertEquals(port,zkClusterKey.clientPort);
  assertEquals(znode,zkClusterKey.znodeParent);
  ZKUtil.applyClusterKeyToConf(conf,key);
  assertEquals(zkClusterKey.quorumString,conf.get(HConstants.ZOOKEEPER_QUORUM));
  assertEquals(zkClusterKey.clientPort,conf.getInt(HConstants.ZOOKEEPER_CLIENT_PORT,-1));
  assertEquals(zkClusterKey.znodeParent,conf.get(HConstants.ZOOKEEPER_ZNODE_PARENT));
  String reconstructedKey=ZKUtil.getZooKeeperClusterKey(conf);
  if (multiplePortSupport) {
    String key2=ensemble2 + ":" + port+ ":"+ znode;
    assertEquals(key2,reconstructedKey);
  }
 else {
    assertEquals(key,reconstructedKey);
  }
}
