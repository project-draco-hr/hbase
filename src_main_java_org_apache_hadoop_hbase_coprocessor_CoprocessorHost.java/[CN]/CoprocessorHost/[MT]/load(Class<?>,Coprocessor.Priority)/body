{
  Coprocessor impl;
  Object o=null;
  try {
    o=implClass.newInstance();
    impl=(Coprocessor)o;
  }
 catch (  InstantiationException e) {
    throw new IOException(e);
  }
catch (  IllegalAccessException e) {
    throw new IOException(e);
  }
  E env=createEnvironment(implClass,impl,priority);
  if (env instanceof Environment) {
    ((Environment)env).startup();
  }
  try {
    coprocessorLock.writeLock().lock();
    coprocessors.add(env);
  }
  finally {
    coprocessorLock.writeLock().unlock();
  }
}
