{
  if (bloomKey == null)   throw new NullPointerException();
  enqueueReadyChunk(false);
  if (chunk == null) {
    if (firstKeyInChunk != null) {
      throw new IllegalStateException("First key in chunk already set: " + Bytes.toStringBinary(firstKeyInChunk));
    }
    firstKeyInChunk=Arrays.copyOfRange(bloomKey,keyOffset,keyOffset + keyLength);
    if (prevChunk == null) {
      chunk=ByteBloomFilter.createBySize(chunkByteSize,errorRate,hashType,maxFold);
    }
 else {
      chunk=prevChunk.createAnother();
    }
    if (chunk.getKeyCount() != 0) {
      throw new IllegalStateException("keyCount=" + chunk.getKeyCount() + " > 0");
    }
    chunk.allocBloom();
    ++numChunks;
  }
  chunk.add(bloomKey,keyOffset,keyLength);
  ++totalKeyCount;
}
