{
  Path rootDir=FSUtils.getRootDir(conf);
  FileSystem fs=FileSystem.get(rootDir.toUri(),conf);
  Path snapshotDir=SnapshotDescriptionUtils.getCompletedSnapshotDir(snapshot,rootDir);
  SnapshotManifest manifest=SnapshotManifest.open(conf,fs,snapshotDir,snapshot);
  final SnapshotStats stats=new SnapshotStats(conf,fs,snapshot);
  SnapshotReferenceUtil.concurrentVisitReferencedFiles(conf,fs,manifest,new SnapshotReferenceUtil.SnapshotVisitor(){
    @Override public void storeFile(    final HRegionInfo regionInfo,    final String family,    final SnapshotRegionManifest.StoreFile storeFile) throws IOException {
      if (!storeFile.hasReference()) {
        stats.addStoreFile(regionInfo,family,storeFile);
      }
    }
    @Override public void logFile(    final String server,    final String logfile) throws IOException {
      stats.addLogFile(server,logfile);
    }
  }
);
  return stats;
}
