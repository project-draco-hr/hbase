{
  TEST_UTIL=new HBaseTestingUtility();
  TEST_UTIL.startMiniZKCluster();
  conf=TEST_UTIL.getConfiguration();
  zkw=new ZooKeeperWatcher(conf,"split-log-manager-tests" + UUID.randomUUID().toString(),null);
  ds=new DummyServer(zkw,conf);
  ZKUtil.deleteChildrenRecursively(zkw,zkw.baseZNode);
  ZKUtil.createAndFailSilent(zkw,zkw.baseZNode);
  assertTrue(ZKUtil.checkExists(zkw,zkw.baseZNode) != -1);
  LOG.debug(zkw.baseZNode + " created");
  ZKUtil.createAndFailSilent(zkw,zkw.splitLogZNode);
  assertTrue(ZKUtil.checkExists(zkw,zkw.splitLogZNode) != -1);
  LOG.debug(zkw.splitLogZNode + " created");
  stopped=false;
  resetCounters();
  Mockito.when(sm.isServerOnline(Mockito.any(ServerName.class))).thenReturn(true);
  Mockito.when(master.getServerManager()).thenReturn(sm);
  to=12000;
  conf.setInt(HConstants.HBASE_SPLITLOG_MANAGER_TIMEOUT,to);
  conf.setInt("hbase.splitlog.manager.unassigned.timeout",2 * to);
  conf.setInt("hbase.splitlog.manager.timeoutmonitor.period",100);
  to=to + 16 * 100;
  this.mode=(conf.getBoolean(HConstants.DISTRIBUTED_LOG_REPLAY_KEY,false) ? RecoveryMode.LOG_REPLAY : RecoveryMode.LOG_SPLITTING);
}
