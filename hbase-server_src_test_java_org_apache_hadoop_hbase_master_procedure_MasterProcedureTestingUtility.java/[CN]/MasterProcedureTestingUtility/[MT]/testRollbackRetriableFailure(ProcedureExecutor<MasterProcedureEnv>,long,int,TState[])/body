{
  ProcedureTestingUtility.waitProcedure(procExec,procId);
  for (int i=0; i < lastStep; ++i) {
    LOG.info("Restart " + i + " exec state: "+ states[i]);
    ProcedureTestingUtility.assertProcNotYetCompleted(procExec,procId);
    ProcedureTestingUtility.restart(procExec);
    ProcedureTestingUtility.waitProcedure(procExec,procId);
  }
  ProcedureTestingUtility.setKillAndToggleBeforeStoreUpdate(procExec,false);
  InjectAbortOnLoadListener abortListener=new InjectAbortOnLoadListener(procExec);
  procExec.registerListener(abortListener);
  try {
    ProcedureTestingUtility.assertProcNotYetCompleted(procExec,procId);
    ProcedureTestingUtility.restart(procExec);
    LOG.info("Restart and rollback");
    ProcedureTestingUtility.waitProcedure(procExec,procId);
  }
  finally {
    assertTrue(procExec.unregisterListener(abortListener));
  }
  ProcedureTestingUtility.assertIsAbortException(procExec.getResult(procId));
}
