{
  long start=System.currentTimeMillis();
  log("blocking until region is split:" + Bytes.toStringBinary(regionName));
  HRegionInfo daughterA=null, daughterB=null;
  Table metaTable=new HTable(conf,TableName.META_TABLE_NAME);
  try {
    Result result=null;
    HRegionInfo region=null;
    while ((System.currentTimeMillis() - start) < timeout) {
      result=getRegionRow(metaTable,regionName);
      if (result == null) {
        break;
      }
      region=HRegionInfo.getHRegionInfo(result);
      if (region.isSplitParent()) {
        log("found parent region: " + region.toString());
        PairOfSameType<HRegionInfo> pair=HRegionInfo.getDaughterRegions(result);
        daughterA=pair.getFirst();
        daughterB=pair.getSecond();
        break;
      }
      Threads.sleep(100);
    }
    if (daughterA == null || daughterB == null) {
      throw new IOException("Failed to get daughters, daughterA=" + daughterA + ", daughterB="+ daughterB+ ", timeout="+ timeout+ ", result="+ result+ ", regionName="+ regionName+ ", region="+ region);
    }
    if (waitForDaughters) {
      long rem=timeout - (System.currentTimeMillis() - start);
      blockUntilRegionIsInMeta(metaTable,rem,daughterA);
      rem=timeout - (System.currentTimeMillis() - start);
      blockUntilRegionIsInMeta(metaTable,rem,daughterB);
      rem=timeout - (System.currentTimeMillis() - start);
      blockUntilRegionIsOpened(conf,rem,daughterA);
      rem=timeout - (System.currentTimeMillis() - start);
      blockUntilRegionIsOpened(conf,rem,daughterB);
    }
  }
  finally {
    IOUtils.closeQuietly(metaTable);
  }
}
