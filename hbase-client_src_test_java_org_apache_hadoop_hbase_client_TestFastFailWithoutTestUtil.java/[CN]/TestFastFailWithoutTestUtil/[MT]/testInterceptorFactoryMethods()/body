{
  Configuration conf=HBaseConfiguration.create();
  conf.setBoolean(HConstants.HBASE_CLIENT_FAST_FAIL_MODE_ENABLED,true);
  RetryingCallerInterceptorFactory interceptorFactory=new RetryingCallerInterceptorFactory(conf);
  RetryingCallerInterceptor interceptorBeforeCast=interceptorFactory.build();
  assertTrue("We should be getting a PreemptiveFastFailInterceptor",interceptorBeforeCast instanceof PreemptiveFastFailInterceptor);
  PreemptiveFastFailInterceptor interceptor=(PreemptiveFastFailInterceptor)interceptorBeforeCast;
  RetryingCallerInterceptorContext contextBeforeCast=interceptor.createEmptyContext();
  assertTrue("We should be getting a FastFailInterceptorContext since we are interacting with the" + " PreemptiveFastFailInterceptor",contextBeforeCast instanceof FastFailInterceptorContext);
  FastFailInterceptorContext context=(FastFailInterceptorContext)contextBeforeCast;
  assertTrue(context != null);
  conf=HBaseConfiguration.create();
  interceptorFactory=new RetryingCallerInterceptorFactory(conf);
  interceptorBeforeCast=interceptorFactory.build();
  assertTrue("We should be getting a NoOpRetryableCallerInterceptor since we disabled PFFE",interceptorBeforeCast instanceof NoOpRetryableCallerInterceptor);
  contextBeforeCast=interceptorBeforeCast.createEmptyContext();
  assertTrue("We should be getting a NoOpRetryingInterceptorContext from NoOpRetryableCallerInterceptor",contextBeforeCast instanceof NoOpRetryingInterceptorContext);
  assertTrue(context != null);
}
