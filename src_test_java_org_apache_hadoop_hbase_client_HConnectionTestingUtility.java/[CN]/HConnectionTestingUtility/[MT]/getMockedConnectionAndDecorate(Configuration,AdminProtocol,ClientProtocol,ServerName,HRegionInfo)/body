{
  HConnection c=HConnectionTestingUtility.getMockedConnection(conf);
  Mockito.doNothing().when(c).close();
  final HRegionLocation loc=new HRegionLocation(hri,sn.getHostname(),sn.getPort());
  Mockito.when(c.getRegionLocation((byte[])Mockito.any(),(byte[])Mockito.any(),Mockito.anyBoolean())).thenReturn(loc);
  Mockito.when(c.locateRegion((byte[])Mockito.any(),(byte[])Mockito.any())).thenReturn(loc);
  if (admin != null) {
    Mockito.when(c.getAdmin(Mockito.anyString(),Mockito.anyInt())).thenReturn(admin);
  }
  if (client != null) {
    Mockito.when(c.getClient(Mockito.anyString(),Mockito.anyInt())).thenReturn(client);
  }
  return c;
}
