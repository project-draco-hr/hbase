{
  int endOffset=offset + length;
  while (offset < endOffset) {
    byte status=(byte)src.read();
    if (status == Dictionary.NOT_IN_DICTIONARY) {
      short tagLen=(short)StreamUtils.readRawVarint32(src);
      offset=Bytes.putShort(dest,offset,tagLen);
      IOUtils.readFully(src,dest,offset,tagLen);
      tagDict.addEntry(dest,offset,tagLen);
      offset+=tagLen;
    }
 else {
      short dictIdx=StreamUtils.toShort(status,(byte)src.read());
      byte[] entry=tagDict.getEntry(dictIdx);
      if (entry == null) {
        throw new IOException("Missing dictionary entry for index " + dictIdx);
      }
      offset=Bytes.putShort(dest,offset,(short)entry.length);
      System.arraycopy(entry,0,dest,offset,entry.length);
      offset+=entry.length;
    }
  }
}
