{
  HLog wal=HLogFactory.createHLog(FS,DIR,"hlogdir","hlogdir_archive",CONF);
  byte[] tableName=Bytes.toBytes("TestDurability");
  HRegion region=createHRegion(tableName,"region",wal,Durability.USE_DEFAULT);
  HRegion deferredRegion=createHRegion(tableName,"deferredRegion",wal,Durability.ASYNC_WAL);
  region.put(newPut(null));
  verifyHLogCount(wal,1);
  deferredRegion.put(newPut(null));
  wal.sync();
  verifyHLogCount(wal,2);
  deferredRegion.put(newPut(null));
  wal.sync();
  verifyHLogCount(wal,3);
  region.put(newPut(null));
  verifyHLogCount(wal,4);
  deferredRegion.put(newPut(Durability.USE_DEFAULT));
  wal.sync();
  verifyHLogCount(wal,5);
  region.put(newPut(Durability.USE_DEFAULT));
  verifyHLogCount(wal,6);
  region.put(newPut(Durability.SKIP_WAL));
  deferredRegion.put(newPut(Durability.SKIP_WAL));
  verifyHLogCount(wal,6);
  wal.sync();
  verifyHLogCount(wal,6);
  region.put(newPut(Durability.ASYNC_WAL));
  deferredRegion.put(newPut(Durability.ASYNC_WAL));
  wal.sync();
  verifyHLogCount(wal,8);
  region.put(newPut(Durability.SYNC_WAL));
  deferredRegion.put(newPut(Durability.SYNC_WAL));
  verifyHLogCount(wal,10);
  region.put(newPut(Durability.FSYNC_WAL));
  deferredRegion.put(newPut(Durability.FSYNC_WAL));
  verifyHLogCount(wal,12);
}
