{
  setupCluster();
  TableName tableName=TableName.valueOf("testWithMockedMapReduce");
  try {
    createTableAndSnapshot(util,tableName,snapshotName,numRegions);
    Job job=new Job(util.getConfiguration());
    Path tmpTableDir=util.getDataTestDirOnTestFS(snapshotName);
    Scan scan=new Scan(bbb,yyy);
    TableMapReduceUtil.initTableSnapshotMapperJob(snapshotName,scan,TestTableSnapshotMapper.class,ImmutableBytesWritable.class,NullWritable.class,job,false,tmpTableDir);
    verifyWithMockedMapReduce(job,numRegions,expectedNumSplits,bbb,yyy);
  }
  finally {
    util.getHBaseAdmin().deleteSnapshot(snapshotName);
    util.deleteTable(tableName);
    tearDownCluster();
  }
}
