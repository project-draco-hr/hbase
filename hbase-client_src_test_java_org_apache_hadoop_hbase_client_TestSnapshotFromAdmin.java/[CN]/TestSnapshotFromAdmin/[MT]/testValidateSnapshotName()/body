{
  HConnectionManager.HConnectionImplementation mockConnection=Mockito.mock(HConnectionManager.HConnectionImplementation.class);
  Configuration conf=HBaseConfiguration.create();
  Mockito.when(mockConnection.getConfiguration()).thenReturn(conf);
  HBaseAdmin admin=new HBaseAdmin(mockConnection);
  SnapshotDescription.Builder builder=SnapshotDescription.newBuilder();
  failSnapshotStart(admin,builder.setName(HConstants.SNAPSHOT_DIR_NAME).build());
  failSnapshotStart(admin,builder.setName("-snapshot").build());
  failSnapshotStart(admin,builder.setName("snapshot fails").build());
  failSnapshotStart(admin,builder.setName("snap$hot").build());
  failSnapshotStart(admin,builder.setName("snap:hot").build());
  failSnapshotStart(admin,builder.setName("snapshot").setTable(".table").build());
  failSnapshotStart(admin,builder.setName("snapshot").setTable("-table").build());
  failSnapshotStart(admin,builder.setName("snapshot").setTable("table fails").build());
  failSnapshotStart(admin,builder.setName("snapshot").setTable("tab%le").build());
  MasterAdminKeepAliveConnection master=Mockito.mock(MasterAdminKeepAliveConnection.class);
  Mockito.when(mockConnection.getKeepAliveMasterAdminService()).thenReturn(master);
  SnapshotResponse response=SnapshotResponse.newBuilder().setExpectedTimeout(0).build();
  Mockito.when(master.snapshot((RpcController)Mockito.isNull(),Mockito.any(SnapshotRequest.class))).thenReturn(response);
  IsSnapshotDoneResponse doneResponse=IsSnapshotDoneResponse.newBuilder().setDone(true).build();
  Mockito.when(master.isSnapshotDone((RpcController)Mockito.isNull(),Mockito.any(IsSnapshotDoneRequest.class))).thenReturn(doneResponse);
  admin.snapshot(builder.setName("snapshot").setTable("table").build());
}
