{
  FileSystem fs=fileSystemManager.getFileSystem();
  Path rootDir=fileSystemManager.getRootDir();
  Path tableDir=HTableDescriptor.getTableDir(rootDir,Bytes.toBytes(tableName));
  try {
    Path snapshotDir=SnapshotDescriptionUtils.getCompletedSnapshotDir(snapshot,rootDir);
    RestoreSnapshotHelper restoreHelper=new RestoreSnapshotHelper(conf,fs,catalogTracker,snapshot,snapshotDir,hTableDescriptor,tableDir,monitor);
    restoreHelper.restore();
    LOG.info("Clone snapshot=" + snapshot.getName() + " on table="+ tableName+ " completed!");
    return MetaReader.getTableRegions(catalogTracker,Bytes.toBytes(tableName));
  }
 catch (  Exception e) {
    String msg="clone snapshot=" + snapshot + " failed";
    LOG.error(msg,e);
    IOException rse=new RestoreSnapshotException(msg,e);
    this.monitor.receive(new ForeignException(NAME,rse));
    throw rse;
  }
 finally {
    this.stopped=true;
  }
}
