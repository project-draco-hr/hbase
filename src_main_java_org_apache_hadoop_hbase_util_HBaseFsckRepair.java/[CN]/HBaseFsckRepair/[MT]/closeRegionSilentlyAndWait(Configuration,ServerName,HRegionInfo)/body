{
  HConnection connection=HConnectionManager.getConnection(conf);
  boolean success=false;
  try {
    HRegionInterface rs=connection.getHRegionConnection(server.getHostname(),server.getPort());
    rs.closeRegion(region,false);
    long timeout=conf.getLong("hbase.hbck.close.timeout",120000);
    long expiration=timeout + System.currentTimeMillis();
    while (System.currentTimeMillis() < expiration) {
      try {
        HRegionInfo rsRegion=rs.getRegionInfo(region.getRegionName());
        if (rsRegion == null)         throw new NotServingRegionException();
      }
 catch (      Exception e) {
        success=true;
        return;
      }
      Thread.sleep(1000);
    }
    throw new IOException("Region " + region + " failed to close within"+ " timeout "+ timeout);
  }
  finally {
    try {
      connection.close();
    }
 catch (    IOException ioe) {
      if (success) {
        throw ioe;
      }
    }
  }
}
