{
  Path testdir=UTIL.getDataTestDir("testCreateTableDescriptorUpdatesIfThereExistsAlready");
  HTableDescriptor htd=new HTableDescriptor(TableName.valueOf("testCreateTableDescriptorUpdatesIfThereExistsAlready"));
  TableDescriptor td=new TableDescriptor(htd,TableState.State.ENABLED);
  FileSystem fs=FileSystem.get(UTIL.getConfiguration());
  FSTableDescriptors fstd=new FSTableDescriptors(fs,testdir);
  assertTrue(fstd.createTableDescriptor(td));
  assertFalse(fstd.createTableDescriptor(td));
  htd.setValue(Bytes.toBytes("mykey"),Bytes.toBytes("myValue"));
  assertTrue(fstd.createTableDescriptor(td));
  Path tableDir=fstd.getTableDir(htd.getTableName());
  Path tmpTableDir=new Path(tableDir,FSTableDescriptors.TMP_DIR);
  FileStatus[] statuses=fs.listStatus(tmpTableDir);
  assertTrue(statuses.length == 0);
  assertEquals(td,FSTableDescriptors.getTableDescriptorFromFs(fs,tableDir));
}
