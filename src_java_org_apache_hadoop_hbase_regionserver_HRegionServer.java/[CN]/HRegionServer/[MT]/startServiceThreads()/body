{
  String n=Thread.currentThread().getName();
  UncaughtExceptionHandler handler=new UncaughtExceptionHandler(){
    public void uncaughtException(    Thread t,    Throwable e){
      abort();
      LOG.fatal("Set stop flag in " + t.getName(),e);
    }
  }
;
  Threads.setDaemonThreadRunning(this.hlogRoller,n + ".logRoller",handler);
  Threads.setDaemonThreadRunning(this.hlogFlusher,n + ".logFlusher",handler);
  Threads.setDaemonThreadRunning(this.cacheFlusher,n + ".cacheFlusher",handler);
  Threads.setDaemonThreadRunning(this.compactSplitThread,n + ".compactor",handler);
  Threads.setDaemonThreadRunning(this.workerThread,n + ".worker",handler);
  Threads.setDaemonThreadRunning(this.majorCompactionChecker,n + ".majorCompactionChecker",handler);
  this.leases.setName(n + ".leaseChecker");
  this.leases.start();
  int port=this.conf.getInt("hbase.regionserver.info.port",60030);
  if (port >= 0) {
    String addr=this.conf.get("hbase.regionserver.info.bindAddress","0.0.0.0");
    boolean auto=this.conf.getBoolean("hbase.regionserver.info.port.auto",false);
    while (true) {
      try {
        this.infoServer=new InfoServer("regionserver",addr,port,false);
        this.infoServer.setAttribute("regionserver",this);
        this.infoServer.start();
        break;
      }
 catch (      BindException e) {
        if (!auto) {
          throw e;
        }
        LOG.info("Failed binding http info server to port: " + port);
        port++;
        this.serverInfo.setInfoPort(port);
      }
    }
  }
  if (!conf.getBoolean("hbase.regionserver.safemode",true)) {
    safeMode.set(false);
    compactSplitThread.setLimit(-1);
    LOG.debug("skipping safe mode");
  }
 else {
    this.compactionLimitThread=new CompactionLimitThread();
    Threads.setDaemonThreadRunning(this.compactionLimitThread,n + ".safeMode",handler);
  }
  this.server.start();
  LOG.info("HRegionServer started at: " + this.serverInfo.getServerAddress().toString());
}
