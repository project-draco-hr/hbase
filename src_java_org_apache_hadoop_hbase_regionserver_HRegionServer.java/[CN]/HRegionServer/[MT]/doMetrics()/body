{
  this.metrics.regions.set(this.onlineRegions.size());
  this.metrics.incrementRequests(this.requestCount.get());
  int storefiles=0;
  long memcacheSize=0;
synchronized (this.onlineRegions) {
    for (    Map.Entry<Integer,HRegion> e : this.onlineRegions.entrySet()) {
      HRegion r=e.getValue();
      memcacheSize+=r.memcacheSize.get();
synchronized (r.stores) {
        for (        Map.Entry<Integer,HStore> ee : r.stores.entrySet()) {
          storefiles+=ee.getValue().getStorefilesCount();
        }
      }
    }
  }
  this.metrics.storefiles.set(storefiles);
  this.metrics.memcacheSizeMB.set((int)(memcacheSize / (1024 * 1024)));
}
