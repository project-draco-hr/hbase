{
  ArrayList<HRegion> regionsToClose=new ArrayList<HRegion>();
  this.lock.writeLock().lock();
  try {
    regionsToClose.addAll(onlineRegions.values());
    onlineRegions.clear();
  }
  finally {
    this.lock.writeLock().unlock();
  }
  for (  Map.Entry<String,InternalScanner> e : this.scanners.entrySet()) {
    try {
      e.getValue().close();
    }
 catch (    IOException ioe) {
      LOG.warn("Closing scanner " + e.getKey(),ioe);
    }
  }
  for (  HRegion region : regionsToClose) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("closing region " + Bytes.toString(region.getRegionName()));
    }
    try {
      region.close(abortRequested);
    }
 catch (    Throwable e) {
      cleanup(e,"Error closing " + Bytes.toString(region.getRegionName()));
    }
  }
  return regionsToClose;
}
