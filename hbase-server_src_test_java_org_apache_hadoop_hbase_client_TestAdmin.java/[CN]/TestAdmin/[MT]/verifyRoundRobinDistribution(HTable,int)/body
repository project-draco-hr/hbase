{
  int numRS=ht.getConnection().getCurrentNrHRS();
  Map<HRegionInfo,ServerName> regions=ht.getRegionLocations();
  Map<ServerName,List<HRegionInfo>> server2Regions=new HashMap<ServerName,List<HRegionInfo>>();
  for (  Map.Entry<HRegionInfo,ServerName> entry : regions.entrySet()) {
    ServerName server=entry.getValue();
    List<HRegionInfo> regs=server2Regions.get(server);
    if (regs == null) {
      regs=new ArrayList<HRegionInfo>();
      server2Regions.put(server,regs);
    }
    regs.add(entry.getKey());
  }
  if (numRS >= 2) {
    numRS--;
  }
  float average=(float)expectedRegions / numRS;
  int min=(int)Math.floor(average);
  int max=(int)Math.ceil(average);
  for (  List<HRegionInfo> regionList : server2Regions.values()) {
    assertTrue(regionList.size() == min || regionList.size() == max);
  }
}
