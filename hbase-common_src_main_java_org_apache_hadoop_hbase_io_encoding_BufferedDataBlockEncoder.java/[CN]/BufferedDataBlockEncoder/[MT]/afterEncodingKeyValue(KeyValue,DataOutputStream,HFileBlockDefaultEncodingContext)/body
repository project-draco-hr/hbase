{
  int size=0;
  if (encodingCtx.getHFileContext().isIncludesTags()) {
    short tagsLength=kv.getTagsLength();
    ByteBufferUtils.putCompressedInt(out,tagsLength);
    if (tagsLength > 0) {
      TagCompressionContext tagCompressionContext=encodingCtx.getTagCompressionContext();
      if (tagCompressionContext != null) {
        tagCompressionContext.compressTags(out,kv.getTagsArray(),kv.getTagsOffset(),tagsLength);
      }
 else {
        out.write(kv.getTagsArray(),kv.getTagsOffset(),tagsLength);
      }
    }
    size+=tagsLength + KeyValue.TAGS_LENGTH_SIZE;
  }
  if (encodingCtx.getHFileContext().isIncludesMvcc()) {
    long memstoreTS=kv.getMvccVersion();
    WritableUtils.writeVLong(out,memstoreTS);
    size+=WritableUtils.getVIntSize(memstoreTS);
  }
  return size;
}
