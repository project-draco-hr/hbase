{
  StripeStoreFileManager manager=createManager();
  StoreFile sf_L0_0a=createFile(), sf_L0_0b=createFile();
  manager.insertNewFiles(al(sf_L0_0a,sf_L0_0b));
  verifyInvalidCompactionScenario(manager,al(sf_L0_0a),al(createFile(OPEN_KEY,KEY_B)));
  verifyInvalidCompactionScenario(manager,al(sf_L0_0a),al(createFile(OPEN_KEY,KEY_B),createFile(KEY_C,OPEN_KEY)));
  verifyInvalidCompactionScenario(manager,al(sf_L0_0a),al(createFile(OPEN_KEY,KEY_B),createFile(KEY_B,OPEN_KEY),createFile(KEY_A,KEY_D)));
  verifyInvalidCompactionScenario(manager,al(sf_L0_0a),al(createFile(OPEN_KEY,KEY_B),createFile(KEY_A,KEY_B),createFile(KEY_B,OPEN_KEY)));
  StoreFile sf_i2B_0=createFile(OPEN_KEY,KEY_B);
  StoreFile sf_B2C_0=createFile(KEY_B,KEY_C);
  StoreFile sf_C2i_0=createFile(KEY_C,OPEN_KEY);
  manager.addCompactionResults(al(sf_L0_0a),al(sf_i2B_0,sf_B2C_0,sf_C2i_0));
  verifyAllFiles(manager,al(sf_L0_0b,sf_i2B_0,sf_B2C_0,sf_C2i_0));
  StoreFile sf_L0_1=createFile();
  StoreFile sf_i2B_1=createFile(OPEN_KEY,KEY_B);
  StoreFile sf_B2C_1=createFile(KEY_B,KEY_C);
  manager.insertNewFiles(al(sf_L0_1));
  manager.addCompactionResults(al(sf_L0_0b,sf_L0_1),al(sf_i2B_1,sf_B2C_1));
  verifyAllFiles(manager,al(sf_i2B_0,sf_B2C_0,sf_C2i_0,sf_i2B_1,sf_B2C_1));
  StoreFile sf_L0_2=createFile(null,null);
  manager.addCompactionResults(al(),al(sf_L0_2));
  verifyAllFiles(manager,al(sf_i2B_0,sf_B2C_0,sf_C2i_0,sf_i2B_1,sf_B2C_1,sf_L0_2));
  manager.addCompactionResults(al(sf_L0_2),al());
  StoreFile sf_i2B_3=createFile(OPEN_KEY,KEY_B);
  manager.addCompactionResults(al(sf_i2B_0,sf_i2B_1),al(sf_i2B_3));
  verifyAllFiles(manager,al(sf_B2C_0,sf_C2i_0,sf_B2C_1,sf_i2B_3));
  StoreFile sf_B2D_4=createFile(KEY_B,KEY_D);
  StoreFile sf_D2i_4=createFile(KEY_D,OPEN_KEY);
  manager.addCompactionResults(al(sf_B2C_0,sf_C2i_0,sf_B2C_1),al(sf_B2D_4,sf_D2i_4));
  verifyAllFiles(manager,al(sf_i2B_3,sf_B2D_4,sf_D2i_4));
  StoreFile sf_i2A_5=createFile(OPEN_KEY,KEY_A);
  StoreFile sf_A2B_5=createFile(KEY_A,KEY_B);
  manager.addCompactionResults(al(sf_i2B_3),al(sf_i2A_5,sf_A2B_5));
  verifyAllFiles(manager,al(sf_B2D_4,sf_D2i_4,sf_i2A_5,sf_A2B_5));
  StoreFile sf_B2C_6=createFile(KEY_B,KEY_C);
  StoreFile sf_C2D_6=createFile(KEY_C,KEY_D);
  manager.addCompactionResults(al(sf_B2D_4),al(sf_B2C_6,sf_C2D_6));
  verifyAllFiles(manager,al(sf_D2i_4,sf_i2A_5,sf_A2B_5,sf_B2C_6,sf_C2D_6));
  StoreFile sf_A2C_7=createFile(KEY_A,KEY_C);
  manager.addCompactionResults(al(sf_A2B_5,sf_B2C_6),al(sf_A2C_7));
  verifyAllFiles(manager,al(sf_D2i_4,sf_i2A_5,sf_C2D_6,sf_A2C_7));
  StoreFile sf_i2C_8=createFile(OPEN_KEY,KEY_C);
  manager.addCompactionResults(al(sf_i2A_5,sf_A2C_7),al(sf_i2C_8));
  verifyAllFiles(manager,al(sf_D2i_4,sf_C2D_6,sf_i2C_8));
  StoreFile sf_i2i_9=createFile(OPEN_KEY,OPEN_KEY);
  manager.addCompactionResults(al(sf_D2i_4,sf_C2D_6,sf_i2C_8),al(sf_i2i_9));
  verifyAllFiles(manager,al(sf_i2i_9));
}
