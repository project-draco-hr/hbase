{
  if (!ensureParentExists(clusterStateZNode)) {
    return false;
  }
  try {
    if (up) {
      byte[] data=Bytes.toBytes("up");
      zooKeeper.create(clusterStateZNode,data,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      LOG.debug("<" + instanceName + ">"+ "State node wrote in ZooKeeper");
    }
 else {
      zooKeeper.delete(clusterStateZNode,-1);
      LOG.debug("<" + instanceName + ">"+ "State node deleted in ZooKeeper");
    }
    return true;
  }
 catch (  InterruptedException e) {
    LOG.warn("<" + instanceName + ">"+ "Failed to set state node in ZooKeeper",e);
  }
catch (  KeeperException e) {
    if (e.code() == KeeperException.Code.NODEEXISTS) {
      LOG.debug("<" + instanceName + ">"+ "State node exists.");
    }
 else {
      LOG.warn("<" + instanceName + ">"+ "Failed to set state node in ZooKeeper",e);
    }
  }
  return false;
}
