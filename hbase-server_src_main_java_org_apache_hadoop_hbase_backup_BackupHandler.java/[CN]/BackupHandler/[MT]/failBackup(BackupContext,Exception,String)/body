{
  LOG.error(msg + getMessage(e));
  if (this.backupContext.getFlag().equals(BACKUPSTATUS.CANCELLED)) {
    return;
  }
  backupContext.setEndTs(EnvironmentEdgeManager.currentTime());
  backupContext.setFailedMsg(e.getMessage());
  backupContext.setFlag(BACKUPSTATUS.FAILED);
  String backupFailedData="BackupId=" + backupContext.getBackupId() + ",startts="+ backupContext.getStartTs()+ ",failedts="+ backupContext.getEndTs()+ ",failedphase="+ backupContext.getPhase()+ ",failedmessage="+ backupContext.getFailedMsg();
  LOG.error(backupFailedData);
  backupManager.updateBackupStatus(backupContext);
  if (backupContext.getType().equals(BackupRestoreConstants.BACKUP_TYPE_FULL)) {
    if (!backupContext.fromExistingSnapshot()) {
      this.deleteSnapshot(backupContext);
    }
    this.cleanupExportSnapshotLog();
  }
  this.cleanupTargetDir();
  LOG.info("Backup " + backupContext.getBackupId() + " failed.");
}
