{
  int klength=kv.getKeyLength();
  int vlength=kv.getValueLength();
  out.writeInt(klength);
  out.writeInt(vlength);
  out.write(kv.getBuffer(),kv.getKeyOffset(),klength);
  out.write(kv.getValueArray(),kv.getValueOffset(),vlength);
  int encodedKvSize=klength + vlength + KeyValue.KEYVALUE_INFRASTRUCTURE_SIZE;
  if (encodingCtx.getHFileContext().isIncludesTags()) {
    short tagsLength=kv.getTagsLength();
    out.writeShort(tagsLength);
    if (tagsLength > 0) {
      out.write(kv.getTagsArray(),kv.getTagsOffset(),tagsLength);
    }
    encodedKvSize+=tagsLength + KeyValue.TAGS_LENGTH_SIZE;
  }
  if (encodingCtx.getHFileContext().isIncludesMvcc()) {
    WritableUtils.writeVLong(out,kv.getMvccVersion());
    encodedKvSize+=WritableUtils.getVIntSize(kv.getMvccVersion());
  }
  return encodedKvSize;
}
