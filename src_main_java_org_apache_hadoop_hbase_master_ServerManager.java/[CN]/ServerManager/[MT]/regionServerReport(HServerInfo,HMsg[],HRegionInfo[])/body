{
  HServerInfo info=new HServerInfo(serverInfo);
  checkIsDead(info.getServerName(),"REPORT");
  if (msgs.length > 0) {
    if (msgs[0].isType(HMsg.Type.MSG_REPORT_EXITING)) {
      processRegionServerExit(info,msgs);
      return HMsg.EMPTY_HMSG_ARRAY;
    }
 else     if (msgs[0].isType(HMsg.Type.MSG_REPORT_QUIESCED)) {
      LOG.info("Region server " + info.getServerName() + " quiesced");
      this.quiescedServers.incrementAndGet();
    }
  }
  if (this.master.getShutdownRequested().get()) {
    if (quiescedServers.get() >= serversToServerInfo.size()) {
      LOG.info("All user tables quiesced. Proceeding with shutdown");
      this.master.startShutdown();
    }
    if (!this.master.isClosed()) {
      if (msgs.length > 0 && msgs[0].isType(HMsg.Type.MSG_REPORT_QUIESCED)) {
        return HMsg.EMPTY_HMSG_ARRAY;
      }
      return new HMsg[]{HMsg.REGIONSERVER_QUIESCE};
    }
  }
  if (this.master.isClosed()) {
    return new HMsg[]{HMsg.REGIONSERVER_STOP};
  }
  HServerInfo storedInfo=this.serversToServerInfo.get(info.getServerName());
  if (storedInfo == null) {
    LOG.warn("Received report from unknown server -- telling it " + "to " + HMsg.REGIONSERVER_STOP + ": "+ info.getServerName());
    return new HMsg[]{HMsg.REGIONSERVER_STOP};
  }
 else   if (storedInfo.getStartCode() != info.getStartCode()) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("region server race condition detected: " + info.getServerName());
    }
synchronized (this.serversToServerInfo) {
      removeServerInfo(info.getServerName(),info.getServerAddress());
      notifyServers();
    }
    return new HMsg[]{HMsg.REGIONSERVER_STOP};
  }
 else {
    return processRegionServerAllsWell(info,mostLoadedRegions,msgs);
  }
}
