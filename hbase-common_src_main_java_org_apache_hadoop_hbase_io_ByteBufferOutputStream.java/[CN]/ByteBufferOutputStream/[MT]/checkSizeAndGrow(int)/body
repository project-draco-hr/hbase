{
  if ((buf.position() + extra) > buf.limit()) {
    int newSize=(int)Math.min((((long)buf.capacity()) * 2),(long)(Integer.MAX_VALUE));
    newSize=Math.max(newSize,buf.position() + extra);
    ByteBuffer newBuf=allocate(newSize,buf.isDirect());
    buf.flip();
    ByteBufferUtils.copyFromBufferToBuffer(buf,newBuf);
    buf=newBuf;
  }
}
