{
  Configuration conf=HBaseConfiguration.create();
  TestRpcServer rpcServer=new TestRpcServer();
  try (AbstractRpcClient client=createRpcClientNoCodec(conf)){
    rpcServer.start();
    BlockingInterface stub=newBlockingStub(client,rpcServer.getListenerAddress());
    PayloadCarryingRpcController pcrc=new PayloadCarryingRpcController();
    String message="hello";
    assertEquals(message,stub.echo(pcrc,EchoRequestProto.newBuilder().setMessage(message).build()).getMessage());
    assertNull(pcrc.cellScanner());
  }
  finally {
    rpcServer.stop();
  }
}
