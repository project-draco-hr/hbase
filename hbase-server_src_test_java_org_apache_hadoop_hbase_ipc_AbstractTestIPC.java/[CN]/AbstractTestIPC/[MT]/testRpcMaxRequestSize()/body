{
  Configuration conf=new Configuration(CONF);
  conf.setInt(RpcServer.MAX_REQUEST_SIZE,100);
  RpcServer rpcServer=new TestRpcServer(conf);
  try (AbstractRpcClient client=createRpcClient(conf)){
    rpcServer.start();
    BlockingInterface stub=newBlockingStub(client,rpcServer.getListenerAddress());
    StringBuilder message=new StringBuilder(120);
    for (int i=0; i < 20; i++) {
      message.append("hello.");
    }
    EchoRequestProto param=EchoRequestProto.newBuilder().setMessage(message.toString()).build();
    stub.echo(new PayloadCarryingRpcController(CellUtil.createCellScanner(ImmutableList.<Cell>of(CELL))),param);
    fail("RPC should have failed because it exceeds max request size");
  }
 catch (  ServiceException e) {
    LOG.info("Caught expected exception: " + e.toString());
  }
 finally {
    rpcServer.stop();
  }
}
