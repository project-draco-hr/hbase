{
  InetSocketAddress address=rpcServer.getListenerAddress();
  if (address == null) {
    throw new IOException("Listener channel is closed");
  }
  MethodDescriptor md=SERVICE.getDescriptorForType().findMethodByName("echo");
  EchoRequestProto param=EchoRequestProto.newBuilder().setMessage("hello").build();
  ServerName serverName=ServerName.valueOf(address.getHostName(),address.getPort(),System.currentTimeMillis());
  AsyncRpcChannel channel=client.createRpcChannel(md.getService().getName(),serverName,User.getCurrent());
  final Future<Message> f=channel.callMethod(md,param,null,md.getOutputType().toProto(),MessageConverter.NO_CONVERTER,null,1000,HConstants.NORMAL_QOS);
  return f.get(1,TimeUnit.SECONDS);
}
