{
  long zkSessionTimeout=15000l;
  Configuration conf=HBaseConfiguration.create();
  conf.set("zookeeper.session.timeout","15000");
  Abortable abortable=new Abortable(){
    boolean aborted=false;
    @Override public void abort(    String why,    Throwable e){
      aborted=true;
      LOG.error(why,e);
    }
    @Override public boolean isAborted(){
      return aborted;
    }
  }
;
  ZooKeeperWatcher watcher=new ZooKeeperWatcher(conf,"testConnectionEvent",abortable,false);
  WatchedEvent event=new WatchedEvent(Watcher.Event.EventType.None,Watcher.Event.KeeperState.Disconnected,null);
  long startTime=EnvironmentEdgeManager.currentTime();
  while (!abortable.isAborted() && (EnvironmentEdgeManager.currentTime() - startTime < zkSessionTimeout)) {
    watcher.process(event);
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
    }
  }
  assertTrue(abortable.isAborted());
  watcher.close();
}
