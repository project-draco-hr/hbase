{
  SnapshotExceptionSnare error=Mockito.mock(SnapshotExceptionSnare.class);
  SnapshotDescription snapshot=SnapshotDescription.newBuilder().setName("snapshot").setTable("table").build();
  final Exception thrown=new Exception("Failed!");
  SnapshotTask fail=new SnapshotTask(snapshot,error,"always fails"){
    @Override protected void process() throws Exception {
      throw thrown;
    }
  }
;
  fail.run();
  Mockito.verify(error,Mockito.times(1)).snapshotFailure(Mockito.anyString(),Mockito.eq(snapshot),Mockito.eq(thrown));
}
