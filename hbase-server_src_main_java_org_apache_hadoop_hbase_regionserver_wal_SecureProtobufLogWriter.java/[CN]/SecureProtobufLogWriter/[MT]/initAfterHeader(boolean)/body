{
  if (conf.getBoolean(HConstants.ENABLE_WAL_ENCRYPTION,false) && encryptor != null) {
    WALCellCodec codec=SecureWALCellCodec.getCodec(this.conf,encryptor);
    this.cellEncoder=codec.getEncoder(this.output);
    this.compressionContext=null;
  }
 else {
    super.initAfterHeader(doCompress);
  }
}
