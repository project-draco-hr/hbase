{
  final HRegionInfo hri=HRegionInfo.FIRST_META_REGIONINFO;
  LoadBalancer balancer=LoadBalancerFactory.getLoadBalancer(server.getConfiguration());
  AssignmentManager am=new AssignmentManager(this.server,this.serverManager,balancer,null,null,master.getTableLockManager());
  RegionStates regionStates=am.getRegionStates();
  try {
    regionStates.updateRegionState(hri,RegionState.State.MERGING);
    am.assign(hri,true,true);
    assertEquals("The region should be still in merging state",RegionState.State.MERGING,regionStates.getRegionState(hri).getState());
  }
  finally {
    am.shutdown();
  }
}
