{
  AssignmentManagerWithExtrasForTesting am=setUpMockedAssignmentManager(this.server,this.serverManager);
  RegionState state=new RegionState(REGIONINFO,State.OPENING,System.currentTimeMillis(),SERVERNAME_A);
  am.getRegionStates().regionOnline(REGIONINFO,SERVERNAME_B);
  am.getRegionStates().regionsInTransition.put(REGIONINFO.getEncodedName(),state);
  am.regionPlans.put(REGIONINFO.getEncodedName(),new RegionPlan(REGIONINFO,SERVERNAME_B,SERVERNAME_A));
  am.getTableStateManager().setTableState(REGIONINFO.getTable(),Table.State.ENABLED);
  try {
    am.assignInvoked=false;
    processServerShutdownHandler(am,false);
    assertTrue(am.assignInvoked);
  }
  finally {
    am.getRegionStates().regionsInTransition.remove(REGIONINFO.getEncodedName());
    am.regionPlans.remove(REGIONINFO.getEncodedName());
  }
}
