{
  Mockito.when(this.serverManager.sendRegionOpen(Mockito.eq(SERVERNAME_B),Mockito.eq(REGIONINFO),Mockito.anyInt(),(List<ServerName>)Mockito.any())).thenThrow(new DoNotRetryIOException());
  this.server.getConfiguration().setInt("hbase.assignment.maximum.attempts",100);
  HRegionInfo hri=REGIONINFO;
  LoadBalancer balancer=LoadBalancerFactory.getLoadBalancer(server.getConfiguration());
  AssignmentManager am=new AssignmentManager(this.server,this.serverManager,balancer,null,null,master.getTableLockManager());
  RegionStates regionStates=am.getRegionStates();
  try {
    am.regionPlans.put(REGIONINFO.getEncodedName(),new RegionPlan(REGIONINFO,null,SERVERNAME_B));
    am.assign(hri,true,false);
  }
  finally {
    assertEquals(SERVERNAME_A,regionStates.getRegionState(REGIONINFO).getServerName());
  }
}
