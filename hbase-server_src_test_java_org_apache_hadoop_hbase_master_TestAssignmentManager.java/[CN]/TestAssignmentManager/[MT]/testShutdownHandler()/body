{
  ExecutorService executor=startupMasterExecutor("testShutdownHandler");
  AssignmentManagerWithExtrasForTesting am=setUpMockedAssignmentManager(this.server,this.serverManager);
  try {
    processServerShutdownHandler(am,false);
  }
  finally {
    executor.shutdown();
    am.shutdown();
    ZKAssign.deleteAllNodes(this.watcher);
  }
}
