{
  final RecoverableZooKeeper recoverableZk=Mockito.mock(RecoverableZooKeeper.class);
  AssignmentManagerWithExtrasForTesting am=setUpMockedAssignmentManager(this.server,this.serverManager);
  Watcher zkw=new ZooKeeperWatcher(HBaseConfiguration.create(),"unittest",null){
    public RecoverableZooKeeper getRecoverableZooKeeper(){
      return recoverableZk;
    }
  }
;
  ((ZooKeeperWatcher)zkw).registerListener(am);
  Mockito.doThrow(new InterruptedException()).when(recoverableZk).getChildren("/hbase/region-in-transition",null);
  am.setWatcher((ZooKeeperWatcher)zkw);
  try {
    am.processDeadServersAndRegionsInTransition(null);
    fail("Expected to abort");
  }
 catch (  NullPointerException e) {
    fail("Should not throw NPE");
  }
catch (  RuntimeException e) {
    assertEquals("Aborted",e.getLocalizedMessage());
  }
}
