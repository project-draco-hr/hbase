{
  final HRegionInfo hri=HRegionInfo.FIRST_META_REGIONINFO;
  Mockito.when(this.serverManager.sendRegionClose(SERVERNAME_A,hri,-1)).thenReturn(true);
  CatalogTracker ct=Mockito.mock(CatalogTracker.class);
  LoadBalancer balancer=LoadBalancerFactory.getLoadBalancer(server.getConfiguration());
  AssignmentManager am=new AssignmentManager(this.server,this.serverManager,ct,balancer,null,null);
  try {
    unassign(am,SERVERNAME_A,hri);
    ZKAssign.deleteClosingNode(this.watcher,hri);
    int version=createNodeSplitting(this.watcher,hri,SERVERNAME_A);
    unassign(am,SERVERNAME_A,hri);
    ZKAssign.transitionNode(this.watcher,hri,SERVERNAME_A,EventType.RS_ZK_REGION_SPLITTING,EventType.RS_ZK_REGION_SPLITTING,version);
    assertTrue(am.isRegionInTransition(hri) == null);
  }
  finally {
    am.shutdown();
  }
}
