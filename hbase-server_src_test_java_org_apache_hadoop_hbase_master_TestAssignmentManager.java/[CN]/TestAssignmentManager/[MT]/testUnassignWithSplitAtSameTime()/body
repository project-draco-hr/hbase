{
  final HRegionInfo hri=HRegionInfo.FIRST_META_REGIONINFO;
  Mockito.when(this.serverManager.sendRegionClose(SERVERNAME_A,hri,-1)).thenReturn(true);
  LoadBalancer balancer=LoadBalancerFactory.getLoadBalancer(server.getConfiguration());
  AssignmentManager am=new AssignmentManager(this.server,this.serverManager,balancer,null,null,master.getTableLockManager());
  try {
    unassign(am,SERVERNAME_A,hri);
    ZKAssign.deleteClosingNode(this.watcher,hri,SERVERNAME_A);
    int version=createNodeSplitting(this.watcher,hri,SERVERNAME_A);
    unassign(am,SERVERNAME_A,hri);
    ZKAssign.transitionNode(this.watcher,hri,SERVERNAME_A,EventType.RS_ZK_REGION_SPLITTING,EventType.RS_ZK_REGION_SPLITTING,version);
    assertFalse(am.getRegionStates().isRegionInTransition(hri));
  }
  finally {
    am.shutdown();
  }
}
