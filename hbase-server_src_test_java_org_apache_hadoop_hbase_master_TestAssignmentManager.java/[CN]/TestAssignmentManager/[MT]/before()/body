{
  this.server=Mockito.mock(Server.class);
  Mockito.when(server.getServerName()).thenReturn(ServerName.valueOf("master,1,1"));
  Mockito.when(server.getConfiguration()).thenReturn(HTU.getConfiguration());
  this.watcher=new ZooKeeperWatcher(HTU.getConfiguration(),"mockedServer",this.server,true);
  Mockito.when(server.getZooKeeper()).thenReturn(this.watcher);
  Mockito.doThrow(new RuntimeException("Aborted")).when(server).abort(Mockito.anyString(),(Throwable)Mockito.anyObject());
  this.serverManager=Mockito.mock(ServerManager.class);
  Mockito.when(this.serverManager.isServerOnline(SERVERNAME_A)).thenReturn(true);
  Mockito.when(this.serverManager.isServerOnline(SERVERNAME_B)).thenReturn(true);
  Mockito.when(this.serverManager.getDeadServers()).thenReturn(new DeadServer());
  final Map<ServerName,ServerLoad> onlineServers=new HashMap<ServerName,ServerLoad>();
  onlineServers.put(SERVERNAME_B,ServerLoad.EMPTY_SERVERLOAD);
  onlineServers.put(SERVERNAME_A,ServerLoad.EMPTY_SERVERLOAD);
  Mockito.when(this.serverManager.getOnlineServersList()).thenReturn(new ArrayList<ServerName>(onlineServers.keySet()));
  Mockito.when(this.serverManager.getOnlineServers()).thenReturn(onlineServers);
  List<ServerName> avServers=new ArrayList<ServerName>();
  avServers.addAll(onlineServers.keySet());
  Mockito.when(this.serverManager.createDestinationServersList()).thenReturn(avServers);
  Mockito.when(this.serverManager.createDestinationServersList(null)).thenReturn(avServers);
  Mockito.when(this.serverManager.sendRegionClose(SERVERNAME_A,REGIONINFO,-1)).thenReturn(true);
  Mockito.when(this.serverManager.sendRegionClose(SERVERNAME_B,REGIONINFO,-1)).thenReturn(true);
  Mockito.when(this.serverManager.sendRegionOpen(SERVERNAME_A,REGIONINFO,-1,null)).thenReturn(RegionOpeningState.OPENED);
  Mockito.when(this.serverManager.sendRegionOpen(SERVERNAME_B,REGIONINFO,-1,null)).thenReturn(RegionOpeningState.OPENED);
  this.master=Mockito.mock(HMaster.class);
  Mockito.when(this.master.getServerManager()).thenReturn(serverManager);
}
