{
  HBaseTestingUtility hbt=new HBaseTestingUtility();
  MiniZooKeeperCluster cluster1=hbt.startMiniZKCluster();
  try {
    assertEquals(0,cluster1.getBackupZooKeeperServerNum());
    assertTrue((cluster1.killCurrentActiveZooKeeperServer() == -1));
  }
  finally {
    hbt.shutdownMiniZKCluster();
  }
  MiniZooKeeperCluster cluster2=hbt.startMiniZKCluster(5);
  int defaultClientPort=21818;
  cluster2.setDefaultClientPort(defaultClientPort);
  try {
    assertEquals(4,cluster2.getBackupZooKeeperServerNum());
    assertTrue((cluster2.killCurrentActiveZooKeeperServer() >= defaultClientPort));
    assertTrue((cluster2.killCurrentActiveZooKeeperServer() >= defaultClientPort));
    assertEquals(2,cluster2.getBackupZooKeeperServerNum());
    assertEquals(3,cluster2.getZooKeeperServerNum());
    cluster2.killOneBackupZooKeeperServer();
    cluster2.killOneBackupZooKeeperServer();
    assertEquals(0,cluster2.getBackupZooKeeperServerNum());
    assertEquals(1,cluster2.getZooKeeperServerNum());
    assertTrue((cluster2.killCurrentActiveZooKeeperServer() == -1));
    cluster2.killOneBackupZooKeeperServer();
    assertEquals(-1,cluster2.getBackupZooKeeperServerNum());
    assertEquals(0,cluster2.getZooKeeperServerNum());
  }
  finally {
    hbt.shutdownMiniZKCluster();
  }
}
