{
  DummyWALObserver observer=new DummyWALObserver();
  List<WALObserver> list=new ArrayList<WALObserver>();
  list.add(observer);
  DummyWALObserver laterobserver=new DummyWALObserver();
  HLog hlog=new HLog(fs,logDir,oldLogDir,conf,list,null);
  HRegionInfo hri=new HRegionInfo(new HTableDescriptor(SOME_BYTES),SOME_BYTES,SOME_BYTES,false);
  for (int i=0; i < 20; i++) {
    byte[] b=Bytes.toBytes(i + "");
    KeyValue kv=new KeyValue(b,b,b);
    WALEdit edit=new WALEdit();
    edit.add(kv);
    HLogKey key=new HLogKey(b,b,0,0);
    hlog.append(hri,key,edit);
    if (i == 10) {
      hlog.registerWALActionsListener(laterobserver);
    }
    if (i % 2 == 0) {
      hlog.rollWriter();
    }
  }
  hlog.close();
  hlog.closeAndDelete();
  assertEquals(11,observer.logRollCounter);
  assertEquals(5,laterobserver.logRollCounter);
  assertEquals(2,observer.closedCount);
}
