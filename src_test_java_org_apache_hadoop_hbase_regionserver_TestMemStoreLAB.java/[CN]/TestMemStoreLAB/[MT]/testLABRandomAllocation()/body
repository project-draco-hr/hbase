{
  Random rand=new Random();
  MemStoreLAB mslab=new MemStoreLAB();
  assertEquals(0,mslab.getWastedBytes());
  int expectedOff=0;
  int slabsUsed=0;
  byte[] lastBuffer=null;
  for (int i=0; i < 100000; i++) {
    int size=rand.nextInt(1000);
    Allocation alloc=mslab.allocateBytes(size);
    if (alloc.getData() != lastBuffer) {
      expectedOff=0;
      lastBuffer=alloc.getData();
      slabsUsed++;
    }
    assertEquals(expectedOff,alloc.getOffset());
    assertTrue("Allocation " + alloc + " overruns buffer",alloc.getOffset() + size <= alloc.getData().length);
    expectedOff+=size;
  }
  long expectedWaste=slabsUsed * 1000 + (lastBuffer.length - expectedOff);
  long waste=mslab.getWastedBytes();
  assertTrue("waste should be less than " + expectedWaste + " but was: "+ waste,waste < expectedWaste);
}
