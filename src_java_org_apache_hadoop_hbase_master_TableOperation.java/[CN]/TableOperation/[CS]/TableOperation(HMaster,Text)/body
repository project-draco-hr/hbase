{
  this.numRetries=master.numRetries;
  this.master=master;
  if (!this.master.isMasterRunning()) {
    throw new MasterNotRunningException();
  }
  this.metaRegions=new HashSet<MetaRegion>();
  this.tableName=tableName;
  this.unservedRegions=new HashSet<HRegionInfo>();
  if (this.master.metaScannerThread.waitForMetaRegionsOrClose()) {
    throw new MasterNotRunningException();
  }
  Text firstMetaRegion=null;
synchronized (this.master.onlineMetaRegions) {
    if (this.master.onlineMetaRegions.size() == 1) {
      firstMetaRegion=this.master.onlineMetaRegions.firstKey();
    }
 else     if (this.master.onlineMetaRegions.containsKey(tableName)) {
      firstMetaRegion=tableName;
    }
 else {
      firstMetaRegion=this.master.onlineMetaRegions.headMap(tableName).lastKey();
    }
    this.metaRegions.addAll(this.master.onlineMetaRegions.tailMap(firstMetaRegion).values());
  }
}
