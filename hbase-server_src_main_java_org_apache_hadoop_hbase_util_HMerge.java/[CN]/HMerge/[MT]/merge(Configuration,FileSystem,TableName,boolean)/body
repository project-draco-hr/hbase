{
  boolean masterIsRunning=false;
  if (testMasterRunning) {
    masterIsRunning=HConnectionManager.execute(new HConnectable<Boolean>(conf){
      @Override public Boolean connect(      HConnection connection) throws IOException {
        return connection.isMasterRunning();
      }
    }
);
  }
  if (tableName.equals(TableName.META_TABLE_NAME)) {
    if (masterIsRunning) {
      throw new IllegalStateException("Can not compact hbase:meta table if instance is on-line");
    }
  }
 else {
    if (!masterIsRunning) {
      throw new IllegalStateException("HBase instance must be running to merge a normal table");
    }
    Admin admin=new HBaseAdmin(conf);
    try {
      if (!admin.isTableDisabled(tableName)) {
        throw new TableNotDisabledException(tableName);
      }
    }
  finally {
      admin.close();
    }
    new OnlineMerger(conf,fs,tableName).process();
  }
}
