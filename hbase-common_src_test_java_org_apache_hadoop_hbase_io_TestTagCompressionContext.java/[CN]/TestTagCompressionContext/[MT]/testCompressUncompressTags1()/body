{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  TagCompressionContext context=new TagCompressionContext(LRUDictionary.class);
  KeyValue kv1=createKVWithTags(2);
  short tagsLength1=kv1.getTagsLength();
  ByteBuffer ib=ByteBuffer.wrap(kv1.getTagsArray(),kv1.getTagsOffset(),tagsLength1);
  context.compressTags(baos,ib,tagsLength1);
  KeyValue kv2=createKVWithTags(3);
  short tagsLength2=kv2.getTagsLength();
  ib=ByteBuffer.wrap(kv2.getTagsArray(),kv2.getTagsOffset(),tagsLength2);
  context.compressTags(baos,ib,tagsLength2);
  context.clear();
  byte[] dest=new byte[tagsLength1];
  ByteBuffer ob=ByteBuffer.wrap(baos.toByteArray());
  context.uncompressTags(ob,dest,0,tagsLength1);
  assertTrue(Bytes.equals(kv1.getTagsArray(),kv1.getTagsOffset(),tagsLength1,dest,0,tagsLength1));
  dest=new byte[tagsLength2];
  context.uncompressTags(ob,dest,0,tagsLength2);
  assertTrue(Bytes.equals(kv2.getTagsArray(),kv2.getTagsOffset(),tagsLength2,dest,0,tagsLength2));
}
