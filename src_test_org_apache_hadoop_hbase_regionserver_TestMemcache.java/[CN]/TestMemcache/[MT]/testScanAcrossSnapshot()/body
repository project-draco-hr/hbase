{
  int rowCount=addRows(this.memcache);
  KeyValueScanner[] memcachescanners=this.memcache.getScanners();
  Scan scan=new Scan();
  List<KeyValue> result=new ArrayList<KeyValue>();
  StoreScanner s=new StoreScanner(scan,null,HConstants.LATEST_TIMESTAMP,this.memcache.comparator,null,memcachescanners);
  int count=0;
  try {
    while (s.next(result)) {
      LOG.info(result);
      count++;
      result.clear();
    }
  }
  finally {
    s.close();
  }
  assertEquals(rowCount,count);
  s=new StoreScanner(scan,null,HConstants.LATEST_TIMESTAMP,this.memcache.comparator,null,memcachescanners);
  count=0;
  try {
    while (s.next(result)) {
      LOG.info(result);
      assertTrue(Bytes.compareTo(Bytes.toBytes(count),result.get(0).getRow()) == 0);
      count++;
      if (count == 2) {
        this.memcache.snapshot();
        LOG.info("Snapshotted");
      }
      result.clear();
    }
  }
  finally {
    s.close();
  }
  assertEquals(rowCount,count);
}
