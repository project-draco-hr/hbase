{
  if (list.isEmpty()) {
    return;
  }
  boolean retryOnlyOne=false;
  Collections.sort(list);
  List<BatchUpdate> tempUpdates=new ArrayList<BatchUpdate>();
  byte[] currentRegion=getRegionLocation(tableName,list.get(0).getRow(),false).getRegionInfo().getRegionName();
  byte[] region=currentRegion;
  boolean isLastRow=false;
  int tries=0;
  for (int i=0; i < list.size() && tries < numRetries; i++) {
    BatchUpdate batchUpdate=list.get(i);
    tempUpdates.add(batchUpdate);
    isLastRow=(i + 1) == list.size();
    if (!isLastRow) {
      region=getRegionLocation(tableName,list.get(i + 1).getRow(),false).getRegionInfo().getRegionName();
    }
    if (!Bytes.equals(currentRegion,region) || isLastRow || retryOnlyOne) {
      final BatchUpdate[] updates=tempUpdates.toArray(new BatchUpdate[0]);
      int index=getRegionServerForWithoutRetries(new ServerCallable<Integer>(this,tableName,batchUpdate.getRow()){
        public Integer call() throws IOException {
          int i=server.batchUpdates(location.getRegionInfo().getRegionName(),updates);
          return i;
        }
      }
);
      if (index != -1) {
        if (tries == numRetries - 1) {
          throw new RetriesExhaustedException("Some server",currentRegion,batchUpdate.getRow(),tries,new ArrayList<Throwable>());
        }
        long sleepTime=getPauseTime(tries);
        if (LOG.isDebugEnabled()) {
          LOG.debug("Reloading region " + Bytes.toString(currentRegion) + " location because regionserver didn't accept updates; "+ "tries="+ tries+ " of max="+ this.numRetries+ ", waiting="+ sleepTime+ "ms");
        }
        try {
          Thread.sleep(sleepTime);
          tries++;
        }
 catch (        InterruptedException e) {
        }
        i=i - updates.length + index;
        retryOnlyOne=true;
        region=getRegionLocation(tableName,list.get(i + 1).getRow(),true).getRegionInfo().getRegionName();
      }
 else {
        retryOnlyOne=false;
      }
      currentRegion=region;
      tempUpdates.clear();
    }
  }
}
