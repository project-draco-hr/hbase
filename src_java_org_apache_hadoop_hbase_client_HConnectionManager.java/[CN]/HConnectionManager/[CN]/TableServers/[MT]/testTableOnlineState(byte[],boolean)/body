{
  if (!tableExists(tableName)) {
    throw new TableNotFoundException(Bytes.toString(tableName));
  }
  if (Bytes.equals(tableName,HConstants.ROOT_TABLE_NAME)) {
    return true;
  }
  int rowsScanned=0;
  int rowsOffline=0;
  byte[] startKey=HRegionInfo.createRegionName(tableName,null,HConstants.ZEROES);
  byte[] endKey=null;
  HRegionInfo currentRegion=null;
  Scan scan=new Scan(startKey);
  scan.addColumn(CATALOG_FAMILY,REGIONINFO_QUALIFIER);
  int rows=this.conf.getInt("hbase.meta.scanner.caching",100);
  scan.setCaching(rows);
  ScannerCallable s=new ScannerCallable(this,(Bytes.equals(tableName,HConstants.META_TABLE_NAME) ? HConstants.ROOT_TABLE_NAME : HConstants.META_TABLE_NAME),scan);
  try {
    getRegionServerWithRetries(s);
    do {
      HRegionInfo oldRegion=currentRegion;
      if (oldRegion != null) {
        startKey=oldRegion.getEndKey();
      }
      currentRegion=s.getHRegionInfo();
      Result r=null;
      Result[] rrs=null;
      do {
        rrs=getRegionServerWithRetries(s);
        if (rrs == null || rrs.length == 0 || rrs[0].size() == 0) {
          break;
        }
        r=rrs[0];
        byte[] value=r.getValue(HConstants.CATALOG_FAMILY,HConstants.REGIONINFO_QUALIFIER);
        if (value != null) {
          HRegionInfo info=Writables.getHRegionInfoOrNull(value);
          if (info != null) {
            if (Bytes.equals(info.getTableDesc().getName(),tableName)) {
              rowsScanned+=1;
              rowsOffline+=info.isOffline() ? 1 : 0;
            }
          }
        }
      }
 while (true);
      endKey=currentRegion.getEndKey();
    }
 while (!(endKey == null || Bytes.equals(endKey,HConstants.EMPTY_BYTE_ARRAY)));
  }
  finally {
    s.setClose();
    getRegionServerWithRetries(s);
  }
  LOG.debug("Rowscanned=" + rowsScanned + ", rowsOffline="+ rowsOffline);
  boolean onOffLine=online ? rowsOffline == 0 : rowsOffline == rowsScanned;
  return rowsScanned > 0 && onOffLine;
}
