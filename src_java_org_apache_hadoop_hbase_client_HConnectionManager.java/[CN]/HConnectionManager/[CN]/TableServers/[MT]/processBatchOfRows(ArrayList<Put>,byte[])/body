{
  if (list.isEmpty()) {
    return;
  }
  boolean retryOnlyOne=false;
  if (list.size() > 1) {
    Collections.sort(list);
  }
  List<Put> currentPuts=new ArrayList<Put>();
  HRegionLocation location=getRegionLocationForRowWithRetries(tableName,list.get(0).getRow(),false);
  byte[] currentRegion=location.getRegionInfo().getRegionName();
  byte[] region=currentRegion;
  boolean isLastRow=false;
  Put[] putarray=new Put[0];
  for (int i=0, tries=0; i < list.size() && tries < this.numRetries; i++) {
    Put put=list.get(i);
    currentPuts.add(put);
    isLastRow=(i + 1) == list.size();
    if (!isLastRow) {
      location=getRegionLocationForRowWithRetries(tableName,list.get(i + 1).getRow(),false);
      region=location.getRegionInfo().getRegionName();
    }
    if (!Bytes.equals(currentRegion,region) || isLastRow || retryOnlyOne) {
      final Put[] puts=currentPuts.toArray(putarray);
      int index=getRegionServerWithRetries(new ServerCallable<Integer>(this,tableName,put.getRow()){
        public Integer call() throws IOException {
          return server.put(location.getRegionInfo().getRegionName(),puts);
        }
      }
);
      if (index != -1) {
        if (tries == numRetries - 1) {
          throw new RetriesExhaustedException("Some server, retryOnlyOne=" + retryOnlyOne + ", index="+ index+ ", islastrow="+ isLastRow+ ", tries="+ tries+ ", numtries="+ numRetries+ ", i="+ i+ ", listsize="+ list.size()+ ", location="+ location+ ", region="+ Bytes.toStringBinary(region),currentRegion,put.getRow(),tries,new ArrayList<Throwable>());
        }
        long sleepTime=getPauseTime(tries);
        if (LOG.isDebugEnabled()) {
          LOG.debug("Reloading region " + Bytes.toStringBinary(currentRegion) + " location because regionserver didn't accept updates; "+ "tries="+ tries+ " of max="+ this.numRetries+ ", waiting="+ sleepTime+ "ms");
        }
        try {
          Thread.sleep(sleepTime);
          tries++;
        }
 catch (        InterruptedException e) {
        }
        i=i - puts.length + index;
        retryOnlyOne=true;
        location=getRegionLocationForRowWithRetries(tableName,list.get(i + 1).getRow(),true);
        region=location.getRegionInfo().getRegionName();
      }
 else {
        retryOnlyOne=false;
        tries=0;
      }
      currentRegion=region;
      currentPuts.clear();
    }
  }
}
