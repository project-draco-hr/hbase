{
  final Configuration conf=HBaseConfiguration.create();
  final ChoreService choreService=new ChoreService("CANARY_TOOL");
  final ScheduledChore authChore=AuthUtil.getAuthChore(conf);
  if (authChore != null) {
    choreService.scheduleChore(authChore);
  }
  int numThreads=conf.getInt("hbase.canary.threads.num",MAX_THREADS_NUM);
  ExecutorService executor=new ScheduledThreadPoolExecutor(numThreads);
  Class<? extends Sink> sinkClass=conf.getClass("hbase.canary.sink.class",StdOutSink.class,Sink.class);
  Sink sink=ReflectionUtils.newInstance(sinkClass);
  int exitCode=ToolRunner.run(conf,new Canary(executor,sink),args);
  choreService.shutdown();
  executor.shutdown();
  System.exit(exitCode);
}
