{
  List<RegionServerTask> tasks=new ArrayList<RegionServerTask>();
  Random rand=new Random();
  for (  Map.Entry<String,List<HRegionInfo>> entry : rsAndRMap.entrySet()) {
    String serverName=entry.getKey();
    HRegionInfo region=entry.getValue().get(rand.nextInt(entry.getValue().size()));
    tasks.add(new RegionServerTask(this.connection,serverName,region,getSink()));
  }
  try {
    for (    Future<Void> future : this.executor.invokeAll(tasks)) {
      try {
        future.get();
      }
 catch (      ExecutionException e) {
        LOG.error("Sniff regionserver failed!",e);
        this.errorCode=ERROR_EXIT_CODE;
      }
    }
  }
 catch (  InterruptedException e) {
    this.errorCode=ERROR_EXIT_CODE;
    LOG.error("Sniff regionserver failed!",e);
  }
}
