{
  Map<String,List<HRegionInfo>> rsAndRMap=new HashMap<String,List<HRegionInfo>>();
  HTable table=null;
  try {
    HTableDescriptor[] tableDescs=this.admin.listTables();
    List<HRegionInfo> regions=null;
    for (    HTableDescriptor tableDesc : tableDescs) {
      table=new HTable(this.admin.getConfiguration(),tableDesc.getName());
      for (      Map.Entry<HRegionInfo,ServerName> entry : table.getRegionLocations().entrySet()) {
        ServerName rs=entry.getValue();
        String rsName=rs.getHostname();
        HRegionInfo r=entry.getKey();
        if (rsAndRMap.containsKey(rsName)) {
          regions=rsAndRMap.get(rsName);
        }
 else {
          regions=new ArrayList<HRegionInfo>();
          rsAndRMap.put(rsName,regions);
        }
        regions.add(r);
      }
      table.close();
    }
  }
 catch (  IOException e) {
    String msg="Get HTables info failed";
    LOG.error(msg,e);
    this.errorCode=INIT_ERROR_EXIT_CODE;
  }
 finally {
    if (table != null) {
      try {
        table.close();
      }
 catch (      IOException e) {
        LOG.warn("Close table failed",e);
      }
    }
  }
  return rsAndRMap;
}
