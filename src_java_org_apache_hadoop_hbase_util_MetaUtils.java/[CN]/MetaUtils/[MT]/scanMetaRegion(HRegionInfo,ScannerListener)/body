{
  if (!initialized) {
    throw new IllegalStateException("Must call initialize method first.");
  }
  HRegion metaRegion=openMetaRegion(metaRegionInfo);
  InternalScanner metaScanner=metaRegion.getScanner(HConstants.COL_REGIONINFO_ARRAY,HConstants.EMPTY_START_ROW,HConstants.LATEST_TIMESTAMP,null);
  try {
    HStoreKey key=new HStoreKey();
    SortedMap<Text,byte[]> results=new TreeMap<Text,byte[]>();
    while (metaScanner.next(key,results)) {
      HRegionInfo info=Writables.getHRegionInfoOrNull(results.get(HConstants.COL_REGIONINFO));
      if (info == null) {
        LOG.warn("region info is null for row " + key.getRow() + " in table "+ HConstants.META_TABLE_NAME);
        continue;
      }
      if (!listener.processRow(info)) {
        break;
      }
      results.clear();
    }
  }
  finally {
    metaScanner.close();
  }
}
