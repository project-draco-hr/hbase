{
  Configuration conf=TEST_UTIL.getConfiguration();
  SecureRandom rng=new SecureRandom();
  byte[] keyBytes=new byte[AES.KEY_LENGTH];
  rng.nextBytes(keyBytes);
  String algorithm=conf.get(HConstants.CRYPTO_KEY_ALGORITHM_CONF_KEY,HConstants.CIPHER_AES);
  Key cfKey=new SecretKeySpec(keyBytes,algorithm);
  byte[] encryptionKey=EncryptionUtil.wrapKey(conf,conf.get(HConstants.CRYPTO_MASTERKEY_NAME_CONF_KEY,User.getCurrent().getShortName()),cfKey);
  String tableNameAsString="testCompactionDelaySweeperWithEncryption";
  TableName tableName=TableName.valueOf(tableNameAsString);
  HTableDescriptor desc=new HTableDescriptor(tableName);
  HColumnDescriptor hcd=new HColumnDescriptor(family);
  hcd.setMobEnabled(true);
  hcd.setMobThreshold(0);
  hcd.setMaxVersions(4);
  hcd.setEncryptionType(algorithm);
  hcd.setEncryptionKey(encryptionKey);
  desc.addFamily(hcd);
  admin.createTable(desc);
  Connection c=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration());
  BufferedMutator bufMut=c.getBufferedMutator(tableName);
  Table table=c.getTable(tableName);
  testCompactionDelaySweeperInternal(table,bufMut,tableName,true);
  table.close();
  admin.disableTable(tableName);
  admin.deleteTable(tableName);
}
