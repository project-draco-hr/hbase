{
  HTable ht=new HTable();
  Configuration configuration=new Configuration(conf);
  configuration.setBoolean(ConnectionManager.RETRIES_BY_SERVER_KEY,true);
  configuration.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,3);
  ht.setWriteBufferSize(configuration.getLong("hbase.client.write.buffer",2097152));
  ht.connection=new MyConnectionImpl(configuration);
  MyAsyncProcess ap=new MyAsyncProcess(ht.connection,conf,true);
  ht.ap=ap;
  Assert.assertNotNull(ht.ap.createServerErrorTracker());
  Assert.assertTrue(ht.ap.serverTrackerTimeout > 200);
  ht.ap.serverTrackerTimeout=1;
  Put p=createPut(1,false);
  ht.setAutoFlush(false,false);
  ht.put(p);
  try {
    ht.flushCommits();
    Assert.fail();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
  }
  Assert.assertEquals(2,ap.getRetriesRequested());
}
