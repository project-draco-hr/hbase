{
  final int NB_REGS=10000;
  List<HRegionLocation> hrls=new ArrayList<HRegionLocation>(NB_REGS);
  List<Get> gets=new ArrayList<Get>(NB_REGS);
  for (int i=0; i < NB_REGS; i++) {
    HRegionInfo hri=new HRegionInfo(DUMMY_TABLE,Bytes.toBytes(i * 10L),Bytes.toBytes(i * 10L + 9L));
    HRegionLocation hrl=new HRegionLocation(hri,i % 2 == 0 ? sn : sn2);
    hrls.add(hrl);
    Get get=new Get(Bytes.toBytes(i * 10L));
    gets.add(get);
  }
  HTable ht=new HTable();
  MyConnectionImpl2 con=new MyConnectionImpl2(hrls);
  ht.connection=con;
  ht.batch(gets);
  Assert.assertEquals(con.ap.nbActions.get(),NB_REGS);
  Assert.assertEquals(con.ap.nbMultiResponse.get(),2);
  Assert.assertEquals(con.nbThreads.get(),2);
  int nbReg=0;
  for (int i=0; i < NB_REGS; i++) {
    if (con.usedRegions[i])     nbReg++;
  }
  Assert.assertEquals("nbReg=" + nbReg,nbReg,NB_REGS);
}
