{
  HConnection hc=createHConnection();
  MyCB mcb=new MyCB();
  AsyncProcess ap=new MyAsyncProcess<Object>(hc,mcb,conf);
  List<Put> puts=new ArrayList<Put>();
  Put p=createPut(true,false);
  puts.add(p);
  ap.submit(puts,false);
  Assert.assertTrue(puts.isEmpty());
  while (!ap.hasError()) {
    Thread.sleep(1);
  }
  Assert.assertEquals(0,mcb.successCalled.get());
  Assert.assertEquals(2,mcb.retriableFailure.get());
  Assert.assertEquals(1,mcb.failureCalled.get());
  Assert.assertEquals(1,ap.getErrors().exceptions.size());
  Assert.assertTrue("was: " + ap.getErrors().exceptions.get(0),failure.equals(ap.getErrors().exceptions.get(0)));
  Assert.assertTrue("was: " + ap.getErrors().exceptions.get(0),failure.equals(ap.getErrors().exceptions.get(0)));
  Assert.assertEquals(1,ap.getFailedOperations().size());
  Assert.assertTrue("was: " + ap.getFailedOperations().get(0),p.equals(ap.getFailedOperations().get(0)));
}
