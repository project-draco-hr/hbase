{
  HTable ht=new HTable();
  MyAsyncProcess ap=new MyAsyncProcess(createHConnection(),conf,true);
  ht.ap=ap;
  ht.setAutoFlush(false,true);
  ht.setWriteBufferSize(0);
  Put p=createPut(1,false);
  ht.put(p);
  ap.waitUntilDone();
  p=createPut(1,true);
  Assert.assertEquals(0,ht.writeAsyncBuffer.size());
  try {
    ht.put(p);
    Assert.fail();
  }
 catch (  RetriesExhaustedException expected) {
  }
  Assert.assertEquals("the put should not been inserted.",0,ht.writeAsyncBuffer.size());
}
