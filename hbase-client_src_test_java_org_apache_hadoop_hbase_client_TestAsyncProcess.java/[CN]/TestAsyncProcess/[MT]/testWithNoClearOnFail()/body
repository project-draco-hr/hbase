{
  HTable ht=new HTable();
  HConnection hc=createHConnection();
  MyCB mcb=new MyCB();
  ht.ap=new MyAsyncProcess<Object>(hc,mcb,conf);
  ht.setAutoFlush(false,false);
  Put p=createPut(true,false);
  ht.put(p);
  Assert.assertEquals(0,ht.writeAsyncBuffer.size());
  try {
    ht.flushCommits();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
  }
  Assert.assertEquals(1,ht.writeAsyncBuffer.size());
  try {
    ht.close();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
  }
  Assert.assertEquals(1,ht.writeAsyncBuffer.size());
}
