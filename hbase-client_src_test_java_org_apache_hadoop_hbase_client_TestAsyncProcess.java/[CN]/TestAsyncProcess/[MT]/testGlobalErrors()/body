{
  HTable ht=new HTable();
  ht.connection=new MyConnectionImpl(conf);
  AsyncProcessWithFailure ap=new AsyncProcessWithFailure(ht.connection,conf);
  ht.ap=ap;
  Assert.assertNotNull(ht.ap.createServerErrorTracker());
  Put p=createPut(1,true);
  ht.setAutoFlush(false,false);
  ht.put(p);
  try {
    ht.flushCommits();
    Assert.fail();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
  }
  Assert.assertEquals(NB_RETRIES + 1,ap.callsCt.get());
}
