{
  HConnection hc=createHConnection();
  MyCB mcb=new MyCB();
  final AsyncProcess ap=new MyAsyncProcess<Object>(hc,mcb,conf);
  ap.tasksSent.incrementAndGet();
  final AtomicBoolean checkPoint=new AtomicBoolean(false);
  final AtomicBoolean checkPoint2=new AtomicBoolean(false);
  Thread t=new Thread(){
    @Override public void run(){
      Threads.sleep(1000);
      Assert.assertFalse(checkPoint.get());
      ap.tasksDone.incrementAndGet();
      checkPoint2.set(true);
    }
  }
;
  t.start();
  ap.waitForNextTaskDone(0);
  checkPoint.set(true);
  while (!checkPoint2.get()) {
    Threads.sleep(1);
  }
}
