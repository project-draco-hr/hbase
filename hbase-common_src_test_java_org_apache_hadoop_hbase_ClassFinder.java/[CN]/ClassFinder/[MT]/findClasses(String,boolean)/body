{
  final String path=packageName.replace('.','/');
  final Pattern jarResourceRe=Pattern.compile("^file:(.+\\.jar)!/" + path + "$");
  Enumeration<URL> resources=ClassLoader.getSystemClassLoader().getResources(path);
  List<File> dirs=new ArrayList<File>();
  List<String> jars=new ArrayList<String>();
  while (resources.hasMoreElements()) {
    URL resource=resources.nextElement();
    String resourcePath=resource.getFile();
    Matcher matcher=jarResourceRe.matcher(resourcePath);
    if (matcher.find()) {
      jars.add(matcher.group(1));
    }
 else {
      dirs.add(new File(resource.getFile()));
    }
  }
  Set<Class<?>> classes=new HashSet<Class<?>>();
  for (  File directory : dirs) {
    classes.addAll(findClassesFromFiles(directory,packageName,proceedOnExceptions));
  }
  for (  String jarFileName : jars) {
    classes.addAll(findClassesFromJar(jarFileName,packageName,proceedOnExceptions));
  }
  return classes;
}
