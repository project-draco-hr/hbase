{
synchronized (compactLock) {
    List<StoreFile> filesToCompact=this.storefiles;
    int count=filesToCompact.size();
    if (N > count) {
      throw new RuntimeException("Not enough files");
    }
    filesToCompact=new ArrayList<StoreFile>(filesToCompact.subList(count - N,count));
    long maxId=StoreFile.getMaxSequenceIdInList(filesToCompact);
    boolean majorcompaction=(N == count);
    StoreFile.Writer writer=compact(filesToCompact,majorcompaction,maxId);
    StoreFile sf=completeCompaction(filesToCompact,writer);
  }
}
