{
  final CacheConfig writerCacheConf;
  if (isCompaction) {
    writerCacheConf=new CacheConfig(cacheConf);
    writerCacheConf.setCacheDataOnWrite(false);
  }
 else {
    writerCacheConf=cacheConf;
  }
  StoreFile.Writer w=StoreFile.createWriter(fs,region.getTmpDir(),blocksize,compression,comparator,conf,writerCacheConf,family.getBloomFilterType(),maxKeyCount);
  SchemaConfigured sc=(SchemaConfigured)w.writer;
  SchemaConfigured.resetSchemaMetricsConf(sc);
  passSchemaMetricsTo(sc);
  return w;
}
