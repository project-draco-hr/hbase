{
  final CacheConfig writerCacheConf;
  if (isCompaction) {
    writerCacheConf=new CacheConfig(cacheConf);
    writerCacheConf.setCacheDataOnWrite(false);
  }
 else {
    writerCacheConf=cacheConf;
  }
  StoreFile.Writer w=new StoreFile.WriterBuilder(conf,writerCacheConf,fs,blocksize).withOutputDir(region.getTmpDir()).withDataBlockEncoder(dataBlockEncoder).withComparator(comparator).withBloomType(family.getBloomFilterType()).withMaxKeyCount(maxKeyCount).withChecksumType(checksumType).withBytesPerChecksum(bytesPerChecksum).build();
  SchemaConfigured sc=(SchemaConfigured)w.writer;
  SchemaConfigured.resetSchemaMetricsConf(sc);
  passSchemaMetricsTo(sc);
  return w;
}
