{
  MasterKeepAliveConnection master=connection.getKeepAliveMaster();
  try {
    SetBalancerRunningRequest req=RequestConverter.buildLoadBalancerIsRequest(b,false);
    return master.loadBalancerIs(null,req).getPrevBalanceValue();
  }
 catch (  ServiceException se) {
    IOException ioe=ProtobufUtil.getRemoteException(se);
    if (ioe instanceof MasterNotRunningException) {
      throw (MasterNotRunningException)ioe;
    }
    if (ioe instanceof ZooKeeperConnectionException) {
      throw (ZooKeeperConnectionException)ioe;
    }
    throw new MasterNotRunningException("Unexpected exception when calling balanceSwitch",se);
  }
 finally {
    master.close();
  }
}
