{
  Map<byte[],Long> oldestFlushingSeqNumsLocal=null;
  Map<byte[],Long> oldestUnflushedSeqNumsLocal=null;
  List<Path> logsToArchive=new ArrayList<Path>();
synchronized (oldestSeqNumsLock) {
    oldestFlushingSeqNumsLocal=new HashMap<byte[],Long>(this.oldestFlushingSeqNums);
    oldestUnflushedSeqNumsLocal=new HashMap<byte[],Long>(this.oldestUnflushedSeqNums);
  }
  for (  Map.Entry<Path,Map<byte[],Long>> e : hlogSequenceNums.entrySet()) {
    Path log=e.getKey();
    Map<byte[],Long> sequenceNums=e.getValue();
    if (areAllRegionsFlushed(sequenceNums,oldestFlushingSeqNumsLocal,oldestUnflushedSeqNumsLocal)) {
      logsToArchive.add(log);
      LOG.debug("log file is ready for archiving " + log);
    }
  }
  for (  Path p : logsToArchive) {
    archiveLogFile(p);
    this.hlogSequenceNums.remove(p);
  }
}
