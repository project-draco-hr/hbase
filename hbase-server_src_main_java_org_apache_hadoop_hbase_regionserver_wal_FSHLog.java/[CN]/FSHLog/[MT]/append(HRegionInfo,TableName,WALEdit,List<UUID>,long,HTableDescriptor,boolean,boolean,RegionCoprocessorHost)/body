{
  if (edits.isEmpty())   return this.unflushedEntries.get();
  if (this.closed) {
    throw new IOException("Cannot append; log is closed");
  }
  TraceScope traceScope=Trace.startSpan("FSHlog.append");
  try {
    long txid=0;
synchronized (this.updateLock) {
      long seqNum=obtainSeqNum();
      byte[] encodedRegionName=info.getEncodedNameAsBytes();
      if (isInMemstore)       this.oldestUnflushedSeqNums.putIfAbsent(encodedRegionName,seqNum);
      HLogKey logKey=makeKey(encodedRegionName,tableName,seqNum,now,clusterIds);
      doWrite(info,logKey,edits,htd,regionCoproHost);
      this.numEntries.incrementAndGet();
      txid=this.unflushedEntries.incrementAndGet();
      if (htd.isDeferredLogFlush()) {
        lastDeferredTxid=txid;
      }
    }
    if (doSync && (info.isMetaRegion() || !htd.isDeferredLogFlush())) {
      this.sync(txid);
    }
    return txid;
  }
  finally {
    traceScope.close();
  }
}
