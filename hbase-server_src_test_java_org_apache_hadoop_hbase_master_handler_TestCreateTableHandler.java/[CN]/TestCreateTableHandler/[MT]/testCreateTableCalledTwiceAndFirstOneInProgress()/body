{
  final byte[] tableName=Bytes.toBytes("testCreateTableCalledTwiceAndFirstOneInProgress");
  final MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  final HMaster m=cluster.getMaster();
  final HTableDescriptor desc=new HTableDescriptor(TableName.valueOf(tableName));
  desc.addFamily(new HColumnDescriptor(FAMILYNAME));
  final HRegionInfo[] hRegionInfos=new HRegionInfo[]{new HRegionInfo(desc.getTableName(),null,null)};
  CustomCreateTableHandler handler=new CustomCreateTableHandler(m,m.getMasterFileSystem(),desc,cluster.getConfiguration(),hRegionInfos,m);
  handler.prepare();
  throwException=true;
  handler.process();
  throwException=false;
  CustomCreateTableHandler handler1=new CustomCreateTableHandler(m,m.getMasterFileSystem(),desc,cluster.getConfiguration(),hRegionInfos,m);
  handler1.prepare();
  handler1.process();
  for (int i=0; i < 100; i++) {
    if (!TEST_UTIL.getHBaseAdmin().isTableAvailable(tableName)) {
      Thread.sleep(200);
    }
  }
  assertTrue(TEST_UTIL.getHBaseAdmin().isTableEnabled(tableName));
}
