{
  byte[] tableName=Bytes.toBytes("testMasterRestartAfterEnablingNodeIsCreated");
  final MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  final HMaster m=cluster.getMaster();
  final HTableDescriptor desc=new HTableDescriptor(tableName);
  desc.addFamily(new HColumnDescriptor(FAMILYNAME));
  final HRegionInfo[] hRegionInfos=new HRegionInfo[]{new HRegionInfo(desc.getName(),null,null)};
  CustomCreateTableHandler handler=new CustomCreateTableHandler(m,m.getMasterFileSystem(),desc,cluster.getConfiguration(),hRegionInfos,m);
  handler.prepare();
  throwException=true;
  handler.process();
  abortAndStartNewMaster(cluster);
  assertTrue(cluster.getLiveMasterThreads().size() == 1);
}
