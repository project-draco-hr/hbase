{
  byte[] encodedBytes=encodeBytes(encoding,dataset);
  ByteArrayInputStream bais=new ByteArrayInputStream(encodedBytes);
  DataInputStream dis=new DataInputStream(bais);
  ByteBuffer actualDataset;
  DataBlockEncoder encoder=encoding.getEncoder();
  HFileContext meta=new HFileContextBuilder().withHBaseCheckSum(false).withIncludesMvcc(includesMemstoreTS).withIncludesTags(includesTags).withCompressionAlgo(Compression.Algorithm.NONE).build();
  actualDataset=encoder.decodeKeyValues(dis,encoder.newDataBlockDecodingContext(meta));
  dataset.rewind();
  actualDataset.rewind();
  assertEquals("Encoding -> decoding gives different results for " + encoder,Bytes.toStringBinary(dataset),Bytes.toStringBinary(actualDataset));
}
