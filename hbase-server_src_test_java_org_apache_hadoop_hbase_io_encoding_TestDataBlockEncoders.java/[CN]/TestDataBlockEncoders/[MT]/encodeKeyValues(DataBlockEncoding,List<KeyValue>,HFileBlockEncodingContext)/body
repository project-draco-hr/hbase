{
  DataBlockEncoder encoder=encoding.getEncoder();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  baos.write(HConstants.HFILEBLOCK_DUMMY_HEADER);
  DataOutputStream dos=new DataOutputStream(baos);
  encoder.startBlockEncoding(encodingContext,dos);
  for (  KeyValue kv : kvs) {
    encoder.encode(kv,encodingContext,dos);
  }
  BufferGrabbingByteArrayOutputStream stream=new BufferGrabbingByteArrayOutputStream();
  baos.writeTo(stream);
  encoder.endBlockEncoding(encodingContext,dos,stream.getBuffer());
  byte[] encodedData=new byte[baos.size() - ENCODED_DATA_OFFSET];
  System.arraycopy(baos.toByteArray(),ENCODED_DATA_OFFSET,encodedData,0,encodedData.length);
  return ByteBuffer.wrap(encodedData);
}
