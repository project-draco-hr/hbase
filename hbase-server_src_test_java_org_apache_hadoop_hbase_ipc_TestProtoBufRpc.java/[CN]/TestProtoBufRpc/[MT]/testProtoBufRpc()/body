{
  ProtobufRpcClientEngine clientEngine=new ProtobufRpcClientEngine(conf,HConstants.CLUSTER_ID_DEFAULT);
  try {
    TestRpcService client=clientEngine.getProxy(TestRpcService.class,addr,conf,10000);
    EmptyRequestProto emptyRequest=EmptyRequestProto.newBuilder().build();
    client.ping(null,emptyRequest);
    EchoRequestProto echoRequest=EchoRequestProto.newBuilder().setMessage("hello").build();
    EchoResponseProto echoResponse=client.echo(null,echoRequest);
    Assert.assertEquals(echoResponse.getMessage(),"hello");
    try {
      client.error(null,emptyRequest);
      Assert.fail("Expected exception is not thrown");
    }
 catch (    ServiceException e) {
    }
  }
  finally {
    clientEngine.close();
  }
}
