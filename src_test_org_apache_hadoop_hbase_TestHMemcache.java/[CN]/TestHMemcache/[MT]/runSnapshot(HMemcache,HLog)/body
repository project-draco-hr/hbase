{
  int oldHistorySize=hmc.history.size();
  SortedMap<HStoreKey,byte[]> oldMemcache=hmc.memcache;
  Snapshot s=hmc.snapshotMemcacheForLog(log);
  assertEquals("Snapshot equals old memcache",hmc.snapshot,oldMemcache);
  assertEquals("Returned snapshot holds old memcache",s.memcacheSnapshot,oldMemcache);
  assertEquals("History has been incremented",oldHistorySize + 1,hmc.history.size());
  assertEquals("History holds old snapshot",hmc.history.get(oldHistorySize),oldMemcache);
  return s;
}
