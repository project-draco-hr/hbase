{
  final int snapshotCount=5;
  final Text tableName=new Text(getName());
  HLog log=getLogfile();
  for (int i=0; i < snapshotCount; i++) {
    addRows(this.hmemcache);
    int historyInitialSize=this.hmemcache.history.size();
    Snapshot s=runSnapshot(this.hmemcache,log);
    log.completeCacheFlush(new Text(Integer.toString(i)),tableName,s.sequenceId);
    this.hmemcache.deleteSnapshot();
    assertTrue("History not being cleared",historyInitialSize == this.hmemcache.history.size());
  }
  log.closeAndDelete();
}
