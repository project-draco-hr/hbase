{
  final int snapshotCount=5;
  final Text tableName=new Text(getName());
  HLog log=getLogfile();
  try {
    for (int i=0; i < snapshotCount; i++) {
      addRows(this.hmemcache);
      Snapshot s=runSnapshot(this.hmemcache,log);
      log.completeCacheFlush(new Text(Integer.toString(i)),tableName,s.sequenceId);
      this.hmemcache.deleteSnapshot();
    }
    log.close();
  }
  finally {
    log.dir.getFileSystem(this.conf).delete(log.dir);
  }
}
