{
  HBaseTestingUtility htu=new HBaseTestingUtility();
  setRootDirAndCleanIt(htu,"testCleanParent");
  Server server=new MockServer(htu);
  MasterServices services=new MockMasterServices(server);
  CatalogJanitor janitor=new CatalogJanitor(server,services);
  HTableDescriptor htd=createHTableDescriptor();
  HRegionInfo parent=new HRegionInfo(htd.getName(),Bytes.toBytes("aaa"),Bytes.toBytes("eee"));
  HRegionInfo splita=new HRegionInfo(htd.getName(),Bytes.toBytes("aaa"),Bytes.toBytes("ccc"));
  HRegionInfo splitb=new HRegionInfo(htd.getName(),Bytes.toBytes("ccc"),Bytes.toBytes("eee"));
  Result r=createResult(parent,splita,splitb);
  Path rootdir=services.getMasterFileSystem().getRootDir();
  Path tabledir=HTableDescriptor.getTableDir(rootdir,htd.getName());
  Path storedir=Store.getStoreHomedir(tabledir,splita.getEncodedName(),htd.getColumnFamilies()[0].getName());
  Reference ref=new Reference(Bytes.toBytes("ccc"),Reference.Range.top);
  long now=System.currentTimeMillis();
  Path p=new Path(storedir,Long.toString(now) + "." + parent.getEncodedName());
  FileSystem fs=services.getMasterFileSystem().getFileSystem();
  ref.write(fs,p);
  assertFalse(janitor.cleanParent(parent,r));
  assertTrue(fs.delete(p,true));
  assertTrue(janitor.cleanParent(parent,r));
}
