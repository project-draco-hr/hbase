{
  ClusterConnection connection=ConnectionManager.createConnectionInternal(env.getConfiguration());
  if (env instanceof RegionCoprocessorEnvironment) {
    RegionCoprocessorEnvironment e=(RegionCoprocessorEnvironment)env;
    RegionServerServices services=e.getRegionServerServices();
    if (services instanceof HRegionServer) {
      return new CoprocessorHConnection(connection,(HRegionServer)services);
    }
  }
  return connection;
}
