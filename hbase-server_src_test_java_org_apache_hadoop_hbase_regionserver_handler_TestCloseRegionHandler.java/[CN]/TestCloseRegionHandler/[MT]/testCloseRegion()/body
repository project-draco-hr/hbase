{
  final Server server=new MockServer(HTU);
  final RegionServerServices rss=HTU.createMockRegionServerService();
  HTableDescriptor htd=TEST_HTD;
  HRegionInfo hri=TEST_HRI;
  ZkCoordinatedStateManager coordinationProvider=new ZkCoordinatedStateManager();
  coordinationProvider.initialize(server);
  coordinationProvider.start();
  OpenRegion(server,rss,htd,hri,coordinationProvider.getOpenRegionCoordination());
  int versionOfClosingNode=ZKAssign.createNodeClosing(server.getZooKeeper(),hri,server.getServerName());
  ZkCloseRegionCoordination.ZkCloseRegionDetails zkCrd=new ZkCloseRegionCoordination.ZkCloseRegionDetails();
  zkCrd.setPublishStatusInZk(true);
  zkCrd.setExpectedVersion(versionOfClosingNode);
  CloseRegionHandler handler=new CloseRegionHandler(server,rss,hri,false,coordinationProvider.getCloseRegionCoordination(),zkCrd);
  handler.process();
  RegionTransition rt=RegionTransition.parseFrom(ZKAssign.getData(server.getZooKeeper(),hri.getEncodedName()));
  assertTrue(rt.getEventType().equals(EventType.RS_ZK_REGION_CLOSED));
}
