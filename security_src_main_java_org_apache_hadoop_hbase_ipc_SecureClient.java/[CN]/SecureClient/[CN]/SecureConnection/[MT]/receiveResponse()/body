{
  if (shouldCloseConnection.get()) {
    return;
  }
  touch();
  try {
    int id=in.readInt();
    if (LOG.isDebugEnabled())     LOG.debug(getName() + " got value #" + id);
    Call call=calls.remove(id);
    int state=in.readInt();
    if (LOG.isDebugEnabled()) {
      LOG.debug("call #" + id + " state is "+ state);
    }
    if (state == Status.SUCCESS.state) {
      Writable value=ReflectionUtils.newInstance(valueClass,conf);
      value.readFields(in);
      if (LOG.isDebugEnabled()) {
        LOG.debug("call #" + id + ", response is:\n"+ value.toString());
      }
      call.setValue(value);
    }
 else     if (state == Status.ERROR.state) {
      call.setException(new RemoteException(WritableUtils.readString(in),WritableUtils.readString(in)));
    }
 else     if (state == Status.FATAL.state) {
      markClosed(new RemoteException(WritableUtils.readString(in),WritableUtils.readString(in)));
    }
  }
 catch (  IOException e) {
    if (e instanceof SocketTimeoutException && remoteId.rpcTimeout > 0) {
      closeException=e;
    }
 else {
      markClosed(e);
    }
  }
 finally {
    if (remoteId.rpcTimeout > 0) {
      cleanupCalls(remoteId.rpcTimeout);
    }
  }
}
