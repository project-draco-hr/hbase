{
  LOG.info("test=doTestFlushCommits");
  Configuration newconf=new Configuration(conf);
  newconf.setInt("hbase.client.retries.number",10);
  HTable table=new HTable(newconf,TEST_TABLE);
  table.setAutoFlush(false);
  table.setWriteBufferSize(10 * 1024 * 1024);
  List<Row> puts=constructPutRequests();
  for (  Row put : puts) {
    table.put((Put)put);
  }
  table.flushCommits();
  if (doAbort) {
    cluster.abortRegionServer(0);
    puts=constructPutRequests();
    for (    Row put : puts) {
      table.put((Put)put);
    }
    table.flushCommits();
  }
  validateLoadedData(table);
  HBaseAdmin admin=new HBaseAdmin(conf);
  ClusterStatus cs=admin.getClusterStatus();
  assertEquals((doAbort ? 1 : 2),cs.getServers());
  for (  HServerInfo info : cs.getServerInfo()) {
    System.out.println(info);
    assertTrue(info.getLoad().getNumberOfRegions() > 10);
  }
}
