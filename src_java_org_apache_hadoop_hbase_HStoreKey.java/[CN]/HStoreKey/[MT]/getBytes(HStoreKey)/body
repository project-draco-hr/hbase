{
  if (hsk == null) {
    throw new IllegalArgumentException("Writable cannot be null");
  }
  final int serializedSize=getSerializedSize(hsk);
  final ByteArrayOutputStream byteStream=new ByteArrayOutputStream(serializedSize);
  DataOutputStream out=new DataOutputStream(byteStream);
  try {
    hsk.write(out);
    out.close();
    out=null;
    final byte[] serializedKey=byteStream.toByteArray();
    if (serializedKey.length != serializedSize) {
      throw new AssertionError("Sizes do not agree " + serializedKey.length + ", "+ serializedSize);
    }
    return serializedKey;
  }
  finally {
    if (out != null) {
      out.close();
    }
  }
}
