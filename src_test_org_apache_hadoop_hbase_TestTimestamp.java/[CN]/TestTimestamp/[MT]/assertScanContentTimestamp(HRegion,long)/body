{
  int count=0;
  HInternalScannerInterface scanner=r.getScanner(COLUMNS,HConstants.EMPTY_START_ROW,ts,null);
  try {
    HStoreKey key=new HStoreKey();
    TreeMap<Text,byte[]> value=new TreeMap<Text,byte[]>();
    while (scanner.next(key,value)) {
      assertTrue(key.getTimestamp() <= ts);
      Text row=key.getRow();
      assertEquals(row.toString(),new String(value.get(COLUMN),HConstants.UTF8_ENCODING));
      count++;
      value.clear();
    }
  }
  finally {
    scanner.close();
  }
  return count;
}
