{
  MiniHBaseCluster cluster=new MiniHBaseCluster(this.conf,1);
  try {
    HTable table=createTable();
    put(table,VERSION1.getBytes(HConstants.UTF8_ENCODING),T0);
    put(table,LATEST.getBytes(HConstants.UTF8_ENCODING),-1);
    long lockid=table.startUpdate(ROW);
    table.delete(lockid,COLUMN);
    table.commit(lockid,T1);
    assertGets(table);
    HRegionServer s=cluster.regionThreads.get(0).getRegionServer();
    for (    HRegion r : s.onlineRegions.values()) {
      r.flushcache(false);
    }
    assertGets(table);
    assertScanCount(table,-1,1);
    assertScanCount(table,T1,0);
  }
 catch (  Exception e) {
    cluster.shutdown();
  }
}
