{
  byte[] value="value".getBytes(UTF8_ENCODING);
  try {
    new HTable(conf,nosuchTable);
  }
 catch (  TableNotFoundException e) {
  }
catch (  IOException e) {
    e.printStackTrace();
    fail();
  }
  HTableDescriptor tableAdesc=new HTableDescriptor(tableAname);
  tableAdesc.addFamily(family1);
  HTableDescriptor tableBdesc=new HTableDescriptor(tableBname);
  tableBdesc.addFamily(family1);
  HBaseAdmin admin=new HBaseAdmin(conf);
  admin.createTable(tableAdesc);
  admin.createTable(tableBdesc);
  HTable a=new HTable(conf,tableAname);
  HTableDescriptor meta=a.getConnection().getHTableDescriptor(tableAdesc.getName());
  assertTrue(meta.equals(tableAdesc));
  Put put=new Put(row);
  put.add(CATALOG_FAMILY,null,value);
  a.put(put);
  HTable newA=new HTable(conf,tableAname);
  HTable b=new HTable(conf,tableBname);
  Scan scan=new Scan();
  scan.addFamily(HConstants.CATALOG_FAMILY);
  ResultScanner s=newA.getScanner(scan);
  try {
    for (    Result r : s) {
      put=new Put(r.getRow());
      for (      KeyValue kv : r.sorted()) {
        put.add(kv);
      }
      b.put(put);
    }
  }
  finally {
    s.close();
  }
  try {
    HTable anotherA=new HTable(conf,tableAname);
    Get get=new Get(row);
    get.addFamily(CATALOG_FAMILY);
    anotherA.get(get);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail();
  }
  try {
    HTableDescriptor desc=new HTableDescriptor(a.getTableDescriptor());
    admin.disableTable(tableAname);
    desc.setValue(attrName,attrValue);
    for (    HColumnDescriptor c : desc.getFamilies())     c.setValue(attrName,attrValue);
    admin.modifyTable(tableAname,HConstants.Modify.TABLE_SET_HTD,desc);
    admin.enableTable(tableAname);
    desc=a.getTableDescriptor();
    if (Bytes.compareTo(desc.getName(),tableAname) != 0)     fail("wrong table descriptor returned");
    value=desc.getValue(attrName);
    if (value == null)     fail("missing HTD attribute value");
    if (Bytes.compareTo(value,attrValue) != 0)     fail("HTD attribute value is incorrect");
    for (    HColumnDescriptor c : desc.getFamilies()) {
      value=c.getValue(attrName);
      if (value == null)       fail("missing HCD attribute value");
      if (Bytes.compareTo(value,attrValue) != 0)       fail("HCD attribute value is incorrect");
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail();
  }
}
