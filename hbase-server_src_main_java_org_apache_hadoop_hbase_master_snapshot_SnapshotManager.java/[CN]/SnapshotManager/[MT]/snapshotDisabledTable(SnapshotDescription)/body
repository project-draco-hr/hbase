{
  snapshot=snapshot.toBuilder().setType(Type.DISABLED).build();
  DisabledTableSnapshotHandler handler;
  try {
    handler=new DisabledTableSnapshotHandler(snapshot,this.master);
    this.executorService.submit(handler);
    this.handler=handler;
  }
 catch (  IOException e) {
    Path workingDir=SnapshotDescriptionUtils.getWorkingSnapshotDir(snapshot,rootDir);
    try {
      if (!this.master.getMasterFileSystem().getFileSystem().delete(workingDir,true)) {
        LOG.error("Couldn't delete working directory (" + workingDir + " for snapshot:"+ ClientSnapshotDescriptionUtils.toString(snapshot));
      }
    }
 catch (    IOException e1) {
      LOG.error("Couldn't delete working directory (" + workingDir + " for snapshot:"+ ClientSnapshotDescriptionUtils.toString(snapshot));
    }
    throw new SnapshotCreationException("Could not build snapshot handler",e,snapshot);
  }
}
