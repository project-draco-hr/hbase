{
  TakeSnapshotHandler handler;
  try {
    handler=new EnabledTableSnapshotHandler(snapshot,master,this,metricsMaster).prepare();
    this.executorService.submit(handler);
    this.handler=handler;
  }
 catch (  Exception e) {
    Path workingDir=SnapshotDescriptionUtils.getWorkingSnapshotDir(snapshot,rootDir);
    try {
      if (!this.master.getMasterFileSystem().getFileSystem().delete(workingDir,true)) {
        LOG.warn("Couldn't delete working directory (" + workingDir + " for snapshot:"+ ClientSnapshotDescriptionUtils.toString(snapshot));
      }
    }
 catch (    IOException e1) {
      LOG.warn("Couldn't delete working directory (" + workingDir + " for snapshot:"+ ClientSnapshotDescriptionUtils.toString(snapshot));
    }
    throw new SnapshotCreationException("Could not build snapshot handler",e,snapshot);
  }
}
