{
  TakeSnapshotHandler handler;
  try {
    handler=new EnabledTableSnapshotHandler(snapshot,master,this);
    this.executorService.submit(handler);
    this.handler=handler;
  }
 catch (  IOException e) {
    Path workingDir=SnapshotDescriptionUtils.getWorkingSnapshotDir(snapshot,rootDir);
    try {
      if (!this.master.getMasterFileSystem().getFileSystem().delete(workingDir,true)) {
        LOG.warn("Couldn't delete working directory (" + workingDir + " for snapshot:"+ SnapshotDescriptionUtils.toString(snapshot));
      }
    }
 catch (    IOException e1) {
      LOG.warn("Couldn't delete working directory (" + workingDir + " for snapshot:"+ SnapshotDescriptionUtils.toString(snapshot));
    }
    throw new SnapshotCreationException("Could not build snapshot handler",e,snapshot);
  }
}
