{
  FileSystem fs=master.getMasterFileSystem().getFileSystem();
  Path workingDir=SnapshotDescriptionUtils.getWorkingSnapshotDir(snapshot,rootDir);
  if (isTakingSnapshot()) {
    throw new SnapshotCreationException("Already running another snapshot:" + this.handler.getSnapshot(),snapshot);
  }
  if (isRestoringTable(snapshot.getTable())) {
    throw new SnapshotCreationException("Restore in progress on the same table snapshot:" + this.handler.getSnapshot(),snapshot);
  }
  try {
    fs.delete(workingDir,true);
    if (!fs.mkdirs(workingDir)) {
      throw new SnapshotCreationException("Couldn't create working directory (" + workingDir + ") for snapshot.",snapshot);
    }
  }
 catch (  HBaseSnapshotException e) {
    throw e;
  }
catch (  IOException e) {
    throw new SnapshotCreationException("Exception while checking to see if snapshot could be started.",e,snapshot);
  }
}
