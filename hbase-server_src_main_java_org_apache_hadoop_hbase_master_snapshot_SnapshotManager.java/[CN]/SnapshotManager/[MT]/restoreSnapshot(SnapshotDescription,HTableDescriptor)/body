{
  String tableName=hTableDescriptor.getNameAsString();
  if (isTakingSnapshot(tableName)) {
    throw new RestoreSnapshotException("Snapshot in progress on the restore table=" + tableName);
  }
  if (isRestoringTable(tableName)) {
    throw new RestoreSnapshotException("Restore already in progress on the table=" + tableName);
  }
  try {
    RestoreSnapshotHandler handler=new RestoreSnapshotHandler(master,snapshot,hTableDescriptor,metricsMaster).prepare();
    this.executorService.submit(handler);
    restoreHandlers.put(hTableDescriptor.getNameAsString(),handler);
  }
 catch (  Exception e) {
    String msg="Couldn't restore the snapshot=" + ClientSnapshotDescriptionUtils.toString(snapshot) + " on table="+ tableName;
    LOG.error(msg,e);
    throw new RestoreSnapshotException(msg,e);
  }
}
