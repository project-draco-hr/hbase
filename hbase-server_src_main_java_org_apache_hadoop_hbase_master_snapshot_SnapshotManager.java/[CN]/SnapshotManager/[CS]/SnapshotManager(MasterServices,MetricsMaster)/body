{
  this.master=master;
  this.metricsMaster=metricsMaster;
  this.rootDir=master.getMasterFileSystem().getRootDir();
  checkSnapshotSupport(master.getConfiguration(),master.getMasterFileSystem());
  Configuration conf=master.getConfiguration();
  this.wakeFrequency=conf.getInt(SNAPSHOT_WAKE_MILLIS_KEY,SNAPSHOT_WAKE_MILLIS_DEFAULT);
  long keepAliveTime=conf.getLong(SNAPSHOT_TIMEOUT_MILLIS_KEY,SNAPSHOT_TIMEOUT_MILLIS_DEFAULT);
  String name=master.getServerName().toString();
  ThreadPoolExecutor tpool=ProcedureCoordinator.defaultPool(name,keepAliveTime,opThreads,wakeFrequency);
  ProcedureCoordinatorRpcs comms=new ZKProcedureCoordinatorRpcs(master.getZooKeeper(),SnapshotManager.ONLINE_SNAPSHOT_CONTROLLER_DESCRIPTION,name);
  this.coordinator=new ProcedureCoordinator(comms,tpool);
  this.executorService=master.getExecutorService();
  resetTempDir();
}
