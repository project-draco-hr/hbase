{
  archivingClient.enableHFileBackupAsync(TABLE_NAME);
  assertTrue("Archving didn't get turned on",archivingClient.getArchivingEnabled(TABLE_NAME));
  String otherTable="otherTable";
  UTIL.createTable(Bytes.toBytes(otherTable),TEST_FAM);
  FileSystem fs=FileSystem.get(UTIL.getConfiguration());
  loadAndCompact(STRING_TABLE_NAME);
  loadAndCompact(otherTable);
  Thread.sleep(ttl);
  ensureHFileCleanersRun();
  Path primaryStoreArchive=HFileArchiveTestingUtil.getStoreArchivePath(UTIL,STRING_TABLE_NAME,TEST_FAM);
  Path otherStoreArchive=HFileArchiveTestingUtil.getStoreArchivePath(UTIL,otherTable,TEST_FAM);
  assertTrue("Store archive got deleted",fs.exists(primaryStoreArchive));
  assertTrue("Archived HFiles got deleted",FSUtils.listStatus(fs,primaryStoreArchive,null).length > 0);
  assertNull("Archived HFiles should have gotten deleted, but didn't",FSUtils.listStatus(fs,otherStoreArchive,null));
  Thread.sleep(ttl);
  ensureHFileCleanersRun();
  assertFalse(fs.exists(otherStoreArchive));
  Thread.sleep(ttl);
  ensureHFileCleanersRun();
  Path parent=otherStoreArchive.getParent();
  assertFalse(fs.exists(parent));
  Thread.sleep(ttl);
  ensureHFileCleanersRun();
  parent=otherStoreArchive.getParent();
  assertFalse(fs.exists(parent));
  assertTrue(fs.exists(HFileArchiveUtil.getArchivePath(UTIL.getConfiguration())));
  FSUtils.logFileSystemState(fs,HFileArchiveUtil.getArchivePath(UTIL.getConfiguration()),LOG);
  UTIL.deleteTable(Bytes.toBytes(otherTable));
}
