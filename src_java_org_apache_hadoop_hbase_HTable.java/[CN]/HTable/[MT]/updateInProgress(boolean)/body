{
  if (updateMustBeInProgress) {
    if (batch.get() == null) {
      throw new IllegalStateException("no update in progress");
    }
  }
 else {
    if (batch.get() != null) {
      throw new IllegalStateException("update in progress");
    }
  }
}
