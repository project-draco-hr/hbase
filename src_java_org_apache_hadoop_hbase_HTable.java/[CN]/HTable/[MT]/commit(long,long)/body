{
  checkClosed();
  updateInProgress(true);
  if (batch.get().getLockid() != lockid) {
    throw new IllegalArgumentException("invalid lock id " + lockid);
  }
  try {
    getRegionServerWithRetries(new ServerCallable<Boolean>(batch.get().getRow()){
      public Boolean call() throws IOException {
        server.batchUpdate(location.getRegionInfo().getRegionName(),timestamp,batch.get());
        return null;
      }
    }
);
  }
  finally {
    batch.set(null);
  }
}
