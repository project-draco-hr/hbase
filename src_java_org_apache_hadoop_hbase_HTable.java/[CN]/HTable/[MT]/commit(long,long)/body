{
  checkClosed();
  updateInProgress(true);
  if (batch.getLockid() != lockid) {
    throw new IllegalArgumentException("invalid lock id " + lockid);
  }
  try {
    for (int tries=0; tries < numRetries; tries++) {
      HRegionLocation r=getRegionLocation(batch.getRow());
      HRegionInterface server=connection.getHRegionConnection(r.getServerAddress());
      try {
        server.batchUpdate(r.getRegionInfo().getRegionName(),timestamp,batch);
        break;
      }
 catch (      IOException e) {
        if (e instanceof RemoteException) {
          e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
        }
        if (tries < numRetries - 1) {
          if (LOG.isDebugEnabled()) {
            LOG.debug("reloading table servers because: " + e.getMessage());
          }
          tableServers=connection.reloadTableServers(tableName);
        }
 else {
          throw e;
        }
      }
      try {
        Thread.sleep(pause);
      }
 catch (      InterruptedException e) {
      }
    }
  }
  finally {
    batch=null;
  }
}
