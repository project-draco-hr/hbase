{
  Stat stat=new Stat();
  long t=-1;
  byte[] data;
synchronized (grabTaskLock) {
    currentTask=path;
    workerInGrabTask=true;
    if (Thread.interrupted()) {
      return;
    }
  }
  try {
    try {
      if ((data=ZKUtil.getDataNoWatch(this.watcher,path,stat)) == null) {
        SplitLogCounters.tot_wkr_failed_to_grab_task_no_data.incrementAndGet();
        return;
      }
    }
 catch (    KeeperException e) {
      LOG.warn("Failed to get data for znode " + path,e);
      SplitLogCounters.tot_wkr_failed_to_grab_task_exception.incrementAndGet();
      return;
    }
    SplitLogTask slt;
    try {
      slt=SplitLogTask.parseFrom(data);
    }
 catch (    DeserializationException e) {
      LOG.warn("Failed parse data for znode " + path,e);
      SplitLogCounters.tot_wkr_failed_to_grab_task_exception.incrementAndGet();
      return;
    }
    if (slt.isUnassigned() == false) {
      SplitLogCounters.tot_wkr_failed_to_grab_task_owned.incrementAndGet();
      return;
    }
    currentVersion=stat.getVersion();
    if (attemptToOwnTask(true) == false) {
      SplitLogCounters.tot_wkr_failed_to_grab_task_lost_race.incrementAndGet();
      return;
    }
    if (ZKSplitLog.isRescanNode(watcher,currentTask)) {
      endTask(new SplitLogTask.Done(this.serverName),SplitLogCounters.tot_wkr_task_acquired_rescan);
      return;
    }
    LOG.info("worker " + serverName + " acquired task "+ path);
    SplitLogCounters.tot_wkr_task_acquired.incrementAndGet();
    getDataSetWatchAsync();
    t=System.currentTimeMillis();
    TaskExecutor.Status status;
    status=splitTaskExecutor.exec(ZKSplitLog.getFileName(currentTask),new CancelableProgressable(){
      @Override public boolean progress(){
        if (attemptToOwnTask(false) == false) {
          LOG.warn("Failed to heartbeat the task" + currentTask);
          return false;
        }
        return true;
      }
    }
);
switch (status) {
case DONE:
      endTask(new SplitLogTask.Done(this.serverName),SplitLogCounters.tot_wkr_task_done);
    break;
case PREEMPTED:
  SplitLogCounters.tot_wkr_preempt_task.incrementAndGet();
LOG.warn("task execution prempted " + path);
break;
case ERR:
if (!exitWorker) {
endTask(new SplitLogTask.Err(this.serverName),SplitLogCounters.tot_wkr_task_err);
break;
}
case RESIGNED:
if (exitWorker) {
LOG.info("task execution interrupted because worker is exiting " + path);
endTask(new SplitLogTask.Resigned(this.serverName),SplitLogCounters.tot_wkr_task_resigned);
}
 else {
SplitLogCounters.tot_wkr_preempt_task.incrementAndGet();
LOG.info("task execution interrupted via zk by manager " + path);
}
break;
}
}
  finally {
if (t > 0) {
LOG.info("worker " + serverName + " done with task "+ path+ " in "+ (System.currentTimeMillis() - t)+ "ms");
}
synchronized (grabTaskLock) {
workerInGrabTask=false;
Thread.interrupted();
}
}
return;
}
