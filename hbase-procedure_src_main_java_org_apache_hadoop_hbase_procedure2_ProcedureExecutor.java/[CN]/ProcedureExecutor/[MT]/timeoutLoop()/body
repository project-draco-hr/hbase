{
  while (isRunning()) {
    Procedure proc;
    try {
      proc=waitingTimeout.take().proc;
    }
 catch (    InterruptedException e) {
      continue;
    }
    if (proc == null) {
      break;
    }
    if (proc instanceof ProcedureInMemoryChore) {
      if (proc.isRunnable()) {
        try {
          ((ProcedureInMemoryChore)proc).periodicExecute(getEnvironment());
        }
 catch (        Throwable e) {
          LOG.error("Ignoring CompletedProcedureCleaner exception: " + e.getMessage(),e);
        }
        proc.updateTimestamp();
        if (proc.isRunnable())         waitingTimeout.add(new DelayedContainer(proc));
      }
      continue;
    }
    if (proc.setTimeoutFailure(getEnvironment())) {
      long rootProcId=Procedure.getRootProcedureId(procedures,proc);
      RootProcedureState procStack=rollbackStack.get(rootProcId);
      procStack.abort();
      store.update(proc);
      scheduler.addFront(proc);
      continue;
    }
  }
}
