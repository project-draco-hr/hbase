{
  if (completed.isEmpty()) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("No completed procedures to cleanup.");
    }
    return;
  }
  final long evictTtl=conf.getInt(EVICT_TTL_CONF_KEY,DEFAULT_EVICT_TTL);
  final long evictAckTtl=conf.getInt(EVICT_ACKED_TTL_CONF_KEY,DEFAULT_ACKED_EVICT_TTL);
  final long now=EnvironmentEdgeManager.currentTime();
  final Iterator<Map.Entry<Long,ProcedureInfo>> it=completed.entrySet().iterator();
  final boolean isDebugEnabled=LOG.isDebugEnabled();
  while (it.hasNext() && store.isRunning()) {
    final Map.Entry<Long,ProcedureInfo> entry=it.next();
    final ProcedureInfo procInfo=entry.getValue();
    if ((procInfo.hasClientAckTime() && (now - procInfo.getClientAckTime()) >= evictAckTtl) || (now - procInfo.getLastUpdate()) >= evictTtl) {
      if (isDebugEnabled) {
        LOG.debug("Evict completed procedure: " + procInfo);
      }
      store.delete(entry.getKey());
      it.remove();
      NonceKey nonceKey=procInfo.getNonceKey();
      if (nonceKey != null) {
        nonceKeysToProcIdsMap.remove(nonceKey);
      }
    }
  }
}
