{
  if (batchPool == null) {
synchronized (this) {
      if (batchPool == null) {
        int maxThreads=conf.getInt("hbase.hconnection.threads.max",256);
        if (maxThreads == 0) {
          maxThreads=Runtime.getRuntime().availableProcessors() * 8;
        }
        long keepAliveTime=conf.getLong("hbase.hconnection.threads.keepalivetime",60);
        LinkedBlockingQueue<Runnable> workQueue=new LinkedBlockingQueue<Runnable>(256 * conf.getInt(HConstants.HBASE_CLIENT_MAX_TOTAL_TASKS,HConstants.DEFAULT_HBASE_CLIENT_MAX_TOTAL_TASKS));
        this.batchPool=new ThreadPoolExecutor(maxThreads,maxThreads,keepAliveTime,TimeUnit.SECONDS,workQueue,Threads.newDaemonThreadFactory("hbase-connection-shared-executor"));
      }
      this.cleanupPool=true;
    }
  }
  return this.batchPool;
}
