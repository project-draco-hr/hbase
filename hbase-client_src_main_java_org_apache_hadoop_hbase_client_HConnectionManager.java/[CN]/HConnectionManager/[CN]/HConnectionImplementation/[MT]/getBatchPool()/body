{
  if (batchPool == null) {
synchronized (this) {
      if (batchPool == null) {
        int maxThreads=conf.getInt("hbase.hconnection.threads.max",Integer.MAX_VALUE);
        if (maxThreads == 0) {
          maxThreads=Runtime.getRuntime().availableProcessors();
        }
        long keepAliveTime=conf.getLong("hbase.hconnection.threads.keepalivetime",60);
        this.batchPool=new ThreadPoolExecutor(Runtime.getRuntime().availableProcessors(),maxThreads,keepAliveTime,TimeUnit.SECONDS,new SynchronousQueue<Runnable>(),Threads.newDaemonThreadFactory("hbase-connection-shared-executor"));
        ((ThreadPoolExecutor)this.batchPool).allowCoreThreadTimeOut(true);
      }
      this.cleanupPool=true;
    }
  }
  return this.batchPool;
}
