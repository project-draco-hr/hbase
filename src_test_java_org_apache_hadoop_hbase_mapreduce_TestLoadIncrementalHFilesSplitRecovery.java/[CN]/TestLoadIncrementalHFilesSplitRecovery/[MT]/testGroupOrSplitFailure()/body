{
  String table="groupOrSplitStoreFail";
  setupTable(table,10);
  try {
    LoadIncrementalHFiles lih=new LoadIncrementalHFiles(util.getConfiguration()){
      int i=0;
      protected List<LoadQueueItem> groupOrSplit(      Multimap<ByteBuffer,LoadQueueItem> regionGroups,      final LoadQueueItem item,      final HTable table,      final Pair<byte[][],byte[][]> startEndKeys) throws IOException {
        i++;
        if (i == 5) {
          throw new IOException("failure");
        }
        return super.groupOrSplit(regionGroups,item,table,startEndKeys);
      }
    }
;
    Path dir=util.getDataTestDir(table);
    FileSystem fs=util.getTestFileSystem();
    buildHFiles(fs,dir,1);
    HTable t=new HTable(util.getConfiguration(),Bytes.toBytes(table));
    lih.doBulkLoad(dir,t);
    assertExpectedTable(table,ROWCOUNT,1);
  }
  finally {
    util.shutdownMiniCluster();
  }
}
