{
  int len=Ints.checkedCast(status.getLen());
  byte[] content=new byte[len];
  FSDataInputStream fsDataInputStream=fs.open(status.getPath());
  try {
    fsDataInputStream.readFully(content);
  }
  finally {
    fsDataInputStream.close();
  }
  TableDescriptor td=null;
  try {
    td=TableDescriptor.parseFrom(content);
  }
 catch (  DeserializationException e) {
    try {
      HTableDescriptor htd=HTableDescriptor.parseFrom(content);
      LOG.warn("Found old table descriptor, converting to new format for table " + htd.getTableName() + "; NOTE table will be in ENABLED state!");
      td=new TableDescriptor(htd);
      if (rewritePb)       rewriteTableDescriptor(fs,status,td);
    }
 catch (    DeserializationException e1) {
      throw new IOException("content=" + Bytes.toShort(content),e);
    }
  }
  if (rewritePb && !ProtobufUtil.isPBMagicPrefix(content)) {
    rewriteTableDescriptor(fs,status,td);
  }
  return td;
}
