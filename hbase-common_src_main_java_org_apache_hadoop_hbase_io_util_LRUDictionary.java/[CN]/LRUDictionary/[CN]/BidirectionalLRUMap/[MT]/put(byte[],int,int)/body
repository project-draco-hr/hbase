{
  byte[] stored=new byte[length];
  Bytes.putBytes(stored,0,array,offset,length);
  if (currSize < initSize) {
    if (indexToNode[currSize] == null) {
      indexToNode[currSize]=new Node();
    }
    indexToNode[currSize].setContents(stored,0,stored.length);
    setHead(indexToNode[currSize]);
    short ret=(short)currSize++;
    nodeToIndex.put(indexToNode[ret],ret);
    return ret;
  }
 else {
    short s=nodeToIndex.remove(tail);
    tail.setContents(stored,0,stored.length);
    nodeToIndex.put(tail,s);
    moveToHead(tail);
    return s;
  }
}
