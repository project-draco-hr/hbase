{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Creating scanner over " + Bytes.toString(tableName) + " starting at key '"+ Bytes.toStringBinary(scan.getStartRow())+ "'");
  }
  this.scan=scan;
  this.tableName=tableName;
  this.lastNext=EnvironmentEdgeManager.currentTimeMillis();
  this.connection=connection;
  if (scan.getMaxResultSize() > 0) {
    this.maxScannerResultSize=scan.getMaxResultSize();
  }
 else {
    this.maxScannerResultSize=conf.getLong(HConstants.HBASE_CLIENT_SCANNER_MAX_RESULT_SIZE_KEY,HConstants.DEFAULT_HBASE_CLIENT_SCANNER_MAX_RESULT_SIZE);
  }
  this.scannerTimeout=conf.getInt(HConstants.HBASE_CLIENT_SCANNER_TIMEOUT_PERIOD,HConstants.DEFAULT_HBASE_CLIENT_SCANNER_TIMEOUT_PERIOD);
  byte[] enableMetrics=scan.getAttribute(Scan.SCAN_ATTRIBUTES_METRICS_ENABLE);
  if (enableMetrics != null && Bytes.toBoolean(enableMetrics)) {
    scanMetrics=new ScanMetrics();
  }
  if (this.scan.getCaching() > 0) {
    this.caching=this.scan.getCaching();
  }
 else {
    this.caching=conf.getInt("hbase.client.scanner.caching",1);
  }
  nextScanner(this.caching,false);
}
