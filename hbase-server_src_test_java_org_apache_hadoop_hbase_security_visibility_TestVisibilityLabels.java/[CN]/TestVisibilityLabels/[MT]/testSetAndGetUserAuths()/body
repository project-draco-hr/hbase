{
  final String user="user1";
  PrivilegedExceptionAction<Void> action=new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      String[] auths={SECRET,CONFIDENTIAL};
      try {
        VisibilityClient.setAuths(conf,auths,user);
      }
 catch (      Throwable e) {
      }
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
  HTable ht=null;
  try {
    ht=new HTable(conf,LABELS_TABLE_NAME);
    ResultScanner scanner=ht.getScanner(new Scan());
    Result result=null;
    while ((result=scanner.next()) != null) {
      Cell label=result.getColumnLatestCell(LABELS_TABLE_FAMILY,LABEL_QUALIFIER);
      Cell userAuth=result.getColumnLatestCell(LABELS_TABLE_FAMILY,user.getBytes());
      if (Bytes.equals(SECRET.getBytes(),0,SECRET.getBytes().length,label.getValueArray(),label.getValueOffset(),label.getValueLength()) || Bytes.equals(CONFIDENTIAL.getBytes(),0,CONFIDENTIAL.getBytes().length,label.getValueArray(),label.getValueOffset(),label.getValueLength())) {
        assertNotNull(userAuth);
      }
 else {
        assertNull(userAuth);
      }
    }
  }
  finally {
    if (ht != null) {
      ht.close();
    }
  }
  action=new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      GetAuthsResponse authsResponse=null;
      try {
        authsResponse=VisibilityClient.getAuths(conf,user);
      }
 catch (      Throwable e) {
        fail("Should not have failed");
      }
      List<String> authsList=new ArrayList<String>();
      for (      ByteString authBS : authsResponse.getAuthList()) {
        authsList.add(Bytes.toString(authBS.toByteArray()));
      }
      assertEquals(2,authsList.size());
      assertTrue(authsList.contains(SECRET));
      assertTrue(authsList.contains(CONFIDENTIAL));
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
  action=new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      String[] auths1={SECRET,CONFIDENTIAL};
      GetAuthsResponse authsResponse=null;
      try {
        VisibilityClient.setAuths(conf,auths1,user);
        try {
          authsResponse=VisibilityClient.getAuths(conf,user);
        }
 catch (        Throwable e) {
          fail("Should not have failed");
        }
      }
 catch (      Throwable e) {
      }
      List<String> authsList=new ArrayList<String>();
      for (      ByteString authBS : authsResponse.getAuthList()) {
        authsList.add(Bytes.toString(authBS.toByteArray()));
      }
      assertEquals(2,authsList.size());
      assertTrue(authsList.contains(SECRET));
      assertTrue(authsList.contains(CONFIDENTIAL));
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
}
