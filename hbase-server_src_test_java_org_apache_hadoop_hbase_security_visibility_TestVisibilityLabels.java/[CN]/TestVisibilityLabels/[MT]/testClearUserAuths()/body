{
  String[] auths={SECRET,CONFIDENTIAL,PRIVATE};
  String user="testUser";
  VisibilityClient.setAuths(conf,auths,user);
  auths=new String[]{SECRET,PUBLIC,CONFIDENTIAL};
  VisibilityLabelsResponse response=VisibilityClient.clearAuths(conf,auths,user);
  List<RegionActionResult> resultList=response.getResultList();
  assertEquals(3,resultList.size());
  assertTrue(resultList.get(0).getException().getValue().isEmpty());
  assertEquals("org.apache.hadoop.hbase.security.visibility.InvalidLabelException",resultList.get(1).getException().getName());
  assertTrue(resultList.get(2).getException().getValue().isEmpty());
  HTable ht=null;
  try {
    ht=new HTable(conf,LABELS_TABLE_NAME);
    ResultScanner scanner=ht.getScanner(new Scan());
    Result result=null;
    while ((result=scanner.next()) != null) {
      Cell label=result.getColumnLatestCell(LABELS_TABLE_FAMILY,LABEL_QUALIFIER);
      Cell userAuth=result.getColumnLatestCell(LABELS_TABLE_FAMILY,user.getBytes());
      if (Bytes.equals(PRIVATE.getBytes(),0,PRIVATE.getBytes().length,label.getValueArray(),label.getValueOffset(),label.getValueLength())) {
        assertNotNull(userAuth);
      }
 else {
        assertNull(userAuth);
      }
    }
  }
  finally {
    if (ht != null) {
      ht.close();
    }
  }
  GetAuthsResponse authsResponse=VisibilityClient.getAuths(conf,user);
  List<String> authsList=new ArrayList<String>();
  for (  ByteString authBS : authsResponse.getAuthList()) {
    authsList.add(Bytes.toString(authBS.toByteArray()));
  }
  assertEquals(1,authsList.size());
  assertTrue(authsList.contains(PRIVATE));
}
