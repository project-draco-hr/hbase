{
  NavigableMap<byte[],Integer> scopes=entry.getKey().getScopes();
  if (scopes == null || scopes.isEmpty()) {
    return null;
  }
  ArrayList<KeyValue> kvs=entry.getEdit().getKeyValues();
  int size=kvs.size();
  for (int i=size - 1; i >= 0; i--) {
    KeyValue kv=kvs.get(i);
    if (!scopes.containsKey(kv.getFamily()) || scopes.get(kv.getFamily()) == HConstants.REPLICATION_SCOPE_LOCAL) {
      kvs.remove(i);
    }
  }
  if (kvs.size() < size / 2) {
    kvs.trimToSize();
  }
  return entry;
}
