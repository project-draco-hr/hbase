{
  NavigableMap<byte[],Integer> scopes=entry.getKey().getScopes();
  if (scopes == null || scopes.isEmpty()) {
    return null;
  }
  ArrayList<Cell> cells=entry.getEdit().getCells();
  int size=cells.size();
  for (int i=size - 1; i >= 0; i--) {
    Cell cell=cells.get(i);
    if (!scopes.containsKey(cell.getFamily()) || scopes.get(cell.getFamily()) == HConstants.REPLICATION_SCOPE_LOCAL) {
      cells.remove(i);
    }
  }
  if (cells.size() < size / 2) {
    cells.trimToSize();
  }
  return entry;
}
