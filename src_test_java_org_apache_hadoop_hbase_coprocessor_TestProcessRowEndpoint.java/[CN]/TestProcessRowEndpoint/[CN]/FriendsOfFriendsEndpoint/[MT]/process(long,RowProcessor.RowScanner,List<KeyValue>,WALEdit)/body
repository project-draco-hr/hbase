{
  List<KeyValue> kvs=new ArrayList<KeyValue>();
{
    Scan scan=new Scan(row,row);
    scan.addColumn(FAM,person);
    scan.addColumn(FAM,REQUESTS);
    scanner.doScan(scan,kvs);
  }
  LOG.debug("first scan:" + stringifyKvs(kvs));
  int numRequests=0;
  Scan scan=new Scan(row,row);
  for (  KeyValue kv : kvs) {
    if (Bytes.equals(kv.getQualifier(),REQUESTS)) {
      numRequests=Bytes.toInt(kv.getValue());
      continue;
    }
    byte[] friends=kv.getValue();
    for (    byte f : friends) {
      scan.addColumn(FAM,new byte[]{f});
    }
  }
  scanner.doScan(scan,kvs);
  LOG.debug("second scan:" + stringifyKvs(kvs));
  numRequests+=1;
  KeyValue kv=new KeyValue(row,FAM,REQUESTS,now,Bytes.toBytes(numRequests));
  mutations.clear();
  mutations.add(kv);
  kvs.add(kv);
  LOG.debug("final result:" + stringifyKvs(kvs) + " mutations:"+ stringifyKvs(mutations));
  result=new Result(kvs);
  KeyValue metaKv=new KeyValue(getRow(),HLog.METAFAMILY,Bytes.toBytes("FriendsOfFriends query"),person);
  walEdit.add(metaKv);
}
