{
  final String tableNameStr="test2727";
  HRegionInfo hri=createBasic3FamilyHRegionInfo(tableNameStr);
  Path basedir=new Path(hbaseRootDir,tableNameStr);
  deleteDir(basedir);
  fs.mkdirs(new Path(basedir,hri.getEncodedName()));
  HTableDescriptor htd=createBasic3FamilyHTD(tableNameStr);
  HRegion region2=HRegion.createHRegion(hri,hbaseRootDir,this.conf,htd);
  region2.close();
  region2.getLog().closeAndDelete();
  final byte[] tableName=Bytes.toBytes(tableNameStr);
  final byte[] rowName=tableName;
  HLog wal1=createWAL(this.conf);
  final int countPerFamily=1000;
  for (  HColumnDescriptor hcd : htd.getFamilies()) {
    addWALEdits(tableName,hri,rowName,hcd.getName(),countPerFamily,ee,wal1,htd);
  }
  wal1.close();
  runWALSplit(this.conf);
  HLog wal2=createWAL(this.conf);
  wal2.setSequenceNumber(wal1.getSequenceNumber());
  for (  HColumnDescriptor hcd : htd.getFamilies()) {
    addWALEdits(tableName,hri,rowName,hcd.getName(),countPerFamily,ee,wal2,htd);
  }
  wal2.close();
  runWALSplit(this.conf);
  HLog wal3=createWAL(this.conf);
  wal3.setSequenceNumber(wal2.getSequenceNumber());
  try {
    final HRegion region=new HRegion(basedir,wal3,this.fs,this.conf,hri,htd,null);
    long seqid=region.initialize();
    assertTrue(seqid > wal3.getSequenceNumber());
    region.close();
  }
  finally {
    wal3.closeAndDelete();
  }
}
