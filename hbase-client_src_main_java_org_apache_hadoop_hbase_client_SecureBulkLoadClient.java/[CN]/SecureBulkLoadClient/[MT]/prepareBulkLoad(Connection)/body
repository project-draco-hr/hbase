{
  try {
    RegionServerCallable<String> callable=new RegionServerCallable<String>(conn,table.getName(),HConstants.EMPTY_START_ROW){
      @Override public String call(      int callTimeout) throws IOException {
        byte[] regionName=getLocation().getRegionInfo().getRegionName();
        RegionSpecifier region=RequestConverter.buildRegionSpecifier(RegionSpecifierType.REGION_NAME,regionName);
        try {
          PrepareBulkLoadRequest request=PrepareBulkLoadRequest.newBuilder().setTableName(ProtobufUtil.toProtoTableName(table.getName())).setRegion(region).build();
          PrepareBulkLoadResponse response=getStub().prepareBulkLoad(null,request);
          return response.getBulkToken();
        }
 catch (        ServiceException se) {
          throw ProtobufUtil.getRemoteException(se);
        }
      }
    }
;
    return RpcRetryingCallerFactory.instantiate(conn.getConfiguration(),null).<String>newCaller().callWithRetries(callable,Integer.MAX_VALUE);
  }
 catch (  Throwable throwable) {
    throw new IOException(throwable);
  }
}
