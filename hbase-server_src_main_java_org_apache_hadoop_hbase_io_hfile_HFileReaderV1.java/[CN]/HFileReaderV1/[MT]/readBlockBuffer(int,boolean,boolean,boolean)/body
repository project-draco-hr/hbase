{
  if (dataBlockIndexReader == null) {
    throw new IOException("Block index not loaded");
  }
  if (block < 0 || block >= dataBlockIndexReader.getRootBlockCount()) {
    throw new IOException("Requested block is out of range: " + block + ", max: "+ dataBlockIndexReader.getRootBlockCount());
  }
  long offset=dataBlockIndexReader.getRootBlockOffset(block);
  BlockCacheKey cacheKey=new BlockCacheKey(name,offset);
synchronized (dataBlockIndexReader.getRootBlockKey(block)) {
    blockLoads.incrementAndGet();
    if (cacheConf.isBlockCacheEnabled()) {
      HFileBlock cachedBlock=(HFileBlock)cacheConf.getBlockCache().getBlock(cacheKey,cacheConf.shouldCacheDataOnRead());
      if (cachedBlock != null) {
        cacheHits.incrementAndGet();
        getSchemaMetrics().updateOnCacheHit(cachedBlock.getBlockType().getCategory(),isCompaction);
        return cachedBlock.getBufferWithoutHeader();
      }
    }
    long startTimeNs=System.nanoTime();
    long nextOffset;
    if (block == dataBlockIndexReader.getRootBlockCount() - 1) {
      nextOffset=(metaBlockIndexReader.getRootBlockCount() == 0) ? this.trailer.getFileInfoOffset() : metaBlockIndexReader.getRootBlockOffset(0);
    }
 else {
      nextOffset=dataBlockIndexReader.getRootBlockOffset(block + 1);
    }
    HFileBlock hfileBlock=fsBlockReader.readBlockData(offset,nextOffset - offset,dataBlockIndexReader.getRootBlockDataSize(block),pread);
    passSchemaMetricsTo(hfileBlock);
    hfileBlock.expectType(BlockType.DATA);
    final long delta=System.nanoTime() - startTimeNs;
    HFile.offerReadLatency(delta,pread);
    getSchemaMetrics().updateOnCacheMiss(BlockCategory.DATA,isCompaction,delta);
    if (cacheBlock && cacheConf.shouldCacheBlockOnRead(hfileBlock.getBlockType().getCategory())) {
      cacheConf.getBlockCache().cacheBlock(cacheKey,hfileBlock,cacheConf.isInMemory());
    }
    return hfileBlock.getBufferWithoutHeader();
  }
}
