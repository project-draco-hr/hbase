{
  job.setOutputFormat(TableOutputFormat.class);
  job.setReducerClass(reducer);
  job.set(TableOutputFormat.OUTPUT_TABLE,table);
  job.setOutputKeyClass(ImmutableBytesWritable.class);
  job.setOutputValueClass(BatchUpdate.class);
  if (partitioner == HRegionPartitioner.class) {
    job.setPartitionerClass(HRegionPartitioner.class);
    HTable outputTable=new HTable(new HBaseConfiguration(job),table);
    int regions=outputTable.getRegionsInfo().size();
    if (job.getNumReduceTasks() > regions) {
      job.setNumReduceTasks(outputTable.getRegionsInfo().size());
    }
  }
 else   if (partitioner != null) {
    job.setPartitionerClass(partitioner);
  }
}
