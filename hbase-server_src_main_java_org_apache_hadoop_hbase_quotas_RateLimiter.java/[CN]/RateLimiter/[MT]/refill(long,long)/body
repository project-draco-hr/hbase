{
  long delta=(limit * (now - lastTs)) / tunit;
  if (delta > 0) {
    avail=Math.min(limit,avail + delta);
  }
  return avail;
}
