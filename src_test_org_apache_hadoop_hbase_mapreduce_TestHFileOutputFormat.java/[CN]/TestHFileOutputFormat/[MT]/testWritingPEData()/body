{
  this.conf.setInt("io.sort.mb",20);
  this.conf.setLong("hbase.hregion.max.filesize",64 * 1024);
  Job job=new Job(this.conf,getName());
  job.setInputFormatClass(TestHFileOutputFormat.PEInputFormat.class);
  job.setMapperClass(TestHFileOutputFormat.PEtoKVMapper.class);
  job.setMapOutputKeyClass(ImmutableBytesWritable.class);
  job.setMapOutputValueClass(KeyValue.class);
  job.setReducerClass(KeyValueSortReducer.class);
  job.setOutputFormatClass(HFileOutputFormat.class);
  FileOutputFormat.setOutputPath(job,this.testDir);
  assertTrue(job.waitForCompletion(false));
  FileStatus[] files=this.fs.listStatus(this.testDir);
  assertTrue(files.length > 0);
}
