{
  long stop=EnvironmentEdgeManager.currentTimeMillis() + timeout;
  long waitTime=Math.min(50,timeout);
synchronized (metaAvailable) {
    while (!stopped && (timeout == 0 || EnvironmentEdgeManager.currentTimeMillis() < stop)) {
      if (getMetaServerConnection() != null) {
        return metaLocation;
      }
      metaAvailable.wait(waitTime);
    }
    if (getMetaServerConnection() == null) {
      throw new NotAllMetaRegionsOnlineException("Timed out (" + timeout + "ms)");
    }
    return metaLocation;
  }
}
