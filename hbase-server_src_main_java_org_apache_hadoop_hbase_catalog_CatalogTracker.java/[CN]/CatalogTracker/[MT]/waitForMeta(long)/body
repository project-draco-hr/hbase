{
  long stop=timeout == 0 ? Long.MAX_VALUE : System.currentTimeMillis() + timeout;
  long waitTime=Math.min(50,timeout);
synchronized (metaAvailable) {
    while (!stopped && System.currentTimeMillis() < stop) {
      if (getMetaServerConnection() != null) {
        return metaLocation;
      }
      metaAvailable.wait(waitTime);
    }
    if (getMetaServerConnection() == null) {
      throw new NotAllMetaRegionsOnlineException("Timed out (" + timeout + "ms)");
    }
    return metaLocation;
  }
}
