{
  HTableDescriptor htd=hbu.createTableDescriptor(name.getMethodName(),0,3,HConstants.FOREVER,KeepDeletedCells.TRUE);
  HRegion region=hbu.createLocalHRegion(htd,null,null);
  long ts=EnvironmentEdgeManager.currentTime();
  Put p=new Put(T1,ts);
  p.add(c0,c0,T1);
  region.put(p);
  p=new Put(T1,ts + 2);
  p.add(c0,c0,T2);
  region.put(p);
  p=new Put(T1,ts + 4);
  p.add(c0,c0,T3);
  region.put(p);
  Delete d=new Delete(T1,ts + 1);
  region.delete(d);
  d=new Delete(T1,ts + 2);
  d.deleteColumn(c0,c0,ts + 2);
  region.delete(d);
  d=new Delete(T1,ts + 3);
  d.deleteColumns(c0,c0,ts + 3);
  region.delete(d);
  Scan s=new Scan();
  s.setRaw(true);
  s.setMaxVersions();
  InternalScanner scan=region.getScanner(s);
  List<Cell> kvs=new ArrayList<Cell>();
  scan.next(kvs);
  assertEquals(8,kvs.size());
  assertTrue(CellUtil.isDeleteFamily(kvs.get(0)));
  assertArrayEquals(CellUtil.cloneValue(kvs.get(1)),T3);
  assertTrue(CellUtil.isDelete(kvs.get(2)));
  assertTrue(CellUtil.isDelete(kvs.get(3)));
  assertArrayEquals(CellUtil.cloneValue(kvs.get(4)),T2);
  assertArrayEquals(CellUtil.cloneValue(kvs.get(5)),T1);
  assertTrue(CellUtil.isDeleteFamily(kvs.get(6)));
  assertTrue(CellUtil.isDeleteFamily(kvs.get(7)));
  s=new Scan();
  s.setRaw(true);
  s.setMaxVersions();
  s.setTimeRange(0,1);
  scan=region.getScanner(s);
  kvs=new ArrayList<Cell>();
  scan.next(kvs);
  assertTrue(kvs.isEmpty());
  s=new Scan();
  s.setRaw(true);
  s.setMaxVersions();
  s.setTimeRange(0,ts + 2);
  scan=region.getScanner(s);
  kvs=new ArrayList<Cell>();
  scan.next(kvs);
  assertEquals(4,kvs.size());
  assertTrue(CellUtil.isDeleteFamily(kvs.get(0)));
  assertArrayEquals(CellUtil.cloneValue(kvs.get(1)),T1);
  assertTrue(CellUtil.isDeleteFamily(kvs.get(2)));
  assertTrue(CellUtil.isDeleteFamily(kvs.get(3)));
  s=new Scan();
  s.setRaw(true);
  s.setMaxVersions();
  s.setTimeRange(ts + 3,ts + 5);
  scan=region.getScanner(s);
  kvs=new ArrayList<Cell>();
  scan.next(kvs);
  assertEquals(2,kvs.size());
  assertArrayEquals(CellUtil.cloneValue(kvs.get(0)),T3);
  assertTrue(CellUtil.isDelete(kvs.get(1)));
  HBaseTestingUtility.closeRegionAndWAL(region);
}
