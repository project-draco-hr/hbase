{
  HTableDescriptor htd=createTableDescriptor(getName(),0,3,HConstants.FOREVER,false);
  HRegion region=createNewHRegion(htd,null,null);
  long ts=EnvironmentEdgeManager.currentTimeMillis();
  Put p=new Put(T1,ts);
  p.add(c0,c0,T1);
  region.put(p);
  Delete d=new Delete(T1,ts + 2);
  d.deleteColumn(c0,c0,ts);
  region.delete(d,true);
  Get g=new Get(T1);
  g.setMaxVersions();
  g.setTimeRange(0L,ts + 1);
  Result r=region.get(g);
  assertTrue(r.isEmpty());
  Scan s=new Scan();
  s.setMaxVersions();
  s.setTimeRange(0L,ts + 1);
  InternalScanner scanner=region.getScanner(s);
  List<KeyValue> kvs=new ArrayList<KeyValue>();
  while (scanner.next(kvs))   ;
  assertTrue(kvs.isEmpty());
  region.flushcache();
  region.compactStores();
  assertEquals(1,countDeleteMarkers(region));
  region.compactStores(true);
  assertEquals(0,countDeleteMarkers(region));
  HRegion.closeHRegion(region);
}
