{
  try {
    this.conf.setBoolean("hbase.regionserver.restart.on.zk.expire",true);
    new HTable(conf,HConstants.META_TABLE_NAME);
    ZooKeeperWrapper zkw=new ZooKeeperWrapper(conf,EmptyWatcher.instance);
    String quorumServers=zkw.getQuorumServers();
    int sessionTimeout=5 * 1000;
    HRegionServer rs=cluster.getRegionServer(0);
    ZooKeeperWrapper rsZK=rs.getZooKeeperWrapper();
    long sessionID=rsZK.getSessionID();
    byte[] password=rsZK.getSessionPassword();
    ZooKeeper zk=new ZooKeeper(quorumServers,sessionTimeout,EmptyWatcher.instance,sessionID,password);
    zk.close();
    Thread.sleep(sessionTimeout * 3L);
    new HTable(conf,HConstants.META_TABLE_NAME);
    HBaseAdmin admin=new HBaseAdmin(conf);
    HTableDescriptor desc=new HTableDescriptor("test");
    HColumnDescriptor family=new HColumnDescriptor("fam");
    desc.addFamily(family);
    admin.createTable(desc);
    HTable table=new HTable("test");
    Put put=new Put(Bytes.toBytes("testrow"));
    put.add(Bytes.toBytes("fam"),Bytes.toBytes("col"),Bytes.toBytes("testdata"));
    table.put(put);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail();
  }
}
