{
  VersionedProtocol proxy=(VersionedProtocol)Proxy.newProxyInstance(protocol.getClassLoader(),new Class[]{protocol},new Invoker(protocol,addr,ticket,conf,factory,rpcTimeout));
  if (proxy instanceof VersionedProtocol) {
    long serverVersion=((VersionedProtocol)proxy).getProtocolVersion(protocol.getName(),clientVersion);
    if (serverVersion != clientVersion) {
      throw new HBaseRPC.VersionMismatch(protocol.getName(),clientVersion,serverVersion);
    }
  }
  return proxy;
}
