{
  final HBaseAdmin admin=new HBaseAdmin(conf);
  String msg=null;
  try {
    admin.createTable(HTableDescriptor.ROOT_TABLEDESC);
  }
 catch (  IllegalArgumentException e) {
    msg=e.toString();
  }
  assertTrue("Unexcepted exception message " + msg,msg != null && msg.startsWith(IllegalArgumentException.class.getName()) && msg.contains(HTableDescriptor.ROOT_TABLEDESC.getNameAsString()));
  msg=null;
  try {
    admin.createTable(HTableDescriptor.META_TABLEDESC);
  }
 catch (  IllegalArgumentException e) {
    msg=e.toString();
  }
  assertTrue("Unexcepted exception message " + msg,msg != null && msg.startsWith(IllegalArgumentException.class.getName()) && msg.contains(HTableDescriptor.META_TABLEDESC.getNameAsString()));
  msg=null;
  HTableDescriptor desc=new HTableDescriptor(getName());
  desc.addFamily(new HColumnDescriptor(HConstants.COLUMN_FAMILY));
  admin.createTable(desc);
  assertTrue("First table creation completed",admin.listTables().length == 1);
  boolean gotException=false;
  try {
    admin.createTable(desc);
  }
 catch (  TableExistsException e) {
    gotException=true;
    msg=e.getMessage();
  }
  assertTrue("Didn't get a TableExistsException!",gotException);
  assertTrue("Unexpected exception message " + msg,msg != null && msg.contains(getName()));
  final HTableDescriptor threadDesc=new HTableDescriptor("threaded_" + getName());
  threadDesc.addFamily(new HColumnDescriptor(HConstants.COLUMN_FAMILY));
  int count=10;
  Thread[] threads=new Thread[count];
  final AtomicInteger successes=new AtomicInteger(0);
  final AtomicInteger failures=new AtomicInteger(0);
  for (int i=0; i < count; i++) {
    threads[i]=new Thread(Integer.toString(i)){
      @Override public void run(){
        try {
          admin.createTable(threadDesc);
          successes.incrementAndGet();
        }
 catch (        TableExistsException e) {
          failures.incrementAndGet();
        }
catch (        IOException e) {
          System.out.println("Got an IOException... " + e);
          fail();
        }
      }
    }
;
  }
  for (int i=0; i < count; i++) {
    threads[i].start();
  }
  for (int i=0; i < count; i++) {
    while (threads[i].isAlive()) {
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException e) {
      }
    }
  }
  assertTrue(successes.get() == 1);
  assertTrue(failures.get() == (count - 1));
}
