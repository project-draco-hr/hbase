{
  if (closed) {
    throw new IllegalStateException("Cannot put when the BufferedMutator is closed.");
  }
  if (!(m instanceof Put) && !(m instanceof Delete)) {
    throw new IllegalArgumentException("Pass a Delete or a Put");
  }
  if (ap.hasError()) {
    writeAsyncBuffer.add(m);
    backgroundFlushCommits(true);
  }
  if (m instanceof Put) {
    validatePut((Put)m);
  }
  currentWriteBufferSize+=m.heapSize();
  writeAsyncBuffer.add(m);
  while (currentWriteBufferSize > writeBufferSize) {
    backgroundFlushCommits(false);
  }
}
