{
  if (closed) {
    throw new IllegalStateException("Cannot put when the BufferedMutator is closed.");
  }
  for (  Mutation m : ms) {
    if (m instanceof Put) {
      validatePut((Put)m);
    }
    currentWriteBufferSize+=m.heapSize();
  }
  if (ap.hasError()) {
    writeAsyncBuffer.addAll(ms);
    backgroundFlushCommits(true);
  }
 else {
    writeAsyncBuffer.addAll(ms);
  }
  while (currentWriteBufferSize > writeBufferSize) {
    backgroundFlushCommits(false);
  }
}
