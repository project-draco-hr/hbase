{
  if (this.master == null) {
    throw new MasterNotRunningException("master has been shut down");
  }
  checkReservedTableName(tableName);
  HRegionLocation firstMetaServer=getFirstMetaServerForTable(tableName);
  try {
    this.master.enableTable(tableName);
  }
 catch (  RemoteException e) {
    throw RemoteExceptionHandler.decodeRemoteException(e);
  }
  HRegionInterface server=connection.getHRegionConnection(firstMetaServer.getServerAddress());
  HRegionInfo info=new HRegionInfo();
  for (int tries=0; tries < numRetries; tries++) {
    int valuesfound=0;
    long scannerId=-1L;
    try {
      scannerId=server.openScanner(firstMetaServer.getRegionInfo().getRegionName(),COL_REGIONINFO_ARRAY,tableName,System.currentTimeMillis(),null);
      boolean isenabled=false;
      while (true) {
        MapWritable values=server.next(scannerId);
        if (values == null || values.size() == 0) {
          if (valuesfound == 0) {
            throw new NoSuchElementException("table " + tableName + " not found");
          }
          break;
        }
        valuesfound+=1;
        for (        Map.Entry<Writable,Writable> e : values.entrySet()) {
          HStoreKey key=(HStoreKey)e.getKey();
          if (key.getColumn().equals(COL_REGIONINFO)) {
            info=(HRegionInfo)Writables.getWritable(((ImmutableBytesWritable)e.getValue()).get(),info);
            isenabled=!info.offLine;
            break;
          }
        }
        if (isenabled) {
          break;
        }
      }
      if (isenabled) {
        break;
      }
    }
 catch (    IOException e) {
      if (tries == numRetries - 1) {
        if (e instanceof RemoteException) {
          e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
        }
        throw e;
      }
    }
 finally {
      if (scannerId != -1L) {
        try {
          server.close(scannerId);
        }
 catch (        Exception e) {
          LOG.warn(e);
        }
      }
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("Sleep. Waiting for first region to be enabled from " + tableName);
    }
    try {
      Thread.sleep(pause);
    }
 catch (    InterruptedException e) {
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("Wake. Waiting for first region to be enabled from " + tableName);
    }
  }
  LOG.info("Enabled table " + tableName);
}
