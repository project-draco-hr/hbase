{
  checkClosing();
synchronized (commitCheckLock) {
    TransactionState state=getTransactionState(transactionId);
    if (state == null) {
      return TransactionalRegionInterface.COMMIT_UNSUCESSFUL;
    }
    if (hasConflict(state)) {
      state.setStatus(Status.ABORTED);
      retireTransaction(state);
      return TransactionalRegionInterface.COMMIT_UNSUCESSFUL;
    }
    LOG.trace("No conflicts for transaction " + transactionId + " found in region "+ super.getRegionInfo().getRegionNameAsString()+ ". Voting for commit");
    if (state.hasWrite()) {
      state.setStatus(Status.COMMIT_PENDING);
      commitPendingTransactions.add(state);
      state.setSequenceNumber(nextSequenceId.getAndIncrement());
      commitedTransactionsBySequenceNumber.put(state.getSequenceNumber(),state);
      return TransactionalRegionInterface.COMMIT_OK;
    }
    state.setStatus(Status.COMMITED);
    this.hlog.writeCommitToLog(super.getRegionInfo(),state.getTransactionId());
    retireTransaction(state);
    return TransactionalRegionInterface.COMMIT_OK_READ_ONLY;
  }
}
