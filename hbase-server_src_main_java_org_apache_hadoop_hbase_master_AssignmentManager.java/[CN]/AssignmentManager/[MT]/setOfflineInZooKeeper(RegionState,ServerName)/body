{
  if (!state.isClosed() && !state.isOffline()) {
    String msg="Unexpected state : " + state + " .. Cannot transit it to OFFLINE.";
    this.server.abort(msg,new IllegalStateException(msg));
    return -1;
  }
  regionStates.updateRegionState(state.getRegion(),RegionState.State.OFFLINE);
  int versionOfOfflineNode;
  try {
    versionOfOfflineNode=ZKAssign.createOrForceNodeOffline(watcher,state.getRegion(),destination);
    if (versionOfOfflineNode == -1) {
      LOG.warn("Attempted to create/force node into OFFLINE state before " + "completing assignment but failed to do so for " + state);
      return -1;
    }
  }
 catch (  KeeperException e) {
    server.abort("Unexpected ZK exception creating/setting node OFFLINE",e);
    return -1;
  }
  return versionOfOfflineNode;
}
