{
  RegionState state=regionStates.getRegionState(region);
  if (state == null) {
    LOG.warn("Assigning a region not in region states: " + region);
    state=regionStates.createRegionState(region);
  }
 else {
switch (state.getState()) {
case OPEN:
case OPENING:
case PENDING_OPEN:
      if (!forceNewPlan) {
        LOG.debug("Attempting to assign region " + region + " but it is already in transition: "+ state);
        return null;
      }
case CLOSING:
case PENDING_CLOSE:
    unassign(region,state,-1,null,false);
case CLOSED:
  if (!state.isOffline()) {
    LOG.debug("Forcing OFFLINE; was=" + state);
    state=regionStates.updateRegionState(region,RegionState.State.OFFLINE);
  }
case OFFLINE:
break;
default :
LOG.error("Trying to assign region " + region + ", which is in state "+ state);
return null;
}
}
return state;
}
