{
  final long endTime=System.currentTimeMillis() + timeout;
  while (!regions.isEmpty() && !this.master.isStopped() && endTime > System.currentTimeMillis()) {
    Iterator<HRegionInfo> regionInfoIterator=regions.iterator();
    while (regionInfoIterator.hasNext()) {
      HRegionInfo hri=regionInfoIterator.next();
      if (!regionsInTransition.containsKey(hri.getEncodedName())) {
        regionInfoIterator.remove();
      }
    }
    if (!regions.isEmpty()) {
      regionsInTransition.waitForUpdate(100);
    }
  }
  return regions.isEmpty();
}
