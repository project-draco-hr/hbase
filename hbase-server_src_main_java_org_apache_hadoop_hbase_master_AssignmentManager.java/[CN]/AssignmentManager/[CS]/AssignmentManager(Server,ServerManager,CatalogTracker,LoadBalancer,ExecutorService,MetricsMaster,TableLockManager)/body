{
  super(server.getZooKeeper());
  this.server=server;
  this.serverManager=serverManager;
  this.catalogTracker=catalogTracker;
  this.executorService=service;
  this.regionsToReopen=Collections.synchronizedMap(new HashMap<String,HRegionInfo>());
  Configuration conf=server.getConfiguration();
  this.shouldAssignRegionsWithFavoredNodes=conf.getClass(HConstants.HBASE_MASTER_LOADBALANCER_CLASS,Object.class).equals(FavoredNodeLoadBalancer.class);
  this.tomActivated=conf.getBoolean("hbase.assignment.timeout.management",false);
  if (tomActivated) {
    this.serversInUpdatingTimer=new ConcurrentSkipListSet<ServerName>();
    this.timeoutMonitor=new TimeoutMonitor(conf.getInt("hbase.master.assignment.timeoutmonitor.period",30000),server,serverManager,conf.getInt("hbase.master.assignment.timeoutmonitor.timeout",600000));
    this.timerUpdater=new TimerUpdater(conf.getInt("hbase.master.assignment.timerupdater.period",10000),server);
    Threads.setDaemonThreadRunning(timerUpdater.getThread(),server.getServerName() + ".timerUpdater");
  }
 else {
    this.serversInUpdatingTimer=null;
    this.timeoutMonitor=null;
    this.timerUpdater=null;
  }
  this.zkTable=new ZKTable(this.watcher);
  this.maximumAttempts=this.server.getConfiguration().getInt("hbase.assignment.maximum.attempts",10);
  this.balancer=balancer;
  int maxThreads=conf.getInt("hbase.assignment.threads.max",30);
  this.threadPoolExecutorService=Threads.getBoundedCachedThreadPool(maxThreads,60L,TimeUnit.SECONDS,Threads.newDaemonThreadFactory("hbase-am"));
  this.metricsMaster=metricsMaster;
  this.regionStates=new RegionStates(server,serverManager);
  this.bulkAssignWaitTillAllAssigned=conf.getBoolean("hbase.bulk.assignment.waittillallassigned",false);
  this.bulkAssignThresholdRegions=conf.getInt("hbase.bulk.assignment.threshold.regions",7);
  this.bulkAssignThresholdServers=conf.getInt("hbase.bulk.assignment.threshold.servers",3);
  int workers=conf.getInt("hbase.assignment.zkevent.workers",20);
  ThreadFactory threadFactory=Threads.newDaemonThreadFactory("hbase-am-zkevent-worker");
  zkEventWorkers=Threads.getBoundedCachedThreadPool(workers,60L,TimeUnit.SECONDS,threadFactory);
  this.tableLockManager=tableLockManager;
}
