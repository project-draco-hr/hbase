{
  boolean noRSAvailable=this.serverManager.createDestinationServersList().isEmpty();
  long now=System.currentTimeMillis();
  for (  String regionName : regionStates.getRegionsInTransition().keySet()) {
    RegionState regionState=regionStates.getRegionTransitionState(regionName);
    if (regionState == null)     continue;
    if (regionState.getStamp() + timeout <= now) {
      actOnTimeOut(regionState);
    }
 else     if (this.allRegionServersOffline && !noRSAvailable) {
      RegionPlan existingPlan=regionPlans.get(regionName);
      if (existingPlan == null || !this.serverManager.isServerOnline(existingPlan.getDestination())) {
        actOnTimeOut(regionState);
      }
    }
  }
  setAllRegionServersOffline(noRSAvailable);
}
