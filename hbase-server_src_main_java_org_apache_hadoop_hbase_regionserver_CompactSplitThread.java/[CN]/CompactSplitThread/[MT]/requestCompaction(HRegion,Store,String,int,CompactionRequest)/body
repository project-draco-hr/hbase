{
  if (this.server.isStopped()) {
    return null;
  }
  CompactionRequest cr=s.requestCompaction(priority,request);
  if (cr != null) {
    cr.setServer(server);
    if (priority != Store.NO_PRIORITY) {
      cr.setPriority(priority);
    }
    ThreadPoolExecutor pool=s.throttleCompaction(cr.getSize()) ? largeCompactions : smallCompactions;
    pool.execute(cr);
    if (LOG.isDebugEnabled()) {
      String type=(pool == smallCompactions) ? "Small " : "Large ";
      LOG.debug(type + "Compaction requested: " + cr+ (why != null && !why.isEmpty() ? "; Because: " + why : "")+ "; "+ this);
    }
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Not compacting " + r.getRegionNameAsString() + " because compaction request was cancelled");
    }
  }
  return cr;
}
