{
  List<HRegionInfo> regions=MetaReader.getTableRegions(this.services.getCatalogTracker(),tableName);
  Set<String> snapshotRegions=SnapshotReferenceUtil.getSnapshotRegionNames(fs,snapshotDir);
  if (snapshotRegions == null) {
    String msg="Snapshot " + ClientSnapshotDescriptionUtils.toString(snapshot) + " looks empty";
    LOG.error(msg);
    throw new CorruptedSnapshotException(msg);
  }
  String errorMsg="";
  if (snapshotRegions.size() != regions.size()) {
    errorMsg="Regions moved during the snapshot '" + ClientSnapshotDescriptionUtils.toString(snapshot) + "'. expected="+ regions.size()+ " snapshotted="+ snapshotRegions.size()+ ".";
    LOG.error(errorMsg);
  }
  for (  HRegionInfo region : regions) {
    if (!snapshotRegions.contains(region.getEncodedName())) {
      String mesg=" No snapshot region directory found for region:" + region;
      if (errorMsg.isEmpty())       errorMsg=mesg;
      LOG.error(mesg);
    }
    verifyRegion(fs,snapshotDir,region);
  }
  if (!errorMsg.isEmpty()) {
    throw new CorruptedSnapshotException(errorMsg);
  }
}
