{
  Path regionDir=new Path(snapshotDir,region.getEncodedName());
  if (!fs.exists(regionDir)) {
    throw new CorruptedSnapshotException("No region directory found for region:" + region,snapshot);
  }
  Path regionInfo=new Path(regionDir,HRegionFileSystem.REGION_INFO_FILE);
  if (!fs.exists(regionInfo)) {
    throw new CorruptedSnapshotException("No region info found for region:" + region,snapshot);
  }
  HRegionInfo found=HRegionFileSystem.loadRegionInfoFileContent(fs,regionDir);
  if (!region.equals(found)) {
    throw new CorruptedSnapshotException("Found region info (" + found + ") doesn't match expected region:"+ region,snapshot);
  }
  TakeSnapshotUtils.verifyRecoveredEdits(fs,snapshotDir,found,snapshot);
  PathFilter familiesDirs=new FSUtils.FamilyDirFilter(fs);
  FileStatus[] columnFamilies=FSUtils.listStatus(fs,regionDir,familiesDirs);
  if (columnFamilies == null)   return;
  Path tableNameSuffix=new Path(tableName);
  Path regionNameSuffix=new Path(tableNameSuffix,region.getEncodedName());
  Path archivedRegion=new Path(HFileArchiveUtil.getArchivePath(services.getConfiguration()),regionNameSuffix);
  Path realRegion=new Path(rootDir,regionNameSuffix);
  for (  FileStatus cf : columnFamilies) {
    FileStatus[] hfiles=FSUtils.listStatus(fs,cf.getPath(),null);
    if (hfiles == null || hfiles.length == 0)     continue;
    Path realCfDir=new Path(realRegion,cf.getPath().getName());
    Path archivedCfDir=new Path(archivedRegion,cf.getPath().getName());
    for (    FileStatus hfile : hfiles) {
      if (!StoreFile.validateStoreFileName(hfile.getPath().getName())) {
        throw new CorruptedSnapshotException("HFile: " + hfile.getPath() + " is not a valid hfile name.",snapshot);
      }
      String fileName=hfile.getPath().getName();
      Path file=new Path(realCfDir,fileName);
      Path archived=new Path(archivedCfDir,fileName);
      if (!fs.exists(file) && !file.equals(archived)) {
        throw new CorruptedSnapshotException("Can't find hfile: " + hfile.getPath() + " in the real ("+ realCfDir+ ") or archive ("+ archivedCfDir+ ") directory for the primary table.",snapshot);
      }
    }
  }
}
