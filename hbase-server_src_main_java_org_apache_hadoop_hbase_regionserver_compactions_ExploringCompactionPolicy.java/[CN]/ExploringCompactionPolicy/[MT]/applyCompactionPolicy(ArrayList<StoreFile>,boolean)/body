{
  List<StoreFile> bestSelection=new ArrayList<StoreFile>(0);
  long bestSize=0;
  for (int start=0; start < candidates.size(); start++) {
    for (int currentEnd=start + comConf.getMinFilesToCompact() - 1; currentEnd < candidates.size(); currentEnd++) {
      List<StoreFile> potentialMatchFiles=candidates.subList(start,currentEnd + 1);
      if (potentialMatchFiles.size() < comConf.getMinFilesToCompact())       continue;
      if (potentialMatchFiles.size() > comConf.getMaxFilesToCompact())       continue;
      if (!filesInRatio(potentialMatchFiles,mayUseOffPeak))       continue;
      long size=0;
      for (      StoreFile s : potentialMatchFiles) {
        size+=s.getReader().length();
      }
      if (potentialMatchFiles.size() > bestSelection.size() || (potentialMatchFiles.size() == bestSelection.size() && size < bestSize)) {
        bestSelection=potentialMatchFiles;
        bestSize=size;
      }
    }
  }
  return new ArrayList<StoreFile>(bestSelection);
}
