{
  conf.setInt("hbase.hregion.memcache.flush.size",1024 * 1024);
  conf.setInt("hbase.hstore.compactionThreshold",2);
  conf.setLong("hbase.hregion.max.filesize",128 * 1024);
  desc=new HTableDescriptor(TABLE_NAME);
  desc.addFamily(new HColumnDescriptor(INPUT_COLUMN));
  desc.addFamily(new HColumnDescriptor(OUTPUT_COLUMN));
  dfsCluster=new MiniDFSCluster(conf,1,true,(String[])null);
  super.setUp();
  try {
    dir=new Path("/hbase");
    fs.mkdirs(dir);
    hCluster=new MiniHBaseCluster(conf,1,dfsCluster,true);
    HBaseAdmin admin=new HBaseAdmin(conf);
    admin.createTable(desc);
    makeMultiRegionTable(conf,hCluster,this.fs,TABLE_NAME,INPUT_COLUMN);
    HTable table=new HTable(conf,new Text(TABLE_NAME));
    Text[] startKeys=table.getStartKeys();
    assertTrue(startKeys.length > 1);
  }
 catch (  Exception e) {
    StaticTestEnvironment.shutdownDfs(dfsCluster);
    throw e;
  }
}
