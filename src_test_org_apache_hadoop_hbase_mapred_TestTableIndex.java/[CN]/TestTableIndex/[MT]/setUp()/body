{
  super.setUp();
  conf.setLong("hbase.hregion.max.filesize",256 * 1024);
  desc=new HTableDescriptor(TABLE_NAME);
  desc.addFamily(new HColumnDescriptor(INPUT_COLUMN));
  desc.addFamily(new HColumnDescriptor(OUTPUT_COLUMN));
  dfsCluster=new MiniDFSCluster(conf,1,true,(String[])null);
  try {
    fs=dfsCluster.getFileSystem();
    dir=new Path("/hbase");
    fs.mkdirs(dir);
    hCluster=new MiniHBaseCluster(conf,1,dfsCluster);
    HBaseAdmin admin=new HBaseAdmin(conf);
    admin.createTable(desc);
    MultiRegionTable.makeMultiRegionTable(conf,hCluster,null,TABLE_NAME,INPUT_COLUMN);
    HTable table=new HTable(conf,new Text(TABLE_NAME));
    Text[] startKeys=table.getStartKeys();
    assertTrue(startKeys.length > 1);
  }
 catch (  Exception e) {
    if (dfsCluster != null) {
      dfsCluster.shutdown();
      dfsCluster=null;
    }
    throw e;
  }
}
