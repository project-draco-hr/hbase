{
  long tid=System.currentTimeMillis();
  final byte[] snapshotName=Bytes.toBytes("snapshot-" + tid);
  Admin admin=UTIL.getHBaseAdmin();
  SnapshotTestingUtils.createTable(UTIL,snapshotTableName,getNumReplicas(),CF1,CF2);
  SnapshotTestingUtils.loadData(UTIL,snapshotTableName,rowCountCF1,CF1);
  SnapshotTestingUtils.loadData(UTIL,snapshotTableName,rowCountCF2,CF2);
  SnapshotTestingUtils.verifyRowCount(UTIL,snapshotTableName,rowCountCF1 + rowCountCF2);
  snapshotHTD=admin.getTableDescriptor(snapshotTableName);
  admin.disableTable(snapshotTableName);
  admin.snapshot(snapshotName,snapshotTableName);
  List<SnapshotDescription> snapshotList=admin.listSnapshots();
  snapshot=ProtobufUtil.createHBaseProtosSnapshotDesc(snapshotList.get(0));
  HColumnDescriptor columnFamilyDescriptor3=new HColumnDescriptor(CF3);
  HColumnDescriptor columnFamilyDescriptor4=new HColumnDescriptor(CF4);
  admin.addColumnFamily(snapshotTableName,columnFamilyDescriptor3);
  admin.addColumnFamily(snapshotTableName,columnFamilyDescriptor4);
  admin.deleteColumnFamily(snapshotTableName,CF2);
  admin.enableTable(snapshotTableName);
  SnapshotTestingUtils.loadData(UTIL,snapshotTableName,rowCountCF3,CF3);
  SnapshotTestingUtils.loadData(UTIL,snapshotTableName,rowCountCF4,CF4);
  SnapshotTestingUtils.loadData(UTIL,snapshotTableName,rowCountCF1addition,CF1);
  HTableDescriptor currentHTD=admin.getTableDescriptor(snapshotTableName);
  assertTrue(currentHTD.hasFamily(CF1));
  assertFalse(currentHTD.hasFamily(CF2));
  assertTrue(currentHTD.hasFamily(CF3));
  assertTrue(currentHTD.hasFamily(CF4));
  assertNotEquals(currentHTD.getFamiliesKeys().size(),snapshotHTD.getFamiliesKeys().size());
  SnapshotTestingUtils.verifyRowCount(UTIL,snapshotTableName,rowCountCF1 + rowCountCF3 + rowCountCF4+ rowCountCF1addition);
  admin.disableTable(snapshotTableName);
}
