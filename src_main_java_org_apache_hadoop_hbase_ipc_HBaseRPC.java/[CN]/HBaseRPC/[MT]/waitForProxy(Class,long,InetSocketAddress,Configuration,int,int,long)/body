{
  long startTime=System.currentTimeMillis();
  IOException ioe;
  int reconnectAttempts=0;
  while (true) {
    try {
      return getProxy(protocol,clientVersion,addr,conf,rpcTimeout);
    }
 catch (    SocketTimeoutException te) {
      LOG.info("Problem connecting to server: " + addr);
      ioe=te;
    }
catch (    IOException ioex) {
      ConnectException ce=null;
      if (ioex instanceof ConnectException) {
        ce=(ConnectException)ioex;
        ioe=ce;
      }
 else       if (ioex.getCause() != null && ioex.getCause() instanceof ConnectException) {
        ce=(ConnectException)ioex.getCause();
        ioe=ce;
      }
 else       if (ioex.getMessage().toLowerCase().contains("connection refused")) {
        ce=new ConnectException(ioex.getMessage());
        ioe=ce;
      }
 else {
        ioe=ioex;
      }
      if (ce != null) {
        handleConnectionException(++reconnectAttempts,maxAttempts,protocol,addr,ce);
      }
    }
    if (System.currentTimeMillis() - timeout >= startTime) {
      throw ioe;
    }
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException ie) {
    }
  }
}
