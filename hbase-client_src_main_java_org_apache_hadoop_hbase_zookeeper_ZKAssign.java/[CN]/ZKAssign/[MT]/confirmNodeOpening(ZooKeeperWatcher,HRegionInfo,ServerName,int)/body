{
  String encoded=region.getEncodedName();
  if (LOG.isDebugEnabled()) {
    LOG.debug(zkw.prefix("Attempting to retransition opening state of node " + HRegionInfo.prettyPrint(encoded)));
  }
  String node=getNodeName(zkw,encoded);
  zkw.sync(node);
  Stat stat=new Stat();
  byte[] existingBytes=ZKUtil.getDataNoWatch(zkw,node,stat);
  if (existingBytes == null) {
    return -1;
  }
  RegionTransition rt=getRegionTransition(existingBytes);
  if (expectedVersion != -1 && stat.getVersion() != expectedVersion) {
    LOG.warn(zkw.prefix("Attempt to retransition the opening state of the " + "unassigned node for " + encoded + " failed, "+ "the node existed but was version "+ stat.getVersion()+ " not the expected version "+ expectedVersion));
    return -1;
  }
  EventType et=rt.getEventType();
  if (!et.equals(EventType.RS_ZK_REGION_OPENING)) {
    String existingServer=(rt.getServerName() == null) ? "<unknown>" : rt.getServerName().toString();
    LOG.warn(zkw.prefix("Attempt to retransition the opening state of the unassigned node for " + encoded + " failed, the node existed but was in the state "+ et+ " set by the server "+ existingServer));
    return -1;
  }
  return expectedVersion;
}
