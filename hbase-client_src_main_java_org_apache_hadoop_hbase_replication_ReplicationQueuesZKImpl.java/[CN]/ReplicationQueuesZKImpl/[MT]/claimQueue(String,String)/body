{
  if (conf.getBoolean(HConstants.ZOOKEEPER_USEMULTI,true)) {
    LOG.info("Atomically moving " + regionserver + "/"+ queueId+ "'s WALs to my queue");
    return moveQueueUsingMulti(regionserver,queueId);
  }
 else {
    LOG.info("Moving " + regionserver + "/"+ queueId+ "'s wals to my queue");
    if (!lockOtherRS(regionserver)) {
      LOG.info("Can not take the lock now");
      return null;
    }
    Pair<String,SortedSet<String>> newQueues;
    try {
      newQueues=copyQueueFromLockedRS(regionserver,queueId);
      removeQueueFromLockedRS(regionserver,queueId);
    }
  finally {
      unlockOtherRS(regionserver);
    }
    return newQueues;
  }
}
