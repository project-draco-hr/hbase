{
  try {
    checkOpen();
    requestCount.increment();
    regionServer.getRegionServerCoprocessorHost().preRollWALWriterRequest();
    HLog wal=regionServer.getWAL();
    byte[][] regionsToFlush=wal.rollWriter(true);
    RollWALWriterResponse.Builder builder=RollWALWriterResponse.newBuilder();
    if (regionsToFlush != null) {
      for (      byte[] region : regionsToFlush) {
        builder.addRegionToFlush(ByteStringer.wrap(region));
      }
    }
    return builder.build();
  }
 catch (  IOException ie) {
    throw new ServiceException(ie);
  }
}
