{
  final HFileBlockPair kv=generateHFileBlocks(BlockSize,1)[0];
  Configuration conf=new Configuration();
  MultithreadedTestUtil.TestContext ctx=new MultithreadedTestUtil.TestContext(conf);
  final AtomicInteger totalQueries=new AtomicInteger();
  toBeTested.cacheBlock(kv.blockName,kv.block);
  for (int i=0; i < numThreads; i++) {
    TestThread t=new MultithreadedTestUtil.RepeatingTestThread(ctx){
      @Override public void doAnAction() throws Exception {
        assertEquals(kv.block,toBeTested.getBlock(kv.blockName,false));
        totalQueries.incrementAndGet();
      }
    }
;
    ctx.addThread(t);
  }
  ctx.startThreads();
  while (totalQueries.get() < numQueries && ctx.shouldRun()) {
    Thread.sleep(10);
  }
  ctx.stop();
}
