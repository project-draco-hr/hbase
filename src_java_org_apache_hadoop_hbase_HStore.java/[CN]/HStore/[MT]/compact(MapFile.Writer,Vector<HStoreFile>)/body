{
  int size=toCompactFiles.size();
  CompactionReader[] rdrs=new CompactionReader[size];
  int index=0;
  for (  HStoreFile hsf : toCompactFiles) {
    try {
      rdrs[index++]=new MapFileCompactionReader(hsf.getReader(fs,bloomFilter));
    }
 catch (    IOException e) {
      LOG.warn("Failed with " + e.toString() + ": "+ hsf.toString()+ (hsf.isReference() ? " " + hsf.getReference().toString() : ""));
      throw e;
    }
  }
  try {
    compact(compactedOut,rdrs);
  }
  finally {
    for (int i=0; i < rdrs.length; i++) {
      if (rdrs[i] != null) {
        try {
          rdrs[i].close();
        }
 catch (        IOException e) {
          LOG.warn("Exception closing reader",e);
        }
      }
    }
  }
}
