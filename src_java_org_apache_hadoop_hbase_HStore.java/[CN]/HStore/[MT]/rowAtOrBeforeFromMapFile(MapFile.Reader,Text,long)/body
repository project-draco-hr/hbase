{
  Text previousRow=null;
  ImmutableBytesWritable readval=new ImmutableBytesWritable();
  HStoreKey readkey=new HStoreKey();
synchronized (map) {
    map.reset();
    while (map.next(readkey,readval)) {
      if (readkey.getRow().compareTo(row) == 0) {
        if (readkey.getTimestamp() <= timestamp) {
          return readkey.getRow();
        }
      }
 else       if (readkey.getRow().toString().compareTo(row.toString()) > 0) {
        return previousRow;
      }
 else {
        if (readkey.getTimestamp() <= timestamp) {
          previousRow=new Text(readkey.getRow());
        }
      }
    }
  }
  return previousRow;
}
