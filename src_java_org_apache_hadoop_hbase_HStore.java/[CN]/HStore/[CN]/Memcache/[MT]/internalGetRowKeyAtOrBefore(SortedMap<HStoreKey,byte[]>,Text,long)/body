{
  HStoreKey search_key=new HStoreKey(key,timestamp);
  SortedMap<HStoreKey,byte[]> tailMap=map.tailMap(search_key);
  if (!tailMap.isEmpty() && tailMap.firstKey().getRow().equals(key)) {
    Iterator<HStoreKey> key_iterator=tailMap.keySet().iterator();
    HStoreKey found_key=key_iterator.next();
    while (found_key.getRow().equals(key) && found_key.getTimestamp() > timestamp && key_iterator.hasNext()) {
      found_key=key_iterator.next();
    }
    if (found_key.getTimestamp() <= timestamp) {
      return found_key.getRow();
    }
  }
  SortedMap<HStoreKey,byte[]> headMap=map.headMap(search_key);
  if (headMap.isEmpty()) {
    return null;
  }
 else {
    return headMap.lastKey().getRow();
  }
}
