{
  final HRegionServer rs=TEST_UTIL.getMiniHBaseCluster().getRegionServer(0);
  byte[] tableName=Bytes.toBytes("testCheckAndMutateMetrics");
  byte[] family=Bytes.toBytes("family");
  byte[] qualifier=Bytes.toBytes("qualifier");
  byte[] row=Bytes.toBytes("row1");
  HTable table=TEST_UTIL.createTable(tableName,family);
  long expectedPassed=0;
  long expectedFailed=0;
  Put put=new Put(row);
  byte[] val1=Bytes.toBytes("val1");
  put.add(family,qualifier,val1);
  table.checkAndPut(row,family,qualifier,null,put);
  expectedPassed++;
  assertCheckAndMutateMetrics(rs,expectedPassed,expectedFailed);
  byte[] val2=Bytes.toBytes("val2");
  table.checkAndPut(row,family,qualifier,val2,put);
  expectedFailed++;
  assertCheckAndMutateMetrics(rs,expectedPassed,expectedFailed);
  Delete delete=new Delete(row);
  delete.deleteColumn(family,qualifier);
  table.checkAndDelete(row,family,qualifier,val1,delete);
  expectedPassed++;
  assertCheckAndMutateMetrics(rs,expectedPassed,expectedFailed);
  table.checkAndDelete(row,family,qualifier,val1,delete);
  expectedFailed++;
  assertCheckAndMutateMetrics(rs,expectedPassed,expectedFailed);
}
