{
  lockForRegularUsage();
  try {
    final double priority=weight(timestamp - startTime) / RANDOM.nextDouble();
    final long newCount=count.incrementAndGet();
    if (newCount <= reservoirSize) {
      values.put(priority,value);
    }
 else {
      Double first=values.firstKey();
      if (first < priority) {
        if (values.putIfAbsent(priority,value) == null) {
          while (values.remove(first) == null) {
            first=values.firstKey();
          }
        }
      }
    }
  }
  finally {
    unlockForRegularUsage();
  }
  final long now=System.nanoTime();
  final long next=nextScaleTime.get();
  if (now >= next) {
    rescale(now,next);
  }
}
