{
  HRegion region=null;
  HRegionIncommon region_incommon=null;
  BatchUpdate batchUpdate=null;
  try {
    HTableDescriptor htd=createTableDescriptor(getName());
    region=createNewHRegion(htd,null,null);
    region_incommon=new HRegionIncommon(region);
    String t10="010";
    String t20="020";
    String t30="030";
    String t35="035";
    String t40="040";
    batchUpdate=new BatchUpdate(t10);
    batchUpdate.put(COLUMNS[0],"t10 bytes".getBytes());
    region.batchUpdate(batchUpdate,null);
    batchUpdate=new BatchUpdate(t20);
    batchUpdate.put(COLUMNS[0],"t20 bytes".getBytes());
    region.batchUpdate(batchUpdate,null);
    batchUpdate=new BatchUpdate(t30);
    batchUpdate.put(COLUMNS[0],"t30 bytes".getBytes());
    region.batchUpdate(batchUpdate,null);
    batchUpdate=new BatchUpdate(t35);
    batchUpdate.put(COLUMNS[0],"t35 bytes".getBytes());
    region.batchUpdate(batchUpdate,null);
    batchUpdate=new BatchUpdate(t35);
    batchUpdate.delete(COLUMNS[0]);
    region.batchUpdate(batchUpdate,null);
    batchUpdate=new BatchUpdate(t40);
    batchUpdate.put(COLUMNS[0],"t40 bytes".getBytes());
    region.batchUpdate(batchUpdate,null);
    String t15="015";
    Map<byte[],Cell> results=region.getClosestRowBefore(Bytes.toBytes(t15));
    assertEquals(new String(results.get(COLUMNS[0]).getValue()),"t10 bytes");
    results=region.getClosestRowBefore(Bytes.toBytes(t20));
    assertEquals(new String(results.get(COLUMNS[0]).getValue()),"t20 bytes");
    String t38="038";
    results=region.getClosestRowBefore(Bytes.toBytes(t38));
    assertEquals(new String(results.get(COLUMNS[0]).getValue()),"t30 bytes");
    String t50="050";
    results=region.getClosestRowBefore(Bytes.toBytes(t50));
    assertEquals(new String(results.get(COLUMNS[0]).getValue()),"t40 bytes");
    region.flushcache();
    results=region.getClosestRowBefore(Bytes.toBytes(t15));
    assertEquals(new String(results.get(COLUMNS[0]).getValue()),"t10 bytes");
    results=region.getClosestRowBefore(Bytes.toBytes(t20));
    assertEquals(new String(results.get(COLUMNS[0]).getValue()),"t20 bytes");
    results=region.getClosestRowBefore(Bytes.toBytes(t38));
    assertEquals(new String(results.get(COLUMNS[0]).getValue()),"t30 bytes");
    results=region.getClosestRowBefore(Bytes.toBytes(t50));
    assertEquals(new String(results.get(COLUMNS[0]).getValue()),"t40 bytes");
  }
  finally {
    if (region != null) {
      try {
        region.close();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
      region.getLog().closeAndDelete();
    }
  }
}
