{
  final Configuration conf=HBaseConfiguration.create();
  ServerManager sm=new ServerManager(new Server(){
    @Override public ClusterConnection getConnection(){
      return null;
    }
    @Override public MetaTableLocator getMetaTableLocator(){
      return null;
    }
    @Override public Configuration getConfiguration(){
      return conf;
    }
    @Override public ServerName getServerName(){
      return null;
    }
    @Override public ZooKeeperWatcher getZooKeeper(){
      return null;
    }
    @Override public CoordinatedStateManager getCoordinatedStateManager(){
      return null;
    }
    @Override public void abort(    String why,    Throwable e){
    }
    @Override public boolean isAborted(){
      return false;
    }
    @Override public boolean isStopped(){
      return false;
    }
    @Override public void stop(    String why){
    }
  }
,null,false);
  LOG.debug("regionServerStartup 1");
  InetAddress ia1=InetAddress.getLocalHost();
  sm.regionServerStartup(ia1,1234,-1,System.currentTimeMillis());
  final Configuration c=HBaseConfiguration.create();
  long maxSkew=c.getLong("hbase.master.maxclockskew",30000);
  long warningSkew=c.getLong("hbase.master.warningclockskew",1000);
  try {
    LOG.debug("Test: Master Time > Region Server Time");
    LOG.debug("regionServerStartup 2");
    InetAddress ia2=InetAddress.getLocalHost();
    sm.regionServerStartup(ia2,1235,-1,System.currentTimeMillis() - maxSkew * 2);
    fail("HMaster should have thrown a ClockOutOfSyncException but didn't.");
  }
 catch (  ClockOutOfSyncException e) {
    LOG.info("Recieved expected exception: " + e);
  }
  try {
    LOG.debug("Test: Master Time < Region Server Time");
    LOG.debug("regionServerStartup 3");
    InetAddress ia3=InetAddress.getLocalHost();
    sm.regionServerStartup(ia3,1236,-1,System.currentTimeMillis() + maxSkew * 2);
    fail("HMaster should have thrown a ClockOutOfSyncException but didn't.");
  }
 catch (  ClockOutOfSyncException e) {
    LOG.info("Recieved expected exception: " + e);
  }
  LOG.debug("regionServerStartup 4");
  InetAddress ia4=InetAddress.getLocalHost();
  sm.regionServerStartup(ia4,1237,-1,System.currentTimeMillis() - warningSkew * 2);
  LOG.debug("regionServerStartup 5");
  InetAddress ia5=InetAddress.getLocalHost();
  sm.regionServerStartup(ia5,1238,-1,System.currentTimeMillis() + warningSkew * 2);
}
