{
  Iterator<Entry<Integer,Call>> itor=calls.entrySet().iterator();
  while (itor.hasNext()) {
    Call c=itor.next().getValue();
    if (c.done) {
      itor.remove();
    }
 else     if (allCalls) {
      long waitTime=EnvironmentEdgeManager.currentTimeMillis() - c.getStartTime();
      IOException ie=new IOException("Connection to " + getRemoteAddress() + " is closing. Call id="+ c.id+ ", waitTime="+ waitTime);
      c.setException(ie);
      itor.remove();
    }
 else     if (c.checkAndSetTimeout()) {
      itor.remove();
    }
 else {
      break;
    }
  }
}
