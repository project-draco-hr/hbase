{
  if (!shouldCloseConnection.get()) {
    LOG.error(getName() + ": the connection is not in the closed state");
    return;
  }
synchronized (connections) {
    connections.removeValue(remoteId,this);
  }
  if (this.out != null) {
synchronized (this.out) {
      IOUtils.closeStream(out);
      this.out=null;
    }
  }
  IOUtils.closeStream(in);
  this.in=null;
  disposeSasl();
  if (LOG.isDebugEnabled()) {
    LOG.debug(getName() + ": closing ipc connection to " + server);
  }
  cleanupCalls();
  if (LOG.isDebugEnabled())   LOG.debug(getName() + ": ipc connection closed");
}
