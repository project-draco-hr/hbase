{
  if (!running.get())   throw new StoppedRpcClientException();
  Connection connection;
  ConnectionId remoteId=new ConnectionId(ticket,call.md.getService().getName(),addr,rpcTimeout);
synchronized (connections) {
    connection=connections.get(remoteId);
    if (connection == null) {
      connection=createConnection(remoteId,this.codec,this.compressor);
      connections.put(remoteId,connection);
    }
  }
  connection.addCall(call);
  connection.setupIOstreams();
  return connection;
}
