{
  byte[] TEST_TABLE=Bytes.toBytes("observed_table");
  byte[] TEST_FAMILY=Bytes.toBytes("aaa");
  HTable table=TEST_UTIL.createTable(TEST_TABLE,TEST_FAMILY);
  TEST_UTIL.waitUntilAllRegionsAssigned(TEST_TABLE,TEST_UTIL.createMultiRegions(table,TEST_FAMILY));
  HRegionServer regionServer=TEST_UTIL.getRSForFirstRegionInTable(TEST_TABLE);
  boolean threwDNRE=false;
  try {
    final byte[] ROW=Bytes.toBytes("aaa");
    Put put=new Put(ROW);
    put.add(TEST_FAMILY,ROW,ROW);
    table.put(put);
  }
 catch (  RetriesExhaustedWithDetailsException e) {
    assertTrue(e.getMessage().contains("DoNotRetryIOException"));
    threwDNRE=true;
  }
 finally {
    assertTrue(threwDNRE);
  }
  for (int i=0; i < 3; i++) {
    assertFalse(regionServer.isAborted());
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      fail("InterruptedException while waiting for regionserver " + "zk node to be deleted.");
    }
  }
  table.close();
}
