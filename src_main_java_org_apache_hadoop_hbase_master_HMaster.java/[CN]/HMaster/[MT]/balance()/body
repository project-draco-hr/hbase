{
  if (!this.balance)   return false;
synchronized (this.balancer) {
    if (this.assignmentManager.isRegionsInTransition()) {
      LOG.debug("Not running balancer because regions in transition: " + this.assignmentManager.getRegionsInTransition());
      return false;
    }
    Map<HServerInfo,List<HRegionInfo>> assignments=this.assignmentManager.getAssignments();
    for (    Map.Entry<String,HServerInfo> e : this.serverManager.getOnlineServers().entrySet()) {
      HServerInfo hsi=e.getValue();
      if (!assignments.containsKey(hsi)) {
        assignments.put(hsi,new ArrayList<HRegionInfo>());
      }
    }
    List<RegionPlan> plans=this.balancer.balanceCluster(assignments);
    if (plans != null && !plans.isEmpty()) {
      for (      RegionPlan plan : plans) {
        this.assignmentManager.balance(plan);
      }
    }
  }
  return true;
}
