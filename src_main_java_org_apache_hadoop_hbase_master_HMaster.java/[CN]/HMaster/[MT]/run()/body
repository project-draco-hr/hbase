{
  MonitoredTask startupStatus=TaskMonitor.get().createStatus("Master startup");
  startupStatus.setDescription("Master startup");
  masterStartTime=System.currentTimeMillis();
  try {
    becomeActiveMaster(startupStatus);
    if (!this.stopped) {
      finishInitialization(startupStatus);
      loop();
    }
  }
 catch (  Throwable t) {
    abort("Unhandled exception. Starting shutdown.",t);
  }
 finally {
    startupStatus.cleanup();
    stopChores();
    if (!this.abort && this.serverManager != null && this.serverManager.isClusterShutdown()) {
      this.serverManager.letRegionServersShutdown();
    }
    stopServiceThreads();
    if (this.activeMasterManager != null)     this.activeMasterManager.stop();
    if (this.catalogTracker != null)     this.catalogTracker.stop();
    if (this.serverManager != null)     this.serverManager.stop();
    if (this.assignmentManager != null)     this.assignmentManager.stop();
    if (this.fileSystemManager != null)     this.fileSystemManager.stop();
    this.zooKeeper.close();
  }
  LOG.info("HMaster main thread exiting");
}
