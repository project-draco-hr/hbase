{
  try {
    startServiceThreads();
    this.serverManager.waitForMinServers();
    if (!this.stopped) {
      if (this.freshClusterStart) {
        clusterStarterInitializations(this.fileSystemManager,this.serverManager,this.catalogTracker,this.assignmentManager);
      }
 else {
        this.assignmentManager.processFailover();
      }
    }
    Sleeper sleeper=new Sleeper(1000,this);
    while (!this.stopped)     sleeper.sleep();
  }
 catch (  Throwable t) {
    abort("Unhandled exception. Starting shutdown.",t);
  }
  if (!this.abort && this.serverManager.isClusterShutdown()) {
    this.serverManager.letRegionServersShutdown();
  }
  if (this.infoServer != null) {
    LOG.info("Stopping infoServer");
    try {
      this.infoServer.stop();
    }
 catch (    Exception ex) {
      ex.printStackTrace();
    }
  }
  this.rpcServer.stop();
  if (this.balancerChore != null)   this.balancerChore.interrupt();
  this.activeMasterManager.stop();
  this.executorService.shutdown();
  HConnectionManager.deleteConnection(this.conf,true);
  this.zooKeeper.close();
  LOG.info("HMaster main thread exiting");
}
