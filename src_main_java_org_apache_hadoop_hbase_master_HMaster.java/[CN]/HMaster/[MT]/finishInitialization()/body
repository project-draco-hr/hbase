{
  isActiveMaster=true;
  this.fileSystemManager=new MasterFileSystem(this,metrics);
  ClusterId.setClusterId(this.zooKeeper,fileSystemManager.getClusterId());
  this.executorService=new ExecutorService(getServerName().toString());
  this.serverManager=new ServerManager(this,this);
  initializeZKBasedSystemTrackers();
  this.cpHost=new MasterCoprocessorHost(this,this.conf);
  startServiceThreads();
  this.serverManager.waitForRegionServers();
  for (  ServerName sn : this.regionServerTracker.getOnlineServers()) {
    if (!this.serverManager.isServerOnline(sn)) {
      LOG.info("Registering server found up in zk: " + sn);
      this.serverManager.recordNewServer(sn,HServerLoad.EMPTY_HSERVERLOAD);
    }
  }
  this.fileSystemManager.splitLogAfterStartup(this.serverManager.getOnlineServers().keySet());
  assignRootAndMeta();
  this.assignmentManager.joinCluster();
  this.balancerChore=getAndStartBalancerChore(this);
  this.catalogJanitorChore=Threads.setDaemonThreadRunning(new CatalogJanitor(this,this));
  LOG.info("Master has completed initialization");
  initialized=true;
}
