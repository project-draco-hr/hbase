{
  this.conf=conf;
  HServerAddress a=new HServerAddress(getMyAddress(this.conf));
  int numHandlers=conf.getInt("hbase.regionserver.handler.count",10);
  this.rpcServer=HBaseRPC.getServer(this,a.getBindAddress(),a.getPort(),numHandlers,false,conf);
  this.address=new HServerAddress(rpcServer.getListenerAddress());
  setName(MASTER + "-" + this.address);
  if (this.conf.get("mapred.task.id") == null) {
    this.conf.set("mapred.task.id","hb_m_" + this.address.toString() + "_"+ System.currentTimeMillis());
  }
  this.zooKeeper=new ZooKeeperWatcher(conf,MASTER + "-" + getMasterAddress(),this);
  this.clusterStarter=0 == ZKUtil.getNumberOfChildren(zooKeeper,zooKeeper.rsZNode);
  activeMasterManager=new ActiveMasterManager(zooKeeper,address,this);
  zooKeeper.registerListener(activeMasterManager);
  clusterStarter=activeMasterManager.blockUntilBecomingActiveMaster();
  this.fileSystemManager=new MasterFileSystem(this);
  this.connection=ServerConnectionManager.getConnection(conf);
  this.executorService=new ExecutorService(getServerName());
  this.serverManager=new ServerManager(this,this);
  this.catalogTracker=new CatalogTracker(this.zooKeeper,this.connection,this,conf.getInt("hbase.master.catalog.timeout",-1));
  this.catalogTracker.start();
  this.assignmentManager=new AssignmentManager(this,serverManager,this.catalogTracker,this.executorService);
  zooKeeper.registerListener(assignmentManager);
  this.regionServerTracker=new RegionServerTracker(zooKeeper,this,this.serverManager);
  regionServerTracker.start();
  this.clusterStatusTracker=new ClusterStatusTracker(getZooKeeper(),this);
  this.clusterStatusTracker.setClusterUp();
  this.clusterStatusTracker.start();
  LOG.info("Server active/primary master; " + this.address + "; clusterStarter="+ this.clusterStarter);
}
