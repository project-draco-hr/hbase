{
  this.conf=conf;
  HServerAddress a=new HServerAddress(getMyAddress(this.conf));
  int numHandlers=conf.getInt("hbase.regionserver.handler.count",10);
  this.rpcServer=HBaseRPC.getServer(this,new Class<?>[]{HMasterInterface.class,HMasterRegionInterface.class},a.getBindAddress(),a.getPort(),numHandlers,0,false,conf,0);
  this.address=new HServerAddress(rpcServer.getListenerAddress());
  User.login(conf,"hbase.master.keytab.file","hbase.master.kerberos.principal",this.address.getHostname());
  setName(MASTER + "-" + this.address);
  Replication.decorateMasterConfiguration(this.conf);
  this.rpcServer.startThreads();
  if (this.conf.get("mapred.task.id") == null) {
    this.conf.set("mapred.task.id","hb_m_" + this.address.toString() + "_"+ System.currentTimeMillis());
  }
  this.zooKeeper=new ZooKeeperWatcher(conf,MASTER + ":" + address.getPort(),this);
  this.metrics=new MasterMetrics(getServerName());
}
