{
  Properties conf=MiniKdc.createConf();
  conf.put(MiniKdc.DEBUG,true);
  KDC=new MiniKdc(conf,new File(TEST_UTIL.getDataTestDir("kdc").toUri().getPath()));
  KDC.start();
  PRINCIPAL=USERNAME + "/" + HOST;
  KDC.createPrincipal(KEYTAB_FILE,PRINCIPAL);
  TEST_UTIL.getConfiguration().setBoolean("ipc.client.fallback-to-simple-auth-allowed",true);
  TEST_UTIL.startMiniZKCluster();
  TEST_UTIL.startMiniDFSCluster(1);
  HBaseKerberosUtils.setKeytabFileForTesting(KEYTAB_FILE.getAbsolutePath());
  HBaseKerberosUtils.setPrincipalForTesting(PRINCIPAL + "@" + KDC.getRealm());
  HBaseKerberosUtils.setSecuredConfiguration(TEST_UTIL.getConfiguration());
  UserGroupInformation.setConfiguration(TEST_UTIL.getConfiguration());
  TEST_UTIL.getConfiguration().setStrings(CoprocessorHost.REGION_COPROCESSOR_CONF_KEY,TokenProvider.class.getName());
  CLUSTER=new LocalHBaseCluster(TEST_UTIL.getConfiguration(),1);
  CLUSTER.startup();
}
