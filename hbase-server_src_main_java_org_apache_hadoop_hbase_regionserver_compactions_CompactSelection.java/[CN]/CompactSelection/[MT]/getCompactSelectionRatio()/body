{
  double r=this.compactRatio;
synchronized (compactionCountLock) {
    if (isOffPeakHour() && numOutstandingOffPeakCompactions == 0) {
      r=this.compactRatioOffPeak;
      numOutstandingOffPeakCompactions++;
      isOffPeakCompaction=true;
    }
  }
  if (isOffPeakCompaction) {
    LOG.info("Running an off-peak compaction, selection ratio = " + compactRatioOffPeak + ", numOutstandingOffPeakCompactions is now "+ numOutstandingOffPeakCompactions);
  }
  return r;
}
