{
  this.sources=new ArrayList<ReplicationSourceInterface>();
  this.replicating=replicating;
  this.zkHelper=zkHelper;
  this.stopper=stopper;
  this.hlogs=new TreeSet<String>();
  this.oldsources=new ArrayList<ReplicationSourceInterface>();
  this.conf=conf;
  this.fs=fs;
  this.logDir=logDir;
  this.oldLogDir=oldLogDir;
  this.sleepBeforeFailover=conf.getLong("replication.sleep.before.failover",2000);
  this.zkHelper.registerRegionServerListener(new OtherRegionServerWatcher(this.zkHelper.getZookeeperWatcher()));
  List<String> otherRSs=this.zkHelper.getRegisteredRegionServers();
  this.zkHelper.registerRegionServerListener(new PeersWatcher(this.zkHelper.getZookeeperWatcher()));
  this.zkHelper.listPeersIdsAndWatch();
  this.otherRegionServers=otherRSs == null ? new ArrayList<String>() : otherRSs;
}
