{
  if (this.stopper.isStopped()) {
    LOG.info("Not transferring queue since we are shutting down");
    return;
  }
  if (!this.zkHelper.lockOtherRS(rsZnode)) {
    return;
  }
  LOG.info("Moving " + rsZnode + "'s hlogs to my queue");
  SortedMap<String,SortedSet<String>> newQueues=this.zkHelper.copyQueuesFromRS(rsZnode);
  if (newQueues == null || newQueues.size() == 0) {
    return;
  }
  this.zkHelper.deleteRsQueues(rsZnode);
  for (  Map.Entry<String,SortedSet<String>> entry : newQueues.entrySet()) {
    String peerId=entry.getKey();
    try {
      ReplicationSourceInterface src=getReplicationSource(this.conf,this.fs,this,this.stopper,this.replicating,peerId);
      this.oldsources.add(src);
      for (      String hlog : entry.getValue()) {
        src.enqueueLog(new Path(this.oldLogDir,hlog));
      }
      src.startup();
    }
 catch (    IOException e) {
      LOG.error("Failed creating a source",e);
    }
  }
}
