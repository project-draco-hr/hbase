{
  if (authMethod == AuthMethod.DIGEST) {
    TokenIdentifier tokenId=HBaseSaslRpcServer.getIdentifier(authorizedId,secretManager);
    UserGroupInformation ugi=tokenId.getUser();
    if (ugi == null) {
      throw new AccessControlException("Can't retrieve username from tokenIdentifier.");
    }
    ugi.addTokenIdentifier(tokenId);
    return User.create(ugi);
  }
 else {
    return User.create(UserGroupInformation.createRemoteUser(authorizedId));
  }
}
