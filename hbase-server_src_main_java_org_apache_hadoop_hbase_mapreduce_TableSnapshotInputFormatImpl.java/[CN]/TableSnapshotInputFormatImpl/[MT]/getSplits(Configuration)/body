{
  String snapshotName=getSnapshotName(conf);
  Path rootDir=FSUtils.getRootDir(conf);
  FileSystem fs=rootDir.getFileSystem(conf);
  Path snapshotDir=SnapshotDescriptionUtils.getCompletedSnapshotDir(snapshotName,rootDir);
  SnapshotDescription snapshotDesc=SnapshotDescriptionUtils.readSnapshotInfo(fs,snapshotDir);
  SnapshotManifest manifest=SnapshotManifest.open(conf,fs,snapshotDir,snapshotDesc);
  List<SnapshotRegionManifest> regionManifests=manifest.getRegionManifests();
  if (regionManifests == null) {
    throw new IllegalArgumentException("Snapshot seems empty");
  }
  HTableDescriptor htd=manifest.getTableDescriptor();
  Scan scan=null;
  if (conf.get(TableInputFormat.SCAN) != null) {
    scan=TableMapReduceUtil.convertStringToScan(conf.get(TableInputFormat.SCAN));
  }
 else   if (conf.get(org.apache.hadoop.hbase.mapred.TableInputFormat.COLUMN_LIST) != null) {
    String[] columns=conf.get(org.apache.hadoop.hbase.mapred.TableInputFormat.COLUMN_LIST).split(" ");
    scan=new Scan();
    for (    String col : columns) {
      scan.addFamily(Bytes.toBytes(col));
    }
  }
 else {
    throw new IllegalArgumentException("Unable to create scan");
  }
  Path tableDir=new Path(conf.get(TABLE_DIR_KEY));
  List<InputSplit> splits=new ArrayList<InputSplit>();
  for (  SnapshotRegionManifest regionManifest : regionManifests) {
    HRegionInfo hri=HRegionInfo.convert(regionManifest.getRegionInfo());
    if (CellUtil.overlappingKeys(scan.getStartRow(),scan.getStopRow(),hri.getStartKey(),hri.getEndKey())) {
      List<String> hosts=getBestLocations(conf,HRegion.computeHDFSBlocksDistribution(conf,htd,hri,tableDir));
      int len=Math.min(3,hosts.size());
      hosts=hosts.subList(0,len);
      splits.add(new InputSplit(htd,hri,hosts));
    }
  }
  return splits;
}
