{
  long now=EnvironmentEdgeManager.currentTime();
  if (identifier.getExpirationDate() < now) {
    throw new InvalidToken("Token has expired");
  }
  AuthenticationKey masterKey=allKeys.get(identifier.getKeyId());
  if (masterKey == null) {
    throw new InvalidToken("Unknown master key for token (id=" + identifier.getKeyId() + ")");
  }
  return createPassword(identifier.getBytes(),masterKey.getKey());
}
