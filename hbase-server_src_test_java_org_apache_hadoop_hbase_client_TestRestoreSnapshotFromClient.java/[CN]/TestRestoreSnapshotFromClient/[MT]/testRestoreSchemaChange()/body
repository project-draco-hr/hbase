{
  byte[] TEST_FAMILY2=Bytes.toBytes("cf2");
  HTable table=new HTable(TEST_UTIL.getConfiguration(),tableName);
  admin.disableTable(tableName);
  admin.addColumn(tableName,new HColumnDescriptor(TEST_FAMILY2));
  admin.enableTable(tableName);
  assertEquals(2,table.getTableDescriptor().getFamilies().size());
  HTableDescriptor htd=admin.getTableDescriptor(tableName);
  assertEquals(2,htd.getFamilies().size());
  loadData(table,500,TEST_FAMILY2);
  long snapshot2Rows=snapshot1Rows + 500;
  assertEquals(snapshot2Rows,TEST_UTIL.countRows(table));
  assertEquals(500,TEST_UTIL.countRows(table,TEST_FAMILY2));
  Set<String> fsFamilies=getFamiliesFromFS(tableName);
  assertEquals(2,fsFamilies.size());
  table.close();
  admin.disableTable(tableName);
  admin.snapshot(snapshotName2,tableName);
  admin.restoreSnapshot(snapshotName0);
  admin.enableTable(tableName);
  assertEquals(1,table.getTableDescriptor().getFamilies().size());
  try {
    TEST_UTIL.countRows(table,TEST_FAMILY2);
    fail("family '" + Bytes.toString(TEST_FAMILY2) + "' should not exists");
  }
 catch (  NoSuchColumnFamilyException e) {
  }
  assertEquals(snapshot0Rows,TEST_UTIL.countRows(table));
  htd=admin.getTableDescriptor(tableName);
  assertEquals(1,htd.getFamilies().size());
  fsFamilies=getFamiliesFromFS(tableName);
  assertEquals(1,fsFamilies.size());
  table.close();
  admin.disableTable(tableName);
  admin.restoreSnapshot(snapshotName2);
  admin.enableTable(tableName);
  htd=admin.getTableDescriptor(tableName);
  assertEquals(2,htd.getFamilies().size());
  assertEquals(2,table.getTableDescriptor().getFamilies().size());
  assertEquals(500,TEST_UTIL.countRows(table,TEST_FAMILY2));
  assertEquals(snapshot2Rows,TEST_UTIL.countRows(table));
  fsFamilies=getFamiliesFromFS(tableName);
  assertEquals(2,fsFamilies.size());
  table.close();
}
