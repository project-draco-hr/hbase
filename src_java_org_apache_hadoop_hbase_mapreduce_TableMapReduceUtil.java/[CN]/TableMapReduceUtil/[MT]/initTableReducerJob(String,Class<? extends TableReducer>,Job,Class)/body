{
  job.setOutputFormatClass(TableOutputFormat.class);
  if (reducer != null)   job.setReducerClass(reducer);
  job.getConfiguration().set(TableOutputFormat.OUTPUT_TABLE,table);
  job.setOutputKeyClass(ImmutableBytesWritable.class);
  job.setOutputValueClass(Writable.class);
  if (partitioner == HRegionPartitioner.class) {
    HBaseConfiguration.addHbaseResources(job.getConfiguration());
    job.setPartitionerClass(HRegionPartitioner.class);
    HTable outputTable=new HTable(job.getConfiguration(),table);
    int regions=outputTable.getRegionsInfo().size();
    if (job.getNumReduceTasks() > regions) {
      job.setNumReduceTasks(outputTable.getRegionsInfo().size());
    }
  }
 else   if (partitioner != null) {
    job.setPartitionerClass(partitioner);
  }
}
