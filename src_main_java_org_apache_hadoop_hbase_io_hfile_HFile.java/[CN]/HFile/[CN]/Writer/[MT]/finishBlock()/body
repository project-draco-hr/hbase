{
  if (this.out == null)   return;
  long now=System.currentTimeMillis();
  int size=releaseCompressingStream(this.out);
  this.out=null;
  blockKeys.add(firstKey);
  blockOffsets.add(Long.valueOf(blockBegin));
  blockDataSizes.add(Integer.valueOf(size));
  this.totalBytes+=size;
  writeTime+=System.currentTimeMillis() - now;
  writeOps++;
  if (blockCache != null) {
    baosDos.flush();
    byte[] bytes=baos.toByteArray();
    ByteBuffer blockToCache=ByteBuffer.wrap(bytes,DATABLOCKMAGIC.length,bytes.length - DATABLOCKMAGIC.length);
    String blockName=path.toString() + blockNumber;
    blockCache.cacheBlock(blockName,blockToCache);
    baosDos.close();
  }
  blockNumber++;
}
