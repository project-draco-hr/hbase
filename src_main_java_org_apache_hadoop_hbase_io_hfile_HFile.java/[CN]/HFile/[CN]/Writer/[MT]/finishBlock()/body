{
  if (bbosDos == null)   return;
  bbosDos.flush();
  DataOutputStream compressStream=getCompressingStream();
  bbos.writeTo(compressStream);
  int size=releaseCompressingStream(compressStream);
  long now=System.currentTimeMillis();
  blockKeys.add(firstKey);
  blockOffsets.add(Long.valueOf(blockBegin));
  blockDataSizes.add(Integer.valueOf(size));
  this.totalBytes+=size;
  writeTime+=System.currentTimeMillis() - now;
  writeOps++;
  if (blockCache != null) {
    byte[] bytes=bbos.toByteArray(DATABLOCKMAGIC.length,bbos.size() - DATABLOCKMAGIC.length);
    ByteBuffer blockToCache=ByteBuffer.wrap(bytes);
    String blockName=path.toString() + blockNumber;
    blockCache.cacheBlock(blockName,blockToCache);
  }
  bbosDos.close();
  bbosDos=null;
  bbos=null;
  blockNumber++;
}
