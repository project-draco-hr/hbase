{
  List<KeyValue> sampleKv=generator.generateTestKeyValues(NUMBER_OF_KV);
  ByteBuffer originalBuffer=RedundantKVGenerator.convertKvToByteBuffer(sampleKv,includesMemstoreTS);
  List<DataBlockEncoder> dataBlockEncoders=DataBlockEncoding.getAllEncoders();
  for (  DataBlockEncoder encoder : dataBlockEncoders) {
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    DataOutputStream dataOut=new DataOutputStream(baos);
    try {
      encoder.compressKeyValues(dataOut,originalBuffer,includesMemstoreTS);
    }
 catch (    IOException e) {
      throw new RuntimeException(String.format("Bug while encoding using '%s'",encoder.toString()),e);
    }
    ByteBuffer encodedBuffer=ByteBuffer.wrap(baos.toByteArray());
    ByteBuffer keyBuffer=encoder.getFirstKeyInBlock(encodedBuffer);
    KeyValue firstKv=sampleKv.get(0);
    if (0 != Bytes.compareTo(keyBuffer.array(),keyBuffer.arrayOffset(),keyBuffer.limit(),firstKv.getBuffer(),firstKv.getKeyOffset(),firstKv.getKeyLength())) {
      int commonPrefix=0;
      int length=Math.min(keyBuffer.limit(),firstKv.getKeyLength());
      while (commonPrefix < length && keyBuffer.array()[keyBuffer.arrayOffset() + commonPrefix] == firstKv.getBuffer()[firstKv.getKeyOffset() + commonPrefix]) {
        commonPrefix++;
      }
      fail(String.format("Bug in '%s' commonPrefix %d",encoder.toString(),commonPrefix));
    }
  }
}
