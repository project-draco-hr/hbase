{
  Scan scan=new Scan();
  scan.setFilter(new FirstKeyOnlyFilter());
  ExampleProtos.CountResponse response=null;
  InternalScanner scanner=null;
  try {
    scanner=env.getRegion().getScanner(scan);
    List<KeyValue> results=new ArrayList<KeyValue>();
    boolean hasMore=false;
    byte[] lastRow=null;
    long count=0;
    do {
      hasMore=scanner.next(results);
      for (      KeyValue kv : results) {
        byte[] currentRow=kv.getRow();
        if (lastRow == null || !Bytes.equals(lastRow,currentRow)) {
          lastRow=currentRow;
          count++;
        }
      }
      results.clear();
    }
 while (hasMore);
    response=ExampleProtos.CountResponse.newBuilder().setCount(count).build();
  }
 catch (  IOException ioe) {
    ResponseConverter.setControllerException(controller,ioe);
  }
 finally {
    if (scanner != null) {
      try {
        scanner.close();
      }
 catch (      IOException ignored) {
      }
    }
  }
  done.run(response);
}
