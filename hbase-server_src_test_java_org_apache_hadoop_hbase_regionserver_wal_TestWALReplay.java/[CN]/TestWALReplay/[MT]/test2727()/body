{
  final TableName tableName=TableName.valueOf("test2727");
  HRegionInfo hri=createBasic3FamilyHRegionInfo(tableName);
  Path basedir=FSUtils.getTableDir(hbaseRootDir,tableName);
  deleteDir(basedir);
  HTableDescriptor htd=createBasic3FamilyHTD(tableName);
  HRegion region2=HRegion.createHRegion(hri,hbaseRootDir,this.conf,htd);
  HRegion.closeHRegion(region2);
  final byte[] rowName=tableName.getName();
  HLog wal1=createWAL(this.conf);
  final int countPerFamily=1000;
  for (  HColumnDescriptor hcd : htd.getFamilies()) {
    addWALEdits(tableName,hri,rowName,hcd.getName(),countPerFamily,ee,wal1,htd);
  }
  wal1.close();
  runWALSplit(this.conf);
  HLog wal2=createWAL(this.conf);
  wal2.setSequenceNumber(wal1.getSequenceNumber());
  for (  HColumnDescriptor hcd : htd.getFamilies()) {
    addWALEdits(tableName,hri,rowName,hcd.getName(),countPerFamily,ee,wal2,htd);
  }
  wal2.close();
  runWALSplit(this.conf);
  HLog wal3=createWAL(this.conf);
  wal3.setSequenceNumber(wal2.getSequenceNumber());
  try {
    long wal3SeqId=wal3.getSequenceNumber();
    HRegion region=HRegion.openHRegion(this.conf,this.fs,hbaseRootDir,hri,htd,wal3);
    long seqid=region.getOpenSeqNum();
    assertTrue(seqid > wal3SeqId);
    region.close();
  }
  finally {
    wal3.closeAndDelete();
  }
}
