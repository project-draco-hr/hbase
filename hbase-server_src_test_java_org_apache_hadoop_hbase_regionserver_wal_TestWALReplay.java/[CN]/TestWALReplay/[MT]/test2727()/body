{
  final TableName tableName=TableName.valueOf("test2727");
  HRegionInfo hri=createBasic3FamilyHRegionInfo(tableName);
  Path basedir=FSUtils.getTableDir(hbaseRootDir,tableName);
  deleteDir(basedir);
  HTableDescriptor htd=createBasic3FamilyHTD(tableName);
  HRegion region2=HRegion.createHRegion(hri,hbaseRootDir,this.conf,htd);
  HRegion.closeHRegion(region2);
  final byte[] rowName=tableName.getName();
  HLog wal1=createWAL(this.conf);
  final int countPerFamily=1000;
  final AtomicLong sequenceId=new AtomicLong(1);
  for (  HColumnDescriptor hcd : htd.getFamilies()) {
    addWALEdits(tableName,hri,rowName,hcd.getName(),countPerFamily,ee,wal1,htd,sequenceId);
  }
  wal1.close();
  runWALSplit(this.conf);
  HLog wal2=createWAL(this.conf);
  for (  HColumnDescriptor hcd : htd.getFamilies()) {
    addWALEdits(tableName,hri,rowName,hcd.getName(),countPerFamily,ee,wal2,htd,sequenceId);
  }
  wal2.close();
  runWALSplit(this.conf);
  HLog wal3=createWAL(this.conf);
  try {
    HRegion region=HRegion.openHRegion(this.conf,this.fs,hbaseRootDir,hri,htd,wal3);
    long seqid=region.getOpenSeqNum();
    assertTrue(seqid > sequenceId.get());
    assertEquals(seqid - 1,sequenceId.get());
    LOG.debug("region.getOpenSeqNum(): " + region.getOpenSeqNum() + ", wal3.id: "+ sequenceId.get());
    region.close();
  }
  finally {
    wal3.closeAndDelete();
  }
}
