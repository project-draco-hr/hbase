{
  final TableName tableName=TableName.valueOf("testSequentialEditLogSeqNum");
  final HRegionInfo hri=createBasic3FamilyHRegionInfo(tableName);
  final Path basedir=FSUtils.getTableDir(this.hbaseRootDir,tableName);
  deleteDir(basedir);
  final byte[] rowName=tableName.getName();
  final int countPerFamily=10;
  final HTableDescriptor htd=createBasic1FamilyHTD(tableName);
  MockHLog wal=createMockWAL(this.conf);
  HRegion region=HRegion.openHRegion(this.conf,this.fs,hbaseRootDir,hri,htd,wal);
  for (  HColumnDescriptor hcd : htd.getFamilies()) {
    addRegionEdits(rowName,hcd.getName(),countPerFamily,this.ee,region,"x");
  }
  region.flushcache();
  for (  HColumnDescriptor hcd : htd.getFamilies()) {
    addRegionEdits(rowName,hcd.getName(),5,this.ee,region,"x");
  }
  long lastestSeqNumber=region.getSequenceId().get();
  wal.doCompleteCacheFlush=true;
  wal.completeCacheFlush(hri.getEncodedNameAsBytes());
  wal.close();
  FileStatus[] listStatus=this.fs.listStatus(wal.getDir());
  HLogSplitter.splitLogFile(hbaseRootDir,listStatus[0],this.fs,this.conf,null,null,null);
  FileStatus[] listStatus1=this.fs.listStatus(new Path(FSUtils.getTableDir(hbaseRootDir,tableName),new Path(hri.getEncodedName(),"recovered.edits")));
  int editCount=0;
  for (  FileStatus fileStatus : listStatus1) {
    editCount=Integer.parseInt(fileStatus.getPath().getName());
  }
  assertEquals("The sequence number of the recoverd.edits and the current edit seq should be same",lastestSeqNumber,editCount);
}
