{
  if (tableNames.length != newTableNames.length) {
    throw new IOException("Number of source tables adn taget Tables does not match!");
  }
  HBaseAdmin admin=null;
  Connection conn=null;
  try {
    conn=ConnectionFactory.createConnection(conf);
    admin=(HBaseAdmin)conn.getAdmin();
    for (    String tableName : newTableNames) {
      if (!admin.tableExists(TableName.valueOf(tableName))) {
        admin.close();
        throw new IOException("HBase table " + tableName + " does not exist. Create the table first, e.g. by restoring a full backup.");
      }
    }
    IncrementalRestoreService restoreService=BackupRestoreServiceFactory.getIncrementalRestoreService(conf);
    restoreService.run(logDir,tableNames,newTableNames);
  }
  finally {
    if (admin != null) {
      admin.close();
    }
    if (conn != null) {
      conn.close();
    }
  }
}
