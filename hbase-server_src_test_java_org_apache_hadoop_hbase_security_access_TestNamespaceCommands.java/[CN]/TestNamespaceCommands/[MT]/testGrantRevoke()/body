{
  final String testUser="testUser";
  PrivilegedExceptionAction grantAction=new PrivilegedExceptionAction(){
    public Object run() throws Exception {
      HTable acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
      try {
        BlockingRpcChannel service=acl.coprocessorService(HConstants.EMPTY_START_ROW);
        AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
        ProtobufUtil.grant(protocol,testUser,TestNamespace,Action.WRITE);
      }
  finally {
        acl.close();
      }
      return null;
    }
  }
;
  PrivilegedExceptionAction revokeAction=new PrivilegedExceptionAction(){
    public Object run() throws Exception {
      HTable acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
      try {
        BlockingRpcChannel service=acl.coprocessorService(HConstants.EMPTY_START_ROW);
        AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
        ProtobufUtil.revoke(protocol,testUser,TestNamespace,Action.WRITE);
      }
  finally {
        acl.close();
      }
      return null;
    }
  }
;
  verifyAllowed(grantAction,SUPERUSER);
  verifyDenied(grantAction,USER_CREATE,USER_RW);
  verifyAllowed(revokeAction,SUPERUSER);
  verifyDenied(revokeAction,USER_CREATE,USER_RW);
}
