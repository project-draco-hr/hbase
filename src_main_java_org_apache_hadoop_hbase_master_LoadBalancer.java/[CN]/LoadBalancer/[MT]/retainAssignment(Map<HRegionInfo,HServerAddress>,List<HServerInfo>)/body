{
  Map<HServerInfo,List<HRegionInfo>> assignments=new TreeMap<HServerInfo,List<HRegionInfo>>();
  Map<HServerAddress,HServerInfo> serverMap=new TreeMap<HServerAddress,HServerInfo>();
  for (  HServerInfo server : servers) {
    serverMap.put(server.getServerAddress(),server);
    assignments.put(server,new ArrayList<HRegionInfo>());
  }
  for (  Map.Entry<HRegionInfo,HServerAddress> region : regions.entrySet()) {
    HServerAddress hsa=region.getValue();
    HServerInfo server=hsa == null ? null : serverMap.get(hsa);
    if (server != null) {
      assignments.get(server).add(region.getKey());
    }
 else {
      assignments.get(servers.get(RANDOM.nextInt(assignments.size()))).add(region.getKey());
    }
  }
  return assignments;
}
