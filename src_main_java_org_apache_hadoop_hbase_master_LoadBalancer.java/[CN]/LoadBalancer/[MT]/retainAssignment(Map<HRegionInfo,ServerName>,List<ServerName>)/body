{
  Map<ServerName,List<HRegionInfo>> assignments=new TreeMap<ServerName,List<HRegionInfo>>();
  for (  ServerName server : servers) {
    assignments.put(server,new ArrayList<HRegionInfo>());
  }
  for (  Map.Entry<HRegionInfo,ServerName> region : regions.entrySet()) {
    ServerName sn=region.getValue();
    if (sn != null && servers.contains(sn)) {
      assignments.get(sn).add(region.getKey());
    }
 else {
      int size=assignments.size();
      assignments.get(servers.get(RANDOM.nextInt(size))).add(region.getKey());
    }
  }
  return assignments;
}
