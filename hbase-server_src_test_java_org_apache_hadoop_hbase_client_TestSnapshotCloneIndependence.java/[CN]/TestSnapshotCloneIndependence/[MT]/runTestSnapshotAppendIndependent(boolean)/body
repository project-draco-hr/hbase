{
  FileSystem fs=UTIL.getHBaseCluster().getMaster().getMasterFileSystem().getFileSystem();
  Path rootDir=UTIL.getHBaseCluster().getMaster().getMasterFileSystem().getRootDir();
  Admin admin=UTIL.getHBaseAdmin();
  final long startTime=System.currentTimeMillis();
  final TableName localTableName=TableName.valueOf(STRING_TABLE_NAME + startTime);
  try (Table original=createTable(localTableName,TEST_FAM)){
    loadData(original,TEST_FAM);
    final int origTableRowCount=countRows(original);
    final String snapshotNameAsString="snapshot_" + localTableName;
    byte[] snapshotName=Bytes.toBytes(snapshotNameAsString);
    SnapshotTestingUtils.createSnapshotAndValidate(admin,localTableName,TEST_FAM_STR,snapshotNameAsString,rootDir,fs,online);
    if (!online) {
      tryDisable(admin,localTableName);
    }
    TableName cloneTableName=TableName.valueOf("test-clone-" + localTableName);
    admin.cloneSnapshot(snapshotName,cloneTableName);
    try (Table clonedTable=UTIL.getConnection().getTable(cloneTableName)){
      UTIL.waitUntilAllRegionsAssigned(cloneTableName);
      final int clonedTableRowCount=countRows(clonedTable);
      Assert.assertEquals("The line counts of original and cloned tables do not match after clone. ",origTableRowCount,clonedTableRowCount);
      final String rowKey="new-row-" + System.currentTimeMillis();
      Put p=new Put(Bytes.toBytes(rowKey));
      p.addColumn(TEST_FAM,Bytes.toBytes("someQualifier"),Bytes.toBytes("someString"));
      original.put(p);
      Assert.assertEquals("The row count of the original table was not modified by the put",origTableRowCount + 1,countRows(original));
      Assert.assertEquals("The row count of the cloned table changed as a result of addition to the original",clonedTableRowCount,countRows(clonedTable));
      p=new Put(Bytes.toBytes(rowKey));
      p.addColumn(TEST_FAM,Bytes.toBytes("someQualifier"),Bytes.toBytes("someString"));
      clonedTable.put(p);
      Assert.assertEquals("The row count of the original table was modified by the put to the clone",origTableRowCount + 1,countRows(original));
      Assert.assertEquals("The row count of the cloned table was not modified by the put",clonedTableRowCount + 1,countRows(clonedTable));
    }
   }
 }
