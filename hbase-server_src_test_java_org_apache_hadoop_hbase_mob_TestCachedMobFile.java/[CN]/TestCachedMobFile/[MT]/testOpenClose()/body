{
  String caseName=getName();
  FileSystem fs=FileSystem.get(conf);
  Path testDir=FSUtils.getRootDir(conf);
  Path outputDir=new Path(new Path(testDir,TABLE),FAMILY);
  HFileContext meta=new HFileContextBuilder().withBlockSize(8 * 1024).build();
  StoreFile.Writer writer=new StoreFile.WriterBuilder(conf,cacheConf,fs).withOutputDir(outputDir).withFileContext(meta).build();
  MobTestUtil.writeStoreFile(writer,caseName);
  CachedMobFile cachedMobFile=CachedMobFile.create(fs,writer.getPath(),conf,cacheConf);
  Assert.assertEquals(EXPECTED_REFERENCE_ZERO,cachedMobFile.getReferenceCount());
  cachedMobFile.open();
  Assert.assertEquals(EXPECTED_REFERENCE_ONE,cachedMobFile.getReferenceCount());
  cachedMobFile.open();
  Assert.assertEquals(EXPECTED_REFERENCE_TWO,cachedMobFile.getReferenceCount());
  cachedMobFile.close();
  Assert.assertEquals(EXPECTED_REFERENCE_ONE,cachedMobFile.getReferenceCount());
  cachedMobFile.close();
  Assert.assertEquals(EXPECTED_REFERENCE_ZERO,cachedMobFile.getReferenceCount());
}
