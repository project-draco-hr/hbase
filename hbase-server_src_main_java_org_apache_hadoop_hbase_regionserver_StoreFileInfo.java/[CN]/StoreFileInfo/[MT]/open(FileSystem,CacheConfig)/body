{
  FSDataInputStreamWrapper in;
  FileStatus status;
  if (this.link != null) {
    in=new FSDataInputStreamWrapper(fs,this.link);
    status=this.link.getFileStatus(fs);
  }
 else   if (this.reference != null) {
    Path referencePath=getReferredToFile(this.getPath());
    in=new FSDataInputStreamWrapper(fs,referencePath);
    status=fs.getFileStatus(referencePath);
  }
 else {
    in=new FSDataInputStreamWrapper(fs,this.getPath());
    status=fileStatus;
  }
  long length=status.getLen();
  if (this.reference != null) {
    hdfsBlocksDistribution=computeRefFileHDFSBlockDistribution(fs,reference,status);
  }
 else {
    hdfsBlocksDistribution=FSUtils.computeHDFSBlocksDistribution(fs,status,0,length);
  }
  StoreFile.Reader reader=null;
  if (this.coprocessorHost != null) {
    reader=this.coprocessorHost.preStoreFileReaderOpen(fs,this.getPath(),in,length,cacheConf,reference);
  }
  if (reader == null) {
    if (this.reference != null) {
      reader=new HalfStoreFileReader(fs,this.getPath(),in,length,cacheConf,reference,conf);
    }
 else {
      reader=new StoreFile.Reader(fs,this.getPath(),in,length,cacheConf,conf);
    }
  }
  if (this.coprocessorHost != null) {
    reader=this.coprocessorHost.postStoreFileReaderOpen(fs,this.getPath(),in,length,cacheConf,reference,reader);
  }
  return reader;
}
