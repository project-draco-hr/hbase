{
  FSDataInputStreamWrapper in;
  FileStatus status;
  if (this.link != null) {
    in=new FSDataInputStreamWrapper(fs,this.link);
    status=this.link.getFileStatus(fs);
  }
 else   if (this.reference != null) {
    Path referencePath=getReferredToFile(this.getPath());
    in=new FSDataInputStreamWrapper(fs,referencePath);
    status=fs.getFileStatus(referencePath);
  }
 else {
    in=new FSDataInputStreamWrapper(fs,this.getPath());
    status=fileStatus;
  }
  long length=status.getLen();
  if (this.reference != null) {
    hdfsBlocksDistribution=computeRefFileHDFSBlockDistribution(fs,reference,status);
    return new HalfStoreFileReader(fs,this.getPath(),in,length,cacheConf,reference,dataBlockEncoding);
  }
 else {
    hdfsBlocksDistribution=FSUtils.computeHDFSBlocksDistribution(fs,status,0,length);
    return new StoreFile.Reader(fs,this.getPath(),in,length,cacheConf,dataBlockEncoding);
  }
}
