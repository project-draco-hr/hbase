{
  FSDataInputStream inNoChecksum=null;
  FileSystem noChecksumFs=null;
  FSDataInputStream in;
  FileStatus status;
  if (fs instanceof HFileSystem) {
    noChecksumFs=((HFileSystem)fs).getNoChecksumFs();
  }
  if (this.reference != null) {
    if (this.link != null) {
      in=this.link.open(fs);
      inNoChecksum=(noChecksumFs != null) ? this.link.open(noChecksumFs) : in;
      status=this.link.getFileStatus(fs);
    }
 else {
      Path referencePath=getReferredToFile(this.getPath());
      in=fs.open(referencePath);
      inNoChecksum=(noChecksumFs != null) ? noChecksumFs.open(referencePath) : in;
      status=fs.getFileStatus(referencePath);
    }
    hdfsBlocksDistribution=computeRefFileHDFSBlockDistribution(fs,reference,status);
    return new HalfStoreFileReader(fs,this.getPath(),in,inNoChecksum,status.getLen(),cacheConf,reference,dataBlockEncoding);
  }
 else {
    if (this.link != null) {
      in=this.link.open(fs);
      inNoChecksum=(noChecksumFs != null) ? link.open(noChecksumFs) : in;
      status=this.link.getFileStatus(fs);
    }
 else {
      status=fileStatus;
      in=fs.open(this.getPath());
      inNoChecksum=(noChecksumFs != null) ? noChecksumFs.open(this.getPath()) : in;
    }
    long length=status.getLen();
    hdfsBlocksDistribution=FSUtils.computeHDFSBlocksDistribution(fs,status,0,length);
    return new StoreFile.Reader(fs,this.getPath(),in,inNoChecksum,length,cacheConf,dataBlockEncoding,true);
  }
}
