{
  Vector<HRegion> regionsToClose=new Vector<HRegion>();
  this.lock.obtainWriteLock();
  try {
    regionsToClose.addAll(regions.values());
    regions.clear();
  }
  finally {
    this.lock.releaseWriteLock();
  }
  for (Iterator<HRegion> it=regionsToClose.iterator(); it.hasNext(); ) {
    HRegion region=it.next();
    if (LOG.isDebugEnabled()) {
      LOG.debug("closing region " + region.getRegionName());
    }
    try {
      region.close();
      LOG.debug("region closed " + region.getRegionName());
    }
 catch (    IOException e) {
      LOG.error("error closing region " + region.getRegionName(),e);
    }
  }
}
