{
  LOG.debug("Shutting down HBase Cluster");
  if (masters != null) {
    for (    JVMClusterUtil.MasterThread t : masters) {
      if (t.master.isActiveMaster()) {
        t.master.shutdown();
      }
 else {
        t.master.stopMaster();
      }
    }
  }
  for (  RegionServerThread t : regionservers) {
    if (t.isAlive()) {
      try {
        t.getRegionServer().stop("Shutdown requested");
        t.join();
      }
 catch (      InterruptedException e) {
      }
    }
  }
  if (masters != null) {
    for (    JVMClusterUtil.MasterThread t : masters) {
      while (t.master.isAlive()) {
        try {
          Threads.threadDumpingIsAlive(t.master.getThread());
        }
 catch (        InterruptedException e) {
        }
      }
    }
  }
  LOG.info("Shutdown of " + ((masters != null) ? masters.size() : "0") + " master(s) and "+ ((regionservers != null) ? regionservers.size() : "0")+ " regionserver(s) complete");
}
