{
  RequestContext ctx=instance.get();
  ctx.user=user;
  ctx.remoteAddress=remoteAddress;
  ctx.service=service;
  ctx.inRequest=true;
  if (Trace.isTracing()) {
    if (user != null) {
      Trace.currentSpan().addKVAnnotation(Bytes.toBytes("user"),Bytes.toBytes(user.getName()));
    }
    if (remoteAddress != null) {
      Trace.currentSpan().addKVAnnotation(Bytes.toBytes("remoteAddress"),Bytes.toBytes(remoteAddress.getHostAddress()));
    }
  }
}
