{
  LOG.debug("Commiting transaction: " + state.toString() + " to "+ super.getRegionInfo().getRegionNameAsString());
  if (state.getWriteSet().size() > 0) {
    logManager.writeCommitToLog(state.getTransactionId());
  }
  for (  BatchUpdate update : state.getWriteSet()) {
    this.batchUpdate(update,false);
  }
  state.setStatus(Status.COMMITED);
  if (state.getWriteSet().size() > 0 && !commitPendingTransactions.remove(state)) {
    LOG.fatal("Commiting a non-query transaction that is not in commitPendingTransactions");
    throw new IOException("commit failure");
  }
  retireTransaction(state);
}
