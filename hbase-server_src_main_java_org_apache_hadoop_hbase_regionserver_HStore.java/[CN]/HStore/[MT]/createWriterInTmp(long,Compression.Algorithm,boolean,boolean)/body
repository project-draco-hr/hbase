{
  final CacheConfig writerCacheConf;
  if (isCompaction) {
    writerCacheConf=new CacheConfig(cacheConf);
    writerCacheConf.setCacheDataOnWrite(false);
  }
 else {
    writerCacheConf=cacheConf;
  }
  InetSocketAddress[] favoredNodes=null;
  if (region.getRegionServerServices() != null) {
    favoredNodes=region.getRegionServerServices().getFavoredNodesForRegion(region.getRegionInfo().getEncodedName());
  }
  StoreFile.Writer w=new StoreFile.WriterBuilder(conf,writerCacheConf,this.getFileSystem(),blocksize).withFilePath(fs.createTempName()).withDataBlockEncoder(dataBlockEncoder).withComparator(comparator).withBloomType(family.getBloomFilterType()).withMaxKeyCount(maxKeyCount).withChecksumType(checksumType).withBytesPerChecksum(bytesPerChecksum).withCompression(compression).withFavoredNodes(favoredNodes).includeMVCCReadpoint(includeMVCCReadpoint).build();
  return w;
}
