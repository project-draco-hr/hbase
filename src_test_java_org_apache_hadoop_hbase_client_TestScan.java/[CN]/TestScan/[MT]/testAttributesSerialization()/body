{
  Scan scan=new Scan();
  scan.setAttribute("attribute1",Bytes.toBytes("value1"));
  scan.setAttribute("attribute2",Bytes.toBytes("value2"));
  scan.setAttribute("attribute3",Bytes.toBytes("value3"));
  ByteArrayOutputStream byteArrayOutputStream=new ByteArrayOutputStream();
  DataOutput out=new DataOutputStream(byteArrayOutputStream);
  scan.write(out);
  Scan scan2=new Scan();
  Assert.assertTrue(scan2.getAttributesMap().isEmpty());
  scan2.readFields(new DataInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray())));
  Assert.assertNull(scan2.getAttribute("absent"));
  Assert.assertTrue(Arrays.equals(Bytes.toBytes("value1"),scan2.getAttribute("attribute1")));
  Assert.assertTrue(Arrays.equals(Bytes.toBytes("value2"),scan2.getAttribute("attribute2")));
  Assert.assertTrue(Arrays.equals(Bytes.toBytes("value3"),scan2.getAttribute("attribute3")));
  Assert.assertEquals(3,scan2.getAttributesMap().size());
}
