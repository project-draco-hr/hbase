{
  List<String> nodes=ZKUtil.listChildrenAndWatchForNewChildren(watcher,watcher.assignmentZNode);
  boolean regionsToProcess=false;
  for (  Map.Entry<HRegionInfo,ServerName> e : this.regions.entrySet()) {
    if (!e.getKey().isMetaRegion() && !e.getKey().isRootRegion() && e.getValue() != null) {
      LOG.debug("Found " + e + " out on cluster");
      regionsToProcess=true;
      break;
    }
    if (nodes.contains(e.getKey().getEncodedName())) {
      LOG.debug("Found " + e + " in RITs");
      regionsToProcess=true;
      break;
    }
  }
  if (regionsToProcess) {
    LOG.info("Found regions out on cluster or in RIT; failover");
    if (!nodes.isEmpty()) {
      for (      String encodedRegionName : nodes) {
        processRegionInTransition(encodedRegionName,null);
      }
    }
  }
 else {
    LOG.info("Clean cluster startup. Assigning userregions");
    cleanoutUnassigned();
    assignAllUserRegions();
  }
}
