{
  if (!setOfflineInZooKeeper(state))   return;
  if (this.master.isStopped()) {
    LOG.debug("Server stopped; skipping assign of " + state);
    return;
  }
  RegionPlan plan=getRegionPlan(state);
  if (plan == null)   return;
  try {
    LOG.debug("Assigning region " + state.getRegion().getRegionNameAsString() + " to "+ plan.getDestination().getServerName());
    state.update(RegionState.State.PENDING_OPEN);
    serverManager.sendRegionOpen(plan.getDestination(),state.getRegion());
  }
 catch (  Throwable t) {
    LOG.warn("Failed assignment of " + state.getRegion().getRegionNameAsString() + " to "+ plan.getDestination()+ ", trying to assign elsewhere instead",t);
    state.update(RegionState.State.OFFLINE);
    this.regionPlans.remove(state.getRegion().getEncodedName());
    if (getRegionPlan(state,plan.getDestination()) == null)     return;
    assign(state);
  }
}
