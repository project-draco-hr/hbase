{
  List<HRegionInfo> allRegions=MetaScanner.listAllRegions(master.getConfiguration());
  if (allRegions == null || allRegions.isEmpty())   return;
  List<HServerInfo> servers=serverManager.getOnlineServersList();
  LOG.info("Assigning " + allRegions.size() + " region(s) across "+ servers.size()+ " server(s)");
  Map<HServerInfo,List<HRegionInfo>> bulkPlan=LoadBalancer.bulkAssignment(allRegions,servers);
  for (  Map.Entry<HServerInfo,List<HRegionInfo>> entry : bulkPlan.entrySet()) {
    Thread t=new BulkAssignServer(entry.getKey(),entry.getValue(),this.master);
    t.start();
  }
  try {
    waitUntilNoRegionsInTransition();
  }
 catch (  InterruptedException e) {
    LOG.error("Interrupted waiting for regions to be assigned",e);
    throw new IOException(e);
  }
  LOG.info("All user regions have been assigned");
}
