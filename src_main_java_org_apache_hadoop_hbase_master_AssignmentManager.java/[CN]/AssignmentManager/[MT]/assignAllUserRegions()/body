{
  List<ServerName> servers=serverManager.getOnlineServersList();
  removeDeadNotExpiredServers(servers);
  if (servers.isEmpty())   return;
  Map<HRegionInfo,ServerName> allRegions=MetaReader.fullScan(catalogTracker,this.zkTable.getDisabledTables(),true);
  if (allRegions == null || allRegions.isEmpty())   return;
  boolean retainAssignment=master.getConfiguration().getBoolean("hbase.master.startup.retainassign",true);
  Map<ServerName,List<HRegionInfo>> bulkPlan=null;
  if (retainAssignment) {
    bulkPlan=balancer.retainAssignment(allRegions,servers);
  }
 else {
    assignUserRegions(new ArrayList<HRegionInfo>(allRegions.keySet()),servers);
    for (    HRegionInfo hri : allRegions.keySet()) {
      setEnabledTable(hri);
    }
    return;
  }
  LOG.info("Bulk assigning " + allRegions.size() + " region(s) across "+ servers.size()+ " server(s), retainAssignment="+ retainAssignment);
  BulkAssigner ba=new StartupBulkAssigner(this.master,bulkPlan,this);
  ba.bulkAssign();
  for (  HRegionInfo hri : allRegions.keySet()) {
    setEnabledTable(hri);
  }
  LOG.info("Bulk assigning done");
}
