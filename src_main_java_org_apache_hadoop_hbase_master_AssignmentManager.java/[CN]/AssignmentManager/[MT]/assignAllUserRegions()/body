{
  List<HRegionInfo> allRegions=MetaScanner.listAllRegions(master.getConfiguration());
  if (allRegions == null || allRegions.isEmpty()) {
    return;
  }
  List<HServerInfo> servers=serverManager.getOnlineServersList();
  LOG.info("Assigning " + allRegions.size() + " across "+ servers.size()+ " servers");
  Map<HServerInfo,List<HRegionInfo>> bulkPlan=LoadBalancer.bulkAssignment(allRegions,servers);
  for (  Map.Entry<HServerInfo,List<HRegionInfo>> entry : bulkPlan.entrySet()) {
    HServerInfo server=entry.getKey();
    List<HRegionInfo> regions=entry.getValue();
    LOG.debug("Assigning " + regions.size() + " regions to "+ server);
    for (    HRegionInfo region : regions) {
      LOG.debug("Assigning " + region.getRegionNameAsString() + " to "+ server);
      String regionName=region.getEncodedName();
      RegionPlan plan=new RegionPlan(region,null,server);
      regionPlans.put(regionName,plan);
      assign(region);
    }
  }
  try {
    waitUntilNoRegionsInTransition();
  }
 catch (  InterruptedException e) {
    LOG.error("Interrupted waiting for regions to be assigned",e);
    throw new IOException(e);
  }
  LOG.info("All user regions have been assigned");
}
