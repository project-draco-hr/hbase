{
  LOG.debug("Starting assignment for region " + region.getRegionNameAsString());
  String encodedName=region.getEncodedName();
  RegionState state;
  this.assignLock.lock();
  try {
synchronized (regionsInTransition) {
      state=regionsInTransition.get(encodedName);
      if (state == null) {
        state=new RegionState(region,RegionState.State.OFFLINE);
        regionsInTransition.put(encodedName,state);
      }
    }
synchronized (state) {
      this.assignLock.unlock();
      assign(state);
    }
  }
  finally {
    if (this.assignLock.isHeldByCurrentThread())     this.assignLock.unlock();
  }
}
