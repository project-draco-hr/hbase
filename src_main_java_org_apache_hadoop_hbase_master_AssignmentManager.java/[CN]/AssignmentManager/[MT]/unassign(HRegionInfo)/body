{
  LOG.debug("Starting unassignment of region " + region.getRegionNameAsString() + " (offlining)");
  if (!regions.containsKey(region)) {
    LOG.debug("Attempted to unassign region " + region.getRegionNameAsString() + " but it is not "+ "currently assigned anywhere");
    return;
  }
  String encodedName=region.getEncodedName();
  RegionState state;
synchronized (regionsInTransition) {
    state=regionsInTransition.get(encodedName);
    if (state == null) {
      state=new RegionState(region,RegionState.State.PENDING_CLOSE);
      regionsInTransition.put(encodedName,state);
    }
 else {
      LOG.debug("Attempting to unassign region " + region.getRegionNameAsString() + " but it is "+ "already in transition ("+ state.getState()+ ")");
      return;
    }
  }
  try {
    serverManager.sendRegionClose(regions.get(region),state.getRegion());
  }
 catch (  NotServingRegionException e) {
    LOG.warn("Attempted to close region " + region.getRegionNameAsString() + " but got an NSRE",e);
  }
}
