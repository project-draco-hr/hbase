{
  String encodedName=state.getRegion().getEncodedName();
  List<HServerInfo> servers=this.serverManager.getOnlineServersList();
  if (serverToExclude != null)   servers.remove(serverToExclude);
  if (servers.size() < 0)   return null;
  RegionPlan newPlan=new RegionPlan(state.getRegion(),null,LoadBalancer.randomAssignment(servers));
  RegionPlan existingPlan=this.regionPlans.putIfAbsent(encodedName,newPlan);
  RegionPlan plan=null;
  if (existingPlan == null) {
    LOG.debug("No previous transition plan for " + state.getRegion().getRegionNameAsString() + " so generated a random one; "+ newPlan+ "; "+ serverManager.countOfRegionServers()+ " (online="+ serverManager.getOnlineServers().size()+ ", exclude="+ serverToExclude+ ") available servers");
    plan=newPlan;
  }
 else {
    LOG.debug("Using preexisting plan=" + existingPlan);
    plan=existingPlan;
  }
  return plan;
}
