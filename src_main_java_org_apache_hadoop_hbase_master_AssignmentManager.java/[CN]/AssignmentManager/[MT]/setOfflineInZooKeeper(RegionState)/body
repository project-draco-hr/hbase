{
  if (!state.isClosed() && !state.isOffline()) {
    this.master.abort("Unexpected state trying to OFFLINE; " + state,new IllegalStateException());
    return false;
  }
  state.update(RegionState.State.OFFLINE);
  try {
    if (!ZKAssign.createOrForceNodeOffline(master.getZooKeeper(),state.getRegion(),master.getServerName())) {
      LOG.warn("Attempted to create/force node into OFFLINE state before " + "completing assignment but failed to do so for " + state);
      return false;
    }
  }
 catch (  KeeperException e) {
    master.abort("Unexpected ZK exception creating/setting node OFFLINE",e);
    return false;
  }
  return true;
}
