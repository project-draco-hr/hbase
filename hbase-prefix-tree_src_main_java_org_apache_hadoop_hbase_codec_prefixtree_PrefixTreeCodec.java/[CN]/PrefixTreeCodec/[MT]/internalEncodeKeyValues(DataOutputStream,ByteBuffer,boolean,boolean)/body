{
  rawKeyValues.rewind();
  PrefixTreeEncoder builder=EncoderFactory.checkOut(encodedOutputStream,includesMvccVersion);
  try {
    KeyValue kv;
    while ((kv=KeyValueUtil.nextShallowCopy(rawKeyValues,includesMvccVersion,includesTag)) != null) {
      builder.write(kv);
    }
    builder.flush();
  }
  finally {
    EncoderFactory.checkIn(builder);
  }
}
