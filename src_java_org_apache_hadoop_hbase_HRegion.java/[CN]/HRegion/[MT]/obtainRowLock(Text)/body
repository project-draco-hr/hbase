{
  checkRow(row);
  lock.readLock().lock();
  try {
    if (this.closed.get()) {
      throw new IOException("Region " + this.getRegionName().toString() + " closed");
    }
synchronized (rowsToLocks) {
      while (rowsToLocks.get(row) != null) {
        try {
          rowsToLocks.wait();
        }
 catch (        InterruptedException ie) {
        }
      }
      Long lid=Long.valueOf(Math.abs(rand.nextLong()));
      rowsToLocks.put(row,lid);
      locksToRows.put(lid,row);
      rowsToLocks.notifyAll();
      return lid.longValue();
    }
  }
  finally {
    lock.readLock().unlock();
  }
}
