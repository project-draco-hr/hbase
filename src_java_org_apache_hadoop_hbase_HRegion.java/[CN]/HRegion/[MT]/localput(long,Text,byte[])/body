{
  Text row=getRowFromLock(lockid);
  if (row == null) {
    throw new IOException("No write lock for lockid " + lockid);
  }
synchronized (row) {
    if (row != getRowFromLock(lockid)) {
      throw new IOException("Locking error: put operation on lock " + lockid + " unexpected aborted by another thread");
    }
    TreeMap<Text,byte[]> targets=targetColumns.get(lockid);
    if (targets == null) {
      targets=new TreeMap<Text,byte[]>();
      targetColumns.put(lockid,targets);
    }
    targets.put(targetCol,val);
  }
}
