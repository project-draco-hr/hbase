{
  NameBytesPair.Builder builder=NameBytesPair.newBuilder();
  builder.setName(declaredClass.getName());
  if (value != null) {
    ByteArrayOutputStream baos=null;
    try {
      baos=new ByteArrayOutputStream();
      DataOutput out=new DataOutputStream(baos);
      Class<?> clz=declaredClass;
      if (HbaseObjectWritable.getClassCode(declaredClass) == null) {
        clz=value.getClass();
      }
      HbaseObjectWritable.writeObject(out,value,clz,null);
      builder.setValue(ByteString.copyFrom(baos.toByteArray()));
    }
  finally {
      if (baos != null) {
        baos.close();
      }
    }
  }
  return builder.build();
}
