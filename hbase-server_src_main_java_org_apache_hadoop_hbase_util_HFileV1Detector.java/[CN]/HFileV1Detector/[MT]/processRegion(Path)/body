{
  LOG.debug("processing region: " + regionDir);
  Callable<Path> regionCallable=new Callable<Path>(){
    @Override public Path call() throws Exception {
      for (      Path familyDir : FSUtils.getFamilyDirs(fs,regionDir)) {
        FileStatus[] storeFiles=FSUtils.listStatus(fs,familyDir);
        if (storeFiles == null || storeFiles.length == 0)         continue;
        for (        FileStatus storeFile : storeFiles) {
          Path storeFilePath=storeFile.getPath();
          FSDataInputStream fsdis=null;
          long lenToRead=0;
          try {
            if (StoreFileInfo.isReference(storeFilePath))             continue;
 else             if (HFileLink.isHFileLink(storeFilePath)) {
              HFileLink fileLink=new HFileLink(getConf(),storeFilePath);
              fsdis=fileLink.open(fs);
              lenToRead=fileLink.getFileStatus(fs).getLen();
            }
 else {
              fsdis=fs.open(storeFilePath);
              lenToRead=storeFile.getLen();
            }
            int majorVersion=computeMajorVersion(fsdis,lenToRead);
            if (majorVersion == 1) {
              hFileV1Set.add(storeFilePath);
              return regionDir;
            }
            if (majorVersion > 2 || majorVersion < 1)             throw new IllegalArgumentException("Incorrect major version: " + majorVersion);
          }
 catch (          Exception iae) {
            corruptedHFiles.add(storeFilePath);
            LOG.error("Got exception while reading trailer for file: " + storeFilePath,iae);
          }
 finally {
            if (fsdis != null)             fsdis.close();
          }
        }
      }
      return null;
    }
    private int computeMajorVersion(    FSDataInputStream istream,    long fileSize) throws IOException {
      long seekPoint=fileSize - Bytes.SIZEOF_INT;
      if (seekPoint < 0)       throw new IllegalArgumentException("File too small, no major version found");
      istream.seek(seekPoint);
      int version=istream.readInt();
      return version & 0x00ffffff;
    }
  }
;
  Future<Path> f=exec.submit(regionCallable);
  return f;
}
