{
  Configuration c=getConnection().getConfiguration();
  final long pause=c.getLong(HConstants.HBASE_CLIENT_PAUSE,HConstants.DEFAULT_HBASE_CLIENT_PAUSE);
  final int numRetries=c.getInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,HConstants.DEFAULT_HBASE_CLIENT_RETRIES_NUMBER);
  List<RetriesExhaustedException.ThrowableWithExtraContext> exceptions=new ArrayList<RetriesExhaustedException.ThrowableWithExtraContext>();
  this.globalStartTime=EnvironmentEdgeManager.currentTimeMillis();
  for (int tries=0; ; tries++) {
    long expectedSleep=0;
    try {
      beforeCall();
      prepare(tries != 0);
      return call();
    }
 catch (    Throwable t) {
      LOG.warn("Call exception, tries=" + tries + ", numRetries="+ numRetries+ ", retryTime="+ (this.globalStartTime - System.currentTimeMillis())+ "ms",t);
      t=translateException(t);
      if (t instanceof SocketTimeoutException || t instanceof ConnectException || t instanceof RetriesExhaustedException|| (location != null && getConnection().isDeadServer(location.getServerName()))) {
        getConnection().clearCaches(location.getServerName());
      }
 else       if (t instanceof RegionMovedException) {
        getConnection().updateCachedLocations(tableName,row,t,location);
      }
 else       if (t instanceof NotServingRegionException && numRetries == 1) {
        getConnection().deleteCachedRegionLocation(location);
      }
      RetriesExhaustedException.ThrowableWithExtraContext qt=new RetriesExhaustedException.ThrowableWithExtraContext(t,EnvironmentEdgeManager.currentTimeMillis(),toString());
      exceptions.add(qt);
      if (tries >= numRetries - 1) {
        throw new RetriesExhaustedException(tries,exceptions);
      }
      expectedSleep=ConnectionUtils.getPauseTime(pause,tries + 1);
      if (expectedSleep < MIN_WAIT_DEAD_SERVER && (location == null || getConnection().isDeadServer(location.getServerName()))) {
        expectedSleep=ConnectionUtils.addJitter(MIN_WAIT_DEAD_SERVER,0.10f);
      }
      long duration=singleCallDuration(expectedSleep);
      if (duration > this.callTimeout) {
        throw (SocketTimeoutException)new SocketTimeoutException("Call to access row '" + Bytes.toString(row) + "' on table '"+ Bytes.toString(tableName)+ "' failed on timeout. "+ " callTimeout="+ this.callTimeout+ ", callDuration="+ duration).initCause(t);
      }
    }
 finally {
      afterCall();
    }
    try {
      Thread.sleep(expectedSleep);
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new IOException("Interrupted after " + tries + " tries  on "+ numRetries,e);
    }
  }
}
