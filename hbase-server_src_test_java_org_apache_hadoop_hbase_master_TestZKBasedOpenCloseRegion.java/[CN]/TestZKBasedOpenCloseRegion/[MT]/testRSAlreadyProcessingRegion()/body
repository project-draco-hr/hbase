{
  LOG.info("starting testRSAlreadyProcessingRegion");
  MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  HRegionServer hr0=cluster.getLiveRegionServerThreads().get(0).getRegionServer();
  HRegionServer hr1=cluster.getLiveRegionServerThreads().get(1).getRegionServer();
  HRegionInfo hri=getNonMetaRegion(ProtobufUtil.getOnlineRegions(hr0.getRSRpcServices()));
  hr1.getRegionsInTransitionInRS().putIfAbsent(hri.getEncodedNameAsBytes(),true);
  TEST_UTIL.getHBaseAdmin().move(hri.getEncodedNameAsBytes(),Bytes.toBytes(hr1.getServerName().toString()));
  assertEquals(hr1.getOnlineRegion(hri.getEncodedNameAsBytes()),null);
  hr1.getRegionsInTransitionInRS().remove(hri.getEncodedNameAsBytes());
  hri=getNonMetaRegion(ProtobufUtil.getOnlineRegions(hr1.getRSRpcServices()));
  TEST_UTIL.getHBaseAdmin().move(hri.getEncodedNameAsBytes(),Bytes.toBytes(hr0.getServerName().toString()));
  while (!cluster.getMaster().assignmentManager.wasOpenedHandlerCalled(hri)) {
    Threads.sleep(100);
  }
  assertTrue(hr1.getOnlineRegion(hri.getEncodedNameAsBytes()) == null);
}
