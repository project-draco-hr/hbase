{
  File jarFile1=buildCoprocessorJar(cpName1);
  File jarFile2=buildCoprocessorJar(cpName2);
  File jarFile4=buildCoprocessorJar(cpName4);
  File jarFile5=buildCoprocessorJar(cpName5);
  String cpKey1="COPROCESSOR$1";
  String cpKey2=" Coprocessor$2 ";
  String cpKey3=" coprocessor$03 ";
  String cpValue1=jarFile1.toString() + "|" + cpName1+ "|"+ Coprocessor.PRIORITY_USER;
  String cpValue2=jarFile2.toString() + " | " + cpName2+ " | ";
  String cpValue3=" | org.apache.hadoop.hbase.coprocessor.SimpleRegionObserver | | k=v ";
  HTableDescriptor htd=new HTableDescriptor(tableName);
  htd.addFamily(new HColumnDescriptor("test"));
  htd.setValue(cpKey1,cpValue1);
  htd.setValue(cpKey2,cpValue2);
  htd.setValue(cpKey3,cpValue3);
  htd.addCoprocessor(cpName4,new Path(jarFile4.getPath()),Coprocessor.PRIORITY_USER,null);
  Map<String,String> kvs=new HashMap<String,String>();
  kvs.put("k1","v1");
  kvs.put("k2","v2");
  kvs.put("k3","v3");
  htd.addCoprocessor(cpName5,new Path(jarFile5.getPath()),Coprocessor.PRIORITY_USER,kvs);
  HBaseAdmin admin=new HBaseAdmin(this.conf);
  if (admin.tableExists(tableName)) {
    admin.disableTable(tableName);
    admin.deleteTable(tableName);
  }
  admin.createTable(htd);
  boolean found_2=false, found_1=false, found_3=false, found_4=false, found_5=false;
  boolean found5_k1=false, found5_k2=false, found5_k3=false, found5_k4=false;
  MiniHBaseCluster hbase=TEST_UTIL.getHBaseCluster();
  for (  HRegion region : hbase.getRegionServer(0).getOnlineRegionsLocalContext()) {
    if (region.getRegionNameAsString().startsWith(tableName)) {
      found_1=found_1 || (region.getCoprocessorHost().findCoprocessor(cpName1) != null);
      found_2=found_2 || (region.getCoprocessorHost().findCoprocessor(cpName2) != null);
      found_3=found_3 || (region.getCoprocessorHost().findCoprocessor("SimpleRegionObserver") != null);
      found_4=found_4 || (region.getCoprocessorHost().findCoprocessor(cpName4) != null);
      CoprocessorEnvironment env=region.getCoprocessorHost().findCoprocessorEnvironment(cpName5);
      if (env != null) {
        found_5=true;
        Configuration conf=env.getConfiguration();
        found5_k1=conf.get("k1") != null;
        found5_k2=conf.get("k2") != null;
        found5_k3=conf.get("k3") != null;
      }
    }
  }
  assertTrue("Class " + cpName1 + " was missing on a region",found_1);
  assertTrue("Class " + cpName2 + " was missing on a region",found_2);
  assertTrue("Class SimpleRegionObserver was missing on a region",found_3);
  assertTrue("Class " + cpName4 + " was missing on a region",found_4);
  assertTrue("Class " + cpName5 + " was missing on a region",found_5);
  assertTrue("Configuration key 'k1' was missing on a region",found5_k1);
  assertTrue("Configuration key 'k2' was missing on a region",found5_k2);
  assertTrue("Configuration key 'k3' was missing on a region",found5_k3);
  assertFalse("Configuration key 'k4' wasn't configured",found5_k4);
}
