{
  FSDataInputStream stream=log.getStream();
  try {
    boolean hasMore=true;
    while (hasMore) {
      ProcedureWALEntry entry=ProcedureWALFormat.readEntry(stream);
      if (entry == null) {
        LOG.warn("nothing left to decode. exiting with missing EOF");
        hasMore=false;
        break;
      }
switch (entry.getType()) {
case INIT:
        readInitEntry(entry);
      break;
case INSERT:
    readInsertEntry(entry);
  break;
case UPDATE:
case COMPACT:
readUpdateEntry(entry);
break;
case DELETE:
readDeleteEntry(entry);
break;
case EOF:
hasMore=false;
break;
default :
throw new CorruptedWALProcedureStoreException("Invalid entry: " + entry);
}
}
}
 catch (IOException e) {
LOG.error("got an exception while reading the procedure WAL: " + log,e);
loader.markCorruptedWAL(log,e);
}
if (localProcedureMap.isEmpty()) {
LOG.info("No active entry found in state log " + log + ". removing it");
loader.removeLog(log);
}
 else {
procedureMap.mergeTail(localProcedureMap);
}
}
