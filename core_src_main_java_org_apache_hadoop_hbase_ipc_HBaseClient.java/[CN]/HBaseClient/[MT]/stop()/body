{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Stopping client");
  }
  if (!running.compareAndSet(true,false)) {
    return;
  }
synchronized (connections) {
    for (    Connection conn : connections.values()) {
      conn.interrupt();
    }
  }
  while (!connections.isEmpty()) {
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
    }
  }
}
