{
  Map<ByteRange,Integer> cfVsMaxVersions=new HashMap<ByteRange,Integer>();
  for (  HColumnDescriptor hcd : region.getTableDesc().getFamilies()) {
    cfVsMaxVersions.put(new SimpleByteRange(hcd.getName()),hcd.getMaxVersions());
  }
  if (authorizations == null) {
    TableName table=region.getRegionInfo().getTable();
    if (table.isSystemTable() && !table.equals(LABELS_TABLE_NAME)) {
      return null;
    }
    return new VisibilityLabelFilter(new BitSet(0),cfVsMaxVersions);
  }
  Filter visibilityLabelFilter=null;
  if (this.scanLabelGenerator != null) {
    List<String> labels=null;
    try {
      labels=this.scanLabelGenerator.getLabels(getActiveUser(),authorizations);
    }
 catch (    Throwable t) {
      LOG.error(t);
    }
    int labelsCount=this.visibilityManager.getLabelsCount();
    BitSet bs=new BitSet(labelsCount + 1);
    if (labels != null) {
      for (      String label : labels) {
        int labelOrdinal=this.visibilityManager.getLabelOrdinal(label);
        if (labelOrdinal != 0) {
          bs.set(labelOrdinal);
        }
      }
    }
    visibilityLabelFilter=new VisibilityLabelFilter(bs,cfVsMaxVersions);
  }
  return visibilityLabelFilter;
}
