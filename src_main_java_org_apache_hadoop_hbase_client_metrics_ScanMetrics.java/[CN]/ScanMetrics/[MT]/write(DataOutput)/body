{
  out.writeByte(SCANMETRICS_VERSION);
  Collection<MetricsBase> mbs=registry.getMetricsList();
  int metricsCount=0;
  for (  MetricsBase mb : mbs) {
    if (mb instanceof MetricsTimeVaryingLong) {
      metricsCount++;
    }
 else {
      throw new IOException("unsupported metrics type. metrics name: " + mb.getName() + ", metrics description: "+ mb.getDescription());
    }
  }
  out.writeInt(metricsCount);
  for (  MetricsBase mb : mbs) {
    out.writeUTF(mb.getName());
    out.writeLong(((MetricsTimeVaryingLong)mb).getCurrentIntervalValue());
  }
}
