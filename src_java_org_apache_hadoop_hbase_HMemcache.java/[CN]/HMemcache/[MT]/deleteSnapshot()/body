{
  this.locker.writeLock().lock();
  try {
    if (snapshot == null) {
      throw new IOException("Snapshot not present!");
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("deleting snapshot");
    }
    for (Iterator<TreeMap<HStoreKey,BytesWritable>> it=history.iterator(); it.hasNext(); ) {
      TreeMap<HStoreKey,BytesWritable> cur=it.next();
      if (snapshot == cur) {
        it.remove();
        break;
      }
    }
    this.snapshot=null;
    if (LOG.isDebugEnabled()) {
      LOG.debug("snapshot deleted");
    }
  }
  finally {
    this.locker.writeLock().unlock();
  }
}
