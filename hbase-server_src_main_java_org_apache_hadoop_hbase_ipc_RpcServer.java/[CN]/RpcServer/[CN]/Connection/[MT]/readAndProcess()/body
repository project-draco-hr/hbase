{
  int count=read4Bytes();
  if (count < 0 || dataLengthBuffer.remaining() > 0) {
    return count;
  }
  if (!connectionPreambleRead) {
    count=readPreamble();
    if (!connectionPreambleRead) {
      return count;
    }
    count=read4Bytes();
    if (count < 0 || dataLengthBuffer.remaining() > 0) {
      return count;
    }
  }
  if (data == null) {
    dataLengthBuffer.flip();
    int dataLength=dataLengthBuffer.getInt();
    if (dataLength == RpcClient.PING_CALL_ID) {
      if (!useWrap) {
        dataLengthBuffer.clear();
        return 0;
      }
    }
    if (dataLength < 0) {
      throw new IllegalArgumentException("Unexpected data length " + dataLength + "!! from "+ getHostAddress());
    }
    data=ByteBuffer.allocate(dataLength);
    incRpcCount();
  }
  count=channelRead(channel,data);
  if (count >= 0 && data.remaining() == 0) {
    process();
  }
  return count;
}
