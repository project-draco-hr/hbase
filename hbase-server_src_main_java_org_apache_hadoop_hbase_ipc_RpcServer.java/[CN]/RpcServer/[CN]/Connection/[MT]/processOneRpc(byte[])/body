{
  if (connectionHeaderRead) {
    processRequest(buf);
  }
 else {
    processConnectionHeader(buf);
    this.connectionHeaderRead=true;
    if (!authorizeConnection()) {
      throw new AccessControlException("Connection from " + this + " for service "+ connectionHeader.getServiceName()+ " is unauthorized for user: "+ user);
    }
  }
}
