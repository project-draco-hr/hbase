{
  HRegionServer rs=util.getRSForFirstRegionInTable(tableName);
  List<HRegion> onlineRegions=rs.getOnlineRegions(tableName);
  for (  HRegion region : onlineRegions) {
    region.waitForFlushesAndCompactions();
  }
  final HBaseAdmin hBaseAdmin=util.getHBaseAdmin();
  util.waitFor(60000,new Waiter.Predicate<IOException>(){
    @Override public boolean evaluate() throws IOException {
      return hBaseAdmin.isTableAvailable(tableName);
    }
  }
);
}
