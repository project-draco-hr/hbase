{
  conf.setBoolean(HBASE_SKIP_ERRORS,true);
  generateHLogs(Integer.MAX_VALUE);
  corruptHLog(new Path(HLOGDIR,HLOG_FILE_PREFIX + "5"),Corruptions.APPEND_GARBAGE,true,fs);
  fs.initialize(fs.getUri(),conf);
  int expectedFiles=fs.listStatus(HLOGDIR).length;
  HLogSplitter.split(HBASEDIR,HLOGDIR,OLDLOGDIR,fs,conf);
  for (  String region : REGIONS) {
    Path[] logfiles=getLogForRegion(HBASEDIR,TABLE_NAME,region);
    assertEquals(expectedFiles,logfiles.length);
    int count=0;
    for (    Path logfile : logfiles) {
      count+=countHLog(logfile,fs,conf);
    }
    assertEquals(NUM_WRITERS * ENTRIES,count);
  }
}
