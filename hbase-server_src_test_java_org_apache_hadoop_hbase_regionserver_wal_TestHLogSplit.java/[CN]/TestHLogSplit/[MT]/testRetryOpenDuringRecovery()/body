{
  generateHLogs(-1);
  fs.initialize(fs.getUri(),conf);
  FileSystem spiedFs=Mockito.spy(fs);
  Mockito.doAnswer(new Answer<FSDataInputStream>(){
    private int count=0;
    public FSDataInputStream answer(    InvocationOnMock invocation) throws Throwable {
      if (count++ < 3) {
        throw new IOException("Cannot obtain block length");
      }
      return (FSDataInputStream)invocation.callRealMethod();
    }
  }
).when(spiedFs).open(Mockito.<Path>any(),Mockito.anyInt());
  HLogSplitter logSplitter=new HLogSplitter(conf,HBASEDIR,HLOGDIR,OLDLOGDIR,spiedFs,null);
  try {
    logSplitter.splitLog();
    assertEquals(NUM_WRITERS,fs.listStatus(OLDLOGDIR).length);
    assertFalse(fs.exists(HLOGDIR));
  }
 catch (  IOException e) {
    fail("There shouldn't be any exception but: " + e.toString());
  }
}
