{
  generateHLogs(-1);
  fs.initialize(fs.getUri(),conf);
  FileSystem spiedFs=Mockito.spy(fs);
  Mockito.doThrow(new LeaseExpiredException("Injected: File does not exist")).when(spiedFs).append(Mockito.<Path>any());
  HLogSplitter logSplitter=new HLogSplitter(conf,hbaseDir,hlogDir,oldLogDir,spiedFs);
  try {
    logSplitter.splitLog();
    assertEquals(NUM_WRITERS,fs.listStatus(oldLogDir).length);
    assertFalse(fs.exists(hlogDir));
  }
 catch (  IOException e) {
    fail("There shouldn't be any exception but: " + e.toString());
  }
}
