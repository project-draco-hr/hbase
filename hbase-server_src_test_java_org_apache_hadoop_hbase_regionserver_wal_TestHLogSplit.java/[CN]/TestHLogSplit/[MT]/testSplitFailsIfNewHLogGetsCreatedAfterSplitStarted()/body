{
  AtomicBoolean stop=new AtomicBoolean(false);
  assertFalse("Previous test should clean up table dir",fs.exists(new Path("/hbase/t1")));
  generateHLogs(-1);
  CountDownLatch latch=new CountDownLatch(1);
  try {
    (new ZombieNewLogWriterRegionServer(latch,stop)).start();
    HLogSplitter logSplitter=HLogSplitter.createLogSplitter(conf,HBASEDIR,HLOGDIR,OLDLOGDIR,fs);
    logSplitter.splitLog(latch);
  }
  finally {
    stop.set(true);
  }
}
