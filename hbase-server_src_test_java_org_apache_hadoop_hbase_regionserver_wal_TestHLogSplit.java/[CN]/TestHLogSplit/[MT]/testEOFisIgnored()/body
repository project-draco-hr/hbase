{
  conf.setBoolean(HBASE_SKIP_ERRORS,false);
  final String REGION="region__1";
  regions.removeAll(regions);
  regions.add(REGION);
  int entryCount=10;
  Path c1=new Path(hlogDir,HLOG_FILE_PREFIX + "0");
  generateHLogs(1,entryCount,-1);
  corruptHLog(c1,Corruptions.TRUNCATE,true,fs);
  fs.initialize(fs.getUri(),conf);
  HLogSplitter logSplitter=HLogSplitter.createLogSplitter(conf,hbaseDir,hlogDir,oldLogDir,fs);
  logSplitter.splitLog();
  Path originalLog=(fs.listStatus(oldLogDir))[0].getPath();
  Path splitLog=getLogForRegion(hbaseDir,TABLE_NAME,REGION);
  int actualCount=0;
  HLog.Reader in=HLog.getReader(fs,splitLog,conf);
  HLog.Entry entry;
  while ((entry=in.next()) != null)   ++actualCount;
  assertEquals(entryCount - 1,actualCount);
  FileStatus[] archivedLogs=fs.listStatus(corruptDir);
  assertEquals(archivedLogs.length,0);
}
