{
  conf.setBoolean(HBASE_SKIP_ERRORS,true);
  generateHLogs(Integer.MAX_VALUE);
  corruptHLog(new Path(hlogDir,HLOG_FILE_PREFIX + "5"),Corruptions.INSERT_GARBAGE_ON_FIRST_LINE,true,fs);
  fs.initialize(fs.getUri(),conf);
  HLogSplitter logSplitter=HLogSplitter.createLogSplitter(conf,hbaseDir,hlogDir,oldLogDir,fs);
  logSplitter.splitLog();
  for (  String region : regions) {
    Path logfile=getLogForRegion(hbaseDir,TABLE_NAME,region);
    assertEquals((NUM_WRITERS - 1) * ENTRIES,countHLog(logfile,fs,conf));
  }
}
