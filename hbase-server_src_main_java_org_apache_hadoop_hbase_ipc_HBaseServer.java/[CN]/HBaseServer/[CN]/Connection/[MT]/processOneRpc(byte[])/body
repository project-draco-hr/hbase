{
  if (connectionHeaderRead) {
    processRequest(buf);
  }
 else {
    processConnectionHeader(buf);
    this.connectionHeaderRead=true;
    if (!authorizeConnection()) {
      throw new AccessControlException("Connection from " + this + " for protocol "+ connectionHeader.getProtocol()+ " is unauthorized for user "+ user);
    }
  }
}
