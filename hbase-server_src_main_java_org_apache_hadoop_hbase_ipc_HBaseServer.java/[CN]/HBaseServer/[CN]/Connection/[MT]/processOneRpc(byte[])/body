{
  if (headerRead) {
    processData(buf);
  }
 else {
    processHeader(buf);
    headerRead=true;
    if (!authorizeConnection()) {
      throw new AccessControlException("Connection from " + this + " for protocol "+ header.getProtocol()+ " is unauthorized for user "+ user);
    }
  }
}
