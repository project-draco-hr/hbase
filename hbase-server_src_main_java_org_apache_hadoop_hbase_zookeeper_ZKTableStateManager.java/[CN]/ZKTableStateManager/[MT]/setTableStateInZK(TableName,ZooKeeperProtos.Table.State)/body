{
  String znode=ZKUtil.joinZNode(this.watcher.tableZNode,tableName.getNameAsString());
  if (ZKUtil.checkExists(this.watcher,znode) == -1) {
    ZKUtil.createAndFailSilent(this.watcher,znode);
  }
synchronized (this.cache) {
    ZooKeeperProtos.Table.Builder builder=ZooKeeperProtos.Table.newBuilder();
    builder.setState(state);
    byte[] data=ProtobufUtil.prependPBMagic(builder.build().toByteArray());
    ZKUtil.setData(this.watcher,znode,data);
    this.cache.put(tableName,state);
  }
}
