{
  Configuration conf=util.getConfiguration();
  conf.setStrings(CoprocessorHost.REGION_COPROCESSOR_CONF_KEY,"org.apache.hadoop.hbase.coprocessor.ColumnAggregationEndpoint","org.apache.hadoop.hbase.coprocessor.GenericEndpoint");
  util.startMiniCluster(2);
  HTable table=util.createTable(TEST_TABLE,TEST_FAMILY);
  util.createMultiRegions(util.getConfiguration(),table,TEST_FAMILY,new byte[][]{HConstants.EMPTY_BYTE_ARRAY,ROWS[rowSeperator1],ROWS[rowSeperator2]});
  for (int i=0; i < ROWSIZE; i++) {
    Put put=new Put(ROWS[i]);
    put.setWriteToWAL(false);
    put.add(TEST_FAMILY,TEST_QUALIFIER,Bytes.toBytes(i));
    table.put(put);
  }
  long timeout=System.currentTimeMillis() + (15 * 1000);
  while ((System.currentTimeMillis() < timeout) && (table.getRegionsInfo().size() != 2)) {
    Thread.sleep(250);
  }
  table.close();
}
