{
  int kvlen=(int)KeyValue.getKeyValueDataStructureSize(key.length,value.length,tag.length);
  byte[] b=new byte[kvlen];
  int pos=0;
  pos=Bytes.putInt(b,pos,key.length);
  pos=Bytes.putInt(b,pos,value.length);
  pos=Bytes.putBytes(b,pos,key,0,key.length);
  pos=Bytes.putBytes(b,pos,value,0,value.length);
  if (tag.length > 0) {
    pos=Bytes.putShort(b,pos,(short)tag.length);
    Bytes.putBytes(b,pos,tag,0,tag.length);
  }
  append(new KeyValue(b,0,kvlen));
}
