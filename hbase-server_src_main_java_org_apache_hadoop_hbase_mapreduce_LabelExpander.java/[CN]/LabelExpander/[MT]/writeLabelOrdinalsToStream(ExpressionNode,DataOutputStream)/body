{
  if (node.isSingleNode()) {
    String identifier=null;
    int labelOrdinal=0;
    if (node instanceof LeafExpressionNode) {
      identifier=((LeafExpressionNode)node).getIdentifier();
      if (this.labels.get(identifier) != null) {
        labelOrdinal=this.labels.get(identifier);
      }
    }
 else {
      LeafExpressionNode lNode=(LeafExpressionNode)((NonLeafExpressionNode)node).getChildExps().get(0);
      identifier=lNode.getIdentifier();
      if (this.labels.get(identifier) != null) {
        labelOrdinal=this.labels.get(identifier);
        labelOrdinal=-1 * labelOrdinal;
      }
    }
    if (labelOrdinal == 0) {
      throw new BadTsvLineException("Invalid visibility label " + identifier);
    }
    WritableUtils.writeVInt(dos,labelOrdinal);
  }
 else {
    List<ExpressionNode> childExps=((NonLeafExpressionNode)node).getChildExps();
    for (    ExpressionNode child : childExps) {
      writeLabelOrdinalsToStream(child,dos);
    }
  }
}
