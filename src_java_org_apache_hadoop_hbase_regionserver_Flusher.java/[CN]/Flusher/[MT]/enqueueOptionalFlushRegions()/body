{
  long now=System.currentTimeMillis();
  if (now - threadWakeFrequency > lastOptionalCheck) {
    lastOptionalCheck=now;
    Set<HRegion> regions=server.getRegionsToCheck();
    for (    HRegion region : regions) {
synchronized (regionsInQueue) {
        if (!regionsInQueue.contains(region) && (now - optionalFlushPeriod) > region.getLastFlushTime()) {
          regionsInQueue.add(region);
          flushQueue.add(region);
          region.setLastFlushTime(now);
        }
      }
    }
  }
}
