{
  setConf(conf);
  return new AsyncRpcClient(conf,new ChannelInitializer<SocketChannel>(){
    @Override protected void initChannel(    SocketChannel ch) throws Exception {
      ch.pipeline().addFirst(new ChannelOutboundHandlerAdapter(){
        @Override public void write(        ChannelHandlerContext ctx,        Object msg,        ChannelPromise promise) throws Exception {
          promise.setFailure(new RuntimeException("Injected fault"));
        }
      }
);
    }
  }
);
}
