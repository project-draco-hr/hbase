{
  Configuration conf=getConf();
  TableName tableName=TableName.valueOf(conf.get(TABLE_NAME_KEY,DEFAULT_TABLE_NAME));
  String snapshotName=conf.get(SNAPSHOT_NAME_KEY,tableName.getQualifierAsString() + "_snapshot_" + System.currentTimeMillis());
  int numRegions=conf.getInt(NUM_REGIONS_KEY,DEFAULT_NUM_REGIONS);
  String tableDirStr=conf.get(TABLE_DIR_KEY);
  Path tableDir;
  if (tableDirStr == null) {
    tableDir=util.getDataTestDirOnTestFS(tableName.getQualifierAsString());
  }
 else {
    tableDir=new Path(tableDirStr);
  }
  int expectedNumSplits=numRegions > 2 ? numRegions - 2 : numRegions;
  TestTableSnapshotInputFormat.doTestWithMapReduce(util,tableName,snapshotName,tableDir,numRegions,expectedNumSplits,false);
  return 0;
}
