{
  S sumVal=null;
  Long rowCountVal=0l;
  InternalScanner scanner=((RegionCoprocessorEnvironment)getEnvironment()).getRegion().getScanner(scan);
  byte[] colFamily=scan.getFamilies()[0];
  byte[] qualifier=scan.getFamilyMap().get(colFamily).pollFirst();
  List<KeyValue> results=new ArrayList<KeyValue>();
  boolean hasMoreRows=false;
  try {
    do {
      results.clear();
      hasMoreRows=scanner.next(results);
      for (      KeyValue kv : results) {
        sumVal=ci.add(sumVal,ci.castToReturnType(ci.getValue(colFamily,qualifier,kv)));
      }
      rowCountVal++;
    }
 while (hasMoreRows);
  }
  finally {
    scanner.close();
  }
  Pair<S,Long> pair=new Pair<S,Long>(sumVal,rowCountVal);
  return pair;
}
