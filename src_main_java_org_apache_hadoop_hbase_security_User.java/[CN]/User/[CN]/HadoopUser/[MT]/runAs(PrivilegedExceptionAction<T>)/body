{
  T result=null;
  try {
    UserGroupInformation previous=(UserGroupInformation)callStatic("getCurrentUGI");
    try {
      if (ugi != null) {
        callStatic("setCurrentUGI",new Class[]{UserGroupInformation.class},new Object[]{ugi});
      }
      result=action.run();
    }
  finally {
      callStatic("setCurrentUGI",new Class[]{UserGroupInformation.class},new Object[]{previous});
    }
  }
 catch (  Exception e) {
    if (e instanceof IOException) {
      throw (IOException)e;
    }
 else     if (e instanceof InterruptedException) {
      throw (InterruptedException)e;
    }
 else     if (e instanceof RuntimeException) {
      throw (RuntimeException)e;
    }
 else {
      throw new UndeclaredThrowableException(e,"Unknown exception in runAs()");
    }
  }
  return result;
}
