{
  T result=null;
  UserGroupInformation previous=null;
  try {
    previous=(UserGroupInformation)callStatic("getCurrentUGI");
    try {
      if (ugi != null) {
        callStatic("setCurrentUser",new Class[]{UserGroupInformation.class},new Object[]{ugi});
      }
      result=action.run();
    }
  finally {
      callStatic("setCurrentUser",new Class[]{UserGroupInformation.class},new Object[]{previous});
    }
  }
 catch (  RuntimeException re) {
    throw re;
  }
catch (  Exception e) {
    throw new UndeclaredThrowableException(e,"Unexpected exception in runAs()");
  }
  return result;
}
