{
  try {
    Class c=Class.forName("org.apache.hadoop.security.UnixUserGroupInformation");
    Constructor constructor=c.getConstructor(String.class,String[].class);
    if (constructor == null) {
      throw new NullPointerException();
    }
    UserGroupInformation newUser=(UserGroupInformation)constructor.newInstance(name,groups);
    conf.set("hadoop.job.ugi",newUser.toString());
    return new HadoopUser(newUser);
  }
 catch (  ClassNotFoundException cnfe) {
    throw new RuntimeException("UnixUserGroupInformation not found, is this secure Hadoop?",cnfe);
  }
catch (  NoSuchMethodException nsme) {
    throw new RuntimeException("No valid constructor found for UnixUserGroupInformation!",nsme);
  }
catch (  RuntimeException re) {
    throw re;
  }
catch (  Exception e) {
    throw new UndeclaredThrowableException(e,"Unexpected exception instantiating new UnixUserGroupInformation");
  }
}
