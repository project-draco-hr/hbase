{
  try {
    Class c=Class.forName("org.apache.hadoop.security.UnixUserGroupInformation");
    Constructor constructor=c.getConstructor(String.class,String[].class);
    if (constructor == null) {
      throw new NullPointerException();
    }
    UserGroupInformation newUser=(UserGroupInformation)constructor.newInstance(name,groups);
    conf.set("hadoop.job.ugi",newUser.toString());
    return new HadoopUser(newUser);
  }
 catch (  ClassNotFoundException cnfe) {
    LOG.error("UnixUserGroupInformation not found, is this secure Hadoop?",cnfe);
  }
catch (  NoSuchMethodException nsme) {
    LOG.error("No valid constructor found for UnixUserGroupInformation!",nsme);
  }
catch (  Exception e) {
    LOG.error("Error instantiating new UnixUserGroupInformation",e);
  }
  return null;
}
