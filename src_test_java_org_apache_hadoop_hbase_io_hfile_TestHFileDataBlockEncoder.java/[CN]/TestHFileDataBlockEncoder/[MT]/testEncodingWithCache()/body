{
  HFileBlock block=getSampleHFileBlock();
  LruBlockCache blockCache=new LruBlockCache(8 * 1024 * 1024,32 * 1024);
  HFileBlock cacheBlock=blockEncoder.beforeBlockCache(block,includesMemstoreTS);
  BlockCacheKey cacheKey=new BlockCacheKey("test",0);
  blockCache.cacheBlock(cacheKey,cacheBlock);
  HeapSize heapSize=blockCache.getBlock(cacheKey,false);
  assertTrue(heapSize instanceof HFileBlock);
  HFileBlock afterCache=(HFileBlock)heapSize;
  HFileBlock returnedBlock=blockEncoder.afterBlockCache(afterCache,false,includesMemstoreTS);
  if (!blockEncoder.useEncodedSeek() || blockEncoder.getInCache() == Algorithm.NONE) {
    assertEquals(block.getBufferWithHeader(),returnedBlock.getBufferWithHeader());
  }
 else {
    if (BlockType.ENCODED_DATA != returnedBlock.getBlockType()) {
      System.out.println(blockEncoder);
    }
    assertEquals(BlockType.ENCODED_DATA,returnedBlock.getBlockType());
  }
}
