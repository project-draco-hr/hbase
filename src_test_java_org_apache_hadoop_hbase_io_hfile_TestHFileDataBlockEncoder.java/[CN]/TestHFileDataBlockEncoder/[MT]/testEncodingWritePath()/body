{
  HFileBlock block=getSampleHFileBlock();
  Pair<ByteBuffer,BlockType> result=blockEncoder.beforeWriteToDisk(block.getBufferWithoutHeader(),includesMemstoreTS);
  int size=result.getFirst().limit() - HFileBlock.HEADER_SIZE;
  HFileBlock blockOnDisk=new HFileBlock(result.getSecond(),size,size,-1,result.getFirst(),HFileBlock.FILL_HEADER,0,includesMemstoreTS);
  if (blockEncoder.getEncodingOnDisk() != DataBlockEncoding.NONE) {
    assertEquals(BlockType.ENCODED_DATA,blockOnDisk.getBlockType());
    assertEquals(blockEncoder.getEncodingOnDisk().getId(),blockOnDisk.getDataBlockEncodingId());
  }
 else {
    assertEquals(BlockType.DATA,blockOnDisk.getBlockType());
  }
}
