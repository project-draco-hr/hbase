{
  byte[] compressedBuffer=new byte[buffer.length];
  compressor.setInput(buffer,offset,length);
  compressor.finish();
  int currentPos=0;
  while (!compressor.finished()) {
    try {
      currentPos+=compressor.compress(compressedBuffer,0,compressedBuffer.length);
    }
 catch (    IOException e) {
      throw new RuntimeException("For some reason compressor couldn't read data. " + "It is likely a problem with " + compressor.getClass().getName(),e);
    }
  }
  return currentPos;
}
