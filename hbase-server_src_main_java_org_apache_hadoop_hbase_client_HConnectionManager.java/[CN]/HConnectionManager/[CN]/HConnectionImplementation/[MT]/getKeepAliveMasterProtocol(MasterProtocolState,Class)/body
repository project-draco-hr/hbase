{
synchronized (masterAndZKLock) {
    if (!isKeepAliveMasterConnectedAndRunning(protocolState)) {
      protocolState.protocol=null;
      protocolState.protocol=createMasterWithRetries(protocolState);
    }
    protocolState.userCount++;
    protocolState.keepAliveUntil=Long.MAX_VALUE;
    return Proxy.newProxyInstance(connectionClass.getClassLoader(),new Class[]{connectionClass},new MasterProtocolHandler(this,protocolState));
  }
}
