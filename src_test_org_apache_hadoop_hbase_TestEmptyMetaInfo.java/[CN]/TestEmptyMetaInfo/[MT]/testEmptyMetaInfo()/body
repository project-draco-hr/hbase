{
  HTable t=new HTable(conf,HConstants.META_TABLE_NAME);
  final int COUNT=5;
  final byte[] tableName=Bytes.toBytes(getName());
  for (int i=0; i < COUNT; i++) {
    byte[] regionName=HRegionInfo.createRegionName(tableName,Bytes.toBytes(i == 0 ? "" : Integer.toString(i)),Long.toString(System.currentTimeMillis()));
    BatchUpdate b=new BatchUpdate(regionName);
    b.put(HConstants.COL_SERVER,Bytes.toBytes("localhost:1234"));
    t.commit(b);
  }
  long sleepTime=conf.getLong("hbase.master.meta.thread.rescanfrequency",10000);
  int tries=conf.getInt("hbase.client.retries.number",5);
  int count=0;
  do {
    tries-=1;
    try {
      Thread.sleep(sleepTime);
    }
 catch (    InterruptedException e) {
    }
    Scanner scanner=t.getScanner(HConstants.ALL_META_COLUMNS,tableName);
    try {
      count=0;
      for (      RowResult r : scanner) {
        if (r.size() > 0) {
          count+=1;
        }
      }
    }
  finally {
      scanner.close();
    }
  }
 while (count != 0 && tries >= 0);
  assertTrue(tries >= 0);
  assertEquals(0,count);
}
