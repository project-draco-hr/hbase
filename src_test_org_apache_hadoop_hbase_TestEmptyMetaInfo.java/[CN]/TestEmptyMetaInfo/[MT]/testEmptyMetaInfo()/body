{
  HTable t=new HTable(conf,HConstants.META_TABLE_NAME);
  for (int i=0; i < 5; i++) {
    Text regionName=new Text("tablename," + (i == 0 ? "" : (i + ",")) + System.currentTimeMillis());
    BatchUpdate b=new BatchUpdate(regionName);
    b.put(HConstants.COL_SERVER,"localhost:1234".getBytes(HConstants.UTF8_ENCODING));
    t.commit(b);
  }
  long sleepTime=conf.getLong("hbase.master.meta.thread.rescanfrequency",10000);
  int tries=conf.getInt("hbase.client.retries.number",5);
  int count=0;
  do {
    tries-=1;
    try {
      Thread.sleep(sleepTime);
    }
 catch (    InterruptedException e) {
    }
    HScannerInterface scanner=t.obtainScanner(HConstants.ALL_META_COLUMNS,new Text("tablename"));
    try {
      count=0;
      HStoreKey key=new HStoreKey();
      SortedMap<Text,byte[]> results=new TreeMap<Text,byte[]>();
      while (scanner.next(key,results)) {
        count+=1;
      }
    }
  finally {
      scanner.close();
    }
  }
 while (count != 0 && tries >= 0);
  assertTrue(tries >= 0);
  assertEquals(0,count);
}
