{
  this.conf=conf;
  this.stopRequested=stopRequested;
  this.replication=conf.getBoolean(HConstants.REPLICATION_ENABLE_KEY,false);
  if (replication) {
    this.zkHelper=new ReplicationZookeeperWrapper(ZooKeeperWrapper.getInstance(conf,hsi.getServerName()),conf,this.replicating,hsi.getServerName());
    this.replicationMaster=zkHelper.isReplicationMaster();
    this.replicationManager=this.replicationMaster ? new ReplicationSourceManager(zkHelper,conf,stopRequested,fs,this.replicating,logDir,oldLogDir) : null;
  }
 else {
    replicationManager=null;
    zkHelper=null;
  }
}
