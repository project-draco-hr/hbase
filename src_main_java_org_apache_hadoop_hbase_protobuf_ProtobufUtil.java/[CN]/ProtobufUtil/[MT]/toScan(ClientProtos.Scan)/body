{
  byte[] startRow=HConstants.EMPTY_START_ROW;
  byte[] stopRow=HConstants.EMPTY_END_ROW;
  if (proto.hasStartRow()) {
    startRow=proto.getStartRow().toByteArray();
  }
  if (proto.hasStopRow()) {
    stopRow=proto.getStopRow().toByteArray();
  }
  Scan scan=new Scan(startRow,stopRow);
  if (proto.hasCacheBlocks()) {
    scan.setCacheBlocks(proto.getCacheBlocks());
  }
  if (proto.hasMaxVersions()) {
    scan.setMaxVersions(proto.getMaxVersions());
  }
  if (proto.hasTimeRange()) {
    HBaseProtos.TimeRange timeRange=proto.getTimeRange();
    long minStamp=0;
    long maxStamp=Long.MAX_VALUE;
    if (timeRange.hasFrom()) {
      minStamp=timeRange.getFrom();
    }
    if (timeRange.hasTo()) {
      maxStamp=timeRange.getTo();
    }
    scan.setTimeRange(minStamp,maxStamp);
  }
  if (proto.hasFilter()) {
    NameBytesPair filter=proto.getFilter();
    scan.setFilter((Filter)toObject(filter));
  }
  if (proto.hasBatchSize()) {
    scan.setBatch(proto.getBatchSize());
  }
  for (  NameBytesPair attribute : proto.getAttributeList()) {
    scan.setAttribute(attribute.getName(),attribute.getValue().toByteArray());
  }
  if (proto.getColumnCount() > 0) {
    for (    Column column : proto.getColumnList()) {
      byte[] family=column.getFamily().toByteArray();
      if (column.getQualifierCount() > 0) {
        for (        ByteString qualifier : column.getQualifierList()) {
          scan.addColumn(family,qualifier.toByteArray());
        }
      }
 else {
        scan.addFamily(family);
      }
    }
  }
  return scan;
}
