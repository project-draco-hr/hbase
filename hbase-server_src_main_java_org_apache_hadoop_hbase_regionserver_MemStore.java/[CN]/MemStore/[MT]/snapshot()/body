{
  if (!this.snapshot.isEmpty()) {
    LOG.warn("Snapshot called again without clearing previous. " + "Doing nothing. Another ongoing flush or did we fail last attempt?");
  }
 else {
    if (!this.kvset.isEmpty()) {
      this.snapshot=this.kvset;
      this.kvset=new KeyValueSkipListSet(this.comparator);
      this.snapshotTimeRangeTracker=this.timeRangeTracker;
      this.timeRangeTracker=new TimeRangeTracker();
      this.size.set(DEEP_OVERHEAD);
      this.snapshotAllocator=this.allocator;
      if (allocator != null) {
        this.allocator=new MemStoreLAB(conf,chunkPool);
      }
      timeOfOldestEdit=Long.MAX_VALUE;
    }
  }
}
