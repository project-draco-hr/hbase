{
  this.lock.writeLock().lock();
  try {
    if (this.snapshot != ss) {
      throw new UnexpectedException("Current snapshot is " + this.snapshot + ", was passed "+ ss);
    }
    if (!ss.isEmpty()) {
      this.snapshot=new KeyValueSkipListSet(this.comparator);
      this.snapshotTimeRangeTracker=new TimeRangeTracker();
    }
  }
  finally {
    this.lock.writeLock().unlock();
  }
}
