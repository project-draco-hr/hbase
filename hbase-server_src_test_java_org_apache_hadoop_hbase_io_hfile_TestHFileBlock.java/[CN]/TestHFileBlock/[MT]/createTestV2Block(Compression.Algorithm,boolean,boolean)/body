{
  final BlockType blockType=BlockType.DATA;
  HFileContext meta=new HFileContextBuilder().withCompressionAlgo(algo).withIncludesMvcc(includesMemstoreTS).withIncludesTags(includesTag).withBytesPerCheckSum(HFile.DEFAULT_BYTES_PER_CHECKSUM).withChecksumType(HFile.DEFAULT_CHECKSUM_TYPE).build();
  HFileBlock.Writer hbw=new HFileBlock.Writer(null,meta);
  DataOutputStream dos=hbw.startWriting(blockType);
  writeTestBlockContents(dos);
  dos.flush();
  byte[] headerAndData=hbw.getHeaderAndDataForTest();
  assertEquals(1000 * 4,hbw.getUncompressedSizeWithoutHeader());
  hbw.release();
  return hbw;
}
