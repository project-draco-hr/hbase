{
  final BlockType blockType=BlockType.DATA;
  HFileContext meta=new HFileContext();
  meta.setCompressAlgo(algo);
  meta.setIncludesMvcc(includesMemstoreTS);
  meta.setIncludesTags(includesTag);
  meta.setBytesPerChecksum(HFile.DEFAULT_BYTES_PER_CHECKSUM);
  meta.setChecksumType(HFile.DEFAULT_CHECKSUM_TYPE);
  HFileBlock.Writer hbw=new HFileBlock.Writer(null,meta);
  DataOutputStream dos=hbw.startWriting(blockType);
  writeTestBlockContents(dos);
  dos.flush();
  byte[] headerAndData=hbw.getHeaderAndDataForTest();
  assertEquals(1000 * 4,hbw.getUncompressedSizeWithoutHeader());
  hbw.release();
  return hbw;
}
