{
  if (!doCommandLine(args)) {
    return null;
  }
  if (!conf.getBoolean(HConstants.REPLICATION_ENABLE_KEY,HConstants.REPLICATION_ENABLE_DEFAULT)) {
    throw new IOException("Replication needs to be enabled to verify it.");
  }
  conf.set(NAME + ".peerId",peerId);
  conf.set(NAME + ".tableName",tableName);
  conf.setLong(NAME + ".startTime",startTime);
  conf.setLong(NAME + ".endTime",endTime);
  if (families != null) {
    conf.set(NAME + ".families",families);
  }
  String peerQuorumAddress=getPeerQuorumAddress(conf);
  conf.set(NAME + ".peerQuorumAddress",peerQuorumAddress);
  LOG.info("Peer Quorum Address: " + peerQuorumAddress);
  Job job=Job.getInstance(conf,conf.get(JOB_NAME_CONF_KEY,NAME + "_" + tableName));
  job.setJarByClass(VerifyReplication.class);
  Scan scan=new Scan();
  scan.setTimeRange(startTime,endTime);
  if (versions >= 0) {
    scan.setMaxVersions(versions);
  }
  if (families != null) {
    String[] fams=families.split(",");
    for (    String fam : fams) {
      scan.addFamily(Bytes.toBytes(fam));
    }
  }
  TableMapReduceUtil.initTableMapperJob(tableName,scan,Verifier.class,null,null,job);
  TableMapReduceUtil.initCredentialsForCluster(job,peerQuorumAddress);
  job.setOutputFormatClass(NullOutputFormat.class);
  job.setNumReduceTasks(0);
  return job;
}
