{
  if (store.getCoprocessorHost() == null)   return scanner;
  if (user == null) {
    return store.getCoprocessorHost().preCompact(store,scanner,scanType,request);
  }
 else {
    try {
      return user.getUGI().doAs(new PrivilegedExceptionAction<InternalScanner>(){
        @Override public InternalScanner run() throws Exception {
          return store.getCoprocessorHost().preCompact(store,scanner,scanType,request);
        }
      }
);
    }
 catch (    InterruptedException ie) {
      InterruptedIOException iioe=new InterruptedIOException();
      iioe.initCause(ie);
      throw iioe;
    }
  }
}
