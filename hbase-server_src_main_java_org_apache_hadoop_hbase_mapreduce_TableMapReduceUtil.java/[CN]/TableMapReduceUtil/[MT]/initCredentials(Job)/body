{
  UserProvider userProvider=UserProvider.instantiate(job.getConfiguration());
  if (userProvider.isHBaseSecurityEnabled()) {
    try {
      String quorumAddress=job.getConfiguration().get(TableOutputFormat.QUORUM_ADDRESS);
      if (quorumAddress != null) {
        Configuration peerConf=HBaseConfiguration.create(job.getConfiguration());
        ZKUtil.applyClusterKeyToConf(peerConf,quorumAddress);
        userProvider.getCurrent().obtainAuthTokenForJob(peerConf,job);
      }
      userProvider.getCurrent().obtainAuthTokenForJob(job.getConfiguration(),job);
    }
 catch (    InterruptedException ie) {
      LOG.info("Interrupted obtaining user authentication token");
      Thread.interrupted();
    }
  }
}
