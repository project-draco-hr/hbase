{
  ZooKeeperWrapper zk;
  try {
    zk=getZooKeeperWrapper();
  }
 catch (  IOException e) {
    throw new MasterNotRunningException(e);
  }
  HServerAddress masterLocation=null;
synchronized (this.masterLock) {
    for (int tries=0; !this.closed && !this.masterChecked && this.master == null && tries < numRetries; tries++) {
      try {
        masterLocation=zk.readMasterAddressOrThrow();
        HMasterInterface tryMaster=(HMasterInterface)HBaseRPC.getProxy(HMasterInterface.class,HBaseRPCProtocolVersion.versionID,masterLocation.getInetSocketAddress(),this.conf);
        if (tryMaster.isMasterRunning()) {
          this.master=tryMaster;
          this.masterLock.notifyAll();
          break;
        }
      }
 catch (      IOException e) {
        if (tries == numRetries - 1) {
          LOG.info("getMaster attempt " + tries + " of "+ this.numRetries+ " failed; no more retrying.",e);
          break;
        }
        LOG.info("getMaster attempt " + tries + " of "+ this.numRetries+ " failed; retrying after sleep of "+ getPauseTime(tries),e);
      }
      try {
        this.masterLock.wait(getPauseTime(tries));
      }
 catch (      InterruptedException e) {
      }
    }
    this.masterChecked=true;
  }
  if (this.master == null) {
    if (masterLocation == null) {
      throw new MasterNotRunningException();
    }
    throw new MasterNotRunningException(masterLocation.toString());
  }
  return this.master;
}
