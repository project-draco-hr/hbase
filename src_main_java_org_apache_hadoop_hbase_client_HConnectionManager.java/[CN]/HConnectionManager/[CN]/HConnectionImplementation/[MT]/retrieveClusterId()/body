{
  if (conf.get(HConstants.CLUSTER_ID) != null) {
    return;
  }
  if (this.clusterId == null) {
    this.clusterId=conf.get(HConstants.CLUSTER_ID);
    if (this.clusterId == null) {
      ZooKeeperKeepAliveConnection zkw=null;
      try {
        zkw=getKeepAliveZooKeeperWatcher();
        this.clusterId=Bytes.toString(ZKUtil.getData(zkw,zkw.clusterIdZNode));
        if (clusterId == null) {
          LOG.info("ClusterId read in ZooKeeper is null");
        }
      }
 catch (      KeeperException e) {
        LOG.warn("Can't retrieve clusterId from Zookeeper",e);
      }
catch (      IOException e) {
        LOG.warn("Can't retrieve clusterId from Zookeeper",e);
      }
 finally {
        if (zkw != null) {
          zkw.close();
        }
      }
      if (this.clusterId == null) {
        this.clusterId="default";
      }
      LOG.info("ClusterId is " + clusterId);
    }
  }
  conf.set(HConstants.CLUSTER_ID,clusterId);
}
