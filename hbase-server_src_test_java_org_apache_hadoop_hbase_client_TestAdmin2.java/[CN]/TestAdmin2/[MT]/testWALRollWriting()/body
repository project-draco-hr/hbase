{
  setUpforLogRolling();
  String className=this.getClass().getName();
  StringBuilder v=new StringBuilder(className);
  while (v.length() < 1000) {
    v.append(className);
  }
  byte[] value=Bytes.toBytes(v.toString());
  HRegionServer regionServer=startAndWriteData(TableName.valueOf("TestLogRolling"),value);
  LOG.info("after writing there are " + DefaultWALProvider.getNumRolledLogFiles(regionServer.getWAL(null)) + " log files");
  List<HRegion> regions=new ArrayList<HRegion>(regionServer.getOnlineRegionsLocalContext());
  for (  HRegion r : regions) {
    r.flushcache();
  }
  admin.rollWALWriter(regionServer.getServerName());
  int count=DefaultWALProvider.getNumRolledLogFiles(regionServer.getWAL(null));
  LOG.info("after flushing all regions and rolling logs there are " + count + " log files");
  assertTrue(("actual count: " + count),count <= 2);
}
