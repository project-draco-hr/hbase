{
  if (codec != null && (codec instanceof GzipCodec) && !NativeCodeLoader.isNativeCodeLoaded() && !ZlibFactory.isNativeZlibLoaded(conf)) {
    throw new IllegalArgumentException("SequenceFile doesn't work with " + "GzipCodec without native-hadoop code!");
  }
  Writer writer=null;
  if (!compress) {
    writer=new Writer(conf,out,keyClass,valClass,metadata);
  }
 else   if (compress && !blockCompress) {
    writer=new RecordCompressWriter(conf,out,keyClass,valClass,codec,metadata);
  }
 else {
    writer=new BlockCompressWriter(conf,out,keyClass,valClass,codec,metadata);
  }
  return writer;
}
