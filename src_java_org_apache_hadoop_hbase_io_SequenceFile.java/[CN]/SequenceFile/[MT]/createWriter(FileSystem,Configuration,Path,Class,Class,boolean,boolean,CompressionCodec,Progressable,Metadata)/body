{
  if (codec != null && (codec instanceof GzipCodec) && !NativeCodeLoader.isNativeCodeLoaded() && !ZlibFactory.isNativeZlibLoaded(conf)) {
    throw new IllegalArgumentException("SequenceFile doesn't work with " + "GzipCodec without native-hadoop code!");
  }
  Writer writer=null;
  if (!compress) {
    writer=new Writer(fs,conf,file,keyClass,valClass,progress,metadata);
  }
 else   if (compress && !blockCompress) {
    writer=new RecordCompressWriter(fs,conf,file,keyClass,valClass,codec,progress,metadata);
  }
 else {
    writer=new BlockCompressWriter(fs,conf,file,keyClass,valClass,codec,progress,metadata);
  }
  return writer;
}
