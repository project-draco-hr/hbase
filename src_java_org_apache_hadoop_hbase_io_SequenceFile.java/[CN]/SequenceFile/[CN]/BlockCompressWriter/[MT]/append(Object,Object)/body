{
  if (key.getClass() != keyClass)   throw new IOException("wrong key class: " + key + " is not "+ keyClass);
  if (val.getClass() != valClass)   throw new IOException("wrong value class: " + val + " is not "+ valClass);
  int oldKeyLength=keyBuffer.getLength();
  keySerializer.serialize(key);
  int keyLength=keyBuffer.getLength() - oldKeyLength;
  if (keyLength < 0)   throw new IOException("negative length keys not allowed: " + key);
  WritableUtils.writeVInt(keyLenBuffer,keyLength);
  int oldValLength=valBuffer.getLength();
  uncompressedValSerializer.serialize(val);
  int valLength=valBuffer.getLength() - oldValLength;
  WritableUtils.writeVInt(valLenBuffer,valLength);
  ++noBufferedRecords;
  int currentBlockSize=keyBuffer.getLength() + valBuffer.getLength();
  if (currentBlockSize >= compressionBlockSize) {
    sync();
  }
}
