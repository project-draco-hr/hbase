{
  this.conf=conf;
  this.rootdir=FSUtils.getRootDir(this.conf);
  this.conf.set("fs.defaultFS",this.rootdir.toString());
  this.fs=FileSystem.get(this.conf);
  checkRootDir(this.rootdir,this.conf,this.fs);
  HServerAddress a=new HServerAddress(getMyAddress(this.conf));
  this.rpcServer=HBaseRPC.getServer(this,a.getBindAddress(),a.getPort(),conf.getInt("hbase.regionserver.handler.count",10),false,conf);
  this.address=new HServerAddress(this.rpcServer.getListenerAddress());
  this.numRetries=conf.getInt("hbase.client.retries.number",2);
  this.threadWakeFrequency=conf.getInt(THREAD_WAKE_FREQUENCY,10 * 1000);
  this.sleeper=new Sleeper(this.threadWakeFrequency,this.closed);
  this.connection=ServerConnectionManager.getConnection(conf);
  this.zooKeeperWrapper=new ZooKeeperWrapper(conf,this);
  this.zkMasterAddressWatcher=new ZKMasterAddressWatcher(this.zooKeeperWrapper,this.shutdownRequested);
  this.zkMasterAddressWatcher.writeAddressToZooKeeper(this.address);
  serverManager=new ServerManager(this);
  regionManager=new RegionManager(this);
  setName(MASTER);
  this.metrics=new MasterMetrics(MASTER);
  this.closed.set(false);
  LOG.info("HMaster initialized on " + this.address.toString());
}
