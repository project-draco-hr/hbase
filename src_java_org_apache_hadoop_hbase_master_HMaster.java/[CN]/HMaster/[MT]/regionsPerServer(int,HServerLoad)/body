{
  SortedMap<HServerLoad,Set<String>> lightServers=new TreeMap<HServerLoad,Set<String>>();
synchronized (this.loadToServers) {
    lightServers.putAll(this.loadToServers.headMap(thisServersLoad));
  }
  int nRegions=0;
  for (  Map.Entry<HServerLoad,Set<String>> e : lightServers.entrySet()) {
    HServerLoad lightLoad=new HServerLoad(e.getKey().getNumberOfRequests(),e.getKey().getNumberOfRegions());
    do {
      lightLoad.setNumberOfRegions(lightLoad.getNumberOfRegions() + 1);
      nRegions+=1;
    }
 while (lightLoad.compareTo(thisServersLoad) <= 0 && nRegions < nRegionsToAssign);
    nRegions*=e.getValue().size();
    if (nRegions >= nRegionsToAssign) {
      break;
    }
  }
  return nRegions;
}
