{
  RegionServerOperation op=null;
  if (this.regionManager.getRootRegionLocation() != null) {
    op=this.delayedToDoQueue.poll();
  }
  if (op == null) {
    try {
      op=this.toDoQueue.poll(this.threadWakeFrequency,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException e) {
    }
  }
  if (op == null || this.closed.get()) {
    return true;
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Processing todo: " + op.toString());
  }
  try {
    if (!op.process()) {
      if (this.toDoQueue.size() == 0) {
        this.sleeper.sleep();
      }
      if (LOG.isDebugEnabled()) {
        LOG.debug("Put " + op.toString() + " back on queue");
      }
      queue(op);
    }
  }
 catch (  Exception ex) {
    if (ex instanceof RemoteException) {
      try {
        ex=RemoteExceptionHandler.decodeRemoteException((RemoteException)ex);
      }
 catch (      IOException e) {
        ex=e;
        LOG.warn("main processing loop: " + op.toString(),e);
      }
    }
    if (!checkFileSystem()) {
      return false;
    }
    LOG.warn("Adding to delayed queue: " + op.toString(),ex);
    requeue(op);
  }
  return true;
}
