{
  try {
    long rowKeyBase;
    byte[][] columnFamilies=dataGenerator.getColumnFamilies();
    while ((rowKeyBase=nextKeyToInsert.getAndIncrement()) < endKey) {
      byte[] rowKey=dataGenerator.getDeterministicUniqueKey(rowKeyBase);
      Put put=new Put(rowKey);
      numKeys.addAndGet(1);
      int columnCount=0;
      for (      byte[] cf : columnFamilies) {
        String s;
        byte[][] columns=dataGenerator.generateColumnsForCf(rowKey,cf);
        for (        byte[] column : columns) {
          byte[] value=dataGenerator.generateValue(rowKey,cf,column);
          put.add(cf,column,value);
          ++columnCount;
          if (!isMultiPut) {
            insert(put,rowKeyBase);
            numCols.addAndGet(1);
            put=new Put(rowKey);
          }
        }
      }
      if (isMultiPut) {
        if (verbose) {
          LOG.debug("Preparing put for key = [" + rowKey + "], "+ columnCount+ " columns");
        }
        insert(put,rowKeyBase);
        numCols.addAndGet(columnCount);
      }
      if (trackInsertedKeys) {
        insertedKeys.add(rowKeyBase);
      }
    }
  }
  finally {
    try {
      table.close();
    }
 catch (    IOException e) {
      LOG.error("Error closing table",e);
    }
    numThreadsWorking.decrementAndGet();
  }
}
