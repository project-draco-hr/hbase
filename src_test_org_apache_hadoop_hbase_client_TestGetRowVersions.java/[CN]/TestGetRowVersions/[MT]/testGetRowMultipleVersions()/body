{
  BatchUpdate b=new BatchUpdate(ROW,TIMESTAMP);
  b.put(COLUMN,Bytes.toBytes(VALUE1));
  this.table.commit(b);
  this.cluster.shutdown();
  this.zooKeeperCluster.shutdown();
  LOG.debug("HBase cluster shut down -- restarting");
  this.hBaseClusterSetup();
  this.table=new HTable(conf,TABLE_NAME);
  b=new BatchUpdate(ROW,TIMESTAMP);
  b.put(COLUMN,Bytes.toBytes(VALUE2));
  this.table.commit(b);
  RowResult r=table.getRow(ROW);
  assertNotNull(r);
  assertTrue(r.size() != 0);
  Cell c=r.get(COLUMN);
  assertNotNull(c);
  assertTrue(c.getValue().length != 0);
  String value=Bytes.toString(c.getValue());
  assertTrue(value.compareTo(VALUE2) == 0);
  r=table.getRow(ROW,HConstants.ALL_VERSIONS);
  for (  Map.Entry<byte[],Cell> e : r.entrySet()) {
    c=e.getValue();
    for (Iterator<Map.Entry<Long,byte[]>> it=c.iterator(); it.hasNext(); ) {
      Map.Entry<Long,byte[]> v=it.next();
      value=Bytes.toString(v.getValue());
      assertTrue(VALUE2.compareTo(Bytes.toString(v.getValue())) == 0);
    }
  }
}
