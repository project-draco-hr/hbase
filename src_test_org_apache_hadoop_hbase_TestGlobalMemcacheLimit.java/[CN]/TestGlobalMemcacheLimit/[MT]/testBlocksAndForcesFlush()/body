{
  long startingDataSize=populate(table1,500,0) + populate(table2,500,0);
  long dataNeeded=(2 * 1024 * 1024) - startingDataSize;
  double numRows=(double)dataNeeded / (double)rowSize;
  int preFlushRows=(int)Math.floor(numRows);
  long dataAdded=populate(table1,preFlushRows,500);
  assertEquals("Expected memcache size",dataAdded + startingDataSize,server.getGlobalMemcacheSize());
  populate(table1,2,preFlushRows + 500);
  assertTrue("Post-flush memcache size",server.getGlobalMemcacheSize() <= 1024 * 1024);
}
