{
  HBaseTestingUtility TEST_UTIL=new HBaseTestingUtility();
  TEST_UTIL.startMiniZKCluster();
  Configuration conf=TEST_UTIL.getConfiguration();
  conf.set(HConstants.MASTER_PORT,"0");
  HMaster hm=new HMaster(conf);
  ServerName sm=hm.getServerName();
  InetSocketAddress isa=new InetSocketAddress(sm.getHostname(),sm.getPort());
  int i=0;
  while (i < 20) {
    try {
      MasterMonitorProtocol inf=(MasterMonitorProtocol)HBaseRPC.getProxy(MasterMonitorProtocol.class,MasterMonitorProtocol.VERSION,isa,conf,100 * 10);
      inf.isMasterRunning(null,IsMasterRunningRequest.getDefaultInstance());
      fail();
    }
 catch (    ServiceException ex) {
      IOException ie=ProtobufUtil.getRemoteException(ex);
      if (!(ie instanceof SocketTimeoutException)) {
        if (ie.getMessage().startsWith("org.apache.hadoop.hbase.ipc.ServerNotRunningYetException: Server is not running yet")) {
          return;
        }
      }
 else {
        System.err.println("Got SocketTimeoutException. Will retry. ");
      }
    }
catch (    Throwable t) {
      fail("Unexpected throwable: " + t);
    }
    Thread.sleep(100);
    i++;
  }
  fail();
}
