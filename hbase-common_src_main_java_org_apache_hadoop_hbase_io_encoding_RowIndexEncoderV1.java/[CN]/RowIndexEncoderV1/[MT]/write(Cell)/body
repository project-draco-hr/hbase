{
  if (!checkRow(cell)) {
    if (startOffset < 0) {
      startOffset=out.size();
    }
    rowsOffsetBAOS.writeInt(out.size() - startOffset);
  }
  int klength=KeyValueUtil.keyLength(cell);
  int vlength=cell.getValueLength();
  out.writeInt(klength);
  out.writeInt(vlength);
  CellUtil.writeFlatKey(cell,out);
  CellUtil.writeValue(out,cell,vlength);
  int encodedKvSize=klength + vlength + KeyValue.KEYVALUE_INFRASTRUCTURE_SIZE;
  if (encodingCtx.getHFileContext().isIncludesTags()) {
    int tagsLength=cell.getTagsLength();
    out.writeShort(tagsLength);
    if (tagsLength > 0) {
      CellUtil.writeTags(out,cell,tagsLength);
    }
    encodedKvSize+=tagsLength + KeyValue.TAGS_LENGTH_SIZE;
  }
  if (encodingCtx.getHFileContext().isIncludesMvcc()) {
    WritableUtils.writeVLong(out,cell.getSequenceId());
    encodedKvSize+=WritableUtils.getVIntSize(cell.getSequenceId());
  }
  lastCell=cell;
  return encodedKvSize;
}
