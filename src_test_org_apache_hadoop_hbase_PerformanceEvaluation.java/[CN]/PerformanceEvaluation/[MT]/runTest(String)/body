{
  if (cmd.equals(RANDOM_READ_MEM)) {
    R=(this.R / 10) * N;
  }
  MiniHBaseCluster hbaseMiniCluster=null;
  MiniDFSCluster dfsCluster=null;
  if (this.miniCluster) {
    dfsCluster=new MiniDFSCluster(conf,2,true,(String[])null);
    FileSystem fs=dfsCluster.getFileSystem();
    conf.set("fs.defaultFS",fs.getUri().toString());
    Path parentdir=fs.getHomeDirectory();
    conf.set(HConstants.HBASE_DIR,parentdir.toString());
    fs.mkdirs(parentdir);
    FSUtils.setVersion(fs,parentdir);
    hbaseMiniCluster=new MiniHBaseCluster(this.conf,N);
  }
  try {
    if (N == 1) {
      runNIsOne(cmd);
    }
 else {
      runNIsMoreThanOne(cmd);
    }
  }
  finally {
    if (this.miniCluster && hbaseMiniCluster != null) {
      hbaseMiniCluster.shutdown();
      HBaseTestCase.shutdownDfs(dfsCluster);
    }
  }
}
