{
  try {
    lock.lock();
    while (!closed) {
      if (!queueEmpty.await(this.optionalFlushInterval,TimeUnit.MILLISECONDS)) {
        forceSync=true;
      }
      hflush();
      syncDone.signalAll();
    }
  }
 catch (  IOException e) {
    LOG.error("Error while syncing, requesting close of hlog ",e);
    requestLogRoll();
  }
catch (  InterruptedException e) {
    LOG.debug(getName() + "interrupted while waiting for sync requests");
  }
 finally {
    syncDone.signalAll();
    lock.unlock();
    LOG.info(getName() + " exiting");
  }
}
