{
  assertNoErrors(doFsck(conf,false));
  String table="tableBadMetaAssign";
  TEST_UTIL.createTable(Bytes.toBytes(table),FAM);
  assertNoErrors(doFsck(conf,false));
  HTable meta=new HTable(conf,HTableDescriptor.META_TABLEDESC.getName(),executorService);
  ResultScanner scanner=meta.getScanner(new Scan());
  HRegionInfo hri=null;
  resforloop:   for (  Result res : scanner) {
    long startCode=Bytes.toLong(res.getValue(HConstants.CATALOG_FAMILY,HConstants.STARTCODE_QUALIFIER));
    for (    JVMClusterUtil.RegionServerThread rs : TEST_UTIL.getHBaseCluster().getRegionServerThreads()) {
      ServerName sn=rs.getRegionServer().getServerName();
      if (startCode != sn.getStartcode()) {
        Put put=new Put(res.getRow());
        put.setWriteToWAL(false);
        put.add(HConstants.CATALOG_FAMILY,HConstants.SERVER_QUALIFIER,Bytes.toBytes(sn.getHostAndPort()));
        put.add(HConstants.CATALOG_FAMILY,HConstants.STARTCODE_QUALIFIER,Bytes.toBytes(sn.getStartcode()));
        meta.put(put);
        hri=HRegionInfo.getHRegionInfo(res);
        break resforloop;
      }
    }
  }
  assertErrors(doFsck(conf,true),new ERROR_CODE[]{ERROR_CODE.SERVER_DOES_NOT_MATCH_META});
  TEST_UTIL.getHBaseCluster().getMaster().getAssignmentManager().waitForAssignment(hri);
  assertNoErrors(doFsck(conf,false));
  HTable t=new HTable(conf,Bytes.toBytes(table),executorService);
  ResultScanner s=t.getScanner(new Scan());
  s.close();
  t.close();
  scanner.close();
  meta.close();
}
