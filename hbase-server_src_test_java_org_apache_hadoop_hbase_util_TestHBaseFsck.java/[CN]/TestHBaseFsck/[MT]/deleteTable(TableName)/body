{
  HConnection conn=(HConnection)ConnectionFactory.createConnection(conf);
  Admin admin=conn.getAdmin();
  conn.clearRegionCache();
  if (admin.isTableEnabled(tablename)) {
    admin.disableTableAsync(tablename);
  }
  long totalWait=0;
  long maxWait=30 * 1000;
  long sleepTime=250;
  while (!admin.isTableDisabled(tablename)) {
    try {
      Thread.sleep(sleepTime);
      totalWait+=sleepTime;
      if (totalWait >= maxWait) {
        fail("Waited too long for table to be disabled + " + tablename);
      }
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
      fail("Interrupted when trying to disable table " + tablename);
    }
  }
  admin.deleteTable(tablename);
  admin.close();
  conn.close();
}
