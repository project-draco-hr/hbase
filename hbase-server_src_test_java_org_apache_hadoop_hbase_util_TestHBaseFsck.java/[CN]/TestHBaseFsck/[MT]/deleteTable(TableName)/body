{
  HBaseAdmin admin=new HBaseAdmin(conf);
  admin.getConnection().clearRegionCache();
  admin.disableTableAsync(tablename);
  long totalWait=0;
  long maxWait=30 * 1000;
  long sleepTime=250;
  while (!admin.isTableDisabled(tablename)) {
    try {
      Thread.sleep(sleepTime);
      totalWait+=sleepTime;
      if (totalWait >= maxWait) {
        fail("Waited too long for table to be disabled + " + tablename);
      }
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
      fail("Interrupted when trying to disable table " + tablename);
    }
  }
  admin.deleteTable(tablename);
}
