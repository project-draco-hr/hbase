{
  for (int numCfs=0; numCfs <= 3; numCfs++) {
    Configuration conf=new Configuration(this.util.getConfiguration());
    Map<String,Compression.Algorithm> familyToCompression=getMockColumnFamilies(numCfs);
    HTable table=Mockito.mock(HTable.class);
    setupMockColumnFamilies(table,familyToCompression);
    HFileOutputFormat.configureCompression(table,conf);
    Map<byte[],String> retrievedFamilyToCompressionMap=HFileOutputFormat.createFamilyCompressionMap(conf);
    for (    Entry<String,Algorithm> entry : familyToCompression.entrySet()) {
      assertEquals("Compression configuration incorrect for column family:" + entry.getKey(),entry.getValue().getName(),retrievedFamilyToCompressionMap.get(entry.getKey().getBytes()));
    }
  }
}
