{
  PriorityCompactionQueue pq=new PriorityCompactionQueue();
  HRegion r1=new DummyHRegion("r1");
  HRegion r2=new DummyHRegion("r2");
  HRegion r3=new DummyHRegion("r3");
  HRegion r4=new DummyHRegion("r4");
  HRegion r5=new DummyHRegion("r5");
  addRegion(pq,r1,0);
  addRegion(pq,r2,0);
  addRegion(pq,r3,0);
  addRegion(pq,r4,0);
  addRegion(pq,r5,0);
  getAndCheckRegion(pq,r1);
  getAndCheckRegion(pq,r2);
  getAndCheckRegion(pq,r3);
  getAndCheckRegion(pq,r4);
  getAndCheckRegion(pq,r5);
  addRegion(pq,r1,0);
  addRegion(pq,r2,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r3,0);
  addRegion(pq,r4,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r5,0);
  getAndCheckRegion(pq,r1);
  getAndCheckRegion(pq,r3);
  getAndCheckRegion(pq,r5);
  getAndCheckRegion(pq,r2);
  getAndCheckRegion(pq,r4);
  addRegion(pq,r1,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r2,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r3,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r4,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r5,0);
  getAndCheckRegion(pq,r5);
  getAndCheckRegion(pq,r1);
  getAndCheckRegion(pq,r2);
  getAndCheckRegion(pq,r3);
  getAndCheckRegion(pq,r4);
  addRegion(pq,r1,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r2,0);
  addRegion(pq,r3,CompactSplitThread.PRIORITY_USER);
  Thread.sleep(1000);
  addRegion(pq,r4,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r5,0);
  getAndCheckRegion(pq,r2);
  getAndCheckRegion(pq,r5);
  getAndCheckRegion(pq,r1);
  getAndCheckRegion(pq,r3);
  getAndCheckRegion(pq,r4);
  pq=new PriorityCompactionQueue();
  addRegion(pq,r1,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r2,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r3,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r4,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r5,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r3,0);
  getAndCheckRegion(pq,r3);
  getAndCheckRegion(pq,r1);
  getAndCheckRegion(pq,r2);
  getAndCheckRegion(pq,r4);
  getAndCheckRegion(pq,r5);
  Assert.assertTrue("Queue should be empty.",pq.size() == 0);
  addRegion(pq,r1,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r2,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r3,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r4,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r5,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r1,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r2,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r3,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r4,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r5,CompactSplitThread.PRIORITY_USER);
  getAndCheckRegion(pq,r1);
  getAndCheckRegion(pq,r2);
  getAndCheckRegion(pq,r3);
  getAndCheckRegion(pq,r4);
  getAndCheckRegion(pq,r5);
  Assert.assertTrue("Queue should be empty.",pq.size() == 0);
  addRegion(pq,r1,CompactSplitThread.PRIORITY_USER);
  addRegion(pq,r2,-1);
  addRegion(pq,r3,0);
  addRegion(pq,r4,-2);
  getAndCheckRegion(pq,r4);
  getAndCheckRegion(pq,r2);
  getAndCheckRegion(pq,r3);
  getAndCheckRegion(pq,r1);
  Assert.assertTrue("Queue should be empty.",pq.size() == 0);
}
