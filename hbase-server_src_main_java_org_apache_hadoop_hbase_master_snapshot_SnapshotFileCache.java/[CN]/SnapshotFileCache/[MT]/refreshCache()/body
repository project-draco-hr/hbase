{
  FileStatus dirStatus, tempStatus;
  try {
    dirStatus=fs.getFileStatus(snapshotDir);
  }
 catch (  FileNotFoundException e) {
    if (this.cache.size() > 0) {
      LOG.error("Snapshot directory: " + snapshotDir + " doesn't exist");
    }
    return;
  }
  try {
    Path snapshotTmpDir=new Path(snapshotDir,SnapshotDescriptionUtils.SNAPSHOT_TMP_DIR_NAME);
    tempStatus=fs.getFileStatus(snapshotTmpDir);
  }
 catch (  FileNotFoundException e) {
    tempStatus=dirStatus;
  }
  if (dirStatus.getModificationTime() <= lastModifiedTime && tempStatus.getModificationTime() <= lastModifiedTime) {
    return;
  }
  this.lastModifiedTime=Math.min(dirStatus.getModificationTime(),tempStatus.getModificationTime());
  this.cache.clear();
  Map<String,SnapshotDirectoryInfo> known=new HashMap<String,SnapshotDirectoryInfo>();
  FileStatus[] snapshots=FSUtils.listStatus(fs,snapshotDir);
  if (snapshots == null) {
    if (LOG.isDebugEnabled() && this.snapshots.size() > 0) {
      LOG.debug("No snapshots on-disk, cache empty");
    }
    this.snapshots.clear();
    return;
  }
  for (  FileStatus snapshot : snapshots) {
    String name=snapshot.getPath().getName();
    if (name.equals(SnapshotDescriptionUtils.SNAPSHOT_TMP_DIR_NAME)) {
      FileStatus[] running=FSUtils.listStatus(fs,snapshot.getPath());
      if (running == null)       continue;
      for (      FileStatus run : running) {
        this.cache.addAll(fileInspector.filesUnderSnapshot(run.getPath()));
      }
    }
 else {
      SnapshotDirectoryInfo files=this.snapshots.remove(name);
      if (files == null || files.hasBeenModified(snapshot.getModificationTime())) {
        Collection<String> storedFiles=fileInspector.filesUnderSnapshot(snapshot.getPath());
        files=new SnapshotDirectoryInfo(snapshot.getModificationTime(),storedFiles);
      }
      this.cache.addAll(files.getFiles());
      known.put(name,files);
    }
  }
  this.snapshots.clear();
  this.snapshots.putAll(known);
}
