{
  List<String> snapshotInProgress=Lists.newArrayList();
  Path snapshotTmpDir=new Path(snapshotDir,SnapshotDescriptionUtils.SNAPSHOT_TMP_DIR_NAME);
  FileStatus[] running=FSUtils.listStatus(fs,snapshotTmpDir);
  if (running != null) {
    for (    FileStatus run : running) {
      try {
        snapshotInProgress.addAll(fileInspector.filesUnderSnapshot(run.getPath()));
      }
 catch (      CorruptedSnapshotException e) {
        if (e.getCause() instanceof FileNotFoundException) {
          if (!fs.exists(new Path(run.getPath(),SnapshotDescriptionUtils.SNAPSHOT_IN_PROGRESS))) {
            fs.delete(run.getPath(),true);
            LOG.warn("delete the " + run.getPath() + " due to exception:",e.getCause());
          }
        }
 else {
          throw e;
        }
      }
    }
  }
  return snapshotInProgress;
}
