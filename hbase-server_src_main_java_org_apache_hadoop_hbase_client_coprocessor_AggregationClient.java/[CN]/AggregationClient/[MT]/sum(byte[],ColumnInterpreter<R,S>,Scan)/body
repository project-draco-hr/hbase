{
  validateParameters(scan);
class SumCallBack implements Batch.Callback<S> {
    S sumVal=null;
    public S getSumResult(){
      return sumVal;
    }
    @Override public synchronized void update(    byte[] region,    byte[] row,    S result){
      sumVal=ci.add(sumVal,result);
    }
  }
  SumCallBack sumCallBack=new SumCallBack();
  HTable table=new HTable(conf,tableName);
  table.coprocessorExec(AggregateProtocol.class,scan.getStartRow(),scan.getStopRow(),new Batch.Call<AggregateProtocol,S>(){
    @Override public S call(    AggregateProtocol instance) throws IOException {
      return instance.getSum(ci,scan);
    }
  }
,sumCallBack);
  return sumCallBack.getSumResult();
}
