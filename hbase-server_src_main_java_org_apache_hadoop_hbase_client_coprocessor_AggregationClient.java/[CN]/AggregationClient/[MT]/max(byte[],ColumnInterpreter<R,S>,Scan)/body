{
  validateParameters(scan);
class MaxCallBack implements Batch.Callback<R> {
    R max=null;
    R getMax(){
      return max;
    }
    @Override public synchronized void update(    byte[] region,    byte[] row,    R result){
      max=(max == null || (result != null && ci.compare(max,result) < 0)) ? result : max;
    }
  }
  MaxCallBack aMaxCallBack=new MaxCallBack();
  HTable table=null;
  try {
    table=new HTable(conf,tableName);
    table.coprocessorExec(AggregateProtocol.class,scan.getStartRow(),scan.getStopRow(),new Batch.Call<AggregateProtocol,R>(){
      @Override public R call(      AggregateProtocol instance) throws IOException {
        return instance.getMax(ci,scan);
      }
    }
,aMaxCallBack);
  }
  finally {
    if (table != null) {
      table.close();
    }
  }
  return aMaxCallBack.getMax();
}
