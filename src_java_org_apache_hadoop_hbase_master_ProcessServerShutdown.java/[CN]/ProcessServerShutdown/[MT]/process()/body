{
  LOG.info("process shutdown of server " + this.deadServer + ": logSplit: "+ logSplit+ ", rootRescanned: "+ rootRescanned+ ", numberOfMetaRegions: "+ master.getRegionManager().numMetaRegions()+ ", onlineMetaRegions.size(): "+ master.getRegionManager().numOnlineMetaRegions());
  if (!logSplit) {
    if (this.master.getFileSystem().exists(oldLogDir)) {
      if (!master.getRegionManager().splitLogLock.tryLock()) {
        return false;
      }
      try {
        HLog.splitLog(master.getRootDir(),oldLogDir,this.master.getFileSystem(),this.master.getConfiguration());
      }
  finally {
        master.getRegionManager().splitLogLock.unlock();
      }
    }
    logSplit=true;
  }
  LOG.info("Log split complete, meta reassignment and scanning:");
  if (this.isRootServer) {
    LOG.info("ProcessServerShutdown reassigning ROOT region");
    master.getRegionManager().reassignRootRegion();
    isRootServer=false;
  }
  for (  MetaRegion metaRegion : metaRegions) {
    LOG.info("ProcessServerShutdown setting to unassigned: " + metaRegion.toString());
    master.getRegionManager().setUnassigned(metaRegion.getRegionInfo(),true);
  }
  metaRegions.clear();
  if (!rootAvailable()) {
    return true;
  }
  if (!rootRescanned) {
    Boolean result=new ScanRootRegion(new MetaRegion(master.getRegionManager().getRootRegionLocation(),HRegionInfo.ROOT_REGIONINFO),this.master).doWithRetries();
    if (result == null) {
      return true;
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("process server shutdown scanning root region on " + master.getRegionManager().getRootRegionLocation().getBindAddress() + " finished "+ Thread.currentThread().getName());
    }
    rootRescanned=true;
  }
  if (!metaTableAvailable()) {
    return true;
  }
  List<MetaRegion> regions=master.getRegionManager().getListOfOnlineMetaRegions();
  for (  MetaRegion r : regions) {
    Boolean result=new ScanMetaRegions(r,this.master).doWithRetries();
    if (result == null) {
      break;
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("process server shutdown finished scanning " + Bytes.toString(r.getRegionName()) + " on "+ r.getServer());
    }
  }
  this.master.getServerManager().removeDeadServer(deadServer);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Removed " + deadServer + " from deadservers Map");
  }
  return true;
}
