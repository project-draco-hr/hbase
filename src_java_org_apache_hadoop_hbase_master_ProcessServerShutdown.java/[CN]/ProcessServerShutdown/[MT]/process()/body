{
  LOG.info("process shutdown of server " + this.deadServer + ": logSplit: "+ logSplit+ ", rootRescanned: "+ rootRescanned+ ", numberOfMetaRegions: "+ master.regionManager.numMetaRegions()+ ", onlineMetaRegions.size(): "+ master.regionManager.numOnlineMetaRegions());
  if (!logSplit) {
    if (master.fs.exists(oldLogDir)) {
      if (!master.regionManager.splitLogLock.tryLock()) {
        return false;
      }
      try {
        HLog.splitLog(master.rootdir,oldLogDir,master.fs,master.getConfiguration());
      }
  finally {
        master.regionManager.splitLogLock.unlock();
      }
    }
    logSplit=true;
  }
  LOG.info("Log split complete, meta reassignment and scanning:");
  if (this.isRootServer) {
    LOG.info("ProcessServerShutdown reassigning ROOT region");
    master.regionManager.reassignRootRegion();
    isRootServer=false;
  }
  for (  MetaRegion metaRegion : metaRegions) {
    LOG.info("ProcessServerShutdown setting to unassigned: " + metaRegion.toString());
    master.regionManager.setUnassigned(metaRegion.getRegionInfo(),true);
  }
  metaRegions.clear();
  if (!rootAvailable()) {
    return true;
  }
  if (!rootRescanned) {
    Boolean result=new ScanRootRegion(new MetaRegion(master.getRootRegionLocation(),HRegionInfo.ROOT_REGIONINFO),this.master).doWithRetries();
    if (result == null) {
      return true;
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("process server shutdown scanning root region on " + master.getRootRegionLocation().getBindAddress() + " finished "+ Thread.currentThread().getName());
    }
    rootRescanned=true;
  }
  if (!metaTableAvailable()) {
    return true;
  }
  List<MetaRegion> regions=master.regionManager.getListOfOnlineMetaRegions();
  for (  MetaRegion r : regions) {
    Boolean result=new ScanMetaRegions(r,this.master).doWithRetries();
    if (result == null) {
      break;
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("process server shutdown finished scanning " + Bytes.toString(r.getRegionName()) + " on "+ r.getServer());
    }
  }
  this.master.serverManager.removeDeadServer(deadServer);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Removed " + deadServer + " from deadservers Map");
  }
  return true;
}
