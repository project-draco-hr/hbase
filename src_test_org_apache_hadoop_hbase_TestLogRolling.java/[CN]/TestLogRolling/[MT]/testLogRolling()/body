{
  tableName=getName();
  conf.setLong("hbase.hregion.max.filesize",768L * 1024L);
  try {
    startAndWriteData();
    int count=countLogFiles(true);
    LOG.info("Finished writing. There are " + count + " log files. "+ "Sleeping to let cache flusher and log roller run");
    while (count > 2) {
      try {
        Thread.sleep(1000L);
      }
 catch (      InterruptedException e) {
        LOG.info("Sleep interrupted",e);
      }
      count=countLogFiles(true);
    }
    assertTrue(count <= 2);
  }
 catch (  Exception e) {
    LOG.fatal("unexpected exception",e);
    throw e;
  }
}
