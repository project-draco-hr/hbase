{
  for (  HRegion r : this.instance.onlineRegions.values()) {
    if (r == null)     continue;
    for (    Store s : r.getStores().values()) {
      try {
        if (s.needsCompaction()) {
          this.instance.compactSplitThread.requestCompaction(r,s,getName() + " requests compaction",null);
        }
 else         if (s.isMajorCompaction()) {
          if (majorCompactPriority == DEFAULT_PRIORITY || majorCompactPriority > r.getCompactPriority()) {
            this.instance.compactSplitThread.requestCompaction(r,s,getName() + " requests major compaction; use default priority",null);
          }
 else {
            this.instance.compactSplitThread.requestCompaction(r,s,getName() + " requests major compaction; use configured priority",this.majorCompactPriority,null);
          }
        }
      }
 catch (      IOException e) {
        LOG.warn("Failed major compaction check on " + r,e);
      }
    }
  }
}
