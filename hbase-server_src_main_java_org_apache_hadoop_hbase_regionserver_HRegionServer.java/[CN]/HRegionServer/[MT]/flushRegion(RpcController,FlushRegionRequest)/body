{
  try {
    checkOpen();
    requestCount.increment();
    HRegion region=getRegion(request.getRegion());
    LOG.info("Flushing " + region.getRegionNameAsString());
    boolean shouldFlush=true;
    if (request.hasIfOlderThanTs()) {
      shouldFlush=region.getLastFlushTime() < request.getIfOlderThanTs();
    }
    FlushRegionResponse.Builder builder=FlushRegionResponse.newBuilder();
    if (shouldFlush) {
      boolean result=region.flushcache();
      if (result) {
        this.compactSplitThread.requestSystemCompaction(region,"Compaction through user triggered flush");
      }
      builder.setFlushed(result);
    }
    builder.setLastFlushTime(region.getLastFlushTime());
    return builder.build();
  }
 catch (  DroppedSnapshotException ex) {
    abort("Replay of HLog required. Forcing server shutdown",ex);
    throw new ServiceException(ex);
  }
catch (  IOException ie) {
    throw new ServiceException(ie);
  }
}
