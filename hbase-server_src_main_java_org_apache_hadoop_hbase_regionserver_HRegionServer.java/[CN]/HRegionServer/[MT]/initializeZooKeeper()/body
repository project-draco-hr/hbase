{
  this.zooKeeper=new ZooKeeperWatcher(conf,REGIONSERVER + ":" + this.isa.getPort(),this);
  this.masterAddressManager=new MasterAddressTracker(this.zooKeeper,this);
  this.masterAddressManager.start();
  blockAndCheckIfStopped(this.masterAddressManager);
  this.clusterStatusTracker=new ClusterStatusTracker(this.zooKeeper,this);
  this.clusterStatusTracker.start();
  blockAndCheckIfStopped(this.clusterStatusTracker);
  this.catalogTracker=new CatalogTracker(this.zooKeeper,this.conf,this,this.conf.getInt("hbase.regionserver.catalog.timeout",600000));
  catalogTracker.start();
  try {
    String clusterId=ZKClusterId.readClusterIdZNode(this.zooKeeper);
    if (clusterId == null) {
      this.abort("Cluster ID has not been set");
    }
    this.conf.set(HConstants.CLUSTER_ID,clusterId);
    LOG.info("ClusterId : " + clusterId);
  }
 catch (  KeeperException e) {
    this.abort("Failed to retrieve Cluster ID",e);
  }
}
