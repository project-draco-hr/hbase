{
  Mutation[] mArray=new Mutation[mutations.size()];
  long before=EnvironmentEdgeManager.currentTimeMillis();
  boolean batchContainsPuts=false, batchContainsDelete=false;
  ResultOrException resultOrException=null;
  try {
    int i=0;
    for (    MutationProto m : mutations) {
      Mutation mutation;
      if (m.getMutateType() == MutationType.PUT) {
        mutation=ProtobufUtil.toPut(m,cells);
        batchContainsPuts=true;
      }
 else {
        mutation=ProtobufUtil.toDelete(m,cells);
        batchContainsDelete=true;
      }
      mArray[i++]=mutation;
    }
    requestCount.add(mutations.size());
    if (!region.getRegionInfo().isMetaTable()) {
      cacheFlusher.reclaimMemStoreMemory();
    }
    OperationStatus codes[]=region.batchMutate(mArray,false);
    for (i=0; i < codes.length; i++) {
switch (codes[i].getOperationStatusCode()) {
case BAD_FAMILY:
        resultOrException=ResponseConverter.buildActionResult(new NoSuchColumnFamilyException(codes[i].getExceptionMsg()));
      builder.setResultOrException(i,resultOrException);
    break;
case SANITY_CHECK_FAILURE:
  resultOrException=ResponseConverter.buildActionResult(new FailedSanityCheckException(codes[i].getExceptionMsg()));
builder.setResultOrException(i,resultOrException);
break;
default :
resultOrException=ResponseConverter.buildActionResult(new DoNotRetryIOException(codes[i].getExceptionMsg()));
builder.setResultOrException(i,resultOrException);
break;
case SUCCESS:
break;
}
}
}
 catch (IOException ie) {
resultOrException=ResponseConverter.buildActionResult(ie);
for (int i=0; i < mutations.size(); i++) {
builder.setResultOrException(i,resultOrException);
}
}
long after=EnvironmentEdgeManager.currentTimeMillis();
if (batchContainsPuts) {
metricsRegionServer.updatePut(after - before);
}
if (batchContainsDelete) {
metricsRegionServer.updateDelete(after - before);
}
}
