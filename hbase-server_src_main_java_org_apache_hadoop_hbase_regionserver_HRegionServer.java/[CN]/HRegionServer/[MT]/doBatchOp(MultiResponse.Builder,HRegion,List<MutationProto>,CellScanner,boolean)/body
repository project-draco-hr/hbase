{
  Mutation[] mArray=new Mutation[mutations.size()];
  long before=EnvironmentEdgeManager.currentTimeMillis();
  boolean batchContainsPuts=false, batchContainsDelete=false;
  try {
    ActionResult.Builder resultBuilder=ActionResult.newBuilder();
    resultBuilder.setValue(ClientProtos.Result.newBuilder().build());
    ActionResult result=resultBuilder.build();
    int i=0;
    for (    MutationProto m : mutations) {
      Mutation mutation;
      if (m.getMutateType() == MutationType.PUT) {
        mutation=ProtobufUtil.toPut(m,cells);
        batchContainsPuts=true;
      }
 else {
        mutation=ProtobufUtil.toDelete(m,cells);
        batchContainsDelete=true;
      }
      mArray[i++]=mutation;
      builder.addResult(result);
    }
    requestCount.add(mutations.size());
    if (!region.getRegionInfo().isMetaTable()) {
      cacheFlusher.reclaimMemStoreMemory();
    }
    OperationStatus codes[]=region.batchMutate(mArray);
    for (i=0; i < codes.length; i++) {
switch (codes[i].getOperationStatusCode()) {
case BAD_FAMILY:
        result=ResponseConverter.buildActionResult(new NoSuchColumnFamilyException(codes[i].getExceptionMsg()));
      builder.setResult(i,result);
    break;
case SANITY_CHECK_FAILURE:
  result=ResponseConverter.buildActionResult(new FailedSanityCheckException(codes[i].getExceptionMsg()));
builder.setResult(i,result);
break;
default :
result=ResponseConverter.buildActionResult(new DoNotRetryIOException(codes[i].getExceptionMsg()));
builder.setResult(i,result);
break;
case SUCCESS:
break;
}
if (isReplay && codes[i].getOperationStatusCode() != OperationStatusCode.SUCCESS) {
break;
}
}
}
 catch (IOException ie) {
ActionResult result=ResponseConverter.buildActionResult(ie);
for (int i=0; i < mutations.size(); i++) {
builder.setResult(i,result);
if (isReplay) {
break;
}
}
}
long after=EnvironmentEdgeManager.currentTimeMillis();
if (batchContainsPuts) {
metricsRegionServer.updatePut(after - before);
}
if (batchContainsDelete) {
metricsRegionServer.updateDelete(after - before);
}
}
