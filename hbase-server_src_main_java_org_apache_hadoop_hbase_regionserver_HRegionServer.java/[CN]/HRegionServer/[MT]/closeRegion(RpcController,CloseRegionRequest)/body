{
  int versionOfClosingNode=-1;
  if (request.hasVersionOfClosingNode()) {
    versionOfClosingNode=request.getVersionOfClosingNode();
  }
  boolean zk=request.getTransitionInZK();
  final ServerName sn=(request.hasDestinationServer() ? ProtobufUtil.toServerName(request.getDestinationServer()) : null);
  try {
    checkOpen();
    requestCount.incrementAndGet();
    HRegion region=getRegion(request.getRegion());
    CloseRegionResponse.Builder builder=CloseRegionResponse.newBuilder();
    LOG.info("Received close region: " + region.getRegionNameAsString() + ". Version of ZK closing node:"+ versionOfClosingNode+ ". Destination server:"+ sn);
    HRegionInfo regionInfo=region.getRegionInfo();
    checkIfRegionInTransition(regionInfo,CLOSE);
    boolean closed=closeRegion(regionInfo,false,zk,versionOfClosingNode,sn);
    builder.setClosed(closed);
    return builder.build();
  }
 catch (  IOException ie) {
    throw new ServiceException(ie);
  }
}
