{
  Configuration conf=HBaseConfiguration.create();
  conf.set("fs.defaultFS",conf.get(HConstants.HBASE_DIR));
  HBaseFsck fsck=new HBaseFsck(conf);
  for (int i=0; i < args.length; i++) {
    String cmd=args[i];
    if (cmd.equals("-details")) {
      fsck.displayFullReport();
    }
 else     if (cmd.equals("-base")) {
      i++;
      String path=args[i];
      conf.set(HConstants.HBASE_DIR,path);
      conf.set("fs.defaultFS",conf.get(HConstants.HBASE_DIR));
    }
 else {
      String str="Unknown command line option : " + cmd;
      LOG.info(str);
      System.out.println(str);
      printUsageAndExit();
    }
  }
  boolean success=false;
  try {
    success=fsck.rebuildMeta();
  }
 catch (  MultipleIOException mioes) {
    for (    IOException ioe : mioes.getExceptions()) {
      LOG.error("Bailed out due to:",ioe);
    }
  }
catch (  Exception e) {
    LOG.error("Bailed out due to: ",e);
  }
 finally {
    System.exit(success ? 0 : 1);
  }
}
