{
  try {
    final String regex=TEST_TABLE.getTableName().getNameAsString();
    User testUserPerms=User.createUserForTesting(conf,"testUserPerms",new String[0]);
    PrivilegedAction<List<UserPermission>> listTablesRestrictedAction=new PrivilegedAction<List<UserPermission>>(){
      @Override public List<UserPermission> run(){
        try {
          return AccessControlClient.getUserPermissions(conf,regex);
        }
 catch (        Throwable e) {
          LOG.error("error during call of AccessControlClient.getUserPermissions. " + e.getStackTrace());
          return null;
        }
      }
    }
;
    assertNull(testUserPerms.runAs(listTablesRestrictedAction));
    grantOnTable(TEST_UTIL,testUserPerms.getShortName(),TEST_TABLE.getTableName(),null,null,Permission.Action.ADMIN);
    List<UserPermission> perms=testUserPerms.runAs(listTablesRestrictedAction);
    assertNotNull(perms);
    assertEquals(5,perms.size());
  }
 catch (  Throwable e) {
    throw new HBaseIOException(e);
  }
}
