{
  User testRegexHandler=User.createUserForTesting(conf,"testRegexHandling",new String[0]);
  String tableName="testRegex";
  final TableName table1=TableName.valueOf(tableName);
  final byte[] family=Bytes.toBytes("f1");
  Admin admin=TEST_UTIL.getHBaseAdmin();
  HTableDescriptor htd=new HTableDescriptor(table1);
  htd.addFamily(new HColumnDescriptor(family));
  admin.createTable(htd);
  TEST_UTIL.waitUntilAllRegionsAssigned(table1);
  String ns="testNamespace";
  NamespaceDescriptor desc=NamespaceDescriptor.create(ns).build();
  final TableName table2=TableName.valueOf(ns + ":" + tableName);
  TEST_UTIL.getMiniHBaseCluster().getMaster().createNamespace(desc);
  htd=new HTableDescriptor(table2);
  htd.addFamily(new HColumnDescriptor(family));
  admin.createTable(htd);
  grantOnTable(TEST_UTIL,testRegexHandler.getShortName(),table1,null,null,Action.ADMIN);
  grantOnTable(TEST_UTIL,testRegexHandler.getShortName(),table2,null,null,Action.ADMIN);
  assertEquals(2,testRegexHandler.runAs(getPrivilegedAction(tableName)).size());
  assertEquals(2,testRegexHandler.runAs(getPrivilegedAction("default:" + tableName)).size());
  assertEquals(2,testRegexHandler.runAs(getPrivilegedAction(ns + ":" + tableName)).size());
  assertEquals(0,testRegexHandler.runAs(getPrivilegedAction("notMatchingAny")).size());
  TEST_UTIL.deleteTable(table1);
  TEST_UTIL.deleteTable(table2);
  TEST_UTIL.getMiniHBaseCluster().getMaster().deleteNamespace(ns);
}
