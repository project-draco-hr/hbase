{
  AccessTestAction getAction=new AccessTestAction(){
    @Override public Object run() throws Exception {
      HTable t=new HTable(conf,TEST_TABLE.getTableName());
      try {
        return t.get(new Get(TEST_ROW));
      }
  finally {
        t.close();
      }
    }
  }
;
  verifyDenied(getAction,USER_NONE);
  HTable acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
  try {
    BlockingRpcChannel service=acl.coprocessorService(HConstants.EMPTY_BYTE_ARRAY);
    AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
    AccessControlProtos.GrantRequest request=RequestConverter.buildGrantRequest(USER_NONE.getShortName(),TEST_TABLE.getTableName().getNamespaceAsString(),AccessControlProtos.Permission.Action.READ);
    protocol.grant(null,request);
  }
  finally {
    acl.close();
  }
  verifyAllowed(getAction,USER_NONE);
}
