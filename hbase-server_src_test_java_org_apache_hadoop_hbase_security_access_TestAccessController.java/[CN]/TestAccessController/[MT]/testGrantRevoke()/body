{
  PrivilegedExceptionAction grantAction=new PrivilegedExceptionAction(){
    public Object run() throws Exception {
      HTable acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
      try {
        BlockingRpcChannel service=acl.coprocessorService(TEST_TABLE.getTableName().getName());
        AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
        ProtobufUtil.grant(protocol,USER_RO.getShortName(),TEST_TABLE.getTableName(),TEST_FAMILY,null,Action.READ);
      }
  finally {
        acl.close();
      }
      return null;
    }
  }
;
  PrivilegedExceptionAction revokeAction=new PrivilegedExceptionAction(){
    public Object run() throws Exception {
      HTable acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
      try {
        BlockingRpcChannel service=acl.coprocessorService(TEST_TABLE.getTableName().getName());
        AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
        ProtobufUtil.revoke(protocol,USER_RO.getShortName(),TEST_TABLE.getTableName(),TEST_FAMILY,null,Action.READ);
      }
  finally {
        acl.close();
      }
      return null;
    }
  }
;
  PrivilegedExceptionAction getPermissionsAction=new PrivilegedExceptionAction(){
    public Object run() throws Exception {
      HTable acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
      try {
        BlockingRpcChannel service=acl.coprocessorService(TEST_TABLE.getTableName().getName());
        AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
        ProtobufUtil.getUserPermissions(protocol,TEST_TABLE.getTableName());
      }
  finally {
        acl.close();
      }
      return null;
    }
  }
;
  verifyAllowed(grantAction,SUPERUSER,USER_ADMIN,USER_OWNER);
  verifyDenied(grantAction,USER_CREATE,USER_RW,USER_RO,USER_NONE);
  verifyAllowed(revokeAction,SUPERUSER,USER_ADMIN,USER_OWNER);
  verifyDenied(revokeAction,USER_CREATE,USER_RW,USER_RO,USER_NONE);
  verifyAllowed(getPermissionsAction,SUPERUSER,USER_ADMIN,USER_OWNER);
  verifyDenied(getPermissionsAction,USER_CREATE,USER_RW,USER_RO,USER_NONE);
}
