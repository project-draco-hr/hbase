{
  for (  JVMClusterUtil.RegionServerThread thread : TEST_UTIL.getMiniHBaseCluster().getRegionServerThreads()) {
    HRegionServer rs=thread.getRegionServer();
    for (    HRegion region : rs.getOnlineRegions(TEST_TABLE.getTableName())) {
      region.getCoprocessorHost().load(PingCoprocessor.class,Coprocessor.PRIORITY_USER,conf);
    }
  }
  User userA=User.createUserForTesting(conf,"UserA",new String[0]);
  User userB=User.createUserForTesting(conf,"UserB",new String[0]);
  HTable acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
  try {
    BlockingRpcChannel service=acl.coprocessorService(HConstants.EMPTY_BYTE_ARRAY);
    AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
    AccessControlProtos.GrantRequest request=RequestConverter.buildGrantRequest(userA.getShortName(),TEST_TABLE.getTableName(),null,null,AccessControlProtos.Permission.Action.EXEC);
    protocol.grant(null,request);
  }
  finally {
    acl.close();
  }
  AccessTestAction execEndpointAction=new AccessTestAction(){
    @Override public Object run() throws Exception {
      HTable t=new HTable(conf,TEST_TABLE.getTableName());
      try {
        BlockingRpcChannel service=t.coprocessorService(HConstants.EMPTY_BYTE_ARRAY);
        PingCoprocessor.newBlockingStub(service).noop(null,NoopRequest.newBuilder().build());
      }
  finally {
        t.close();
      }
      return null;
    }
  }
;
  verifyDenied(execEndpointAction,userB);
  verifyAllowed(execEndpointAction,userA);
  acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
  try {
    BlockingRpcChannel service=acl.coprocessorService(HConstants.EMPTY_BYTE_ARRAY);
    AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
    AccessControlProtos.GrantRequest request=RequestConverter.buildGrantRequest(userB.getShortName(),TEST_TABLE.getTableName().getNamespaceAsString(),AccessControlProtos.Permission.Action.EXEC);
    protocol.grant(null,request);
  }
  finally {
    acl.close();
  }
  verifyAllowed(execEndpointAction,userA,userB);
}
