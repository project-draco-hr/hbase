{
  int targetBlock=(int)(target / blockSize);
  long targetBlockStart=targetBlock * blockSize;
  long targetBlockEnd=Math.min(targetBlockStart + blockSize,fileLength) - 1;
  long blockLength=targetBlockEnd - targetBlockStart + 1;
  long offsetIntoBlock=target - targetBlockStart;
  byte[] block=blocks.get(targetBlockStart);
  if (block == null) {
    block=new byte[blockSize];
    ((PositionedReadable)in).readFully(targetBlockStart,block,0,(int)blockLength);
    blocks.put(targetBlockStart,block);
  }
  this.pos=target;
  this.blockEnd=targetBlockEnd;
  this.blockStream.reset(block,(int)offsetIntoBlock,(int)(blockLength - offsetIntoBlock));
}
