{
  if (timeout < 0)   throw new IllegalArgumentException();
  boolean notimeout=timeout == 0;
  long startTime=System.currentTimeMillis();
  long remaining=timeout;
  if (refresh) {
    try {
      this.data=ZKUtil.getDataAndWatch(watcher,node);
    }
 catch (    KeeperException e) {
      abortable.abort("Unexpected exception handling blockUntilAvailable",e);
    }
  }
  while (!this.stopped && (notimeout || remaining > 0) && this.data == null) {
    if (notimeout) {
      wait();
      continue;
    }
    wait(remaining);
    remaining=timeout - (System.currentTimeMillis() - startTime);
  }
  return this.data;
}
