{
  final String table="testSSHWhenDisablingTableRegionsInOpeningOrPendingOpenState";
  AssignmentManager am=TEST_UTIL.getHBaseCluster().getMaster().getAssignmentManager();
  HRegionInfo hri=null;
  ServerName serverName=null;
  try {
    hri=createTableAndGetOneRegion(table);
    serverName=am.getRegionStates().getRegionServerOfRegion(hri);
    ServerName destServerName=null;
    HRegionServer destServer=null;
    for (int i=0; i < 3; i++) {
      destServer=TEST_UTIL.getHBaseCluster().getRegionServer(i);
      if (!destServer.getServerName().equals(serverName)) {
        destServerName=destServer.getServerName();
        break;
      }
    }
    am.regionOffline(hri);
    ZKAssign.createNodeOffline(TEST_UTIL.getHBaseCluster().getMaster().getZooKeeper(),hri,destServerName);
    ZKAssign.transitionNodeOpening(TEST_UTIL.getHBaseCluster().getMaster().getZooKeeper(),hri,destServerName);
    am.getZKTable().setDisablingTable(table);
    List<HRegionInfo> toAssignRegions=am.processServerShutdown(destServerName);
    assertTrue("Regions to be assigned should be empty.",toAssignRegions.isEmpty());
    assertTrue("Regions to be assigned should be empty.",am.getRegionStates().getRegionState(hri).isOffline());
  }
  finally {
    if (hri != null && serverName != null) {
      am.regionOnline(hri,serverName);
    }
    am.getZKTable().setDisabledTable(table);
    TEST_UTIL.deleteTable(Bytes.toBytes(table));
  }
}
