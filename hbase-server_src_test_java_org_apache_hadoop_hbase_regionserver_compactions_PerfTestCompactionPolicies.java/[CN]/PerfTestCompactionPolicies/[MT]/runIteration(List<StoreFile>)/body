{
  List<StoreFile> storeFiles=new ArrayList<StoreFile>(startingStoreFiles);
  CompactSelection sel=cp.selectCompaction(storeFiles,false,false);
  int newFileSize=0;
  List<StoreFile> filesToCompact=sel.getFilesToCompact();
  if (!filesToCompact.isEmpty()) {
    storeFiles=new ArrayList<StoreFile>(storeFiles);
    storeFiles.removeAll(filesToCompact);
    for (    StoreFile storeFile : filesToCompact) {
      newFileSize+=storeFile.getReader().length();
    }
    storeFiles.add(createMockStoreFile(newFileSize));
  }
  written+=newFileSize;
  fileDiff+=storeFiles.size() - startingStoreFiles.size();
  return storeFiles;
}
