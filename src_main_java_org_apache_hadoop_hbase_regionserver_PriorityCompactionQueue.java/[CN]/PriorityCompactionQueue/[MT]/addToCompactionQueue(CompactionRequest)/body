{
  CompactionRequest queuedRequest=null;
synchronized (storesInQueue) {
    queuedRequest=storesInQueue.get(toPair(newRequest));
    if (queuedRequest == null || newRequest.getPriority() < queuedRequest.getPriority()) {
      String reason="";
      if (queuedRequest != null) {
        if (newRequest.getPriority() < queuedRequest.getPriority()) {
          reason="Reason : priority changed from " + queuedRequest.getPriority() + " to "+ newRequest.getPriority()+ ". ";
        }
      }
      LOG.debug("Inserting store in queue. " + reason + newRequest);
      storesInQueue.put(toPair(newRequest),newRequest);
    }
 else {
      LOG.debug("Store already in queue, skipping. Queued: " + queuedRequest + ", requested: "+ newRequest);
      newRequest=null;
    }
  }
  if (newRequest != null && queuedRequest != null) {
    queue.remove(queuedRequest);
  }
  return newRequest;
}
