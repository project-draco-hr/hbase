{
  CompactionRequest queuedRequest=null;
  CompactionRequest newRequest=new CompactionRequest(r,p);
synchronized (regionsInQueue) {
    queuedRequest=regionsInQueue.get(r);
    if (queuedRequest == null || newRequest.getPriority() < queuedRequest.getPriority()) {
      LOG.trace("Inserting region in queue. " + newRequest);
      regionsInQueue.put(r,newRequest);
    }
 else {
      LOG.trace("Region already in queue, skipping. Queued: " + queuedRequest + ", requested: "+ newRequest);
      newRequest=null;
    }
  }
  if (newRequest != null && queuedRequest != null) {
    queue.remove(queuedRequest);
  }
  return newRequest;
}
