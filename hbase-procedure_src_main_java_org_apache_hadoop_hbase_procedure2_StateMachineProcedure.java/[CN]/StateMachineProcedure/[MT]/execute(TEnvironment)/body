{
  updateTimestamp();
  try {
    TState state=getCurrentState();
    if (stateCount == 0) {
      setNextState(getStateId(state));
    }
    if (executeFromState(env,state) == Flow.NO_MORE_STATE) {
      return null;
    }
    if (subProcList != null && subProcList.size() != 0) {
      Procedure[] subProcedures=subProcList.toArray(new Procedure[subProcList.size()]);
      subProcList=null;
      return subProcedures;
    }
    return (isWaiting() || isFailed()) ? null : new Procedure[]{this};
  }
  finally {
    updateTimestamp();
  }
}
