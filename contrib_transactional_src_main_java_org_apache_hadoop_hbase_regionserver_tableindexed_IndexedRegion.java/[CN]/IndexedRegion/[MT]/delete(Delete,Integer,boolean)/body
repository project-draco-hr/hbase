{
  SortedMap<byte[],byte[]> oldColumnValues=null;
  if (!getIndexes().isEmpty()) {
    NavigableSet<byte[]> neededColumns=getColumnsForIndexes(getIndexes());
    Get get=new Get(delete.getRow());
    for (    byte[] col : neededColumns) {
      byte[][] famQf=KeyValue.parseColumn(col);
      if (famQf.length == 1) {
        get.addFamily(famQf[0]);
      }
 else {
        get.addColumn(famQf[0],famQf[1]);
      }
    }
    Result oldRow=super.get(get,lockid);
    oldColumnValues=convertToValueMap(oldRow);
  }
  super.delete(delete,lockid,writeToWAL);
  if (!getIndexes().isEmpty()) {
    Get get=new Get(delete.getRow());
    Result currentRow=super.get(get,lockid);
    SortedMap<byte[],byte[]> currentColumnValues=convertToValueMap(currentRow);
    for (    IndexSpecification indexSpec : getIndexes()) {
      Delete indexDelete=null;
      if (IndexMaintenanceUtils.doesApplyToIndex(indexSpec,oldColumnValues)) {
        indexDelete=makeDeleteToRemoveOldIndexEntry(indexSpec,delete.getRow(),oldColumnValues);
      }
      Put indexPut=null;
      if (IndexMaintenanceUtils.doesApplyToIndex(indexSpec,currentColumnValues)) {
        indexPut=makeIndexUpdate(indexSpec,delete.getRow(),currentColumnValues);
      }
      if (indexPut == null && indexDelete == null) {
        continue;
      }
      HTable indexTable=getIndexTable(indexSpec);
      if (indexDelete != null && (indexPut == null || !Bytes.equals(indexDelete.getRow(),indexPut.getRow()))) {
        LOG.debug("Deleting old index row [" + Bytes.toString(indexDelete.getRow()) + "].");
        indexTable.delete(indexDelete);
      }
 else       if (indexDelete != null) {
        LOG.debug("Skipping deleting index row [" + Bytes.toString(indexDelete.getRow()) + "] because it has not changed.");
        for (        byte[] indexCol : indexSpec.getAdditionalColumns()) {
          byte[][] parsed=KeyValue.parseColumn(indexCol);
          List<KeyValue> famDeletes=delete.getFamilyMap().get(parsed[0]);
          if (famDeletes != null) {
            for (            KeyValue kv : famDeletes) {
              if (Bytes.equals(parsed[0],kv.getFamily()) && Bytes.equals(parsed[1],kv.getQualifier())) {
                LOG.debug("Need to delete this specific column: " + Bytes.toString(indexCol));
                Delete columnDelete=new Delete(indexDelete.getRow());
                columnDelete.deleteColumns(parsed[0],parsed[1]);
                indexTable.delete(columnDelete);
              }
            }
          }
        }
      }
      if (indexPut != null) {
        getIndexTable(indexSpec).put(indexPut);
      }
    }
  }
}
