{
  while (!server.isStopRequested()) {
    if (!rollLog.get()) {
synchronized (rollLog) {
        try {
          rollLog.wait(server.threadWakeFrequency);
        }
 catch (        InterruptedException e) {
          continue;
        }
      }
      continue;
    }
    rollLock.lock();
    try {
      byte[] regionToFlush=server.getLog().rollWriter();
      if (regionToFlush != null) {
        scheduleFlush(regionToFlush);
      }
    }
 catch (    FailedLogCloseException e) {
      LOG.fatal("Forcing server shutdown",e);
      server.checkFileSystem();
      server.abort();
    }
catch (    java.net.ConnectException e) {
      LOG.fatal("Forcing server shutdown",e);
      server.checkFileSystem();
      server.abort();
    }
catch (    IOException ex) {
      LOG.fatal("Log rolling failed with ioe: ",RemoteExceptionHandler.checkIOException(ex));
      server.checkFileSystem();
      server.abort();
    }
catch (    Exception ex) {
      LOG.error("Log rolling failed",ex);
      server.checkFileSystem();
    }
 finally {
      rollLog.set(false);
      rollLock.unlock();
    }
  }
  LOG.info("LogRoller exiting.");
}
