{
  if (LOG.isDebugEnabled()) {
    LOG.debug("get backup contexts from hbase:backup");
  }
  Table table=null;
  ResultScanner scanner=null;
  ArrayList<BackupContext> list=new ArrayList<BackupContext>();
  try {
    table=connection.getTable(tableName);
    Scan scan=BackupSystemTableHelper.createScanForBackupHistory();
    scan.setMaxVersions(1);
    scanner=table.getScanner(scan);
    Result res=null;
    while ((res=scanner.next()) != null) {
      res.advance();
      BackupContext context=BackupSystemTableHelper.cellToBackupContext(res.current());
      if (context.getFlag() != status) {
        continue;
      }
      list.add(context);
    }
    return list;
  }
  finally {
    if (scanner != null) {
      scanner.close();
    }
    if (table != null) {
      table.close();
    }
  }
}
