{
  if (LOG.isDebugEnabled()) {
    LOG.debug("get backup history from hbase:backup");
  }
  Table table=null;
  ResultScanner scanner=null;
  ArrayList<BackupCompleteData> list=new ArrayList<BackupCompleteData>();
  try {
    table=connection.getTable(tableName);
    Scan scan=BackupSystemTableHelper.createScanForBackupHistory();
    scan.setMaxVersions(1);
    scanner=table.getScanner(scan);
    Result res=null;
    while ((res=scanner.next()) != null) {
      res.advance();
      BackupContext context=BackupSystemTableHelper.cellToBackupContext(res.current());
      if (context.getFlag() != BACKUPSTATUS.COMPLETE) {
        continue;
      }
      BackupCompleteData history=new BackupCompleteData();
      history.setBackupToken(context.getBackupId());
      history.setStartTime(Long.toString(context.getStartTs()));
      history.setEndTime(Long.toString(context.getEndTs()));
      history.setBackupRootPath(context.getTargetRootDir());
      history.setTableList(context.getTableListAsString());
      history.setType(context.getType());
      history.setBytesCopied(Long.toString(context.getTotalBytesCopied()));
      if (context.fromExistingSnapshot()) {
        history.markFromExistingSnapshot();
      }
      list.add(history);
    }
    return BackupUtil.sortHistoryListDesc(list);
  }
  finally {
    if (scanner != null) {
      scanner.close();
    }
    if (table != null) {
      table.close();
    }
  }
}
