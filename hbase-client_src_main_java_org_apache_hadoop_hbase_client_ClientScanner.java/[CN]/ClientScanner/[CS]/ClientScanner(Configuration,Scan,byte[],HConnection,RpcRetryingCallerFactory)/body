{
  if (LOG.isTraceEnabled()) {
    LOG.trace("Scan table=" + Bytes.toString(tableName) + ", startRow="+ Bytes.toStringBinary(scan.getStartRow()));
  }
  this.scan=scan;
  this.tableName=tableName;
  this.lastNext=System.currentTimeMillis();
  this.connection=connection;
  if (scan.getMaxResultSize() > 0) {
    this.maxScannerResultSize=scan.getMaxResultSize();
  }
 else {
    this.maxScannerResultSize=conf.getLong(HConstants.HBASE_CLIENT_SCANNER_MAX_RESULT_SIZE_KEY,HConstants.DEFAULT_HBASE_CLIENT_SCANNER_MAX_RESULT_SIZE);
  }
  this.scannerTimeout=HBaseConfiguration.getInt(conf,HConstants.HBASE_CLIENT_SCANNER_TIMEOUT_PERIOD,HConstants.HBASE_REGIONSERVER_LEASE_PERIOD_KEY,HConstants.DEFAULT_HBASE_CLIENT_SCANNER_TIMEOUT_PERIOD);
  byte[] enableMetrics=scan.getAttribute(Scan.SCAN_ATTRIBUTES_METRICS_ENABLE);
  if (enableMetrics != null && Bytes.toBoolean(enableMetrics)) {
    scanMetrics=new ScanMetrics();
  }
  if (this.scan.getCaching() > 0) {
    this.caching=this.scan.getCaching();
  }
 else {
    this.caching=conf.getInt(HConstants.HBASE_CLIENT_SCANNER_CACHING,HConstants.DEFAULT_HBASE_CLIENT_SCANNER_CACHING);
  }
  this.caller=rpcFactory.<Result[]>newCaller();
  nextScanner(this.caching,false);
}
