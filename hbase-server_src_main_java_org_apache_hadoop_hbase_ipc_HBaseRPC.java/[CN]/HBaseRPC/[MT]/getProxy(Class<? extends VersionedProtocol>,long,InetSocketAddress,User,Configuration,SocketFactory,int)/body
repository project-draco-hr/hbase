{
  VersionedProtocol proxy=getProtocolEngine(protocol,conf).getProxy(protocol,clientVersion,addr,ticket,conf,factory,Math.min(rpcTimeout,HBaseRPC.getRpcTimeout()));
  long serverVersion=proxy.getProtocolVersion(protocol.getName(),clientVersion);
  if (serverVersion == clientVersion) {
    return proxy;
  }
  throw new VersionMismatch(protocol.getName(),clientVersion,serverVersion);
}
