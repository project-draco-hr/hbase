{
  final TableName tableName=TableName.valueOf("testUnmanagedHConnectionReconnect");
  TEST_UTIL.createTable(tableName,HConstants.CATALOG_FAMILY);
  Connection conn=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration());
  Table t=conn.getTable(tableName);
  try (HBaseAdmin ha=new HBaseAdmin(conn)){
    assertTrue(ha.tableExists(tableName));
    assertTrue(t.get(new Get(ROW)).isEmpty());
  }
   MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  cluster.stopMaster(0,false);
  cluster.waitOnMaster(0);
  cluster.startMaster();
  assertTrue(cluster.waitForActiveAndReadyMaster());
  try (HBaseAdmin newAdmin=new HBaseAdmin(conn)){
    assertTrue(newAdmin.tableExists(tableName));
    assertTrue(newAdmin.getClusterStatus().getServersSize() == SLAVES + 1);
  }
 }
