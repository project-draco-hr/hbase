{
  TableName TABLE=TableName.valueOf("testUpdatesWithMajorCompaction");
  Table hTable=TEST_UTIL.createTable(TABLE,FAMILY,10);
  HBaseAdmin admin=new HBaseAdmin(TEST_UTIL.getConfiguration());
  byte[] row=Bytes.toBytes("row2");
  byte[] qualifier=Bytes.toBytes("myCol");
  Put put=new Put(row);
  put.add(FAMILY,qualifier,1L,Bytes.toBytes("AAA"));
  hTable.put(put);
  put=new Put(row);
  put.add(FAMILY,qualifier,2L,Bytes.toBytes("BBB"));
  hTable.put(put);
  put=new Put(row);
  put.add(FAMILY,qualifier,3L,Bytes.toBytes("EEE"));
  hTable.put(put);
  Get get=new Get(row);
  get.addColumn(FAMILY,qualifier);
  get.setMaxVersions();
  Result result=hTable.get(get);
  NavigableMap<Long,byte[]> navigableMap=result.getMap().get(FAMILY).get(qualifier);
  assertEquals("AAA",Bytes.toString(navigableMap.get(1L)));
  assertEquals("BBB",Bytes.toString(navigableMap.get(2L)));
  admin.flush(TABLE);
  admin.majorCompact(TABLE);
  Thread.sleep(6000);
  put=new Put(row);
  put.add(FAMILY,qualifier,1L,Bytes.toBytes("CCC"));
  hTable.put(put);
  put=new Put(row);
  put.add(FAMILY,qualifier,2L,Bytes.toBytes("DDD"));
  hTable.put(put);
  admin.flush(TABLE);
  admin.majorCompact(TABLE);
  Thread.sleep(6000);
  result=hTable.get(get);
  navigableMap=result.getMap().get(FAMILY).get(qualifier);
  assertEquals("CCC",Bytes.toString(navigableMap.get(1L)));
  assertEquals("DDD",Bytes.toString(navigableMap.get(2L)));
}
