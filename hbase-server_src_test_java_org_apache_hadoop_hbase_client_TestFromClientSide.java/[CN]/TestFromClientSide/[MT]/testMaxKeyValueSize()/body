{
  byte[] TABLE=Bytes.toBytes("testMaxKeyValueSize");
  Configuration conf=TEST_UTIL.getConfiguration();
  String oldMaxSize=conf.get("hbase.client.keyvalue.maxsize");
  Table ht=TEST_UTIL.createTable(TABLE,FAMILY);
  byte[] value=new byte[4 * 1024 * 1024];
  Put put=new Put(ROW);
  put.add(FAMILY,QUALIFIER,value);
  ht.put(put);
  try {
    TEST_UTIL.getConfiguration().setInt("hbase.client.keyvalue.maxsize",2 * 1024 * 1024);
    TABLE=Bytes.toBytes("testMaxKeyValueSize2");
    try (Connection connection=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration())){
      try (Table t=connection.getTable(TableName.valueOf(FAMILY))){
        put=new Put(ROW);
        put.add(FAMILY,QUALIFIER,value);
        t.put(put);
      }
     }
     fail("Inserting a too large KeyValue worked, should throw exception");
  }
 catch (  Exception e) {
  }
  conf.set("hbase.client.keyvalue.maxsize",oldMaxSize);
}
