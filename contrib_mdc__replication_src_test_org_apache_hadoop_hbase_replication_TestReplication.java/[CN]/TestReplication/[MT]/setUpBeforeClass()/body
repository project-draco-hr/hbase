{
  try {
    conf1=HBaseConfiguration.create();
    conf1.set(REGION_SERVER_CLASS,ReplicationRegionInterface.class.getName());
    conf1.set(REGION_SERVER_IMPL,ReplicationRegionServer.class.getName());
    conf1.set(ZOOKEEPER_ZNODE_PARENT,"/1");
    utility1=new HBaseTestingUtility(conf1);
    utility1.startMiniZKCluster();
    MiniZooKeeperCluster miniZK=utility1.getZkCluster();
    zkw1=new ZooKeeperWrapper(conf1,EmptyWatcher.instance);
    zkw1.writeZNode("/1","replication","");
    zkw1.writeZNode("/1/replication","master",conf1.get(ZOOKEEPER_QUORUM) + ":" + conf1.get("hbase.zookeeper.property.clientPort")+ ":/1");
    setIsReplication("true");
    LOG.info("Setup first Zk");
    conf2=HBaseConfiguration.create();
    conf2.set(REGION_SERVER_CLASS,ReplicationRegionInterface.class.getName());
    conf2.set(REGION_SERVER_IMPL,ReplicationRegionServer.class.getName());
    conf2.set(ZOOKEEPER_ZNODE_PARENT,"/2");
    utility2=new HBaseTestingUtility(conf2);
    utility2.setZkCluster(miniZK);
    zkw2=new ZooKeeperWrapper(conf2,EmptyWatcher.instance);
    zkw2.writeZNode("/2","replication","");
    zkw2.writeZNode("/2/replication","master",conf1.get(ZOOKEEPER_QUORUM) + ":" + conf1.get("hbase.zookeeper.property.clientPort")+ ":/1");
    zkw1.writeZNode("/1/replication/peers","test",conf2.get(ZOOKEEPER_QUORUM) + ":" + conf2.get("hbase.zookeeper.property.clientPort")+ ":/2");
    LOG.info("Setup second Zk");
    utility1.startMiniCluster();
    utility2.startMiniCluster();
    utility1.startMiniMapReduceCluster();
    HTableDescriptor table=new HTableDescriptor(tableName);
    HColumnDescriptor fam=new HColumnDescriptor(famName);
    fam.setScope(REPLICATION_SCOPE_GLOBAL);
    table.addFamily(fam);
    fam=new HColumnDescriptor(noRepfamName);
    table.addFamily(fam);
    HBaseAdmin admin1=new HBaseAdmin(conf1);
    HBaseAdmin admin2=new HBaseAdmin(conf2);
    admin1.createTable(table);
    admin2.createTable(table);
  }
 catch (  Exception ex) {
    ex.printStackTrace();
    throw ex;
  }
}
