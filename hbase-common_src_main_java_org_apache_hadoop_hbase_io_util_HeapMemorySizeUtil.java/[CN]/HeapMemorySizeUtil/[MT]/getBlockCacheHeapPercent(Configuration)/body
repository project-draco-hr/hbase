{
  float l1CachePercent=conf.getFloat(HConstants.HFILE_BLOCK_CACHE_SIZE_KEY,HConstants.HFILE_BLOCK_CACHE_SIZE_DEFAULT);
  float l2CachePercent=0.0F;
  String bucketCacheIOEngineName=conf.get(HConstants.BUCKET_CACHE_IOENGINE_KEY,null);
  if (bucketCacheIOEngineName != null && bucketCacheIOEngineName.startsWith("heap")) {
    float bucketCachePercentage=conf.getFloat(HConstants.BUCKET_CACHE_SIZE_KEY,0F);
    MemoryUsage mu=ManagementFactory.getMemoryMXBean().getHeapMemoryUsage();
    l2CachePercent=bucketCachePercentage < 1 ? bucketCachePercentage : (bucketCachePercentage * 1024 * 1024) / mu.getMax();
  }
  return l1CachePercent + l2CachePercent;
}
