{
  long seq=0;
  long baseline=1000;
  long time=baseline;
  KeyValue kv=new KeyValue(r1,f1,r1);
  WALEdit edit=new WALEdit();
  edit.add(kv);
  List<WALActionsListener> listeners=new ArrayList<WALActionsListener>();
  listeners.add(replication);
  HLog hlog=new HLog(fs,logDir,oldLogDir,conf,listeners,URLEncoder.encode("regionserver:60020","UTF8"));
  manager.init();
  HTableDescriptor htd=new HTableDescriptor();
  htd.addFamily(new HColumnDescriptor(f1));
  for (long i=1; i < 101; i++) {
    if (i > 1 && i % 20 == 0) {
      hlog.rollWriter();
    }
    LOG.info(i);
    HLogKey key=new HLogKey(hri.getRegionName(),test,seq++,System.currentTimeMillis(),HConstants.DEFAULT_CLUSTER_ID);
    hlog.append(hri,key,edit,htd,true);
  }
  LOG.info(baseline + " and " + time);
  baseline+=101;
  time=baseline;
  LOG.info(baseline + " and " + time);
  for (int i=0; i < 3; i++) {
    HLogKey key=new HLogKey(hri.getRegionName(),test,seq++,System.currentTimeMillis(),HConstants.DEFAULT_CLUSTER_ID);
    hlog.append(hri,key,edit,htd,true);
  }
  assertEquals(6,manager.getHLogs().get(slaveId).size());
  hlog.rollWriter();
  manager.logPositionAndCleanOldLogs(manager.getSources().get(0).getCurrentPath(),"1",0,false);
  HLogKey key=new HLogKey(hri.getRegionName(),test,seq++,System.currentTimeMillis(),HConstants.DEFAULT_CLUSTER_ID);
  hlog.append(hri,key,edit,htd,true);
  assertEquals(1,manager.getHLogs().size());
}
