{
  if (!shouldCloseConnection.get()) {
    LOG.error(getName() + ": the connection is not in the closed state");
    return;
  }
synchronized (connections) {
    connections.removeValue(remoteId,this);
  }
synchronized (this.outLock) {
    if (this.out != null) {
      IOUtils.closeStream(out);
      this.out=null;
    }
  }
  IOUtils.closeStream(in);
  this.in=null;
  if (this.socket != null) {
    try {
      this.socket.close();
      this.socket=null;
    }
 catch (    IOException e) {
      LOG.error("Error while closing socket",e);
    }
  }
  disposeSasl();
  if (LOG.isTraceEnabled()) {
    LOG.trace(getName() + ": closing ipc connection to " + server);
  }
  cleanupCalls(true);
  if (LOG.isTraceEnabled()) {
    LOG.trace(getName() + ": ipc connection to " + server+ " closed");
  }
}
