{
  if (LOG.isTraceEnabled()) {
    LOG.trace(getName() + ": starting, connections " + connections.size());
  }
  WaitForWorkResult result=WaitForWorkResult.CALLER_SHOULD_CLOSE;
  try {
    result=waitForWork();
    while (result == WaitForWorkResult.READ_RESPONSE) {
      if (readResponse()) {
        result=WaitForWorkResult.CALLER_SHOULD_CLOSE;
      }
 else {
        result=waitForWork();
      }
    }
  }
 catch (  InterruptedException t) {
    if (LOG.isTraceEnabled()) {
      LOG.trace(getName() + ": interrupted while waiting for call responses");
    }
    if (markClosed(ExceptionUtil.asInterrupt(t))) {
      result=WaitForWorkResult.CALLER_SHOULD_CLOSE;
    }
  }
catch (  Throwable t) {
    if (LOG.isDebugEnabled()) {
      LOG.debug(getName() + ": unexpected throwable while waiting for call responses",t);
    }
    if (markClosed(new IOException("Unexpected throwable while waiting call responses",t))) {
      result=WaitForWorkResult.CALLER_SHOULD_CLOSE;
    }
  }
  if (result == WaitForWorkResult.CALLER_SHOULD_CLOSE) {
    close();
  }
  if (LOG.isTraceEnabled()) {
    LOG.trace(getName() + ": stopped, connections " + connections.size());
  }
}
