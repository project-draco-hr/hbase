{
  if (!running.get()) {
    throw new IOException("The client is stopped");
  }
  Connection connection;
  ConnectionId remoteId=new ConnectionId(addr,protocol,ticket,rpcTimeout);
synchronized (connections) {
    connection=connections.get(remoteId);
    if (connection == null) {
      connection=createConnection(remoteId,this.codec,this.compressor);
      connections.put(remoteId,connection);
    }
  }
  connection.addCall(call);
  connection.setupIOstreams();
  return connection;
}
