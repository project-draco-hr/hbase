{
  final Map<HRegionInfo,HServerAddress> allRegions=new TreeMap<HRegionInfo,HServerAddress>();
  DataInputStream is=null;
  if (in instanceof DataInputStream) {
    is=(DataInputStream)in;
  }
 else {
    is=new DataInputStream(DataInputInputStream.constructInputStream(in));
  }
  int regionsCount=is.readInt();
  for (int i=0; i < regionsCount; ++i) {
    HRegionInfo hri=HRegionInfo.parseFrom(is);
    HServerAddress hsa=new HServerAddress();
    hsa.readFields(is);
    allRegions.put(hri,hsa);
  }
  return allRegions;
}
