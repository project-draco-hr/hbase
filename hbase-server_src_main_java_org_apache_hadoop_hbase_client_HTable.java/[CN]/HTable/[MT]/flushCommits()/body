{
  try {
    Object[] results=new Object[writeBuffer.size()];
    try {
      this.connection.processBatch(writeBuffer,tableName,pool,results);
    }
 catch (    InterruptedException e) {
      throw new IOException(e);
    }
 finally {
      for (int i=results.length - 1; i >= 0; i--) {
        if (results[i] instanceof Result) {
          writeBuffer.remove(i);
        }
      }
    }
  }
  finally {
    if (clearBufferOnFail) {
      writeBuffer.clear();
      currentWriteBufferSize=0;
    }
 else {
      currentWriteBufferSize=0;
      for (      Put aPut : writeBuffer) {
        currentWriteBufferSize+=aPut.heapSize();
      }
    }
  }
}
