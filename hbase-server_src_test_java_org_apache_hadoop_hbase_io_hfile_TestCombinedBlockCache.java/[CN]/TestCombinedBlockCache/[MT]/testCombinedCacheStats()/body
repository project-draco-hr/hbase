{
  CacheStats lruCacheStats=new CacheStats("lruCacheStats",2);
  CacheStats bucketCacheStats=new CacheStats("bucketCacheStats",2);
  CombinedCacheStats stats=new CombinedCacheStats(lruCacheStats,bucketCacheStats);
  double delta=0.01;
  lruCacheStats.hit(true,true,BlockType.DATA);
  lruCacheStats.miss(true,false,BlockType.DATA);
  bucketCacheStats.hit(false,true,BlockType.DATA);
  bucketCacheStats.hit(false,true,BlockType.DATA);
  bucketCacheStats.miss(false,true,BlockType.DATA);
  assertEquals(5,stats.getRequestCount());
  assertEquals(2,stats.getRequestCachingCount());
  assertEquals(2,stats.getMissCount());
  assertEquals(1,stats.getPrimaryMissCount());
  assertEquals(1,stats.getMissCachingCount());
  assertEquals(3,stats.getHitCount());
  assertEquals(3,stats.getPrimaryHitCount());
  assertEquals(1,stats.getHitCachingCount());
  assertEquals(0.6,stats.getHitRatio(),delta);
  assertEquals(0.5,stats.getHitCachingRatio(),delta);
  assertEquals(0.4,stats.getMissRatio(),delta);
  assertEquals(0.5,stats.getMissCachingRatio(),delta);
  lruCacheStats.evicted(1000,true);
  lruCacheStats.evicted(1000,false);
  lruCacheStats.evict();
  bucketCacheStats.evict();
  assertEquals(2,stats.getEvictionCount());
  assertEquals(2,stats.getEvictedCount());
  assertEquals(1,stats.getPrimaryEvictedCount());
  assertEquals(1.0,stats.evictedPerEviction(),delta);
  lruCacheStats.failInsert();
  assertEquals(1,stats.getFailedInserts());
  stats.rollMetricsPeriod();
  assertEquals(3,stats.getSumHitCountsPastNPeriods());
  assertEquals(5,stats.getSumRequestCountsPastNPeriods());
  assertEquals(1,stats.getSumHitCachingCountsPastNPeriods());
  assertEquals(2,stats.getSumRequestCachingCountsPastNPeriods());
  assertEquals(0.6,stats.getHitRatioPastNPeriods(),delta);
  assertEquals(0.5,stats.getHitCachingRatioPastNPeriods(),delta);
  lruCacheStats.hit(true,true,BlockType.DATA);
  lruCacheStats.hit(true,true,BlockType.DATA);
  lruCacheStats.hit(true,true,BlockType.DATA);
  stats.rollMetricsPeriod();
  assertEquals(6,stats.getSumHitCountsPastNPeriods());
  assertEquals(8,stats.getSumRequestCountsPastNPeriods());
  assertEquals(4,stats.getSumHitCachingCountsPastNPeriods());
  assertEquals(5,stats.getSumRequestCachingCountsPastNPeriods());
  assertEquals(0.75,stats.getHitRatioPastNPeriods(),delta);
  assertEquals(0.8,stats.getHitCachingRatioPastNPeriods(),delta);
}
