{
  Set<TableName> tableSet=new TreeSet<TableName>();
  for (  Map.Entry<byte[],List<? extends Cell>> f : familyMap.entrySet()) {
    List<? extends Cell> cells=f.getValue();
    for (    Cell cell : cells) {
      KeyValue kv=KeyValueUtil.ensureKeyValue(cell);
      if (Bytes.equals(kv.getBuffer(),kv.getFamilyOffset(),kv.getFamilyLength(),AccessControlLists.ACL_LIST_FAMILY,0,AccessControlLists.ACL_LIST_FAMILY.length)) {
        tableSet.add(TableName.valueOf(kv.getRow()));
      }
    }
  }
  ZKPermissionWatcher zkw=this.authManager.getZKPermissionWatcher();
  Configuration conf=regionEnv.getConfiguration();
  for (  TableName tableName : tableSet) {
    try {
      ListMultimap<String,TablePermission> perms=AccessControlLists.getTablePermissions(conf,tableName);
      byte[] serialized=AccessControlLists.writePermissionsAsBytes(perms,conf);
      zkw.writeToZookeeper(tableName,serialized);
    }
 catch (    IOException ex) {
      LOG.error("Failed updating permissions mirror for '" + tableName + "'",ex);
    }
  }
}
