{
  Set<byte[]> entries=new TreeSet<byte[]>(Bytes.BYTES_RAWCOMPARATOR);
  for (  Map.Entry<byte[],List<Cell>> f : familyMap.entrySet()) {
    List<Cell> cells=f.getValue();
    for (    Cell cell : cells) {
      KeyValue kv=KeyValueUtil.ensureKeyValue(cell);
      if (Bytes.equals(kv.getFamilyArray(),kv.getFamilyOffset(),kv.getFamilyLength(),AccessControlLists.ACL_LIST_FAMILY,0,AccessControlLists.ACL_LIST_FAMILY.length)) {
        entries.add(kv.getRow());
      }
    }
  }
  ZKPermissionWatcher zkw=this.authManager.getZKPermissionWatcher();
  Configuration conf=regionEnv.getConfiguration();
  for (  byte[] entry : entries) {
    try {
      ListMultimap<String,TablePermission> perms=AccessControlLists.getPermissions(conf,entry);
      byte[] serialized=AccessControlLists.writePermissionsAsBytes(perms,conf);
      zkw.writeToZookeeper(entry,serialized);
    }
 catch (    IOException ex) {
      LOG.error("Failed updating permissions mirror for '" + Bytes.toString(entry) + "'",ex);
    }
  }
}
