{
  LOG.info("Starting testMetaWithLegacyHRI");
  final byte[] FAMILY=Bytes.toBytes("family");
  HTableDescriptor htd=new HTableDescriptor("testMetaMigration");
  HColumnDescriptor hcd=new HColumnDescriptor(FAMILY);
  htd.addFamily(hcd);
  Configuration conf=TEST_UTIL.getConfiguration();
  createMultiRegionsWithLegacyHRI(conf,htd,FAMILY,new byte[][]{HConstants.EMPTY_START_ROW,Bytes.toBytes("region_a"),Bytes.toBytes("region_b")});
  CatalogTracker ct=TEST_UTIL.getMiniHBaseCluster().getMaster().getCatalogTracker();
  undoVersionInMeta();
  MetaReader.fullScanMetaAndPrint(ct);
  LOG.info("Meta Print completed.testUpdatesOnMetaWithLegacyHRI");
  Set<HTableDescriptor> htds=MetaMigrationRemovingHTD.updateMetaWithNewRegionInfo(TEST_UTIL.getHBaseCluster().getMaster());
  MetaReader.fullScanMetaAndPrint(ct);
  assertEquals(1,htds.size());
  assertTrue(htds.contains(htd));
  boolean metaUpdated=MetaMigrationRemovingHTD.isMetaHRIUpdated(TEST_UTIL.getMiniHBaseCluster().getMaster());
  assertEquals(true,metaUpdated);
}
