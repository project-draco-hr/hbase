{
  if (isTraceEnabled()) {
    LOG.trace(this + " rollback state=" + state);
  }
  try {
switch (state) {
case CLONE_SNAPSHOT_POST_OPERATION:
      break;
case CLONE_SNAPSHOT_UPDATE_DESC_CACHE:
    DeleteTableProcedure.deleteTableDescriptorCache(env,getTableName());
  break;
case CLONE_SNAPSHOT_ASSIGN_REGIONS:
DeleteTableProcedure.deleteAssignmentState(env,getTableName());
break;
case CLONE_SNAPSHOT_ADD_TO_META:
DeleteTableProcedure.deleteFromMeta(env,getTableName(),newRegions);
break;
case CLONE_SNAPSHOT_WRITE_FS_LAYOUT:
DeleteTableProcedure.deleteFromFs(env,getTableName(),newRegions,false);
break;
case CLONE_SNAPSHOT_PRE_OPERATION:
DeleteTableProcedure.deleteTableStates(env,getTableName());
break;
default :
throw new UnsupportedOperationException("unhandled state=" + state);
}
}
 catch (IOException e) {
LOG.warn("Failed rollback attempt step=" + state + " table="+ getTableName(),e);
throw e;
}
}
