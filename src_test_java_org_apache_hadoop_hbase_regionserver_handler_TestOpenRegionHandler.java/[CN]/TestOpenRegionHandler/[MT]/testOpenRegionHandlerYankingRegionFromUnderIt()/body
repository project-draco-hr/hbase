{
  final Server server=new MockServer();
  final RegionServerServices rss=new MockRegionServerServices();
  HTableDescriptor htd=new HTableDescriptor("testOpenRegionHandlerYankingRegionFromUnderIt");
  final HRegionInfo hri=new HRegionInfo(htd.getName(),HConstants.EMPTY_END_ROW,HConstants.EMPTY_END_ROW);
  HRegion region=HRegion.createHRegion(hri,HBaseTestingUtility.getTestDir(),HTU.getConfiguration(),htd);
  OpenRegionHandler handler=new OpenRegionHandler(server,rss,hri,htd){
    HRegion openRegion(){
      HRegion region=super.openRegion(HBaseTestingUtility.getTestDir());
      ZooKeeperWatcher zkw=this.server.getZooKeeper();
      String node=ZKAssign.getNodeName(zkw,hri.getEncodedName());
      try {
        ZKUtil.deleteNodeFailSilent(zkw,node);
      }
 catch (      KeeperException e) {
        throw new RuntimeException("Ugh failed delete of " + node,e);
      }
      return region;
    }
  }
;
  handler.process();
  ZKAssign.createNodeOffline(server.getZooKeeper(),hri,server.getServerName());
  handler.process();
}
