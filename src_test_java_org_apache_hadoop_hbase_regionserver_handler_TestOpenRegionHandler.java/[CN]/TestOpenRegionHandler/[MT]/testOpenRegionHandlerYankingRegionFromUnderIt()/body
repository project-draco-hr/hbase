{
  final Server server=new MockServer();
  final RegionServerServices rss=new MockRegionServerServices();
  HTableDescriptor htd=new HTableDescriptor("testOpenRegionHandlerYankingRegionFromUnderIt");
  final HRegionInfo hri=new HRegionInfo(htd,HConstants.EMPTY_END_ROW,HConstants.EMPTY_END_ROW);
  OpenRegionHandler handler=new OpenRegionHandler(server,rss,hri){
    HRegion openRegion(){
      HRegion region=super.openRegion();
      ZooKeeperWatcher zkw=this.server.getZooKeeper();
      String node=ZKAssign.getNodeName(zkw,hri.getEncodedName());
      try {
        ZKUtil.deleteNodeFailSilent(zkw,node);
      }
 catch (      KeeperException e) {
        throw new RuntimeException("Ugh failed delete of " + node,e);
      }
      return region;
    }
  }
;
  handler.process();
  ZKAssign.createNodeOffline(server.getZooKeeper(),hri,server.getServerName());
  handler.process();
}
