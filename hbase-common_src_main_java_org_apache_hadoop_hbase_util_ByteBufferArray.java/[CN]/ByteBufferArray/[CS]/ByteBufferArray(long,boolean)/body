{
  this.bufferSize=DEFAULT_BUFFER_SIZE;
  if (this.bufferSize > (capacity / 16))   this.bufferSize=(int)roundUp(capacity / 16,32768);
  this.bufferCount=(int)(roundUp(capacity,bufferSize) / bufferSize);
  LOG.info("Allocating buffers total=" + StringUtils.byteDesc(capacity) + " , sizePerBuffer="+ StringUtils.byteDesc(bufferSize)+ ", count="+ bufferCount);
  buffers=new ByteBuffer[bufferCount + 1];
  locks=new Lock[bufferCount + 1];
  for (int i=0; i <= bufferCount; i++) {
    locks[i]=new ReentrantLock();
    if (i < bufferCount) {
      buffers[i]=directByteBuffer ? ByteBuffer.allocateDirect(bufferSize) : ByteBuffer.allocate(bufferSize);
    }
 else {
      buffers[i]=ByteBuffer.allocate(0);
    }
  }
}
