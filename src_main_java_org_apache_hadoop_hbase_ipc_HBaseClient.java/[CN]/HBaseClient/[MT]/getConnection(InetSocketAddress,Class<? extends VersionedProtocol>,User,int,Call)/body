{
  if (!running.get()) {
    throw new IOException("The client is stopped");
  }
  Connection connection;
  ConnectionId remoteId=new ConnectionId(addr,protocol,ticket,rpcTimeout);
  do {
synchronized (connections) {
      connection=connections.get(remoteId);
      if (connection == null) {
        connection=new Connection(remoteId);
        connections.put(remoteId,connection);
      }
    }
  }
 while (!connection.addCall(call));
  connection.setupIOstreams();
  return connection;
}
