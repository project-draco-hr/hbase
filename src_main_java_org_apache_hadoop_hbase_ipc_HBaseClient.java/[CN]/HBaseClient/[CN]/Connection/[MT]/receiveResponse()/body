{
  if (shouldCloseConnection.get()) {
    return;
  }
  touch();
  try {
    RpcResponse response=RpcResponse.parseDelimitedFrom(in);
    int id=response.getCallId();
    if (LOG.isDebugEnabled())     LOG.debug(getName() + " got value #" + id);
    Call call=calls.remove(id);
    boolean isError=response.getError();
    if (isError) {
      if (call != null) {
        call.setException(new RemoteException(response.getException().getExceptionName(),response.getException().getStackTrace()));
      }
    }
 else {
      ByteString responseObj=response.getResponse();
      DataInputStream dis=new DataInputStream(responseObj.newInput());
      Writable value=ReflectionUtils.newInstance(valueClass,conf);
      value.readFields(dis);
      if (call != null) {
        call.setValue(value);
      }
    }
  }
 catch (  IOException e) {
    if (e instanceof SocketTimeoutException && remoteId.rpcTimeout > 0) {
      closeException=e;
    }
 else {
      markClosed(e);
    }
  }
 finally {
    if (remoteId.rpcTimeout > 0) {
      cleanupCalls(remoteId.rpcTimeout);
    }
  }
}
