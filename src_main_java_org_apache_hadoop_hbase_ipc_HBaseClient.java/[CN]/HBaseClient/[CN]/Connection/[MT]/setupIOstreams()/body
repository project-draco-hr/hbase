{
  if (socket != null || shouldCloseConnection.get()) {
    return;
  }
  try {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Connecting to " + remoteId);
    }
    setupConnection();
    this.in=new DataInputStream(new BufferedInputStream(new PingInputStream(NetUtils.getInputStream(socket))));
    this.out=new DataOutputStream(new BufferedOutputStream(NetUtils.getOutputStream(socket)));
    writeHeader();
    touch();
    start();
  }
 catch (  Throwable e) {
    IOException exception=new IOException(e);
    markClosed(exception);
    close();
    throw exception;
  }
}
