{
  LOG.info("Starting testMetaScanner");
  final byte[] TABLENAME=Bytes.toBytes("testMetaScanner");
  final byte[] FAMILY=Bytes.toBytes("family");
  TEST_UTIL.createTable(TABLENAME,FAMILY);
  Configuration conf=TEST_UTIL.getConfiguration();
  HTable table=new HTable(conf,TABLENAME);
  TEST_UTIL.createMultiRegions(conf,table,FAMILY,new byte[][]{HConstants.EMPTY_START_ROW,Bytes.toBytes("region_a"),Bytes.toBytes("region_b")});
  TEST_UTIL.countRows(table);
  MetaScanner.MetaScannerVisitor visitor=mock(MetaScanner.MetaScannerVisitor.class);
  doReturn(true).when(visitor).processRow((Result)anyObject());
  MetaScanner.metaScan(conf,visitor,TABLENAME);
  verify(visitor,times(3)).processRow((Result)anyObject());
  reset(visitor);
  doReturn(true).when(visitor).processRow((Result)anyObject());
  MetaScanner.metaScan(conf,visitor,TABLENAME,HConstants.EMPTY_BYTE_ARRAY,1000);
  verify(visitor,times(3)).processRow((Result)anyObject());
  reset(visitor);
  doReturn(true).when(visitor).processRow((Result)anyObject());
  MetaScanner.metaScan(conf,visitor,TABLENAME,Bytes.toBytes("region_ac"),1000);
  verify(visitor,times(2)).processRow((Result)anyObject());
  reset(visitor);
  doReturn(true).when(visitor).processRow((Result)anyObject());
  MetaScanner.metaScan(conf,visitor,TABLENAME,Bytes.toBytes("region_ac"),1);
  verify(visitor,times(1)).processRow((Result)anyObject());
  table.close();
}
