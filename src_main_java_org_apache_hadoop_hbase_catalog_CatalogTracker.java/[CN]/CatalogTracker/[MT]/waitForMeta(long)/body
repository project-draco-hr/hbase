{
  long stop=System.currentTimeMillis() + timeout;
synchronized (metaAvailable) {
    if (getMetaServerConnection(true) != null) {
      return metaLocation;
    }
    while (!stopped && !metaAvailable.get() && (timeout == 0 || System.currentTimeMillis() < stop)) {
      metaAvailable.wait(timeout);
    }
    if (getMetaServerConnection(true) == null) {
      throw new NotAllMetaRegionsOnlineException("Timed out (" + timeout + "ms)");
    }
    return metaLocation;
  }
}
