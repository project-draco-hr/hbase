{
  try {
    try {
      this.fs=FileSystem.get(conf);
      this.parentdir=new Path(conf.get(HREGION_DIR,DEFAULT_HREGION_DIR));
      fs.mkdirs(parentdir);
    }
 catch (    Throwable e) {
      LOG.error("Failed setup of FileSystem",e);
      throw e;
    }
    if (this.conf.get(MASTER_ADDRESS) == null) {
      this.conf.set(MASTER_ADDRESS,"localhost:0");
    }
    this.master=new HMaster(conf);
    this.masterThread=new Thread(this.master,"HMaster");
    LOG.info("Starting HMaster");
    masterThread.start();
    String address=master.getMasterAddress().toString();
    this.conf.set(MASTER_ADDRESS,address);
    if (this.conf.get(REGIONSERVER_ADDRESS) == null) {
      this.conf.set(REGIONSERVER_ADDRESS,"localhost:0");
    }
    LOG.info("Starting HRegionServers");
    startRegionServers(this.conf,nRegionNodes);
  }
 catch (  Throwable e) {
    e.printStackTrace();
    shutdown();
  }
}
