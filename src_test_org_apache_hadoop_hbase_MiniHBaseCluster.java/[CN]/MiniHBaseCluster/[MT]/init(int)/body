{
  try {
    try {
      this.fs=FileSystem.get(conf);
      this.parentdir=new Path(conf.get(HBASE_DIR,DEFAULT_HBASE_DIR));
      fs.mkdirs(parentdir);
    }
 catch (    IOException e) {
      LOG.error("Failed setup of FileSystem",e);
      throw e;
    }
    this.masterThread=startMaster(this.conf);
    this.regionThreads=startRegionServers(this.conf,nRegionNodes);
  }
 catch (  IOException e) {
    shutdown();
    throw e;
  }
}
