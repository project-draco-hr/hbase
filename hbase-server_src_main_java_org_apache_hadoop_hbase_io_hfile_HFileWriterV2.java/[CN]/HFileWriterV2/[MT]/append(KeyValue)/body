{
  byte[] key=kv.getBuffer();
  int koffset=kv.getKeyOffset();
  int klength=kv.getKeyLength();
  byte[] value=kv.getValueArray();
  int voffset=kv.getValueOffset();
  int vlength=kv.getValueLength();
  boolean dupKey=checkKey(key,koffset,klength);
  checkValue(value,voffset,vlength);
  if (!dupKey) {
    checkBlockBoundary();
  }
  if (!fsBlockWriter.isWriting())   newBlock();
  fsBlockWriter.write(kv);
  totalKeyLength+=klength;
  totalValueLength+=vlength;
  if (firstKeyInBlock == null) {
    firstKeyInBlock=new byte[klength];
    System.arraycopy(key,koffset,firstKeyInBlock,0,klength);
  }
  lastKeyBuffer=key;
  lastKeyOffset=koffset;
  lastKeyLength=klength;
  entryCount++;
  this.maxMemstoreTS=Math.max(this.maxMemstoreTS,kv.getMvccVersion());
}
