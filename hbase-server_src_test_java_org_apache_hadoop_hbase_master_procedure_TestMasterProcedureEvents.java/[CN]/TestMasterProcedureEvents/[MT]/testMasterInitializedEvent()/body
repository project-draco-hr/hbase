{
  TableName tableName=TableName.valueOf("testMasterInitializedEvent");
  HMaster master=UTIL.getMiniHBaseCluster().getMaster();
  ProcedureExecutor<MasterProcedureEnv> procExec=master.getMasterProcedureExecutor();
  MasterProcedureScheduler procSched=procExec.getEnvironment().getProcedureQueue();
  HRegionInfo hri=new HRegionInfo(tableName);
  HTableDescriptor htd=new HTableDescriptor(tableName);
  HColumnDescriptor hcd=new HColumnDescriptor("f");
  htd.addFamily(hcd);
  while (!master.isInitialized())   Thread.sleep(250);
  master.setInitialized(false);
  CreateTableProcedure proc=new CreateTableProcedure(procExec.getEnvironment(),htd,new HRegionInfo[]{hri});
  long pollCalls=procSched.getPollCalls();
  long nullPollCalls=procSched.getNullPollCalls();
  long procId=procExec.submitProcedure(proc,HConstants.NO_NONCE,HConstants.NO_NONCE);
  for (int i=0; i < 10; ++i) {
    Thread.sleep(100);
    assertEquals(pollCalls + 1,procSched.getPollCalls());
    assertEquals(nullPollCalls,procSched.getNullPollCalls());
  }
  master.setInitialized(true);
  ProcedureTestingUtility.waitProcedure(procExec,procId);
  assertEquals(pollCalls + 2,procSched.getPollCalls());
  assertEquals(nullPollCalls,procSched.getNullPollCalls());
}
