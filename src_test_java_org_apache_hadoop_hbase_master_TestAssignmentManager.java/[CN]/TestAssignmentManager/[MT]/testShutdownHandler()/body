{
  ExecutorService executor=startupMasterExecutor("testShutdownHandler");
  CatalogTracker ct=Mockito.mock(CatalogTracker.class);
  LoadBalancer balancer=LoadBalancerFactory.getLoadBalancer(server.getConfiguration());
  AssignmentManager am=new AssignmentManager(this.server,this.serverManager,ct,balancer,executor,null);
  try {
    processServerShutdownHandler(ct,am,false);
  }
  finally {
    executor.shutdown();
    am.shutdown();
    ZKAssign.deleteAllNodes(this.watcher);
  }
}
