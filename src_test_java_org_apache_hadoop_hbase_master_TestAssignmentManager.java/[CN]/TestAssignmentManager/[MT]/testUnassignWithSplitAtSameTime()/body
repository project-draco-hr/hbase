{
  final HRegionInfo hri=HRegionInfo.FIRST_META_REGIONINFO;
  Mockito.when(this.serverManager.sendRegionClose(RANDOM_SERVERNAME,hri,-1)).thenReturn(true);
  AssignmentManager am=new AssignmentManager(this.server,this.serverManager,this.ct,this.executor);
  try {
    unassign(am,RANDOM_SERVERNAME,hri);
    ZKAssign.deleteClosingNode(this.watcher,hri);
    int version=createNodeSplitting(this.watcher,hri,RANDOM_SERVERNAME);
    unassign(am,RANDOM_SERVERNAME,hri);
    ZKAssign.transitionNode(this.watcher,hri,RANDOM_SERVERNAME,EventType.RS_ZK_REGION_SPLITTING,EventType.RS_ZK_REGION_SPLITTING,version);
    assertTrue(am.isRegionInTransition(hri) == null);
  }
  finally {
    am.shutdown();
  }
}
