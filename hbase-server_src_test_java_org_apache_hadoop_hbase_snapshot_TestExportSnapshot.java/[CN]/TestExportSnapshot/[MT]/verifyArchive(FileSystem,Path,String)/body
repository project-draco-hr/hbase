{
  final Path exportedSnapshot=new Path(rootDir,new Path(HConstants.SNAPSHOT_DIR_NAME,snapshotName));
  final Path exportedArchive=new Path(rootDir,".archive");
  LOG.debug(listFiles(fs,exportedArchive,exportedArchive));
  SnapshotReferenceUtil.visitReferencedFiles(fs,exportedSnapshot,new SnapshotReferenceUtil.FileVisitor(){
    public void storeFile(    final String region,    final String family,    final String hfile) throws IOException {
      verifyNonEmptyFile(new Path(exportedArchive,new Path(Bytes.toString(tableName),new Path(region,new Path(family,hfile)))));
    }
    public void recoveredEdits(    final String region,    final String logfile) throws IOException {
      verifyNonEmptyFile(new Path(exportedSnapshot,new Path(Bytes.toString(tableName),new Path(region,logfile))));
    }
    public void logFile(    final String server,    final String logfile) throws IOException {
      verifyNonEmptyFile(new Path(exportedSnapshot,new Path(server,logfile)));
    }
    private void verifyNonEmptyFile(    final Path path) throws IOException {
      LOG.debug(path);
      assertTrue(fs.exists(path));
      assertTrue(fs.getFileStatus(path).getLen() > 0);
    }
  }
);
}
