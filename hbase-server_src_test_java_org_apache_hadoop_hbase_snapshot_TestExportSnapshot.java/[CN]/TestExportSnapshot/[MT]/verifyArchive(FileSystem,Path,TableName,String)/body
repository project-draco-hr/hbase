{
  final Path exportedSnapshot=new Path(rootDir,new Path(HConstants.SNAPSHOT_DIR_NAME,snapshotName));
  final Path exportedArchive=new Path(rootDir,HConstants.HFILE_ARCHIVE_DIRECTORY);
  LOG.debug(listFiles(fs,exportedArchive,exportedArchive));
  SnapshotReferenceUtil.visitReferencedFiles(TEST_UTIL.getConfiguration(),fs,exportedSnapshot,new SnapshotReferenceUtil.SnapshotVisitor(){
    public void storeFile(    final HRegionInfo regionInfo,    final String family,    final SnapshotRegionManifest.StoreFile storeFile) throws IOException {
      String hfile=storeFile.getName();
      verifyNonEmptyFile(new Path(exportedArchive,new Path(FSUtils.getTableDir(new Path("./"),tableName),new Path(regionInfo.getEncodedName(),new Path(family,hfile)))));
    }
    public void recoveredEdits(    final String region,    final String logfile) throws IOException {
      verifyNonEmptyFile(new Path(exportedSnapshot,new Path(tableName.getNameAsString(),new Path(region,logfile))));
    }
    public void logFile(    final String server,    final String logfile) throws IOException {
      verifyNonEmptyFile(new Path(exportedSnapshot,new Path(server,logfile)));
    }
    private void verifyNonEmptyFile(    final Path path) throws IOException {
      assertTrue(path + " should exists",fs.exists(path));
      assertTrue(path + " should not be empty",fs.getFileStatus(path).getLen() > 0);
    }
  }
);
}
