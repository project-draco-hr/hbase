{
  if (LOG.isDebugEnabled()) {
    LOG.debug("GET " + uriInfo.getAbsolutePath());
  }
  CellSetModel model=new CellSetModel();
  RowModel rowModel=null;
  byte[] rowKey=null;
  int count=batch;
  do {
    KeyValue value=null;
    try {
      value=generator.next();
    }
 catch (    IllegalStateException e) {
      ScannerResource.delete(id);
      throw new WebApplicationException(Response.Status.GONE);
    }
    if (value == null) {
      LOG.info("generator exhausted");
      if (count == batch) {
        return Response.noContent().build();
      }
      break;
    }
    if (rowKey == null) {
      rowKey=value.getRow();
      rowModel=new RowModel(rowKey);
    }
    if (!Bytes.equals(value.getRow(),rowKey)) {
      model.addRow(rowModel);
      rowKey=value.getRow();
      rowModel=new RowModel(rowKey);
    }
    rowModel.addCell(new CellModel(value));
  }
 while (--count > 0);
  model.addRow(rowModel);
  ResponseBuilder response=Response.ok(model);
  response.cacheControl(cacheControl);
  return response.build();
}
