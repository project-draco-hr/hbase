{
  Put p=new Put(tableName);
  byte[] key=Bytes.toBytes(username);
  if (perm.getFamily() != null && perm.getFamily().length > 0) {
    key=Bytes.add(key,Bytes.add(new byte[]{ACL_KEY_DELIMITER},perm.getFamily()));
    if (perm.getQualifier() != null && perm.getQualifier().length > 0) {
      key=Bytes.add(key,Bytes.add(new byte[]{ACL_KEY_DELIMITER},perm.getQualifier()));
    }
  }
  TablePermission.Action[] actions=perm.getActions();
  if ((actions == null) || (actions.length == 0)) {
    LOG.warn("No actions associated with user '" + username + "'");
    return;
  }
  byte[] value=new byte[actions.length];
  for (int i=0; i < actions.length; i++) {
    value[i]=actions[i].code();
  }
  p.add(ACL_LIST_FAMILY,key,value);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Writing permission for table " + Bytes.toString(tableName) + " "+ Bytes.toString(key)+ ": "+ Bytes.toStringBinary(value));
  }
  HTable acls=null;
  try {
    acls=new HTable(conf,ACL_TABLE_NAME);
    acls.put(p);
  }
  finally {
    if (acls != null)     acls.close();
  }
}
