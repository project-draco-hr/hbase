{
  if (!isAppendSupported(conf)) {
    return;
  }
  if (!(fs instanceof DistributedFileSystem)) {
    return;
  }
  LOG.info("Recovering file" + p);
  long startWaiting=System.currentTimeMillis();
  boolean recovered=false;
  while (!recovered) {
    try {
      FSDataOutputStream out=fs.append(p);
      out.close();
      recovered=true;
    }
 catch (    IOException e) {
      e=RemoteExceptionHandler.checkIOException(e);
      if (e instanceof AlreadyBeingCreatedException) {
        long waitedFor=System.currentTimeMillis() - startWaiting;
        if (waitedFor > FSConstants.LEASE_SOFTLIMIT_PERIOD) {
          LOG.warn("Waited " + waitedFor + "ms for lease recovery on "+ p+ ":"+ e.getMessage());
        }
        try {
          Thread.sleep(1000);
        }
 catch (        InterruptedException ex) {
        }
      }
 else {
        throw new IOException("Failed to open " + p + " for append",e);
      }
    }
  }
  LOG.info("Finished lease recover attempt for " + p);
}
