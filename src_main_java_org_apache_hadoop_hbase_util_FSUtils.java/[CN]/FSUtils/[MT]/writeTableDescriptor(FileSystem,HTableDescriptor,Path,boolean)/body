{
  Path tableInfoPath=new Path(tableDir,HConstants.TABLEINFO_NAME);
  Path tmpPath=new Path(new Path(tableDir,".tmp"),HConstants.TABLEINFO_NAME + "." + System.currentTimeMillis());
  LOG.info("TableInfoPath = " + tableInfoPath + " tmpPath = "+ tmpPath);
  try {
    writeHTD(fs,tmpPath,hTableDescriptor);
  }
 catch (  IOException e) {
    LOG.error("Unable to write the tabledescriptor in the path" + tmpPath + ".",e);
    fs.delete(tmpPath,true);
    throw e;
  }
  try {
    if (forceCreation) {
      if (!fs.delete(tableInfoPath,false)) {
        String errMsg="Unable to delete " + tableInfoPath + " while forcefully writing the table descriptor.";
        LOG.error(errMsg);
        throw new IOException(errMsg);
      }
    }
    if (!fs.rename(tmpPath,tableInfoPath)) {
      String errMsg="Unable to rename " + tmpPath + " to "+ tableInfoPath;
      LOG.error(errMsg);
      throw new IOException(errMsg);
    }
 else {
      LOG.info("TableDescriptor stored. TableInfoPath = " + tableInfoPath);
    }
  }
  finally {
    fs.delete(tmpPath,true);
  }
}
