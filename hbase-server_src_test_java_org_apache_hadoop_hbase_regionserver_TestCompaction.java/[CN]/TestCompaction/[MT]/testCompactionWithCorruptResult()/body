{
  int nfiles=10;
  for (int i=0; i < nfiles; i++) {
    createStoreFile(r);
  }
  HStore store=(HStore)r.getStore(COLUMN_FAMILY);
  Collection<StoreFile> storeFiles=store.getStorefiles();
  Compactor tool=store.compactor;
  List<Path> newFiles=tool.compact(storeFiles,false);
  FileSystem fs=FileSystem.get(conf);
  Path origPath=newFiles.get(0);
  Path homedir=store.getHomedir();
  Path dstPath=new Path(homedir,origPath.getName());
  FSDataOutputStream stream=fs.create(origPath,null,true,512,(short)3,(long)1024,null);
  stream.writeChars("CORRUPT FILE!!!!");
  stream.close();
  try {
    store.completeCompaction(storeFiles,origPath);
  }
 catch (  Exception e) {
    assert(fs.exists(origPath));
    assert(!fs.exists(dstPath));
    System.out.println("testCompactionWithCorruptResult Passed");
    return;
  }
  fail("testCompactionWithCorruptResult failed since no exception was" + "thrown while completing a corrupt file");
}
