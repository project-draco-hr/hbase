{
  Map<HStore,HFileDataBlockEncoder> replaceBlockCache=new HashMap<HStore,HFileDataBlockEncoder>();
  for (  Entry<byte[],Store> pair : r.getStores().entrySet()) {
    HStore store=(HStore)pair.getValue();
    HFileDataBlockEncoder blockEncoder=store.getDataBlockEncoder();
    replaceBlockCache.put(store,blockEncoder);
    final DataBlockEncoding inCache=DataBlockEncoding.PREFIX;
    final DataBlockEncoding onDisk=inCacheOnly ? DataBlockEncoding.NONE : inCache;
    store.setDataBlockEncoderInTest(new HFileDataBlockEncoderImpl(onDisk));
  }
  majorCompaction();
  for (  Entry<HStore,HFileDataBlockEncoder> entry : replaceBlockCache.entrySet()) {
    entry.getKey().setDataBlockEncoderInTest(entry.getValue());
  }
}
