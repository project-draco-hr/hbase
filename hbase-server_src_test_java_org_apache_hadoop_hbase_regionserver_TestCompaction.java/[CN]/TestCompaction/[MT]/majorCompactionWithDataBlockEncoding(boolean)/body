{
  Map<Store,HFileDataBlockEncoder> replaceBlockCache=new HashMap<Store,HFileDataBlockEncoder>();
  for (  Entry<byte[],Store> pair : r.getStores().entrySet()) {
    Store store=pair.getValue();
    HFileDataBlockEncoder blockEncoder=store.getDataBlockEncoder();
    replaceBlockCache.put(pair.getValue(),blockEncoder);
    final DataBlockEncoding inCache=DataBlockEncoding.PREFIX;
    final DataBlockEncoding onDisk=inCacheOnly ? DataBlockEncoding.NONE : inCache;
    store.setDataBlockEncoderInTest(new HFileDataBlockEncoderImpl(onDisk,inCache));
  }
  majorCompaction();
  for (  Entry<Store,HFileDataBlockEncoder> entry : replaceBlockCache.entrySet()) {
    entry.getKey().setDataBlockEncoderInTest(entry.getValue());
  }
}
