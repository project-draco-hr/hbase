{
  LOG.info("Running testCloseRegion");
  MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  LOG.info("Number of region servers = " + cluster.getLiveRegionServerThreads().size());
  int rsIdx=0;
  HRegionServer regionServer=TEST_UTIL.getHBaseCluster().getRegionServer(rsIdx);
  HRegionInfo hri=getNonMetaRegion(ProtobufUtil.getOnlineRegions(regionServer));
  LOG.debug("Asking RS to close region " + hri.getRegionNameAsString());
  AtomicBoolean closeEventProcessed=new AtomicBoolean(false);
  EventHandlerListener listener=new CloseRegionEventListener(hri.getRegionNameAsString(),closeEventProcessed);
  cluster.getMaster().executorService.registerListener(EventType.RS_ZK_REGION_CLOSED,listener);
  cluster.getMaster().assignmentManager.unassign(hri);
  while (!closeEventProcessed.get()) {
    Threads.sleep(100);
  }
  LOG.info("Done with testCloseRegion");
}
