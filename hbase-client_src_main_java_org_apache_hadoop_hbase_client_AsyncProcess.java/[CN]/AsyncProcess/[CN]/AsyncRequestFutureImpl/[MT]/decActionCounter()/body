{
  if (hasAnyReplicaGets && (actionsInProgress.get() == 1)) {
    int staleCount=0;
    if (replicaGetIndices == null) {
      for (int i=0; i < results.length; ++i) {
        staleCount+=convertReplicaResult(i) ? 1 : 0;
      }
    }
 else {
      for (int i=0; i < replicaGetIndices.length; ++i) {
        staleCount+=convertReplicaResult(replicaGetIndices[i]) ? 1 : 0;
      }
    }
    if (!actionsInProgress.compareAndSet(1,0)) {
      throw new AssertionError("Cannot set actions in progress to 0");
    }
    if (staleCount > 0) {
      LOG.trace("Returning " + staleCount + " stale results");
    }
  }
 else {
    actionsInProgress.decrementAndGet();
  }
synchronized (actionsInProgress) {
    actionsInProgress.notifyAll();
  }
}
