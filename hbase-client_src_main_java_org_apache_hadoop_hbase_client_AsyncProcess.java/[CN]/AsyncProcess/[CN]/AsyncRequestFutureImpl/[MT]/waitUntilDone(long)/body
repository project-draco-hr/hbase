{
  boolean hasWait=cutoff != Long.MAX_VALUE;
  long lastLog=hasWait ? 0 : EnvironmentEdgeManager.currentTimeMillis();
  long currentInProgress;
  while (0 != (currentInProgress=actionsInProgress.get())) {
    long now=0;
    if (hasWait && (now=EnvironmentEdgeManager.currentTimeMillis()) > cutoff) {
      return false;
    }
    if (!hasWait) {
      now=EnvironmentEdgeManager.currentTimeMillis();
      if (now > lastLog + 10000) {
        lastLog=now;
        LOG.info("#" + id + ", waiting for "+ currentInProgress+ "  actions to finish");
      }
synchronized (actionsInProgress) {
        if (actionsInProgress.get() == 0)         break;
        actionsInProgress.wait(Math.min(100,hasWait ? (cutoff - now) : Long.MAX_VALUE));
      }
    }
  }
  return true;
}
