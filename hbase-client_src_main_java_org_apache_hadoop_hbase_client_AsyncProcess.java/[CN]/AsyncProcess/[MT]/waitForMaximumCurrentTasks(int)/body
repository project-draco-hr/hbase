{
  long lastLog=EnvironmentEdgeManager.currentTime();
  long currentInProgress, oldInProgress=Long.MAX_VALUE;
  while ((currentInProgress=this.tasksInProgress.get()) > max) {
    if (oldInProgress != currentInProgress) {
      long now=EnvironmentEdgeManager.currentTime();
      if (now > lastLog + 10000) {
        lastLog=now;
        LOG.info("#" + id + ", waiting for some tasks to finish. Expected max="+ max+ ", tasksInProgress="+ currentInProgress);
      }
    }
    oldInProgress=currentInProgress;
    try {
synchronized (this.tasksInProgress) {
        if (tasksInProgress.get() != oldInProgress)         break;
        this.tasksInProgress.wait(100);
      }
    }
 catch (    InterruptedException e) {
      throw new InterruptedIOException("#" + id + ", interrupted."+ " currentNumberOfTask="+ currentInProgress);
    }
  }
}
