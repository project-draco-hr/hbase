{
  if (responses == null) {
    LOG.info("Attempt #" + numAttempt + "/"+ numTries+ " failed all ops, trying resubmit,"+ location);
    resubmitAll(initialActions,rsActions,location,numAttempt + 1,null,errorsByServer);
    return;
  }
  List<Action<Row>> toReplay=new ArrayList<Action<Row>>();
  Throwable throwable=null;
  int failureCount=0;
  boolean canRetry=true;
  for (  Map.Entry<byte[],List<Pair<Integer,Object>>> resultsForRS : responses.getResults().entrySet()) {
    boolean regionFailureRegistered=false;
    for (    Pair<Integer,Object> regionResult : resultsForRS.getValue()) {
      Object result=regionResult.getSecond();
      if (result == null || result instanceof Throwable) {
        throwable=(Throwable)result;
        Action<Row> correspondingAction=initialActions.get(regionResult.getFirst());
        Row row=correspondingAction.getAction();
        failureCount++;
        if (!regionFailureRegistered) {
          regionFailureRegistered=true;
          hConnection.updateCachedLocations(this.tableName,row.getRow(),result,location);
          if (errorsByServer != null) {
            errorsByServer.reportServerError(location);
            canRetry=errorsByServer.canRetryMore();
          }
        }
        if (manageError(numAttempt,correspondingAction.getOriginalIndex(),row,canRetry,throwable,location)) {
          toReplay.add(correspondingAction);
        }
      }
 else {
        if (callback != null) {
          int index=regionResult.getFirst();
          Action<Row> correspondingAction=initialActions.get(index);
          Row row=correspondingAction.getAction();
          this.callback.success(index,resultsForRS.getKey(),row,(CResult)result);
        }
      }
    }
  }
  if (!toReplay.isEmpty()) {
    long backOffTime=(errorsByServer != null ? errorsByServer.calculateBackoffTime(location,pause) : ConnectionUtils.getPauseTime(pause,numAttempt));
    if (numAttempt > START_LOG_ERRORS_CNT && LOG.isDebugEnabled()) {
      LOG.debug("Attempt #" + numAttempt + "/"+ numTries+ " failed "+ failureCount+ " ops , resubmitting "+ toReplay.size()+ ", "+ location+ ", last exception was: "+ (throwable == null ? "null" : throwable.getMessage())+ ", sleeping "+ backOffTime+ "ms");
    }
    try {
      Thread.sleep(backOffTime);
    }
 catch (    InterruptedException e) {
      LOG.warn("Not sent: " + toReplay.size() + " operations, "+ location,e);
      Thread.interrupted();
      return;
    }
    submit(initialActions,toReplay,numAttempt + 1,errorsByServer);
  }
 else {
    if (failureCount != 0) {
      LOG.warn("Attempt #" + numAttempt + "/"+ numTries+ " failed for "+ failureCount+ " ops on "+ location.getServerName()+ " NOT resubmitting. "+ location);
    }
 else     if (numAttempt > START_LOG_ERRORS_CNT + 1 && LOG.isDebugEnabled()) {
      LOG.debug("Attempt #" + numAttempt + "/"+ numTries+ " finally suceeded, size="+ toReplay.size());
    }
  }
}
