{
  Coprocessor impl;
  Object o=null;
  try {
    o=implClass.newInstance();
    impl=(Coprocessor)o;
  }
 catch (  InstantiationException e) {
    throw new IOException(e);
  }
catch (  IllegalAccessException e) {
    throw new IOException(e);
  }
  Environment env=new Environment(impl,priority);
  env.startup();
  for (  Class c : implClass.getInterfaces()) {
    if (CoprocessorProtocol.class.isAssignableFrom(c)) {
      region.registerProtocol(c,(CoprocessorProtocol)o);
      break;
    }
  }
  try {
    coprocessorLock.writeLock().lock();
    coprocessors.add(env);
  }
  finally {
    coprocessorLock.writeLock().unlock();
  }
}
