{
  long beginOffset=out.getPos();
  DataOutputStream dos=blockWriter.startWriting(BlockType.INTERMEDIATE_INDEX);
  curChunk.writeNonRoot(dos);
  byte[] curFirstKey=curChunk.getBlockKey(0);
  blockWriter.writeHeaderAndData(out);
  if (blockCache != null) {
    HFileBlock blockForCaching=blockWriter.getBlockForCaching();
    passSchemaMetricsTo(blockForCaching);
    blockCache.cacheBlock(new BlockCacheKey(nameForCaching,beginOffset,DataBlockEncoding.NONE,blockForCaching.getBlockType()),blockForCaching);
  }
  totalBlockOnDiskSize+=blockWriter.getOnDiskSizeWithoutHeader();
  totalBlockUncompressedSize+=blockWriter.getUncompressedSizeWithoutHeader();
  parent.add(curFirstKey,beginOffset,blockWriter.getOnDiskSizeWithHeader());
  curChunk.clear();
  curFirstKey=null;
}
