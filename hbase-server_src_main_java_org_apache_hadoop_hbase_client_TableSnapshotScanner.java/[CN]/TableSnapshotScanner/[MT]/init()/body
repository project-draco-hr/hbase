{
  Path snapshotDir=SnapshotDescriptionUtils.getCompletedSnapshotDir(snapshotName,rootDir);
  htd=FSTableDescriptors.getTableDescriptorFromFs(fs,snapshotDir);
  Set<String> snapshotRegionNames=SnapshotReferenceUtil.getSnapshotRegionNames(fs,snapshotDir);
  if (snapshotRegionNames == null) {
    throw new IllegalArgumentException("Snapshot seems empty");
  }
  regions=new ArrayList<HRegionInfo>(snapshotRegionNames.size());
  for (  String regionName : snapshotRegionNames) {
    Path regionDir=new Path(snapshotDir,regionName);
    HRegionInfo hri=HRegionFileSystem.loadRegionInfoFileContent(fs,regionDir);
    if (CellUtil.overlappingKeys(scan.getStartRow(),scan.getStopRow(),hri.getStartKey(),hri.getEndKey())) {
      regions.add(hri);
    }
  }
  Collections.sort(regions);
  initScanMetrics(scan);
  RestoreSnapshotHelper.copySnapshotForScanner(conf,fs,rootDir,restoreDir,snapshotName);
}
