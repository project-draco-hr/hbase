{
  Path snapshotDir=SnapshotDescriptionUtils.getCompletedSnapshotDir(snapshotName,rootDir);
  SnapshotDescription snapshotDesc=SnapshotDescriptionUtils.readSnapshotInfo(fs,snapshotDir);
  SnapshotManifest manifest=SnapshotManifest.open(conf,fs,snapshotDir,snapshotDesc);
  htd=manifest.getTableDescriptor();
  List<SnapshotRegionManifest> regionManifests=manifest.getRegionManifests();
  if (regionManifests == null) {
    throw new IllegalArgumentException("Snapshot seems empty");
  }
  regions=new ArrayList<HRegionInfo>(regionManifests.size());
  for (  SnapshotRegionManifest regionManifest : regionManifests) {
    HRegionInfo hri=HRegionInfo.convert(regionManifest.getRegionInfo());
    if (CellUtil.overlappingKeys(scan.getStartRow(),scan.getStopRow(),hri.getStartKey(),hri.getEndKey())) {
      regions.add(hri);
    }
  }
  Collections.sort(regions);
  initScanMetrics(scan);
  RestoreSnapshotHelper.copySnapshotForScanner(conf,fs,rootDir,restoreDir,snapshotName);
}
