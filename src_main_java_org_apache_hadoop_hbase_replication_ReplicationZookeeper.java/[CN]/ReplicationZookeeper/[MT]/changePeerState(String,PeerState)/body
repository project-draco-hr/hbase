{
  try {
    if (!peerExists(id)) {
      throw new IllegalArgumentException("peer " + id + " is not registered");
    }
    String peerStateZNode=getPeerStateNode(id);
    if (ZKUtil.checkExists(this.zookeeper,peerStateZNode) != -1) {
      ZKUtil.setData(this.zookeeper,peerStateZNode,Bytes.toBytes(state.name()));
    }
 else {
      ZKUtil.createAndWatch(zookeeper,peerStateZNode,Bytes.toBytes(state.name()));
    }
    LOG.info("state of the peer " + id + " changed to "+ state.name());
  }
 catch (  KeeperException e) {
    throw new IOException("Unable to change state of the peer " + id,e);
  }
}
