{
  try {
    if (!peerExists(id)) {
      throw new IllegalArgumentException("peer " + id + " is not registered");
    }
    String peerStateZNode=getPeerStateNode(id);
    byte[] stateBytes=(state == ZooKeeperProtos.ReplicationState.State.ENABLED) ? ENABLED_ZNODE_BYTES : DISABLED_ZNODE_BYTES;
    if (ZKUtil.checkExists(this.zookeeper,peerStateZNode) != -1) {
      ZKUtil.setData(this.zookeeper,peerStateZNode,stateBytes);
    }
 else {
      ZKUtil.createAndWatch(zookeeper,peerStateZNode,stateBytes);
    }
    LOG.info("state of the peer " + id + " changed to "+ state.name());
  }
 catch (  KeeperException e) {
    throw new IOException("Unable to change state of the peer " + id,e);
  }
}
