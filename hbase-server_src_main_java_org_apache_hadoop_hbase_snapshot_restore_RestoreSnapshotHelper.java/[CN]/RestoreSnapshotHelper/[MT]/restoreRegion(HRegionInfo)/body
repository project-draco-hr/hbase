{
  Path snapshotRegionDir=new Path(snapshotDir,regionInfo.getEncodedName());
  Map<String,List<String>> snapshotFiles=SnapshotReferenceUtil.getRegionHFileReferences(fs,snapshotRegionDir);
  Path regionDir=new Path(tableDir,regionInfo.getEncodedName());
  String tableName=tableDesc.getNameAsString();
  for (  Map.Entry<String,List<String>> familyEntry : snapshotFiles.entrySet()) {
    byte[] family=Bytes.toBytes(familyEntry.getKey());
    Path familyDir=new Path(regionDir,familyEntry.getKey());
    Set<String> familyFiles=getTableRegionFamilyFiles(familyDir);
    List<String> hfilesToAdd=new LinkedList<String>();
    for (    String hfileName : familyEntry.getValue()) {
      if (familyFiles.contains(hfileName)) {
        familyFiles.remove(hfileName);
      }
 else {
        hfilesToAdd.add(hfileName);
      }
    }
    for (    String hfileName : familyFiles) {
      Path hfile=new Path(familyDir,hfileName);
      LOG.trace("Removing hfile=" + hfile + " from table="+ tableName);
      HFileArchiver.archiveStoreFile(fs,regionInfo,conf,tableDir,family,hfile);
    }
    for (    String hfileName : hfilesToAdd) {
      LOG.trace("Adding HFileLink " + hfileName + " to table="+ tableName);
      restoreStoreFile(familyDir,regionInfo,hfileName);
    }
  }
}
