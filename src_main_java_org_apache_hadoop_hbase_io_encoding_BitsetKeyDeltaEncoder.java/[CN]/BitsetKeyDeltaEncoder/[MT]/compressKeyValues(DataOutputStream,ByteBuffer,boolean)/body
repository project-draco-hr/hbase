{
  in.rewind();
  ByteBufferUtils.putInt(out,in.limit());
  CompressionState state=new CompressionState();
  while (in.hasRemaining()) {
    compressSingleKeyValue(state,out,in);
    afterEncodingKeyValue(in,out,includesMemstoreTS);
  }
}
