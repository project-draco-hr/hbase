{
  int decompressedSize=in.readInt();
  ByteBuffer buffer=ByteBuffer.allocate(decompressedSize + allocHeaderLength);
  buffer.position(allocHeaderLength);
  CompressionState state=new CompressionState();
  while (in.available() > skipLastBytes) {
    uncompressSingleKeyValue(in,buffer,state);
    afterDecodingKeyValue(in,buffer,includesMemstoreTS);
  }
  if (in.available() != skipLastBytes) {
    throw new IllegalStateException("Read too much bytes.");
  }
  return buffer;
}
