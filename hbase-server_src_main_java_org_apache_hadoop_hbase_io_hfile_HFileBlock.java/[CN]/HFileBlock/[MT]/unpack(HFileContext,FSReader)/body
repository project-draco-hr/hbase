{
  if (!fileContext.isCompressedOrEncrypted()) {
    return this;
  }
  HFileBlock unpacked=new HFileBlock(this);
  unpacked.allocateBuffer();
  HFileBlockDecodingContext ctx=blockType == BlockType.ENCODED_DATA ? reader.getBlockDecodingContext() : reader.getDefaultBlockDecodingContext();
  ctx.prepareDecoding(unpacked.getOnDiskSizeWithoutHeader(),unpacked.getUncompressedSizeWithoutHeader(),unpacked.getBufferWithoutHeader(),this.getBufferReadOnlyWithHeader().array(),this.headerSize());
  if (unpacked.hasNextBlockHeader()) {
    System.arraycopy(this.buf.array(),this.buf.arrayOffset() + this.onDiskDataSizeWithHeader,unpacked.buf.array(),unpacked.buf.arrayOffset() + unpacked.headerSize() + unpacked.uncompressedSizeWithoutHeader+ unpacked.totalChecksumBytes(),unpacked.headerSize());
  }
  return unpacked;
}
