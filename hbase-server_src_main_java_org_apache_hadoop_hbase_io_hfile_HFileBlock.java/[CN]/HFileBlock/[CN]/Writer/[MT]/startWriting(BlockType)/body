{
  if (state == State.BLOCK_READY && startOffset != -1) {
    prevOffsetByType[blockType.getId()]=startOffset;
  }
  startOffset=-1;
  blockType=newBlockType;
  baosInMemory.reset();
  baosInMemory.write(HConstants.HFILEBLOCK_DUMMY_HEADER);
  state=State.WRITING;
  userDataStream=new DataOutputStream(baosInMemory);
  return userDataStream;
}
