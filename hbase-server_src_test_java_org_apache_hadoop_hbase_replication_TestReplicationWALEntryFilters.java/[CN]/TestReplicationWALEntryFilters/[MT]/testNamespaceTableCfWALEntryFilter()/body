{
  ReplicationPeer peer=mock(ReplicationPeer.class);
  when(peer.getNamespaces()).thenReturn(null);
  when(peer.getTableCFs()).thenReturn(null);
  Entry userEntry=createEntry(null,a,b,c);
  WALEntryFilter filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,b,c),filter.filter(userEntry));
  userEntry=createEntry(null,a,b,c);
  Map<TableName,List<String>> tableCfs=new HashMap<TableName,List<String>>();
  when(peer.getTableCFs()).thenReturn(tableCfs);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(null,filter.filter(userEntry));
  userEntry=createEntry(null,a,b,c);
  tableCfs=new HashMap<TableName,List<String>>();
  tableCfs.put(TableName.valueOf("bar"),null);
  when(peer.getTableCFs()).thenReturn(tableCfs);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(null,filter.filter(userEntry));
  userEntry=createEntry(null,a,b,c);
  tableCfs=new HashMap<TableName,List<String>>();
  tableCfs.put(TableName.valueOf("foo"),Lists.newArrayList("a"));
  when(peer.getTableCFs()).thenReturn(tableCfs);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a),filter.filter(userEntry));
  userEntry=createEntry(null,a,b,c,d);
  tableCfs=new HashMap<TableName,List<String>>();
  tableCfs.put(TableName.valueOf("foo"),Lists.newArrayList("a","c"));
  when(peer.getTableCFs()).thenReturn(tableCfs);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,c),filter.filter(userEntry));
  when(peer.getTableCFs()).thenReturn(null);
  Set<String> namespaces=new HashSet<String>();
  when(peer.getNamespaces()).thenReturn(namespaces);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(null,filter.filter(userEntry));
  namespaces.add("default");
  when(peer.getNamespaces()).thenReturn(namespaces);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,b,c),filter.filter(userEntry));
  namespaces=new HashSet<String>();
  ;
  namespaces.add("ns1");
  when(peer.getNamespaces()).thenReturn(namespaces);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(null,filter.filter(userEntry));
  namespaces=new HashSet<String>();
  tableCfs=new HashMap<TableName,List<String>>();
  namespaces.add("ns1");
  when(peer.getNamespaces()).thenReturn(namespaces);
  tableCfs.put(TableName.valueOf("foo"),Lists.newArrayList("a","c"));
  when(peer.getTableCFs()).thenReturn(tableCfs);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,c),filter.filter(userEntry));
  namespaces=new HashSet<String>();
  ;
  tableCfs=new HashMap<TableName,List<String>>();
  namespaces.add("default");
  when(peer.getNamespaces()).thenReturn(namespaces);
  tableCfs.put(TableName.valueOf("ns1:foo"),Lists.newArrayList("a","c"));
  when(peer.getTableCFs()).thenReturn(tableCfs);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,b,c),filter.filter(userEntry));
  namespaces=new HashSet<String>();
  ;
  tableCfs=new HashMap<TableName,List<String>>();
  namespaces.add("ns1");
  when(peer.getNamespaces()).thenReturn(namespaces);
  tableCfs.put(TableName.valueOf("bar"),null);
  when(peer.getTableCFs()).thenReturn(tableCfs);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(null,filter.filter(userEntry));
}
