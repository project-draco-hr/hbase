{
  byte[] TABLE=Bytes.toBytes("testBlocksReadWhenCachingDisabled");
  byte[] FAMILY=Bytes.toBytes("cf1");
  byte[][] FAMILIES=new byte[][]{FAMILY};
  HBaseConfiguration conf=getConf();
  initHRegion(TABLE,getName(),conf,FAMILIES);
  putData(FAMILY,"row","col1",1);
  putData(FAMILY,"row","col2",2);
  region.flushcache();
  long blocksStart=getBlkCount();
  Scan scan=new Scan();
  scan.setCacheBlocks(false);
  RegionScanner rs=region.getScanner(scan);
  List<KeyValue> result=new ArrayList<KeyValue>(2);
  rs.next(result);
  assertEquals(2,result.size());
  rs.close();
  long blocksEnd=getBlkCount();
  assertEquals(blocksStart,blocksEnd);
  blocksStart=blocksEnd;
  scan.setCacheBlocks(true);
  rs=region.getScanner(scan);
  result=new ArrayList<KeyValue>(2);
  rs.next(result);
  assertEquals(2,result.size());
  rs.close();
  blocksEnd=getBlkCount();
  assertEquals(2,blocksEnd - blocksStart);
}
