{
  HRegionServer drainingServer=setDrainingServer(TEST_UTIL.getMiniHBaseCluster().getRegionServer(0));
  try {
    final int regionsOnDrainingServer=drainingServer.getNumberOfOnlineRegions();
    Assert.assertTrue(regionsOnDrainingServer > 0);
    int aborted=0;
    final int numberToAbort=2;
    for (int i=1; i < TEST_UTIL.getMiniHBaseCluster().countServedRegions(); i++) {
      HRegionServer hrs=TEST_UTIL.getMiniHBaseCluster().getRegionServer(i);
      if (hrs.getServerName().equals(drainingServer.getServerName()))       continue;
      hrs.abort("Aborting");
      aborted++;
      if (aborted >= numberToAbort)       break;
    }
    waitForAllRegionsOnline();
    Assert.assertEquals(regionsOnDrainingServer,drainingServer.getNumberOfOnlineRegions());
  }
  finally {
    unsetDrainingServer(drainingServer);
  }
}
