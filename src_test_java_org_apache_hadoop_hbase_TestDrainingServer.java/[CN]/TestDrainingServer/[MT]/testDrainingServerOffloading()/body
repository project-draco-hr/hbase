{
  HMaster master=TEST_UTIL.getMiniHBaseCluster().getMaster();
  HRegionInfo hriToMoveBack=null;
  HRegionServer drainingServer=setDrainingServer(TEST_UTIL.getMiniHBaseCluster().getRegionServer(0));
  try {
    final int regionsOnDrainingServer=drainingServer.getNumberOfOnlineRegions();
    Assert.assertTrue(regionsOnDrainingServer > 0);
    List<HRegionInfo> hris=drainingServer.getOnlineRegions();
    for (    HRegionInfo hri : hris) {
      master.move(hri.getEncodedNameAsBytes(),null);
      hriToMoveBack=hri;
    }
    waitForAllRegionsOnline();
    Assert.assertEquals(0,drainingServer.getNumberOfOnlineRegions());
  }
  finally {
    unsetDrainingServer(drainingServer);
  }
  master.move(hriToMoveBack.getEncodedNameAsBytes(),Bytes.toBytes(drainingServer.getServerName().toString()));
  waitForAllRegionsOnline();
  Assert.assertEquals(1,drainingServer.getNumberOfOnlineRegions());
}
