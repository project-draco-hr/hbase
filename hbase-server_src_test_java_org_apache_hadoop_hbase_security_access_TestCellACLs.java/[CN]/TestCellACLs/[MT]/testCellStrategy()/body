{
  AccessTestAction readQ1Default=new AccessTestAction(){
    @Override public Object run() throws Exception {
      HTable t=new HTable(conf,TEST_TABLE.getTableName());
      try {
        return t.get(new Get(TEST_ROW).addColumn(TEST_FAMILY,TEST_Q1));
      }
  finally {
        t.close();
      }
    }
  }
;
  AccessTestAction readQ2Default=new AccessTestAction(){
    @Override public Object run() throws Exception {
      HTable t=new HTable(conf,TEST_TABLE.getTableName());
      try {
        return t.get(new Get(TEST_ROW).addColumn(TEST_FAMILY,TEST_Q2));
      }
  finally {
        t.close();
      }
    }
  }
;
  AccessTestAction readQ1CellFirst=new AccessTestAction(){
    @Override public Object run() throws Exception {
      HTable t=new HTable(conf,TEST_TABLE.getTableName());
      try {
        Get get=new Get(TEST_ROW).addColumn(TEST_FAMILY,TEST_Q1);
        get.setACLStrategy(true);
        return t.get(get);
      }
  finally {
        t.close();
      }
    }
  }
;
  verifyAllowed(new AccessTestAction(){
    @Override public Object run() throws Exception {
      HTable t=new HTable(conf,TEST_TABLE.getTableName());
      try {
        Put p;
        p=new Put(TEST_ROW).add(TEST_FAMILY,TEST_Q1,ZERO);
        p.setACL(USER_OTHER.getShortName(),new Permission());
        t.put(p);
        p=new Put(TEST_ROW).add(TEST_FAMILY,TEST_Q2,ZERO);
        p.setACL(USER_OTHER.getShortName(),new Permission(Action.READ));
        t.put(p);
      }
  finally {
        t.close();
      }
      return null;
    }
  }
,USER_OWNER);
  verifyDenied(readQ1Default,USER_OTHER);
  verifyAllowed(readQ2Default,USER_OTHER);
  grantOnTable(TEST_UTIL,USER_OTHER.getShortName(),TEST_TABLE.getTableName(),TEST_FAMILY,null,Action.READ);
  verifyAllowed(readQ1Default,USER_OTHER);
  verifyDenied(readQ1CellFirst,USER_OTHER);
}
