{
  Thread.currentThread().setName(clientId);
  Random rand=new Random();
  long endTime=System.currentTimeMillis() + NUM_SECONDS * 1000;
  while (System.currentTimeMillis() < endTime) {
    long id=rand.nextInt(NUM_IDS);
    LOG.info(clientId + " is waiting for id " + id);
    IdLock.Entry lockEntry=idLock.getLockEntry(id);
    try {
      int sleepMs=1 + rand.nextInt(4);
      String owner=idOwner.get(id);
      if (owner != null) {
        LOG.error("Id " + id + " already taken by "+ owner+ ", "+ clientId+ " failed");
        return false;
      }
      idOwner.put(id,clientId);
      LOG.info(clientId + " took id " + id+ ", sleeping for "+ sleepMs+ "ms");
      Thread.sleep(sleepMs);
      LOG.info(clientId + " is releasing id " + id);
      idOwner.remove(id);
    }
  finally {
      idLock.releaseLockEntry(lockEntry);
    }
  }
  return true;
}
