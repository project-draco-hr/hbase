{
  BatchOperationInProgress<Pair<Put,Integer>> batchOp=new BatchOperationInProgress<Pair<Put,Integer>>(putsAndLocks);
  while (!batchOp.isDone()) {
    checkReadOnly();
    checkResources();
    long newSize;
    splitsAndClosesLock.readLock().lock();
    try {
      long addedSize=doMiniBatchPut(batchOp);
      newSize=memstoreSize.addAndGet(addedSize);
    }
  finally {
      splitsAndClosesLock.readLock().unlock();
    }
    if (isFlushSize(newSize)) {
      requestFlush();
    }
  }
  return batchOp.retCodes;
}
