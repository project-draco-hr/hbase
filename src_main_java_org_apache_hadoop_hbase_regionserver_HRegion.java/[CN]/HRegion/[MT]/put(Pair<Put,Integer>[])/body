{
  BatchOperationInProgress<Pair<Put,Integer>> batchOp=new BatchOperationInProgress<Pair<Put,Integer>>(putsAndLocks);
  boolean initialized=false;
  while (!batchOp.isDone()) {
    checkReadOnly();
    checkResources();
    long newSize;
    startRegionOperation();
    try {
      if (!initialized) {
        this.writeRequestsCount.increment();
        doPrePutHook(batchOp);
        initialized=true;
      }
      long addedSize=doMiniBatchPut(batchOp);
      newSize=this.addAndGetGlobalMemstoreSize(addedSize);
    }
  finally {
      closeRegionOperation();
    }
    if (isFlushSize(newSize)) {
      requestFlush();
    }
  }
  return batchOp.retCodeDetails;
}
