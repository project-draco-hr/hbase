{
  ReadWriteConsistencyControl.WriteEntry w=null;
  long size=0;
  try {
    w=rwcc.beginMemstoreInsert();
    for (    Map.Entry<byte[],List<KeyValue>> e : familyMap.entrySet()) {
      byte[] family=e.getKey();
      List<KeyValue> edits=e.getValue();
      Store store=getStore(family);
      for (      KeyValue kv : edits) {
        kv.setMemstoreTS(w.getWriteNumber());
        size+=store.add(kv);
      }
    }
  }
  finally {
    rwcc.completeMemstoreInsert(w);
  }
  return size;
}
