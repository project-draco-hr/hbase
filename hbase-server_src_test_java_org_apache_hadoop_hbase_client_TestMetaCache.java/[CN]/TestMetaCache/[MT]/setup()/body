{
  MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  cluster.getConfiguration().setStrings(HConstants.REGION_SERVER_IMPL,RegionServerWithFakeRpcServices.class.getName());
  JVMClusterUtil.RegionServerThread rsThread=cluster.startRegionServer();
  rsThread.waitForServerOnline();
  badRS=rsThread.getRegionServer();
  assertTrue(badRS.getRSRpcServices() instanceof FakeRSRpcServices);
  cluster.getConfiguration().setStrings(HConstants.REGION_SERVER_IMPL,HRegionServer.class.getName());
  assertEquals(2,cluster.getRegionServerThreads().size());
  conn=(ConnectionImplementation)ConnectionFactory.createConnection(TEST_UTIL.getConfiguration());
  HTableDescriptor table=new HTableDescriptor(TABLE_NAME);
  HColumnDescriptor fam=new HColumnDescriptor(FAMILY);
  fam.setMaxVersions(2);
  table.addFamily(fam);
  try (Admin admin=conn.getAdmin()){
    admin.createTable(table,HBaseTestingUtility.KEYS_FOR_HBA_CREATE_TABLE);
  }
   TEST_UTIL.waitUntilAllRegionsAssigned(TABLE_NAME);
}
