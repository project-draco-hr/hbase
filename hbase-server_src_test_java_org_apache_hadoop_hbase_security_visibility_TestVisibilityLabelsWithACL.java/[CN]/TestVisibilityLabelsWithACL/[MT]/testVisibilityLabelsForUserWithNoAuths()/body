{
  String user="admin";
  String[] auths={SECRET};
  VisibilityClient.clearAuths(conf,auths,user);
  VisibilityClient.setAuths(conf,auths,"user1");
  TableName tableName=TableName.valueOf(TEST_NAME.getMethodName());
  final HTable table=createTableAndWriteDataWithLabels(tableName,SECRET);
  HTable acl=new HTable(conf,AccessControlLists.ACL_TABLE_NAME);
  try {
    BlockingRpcChannel service=acl.coprocessorService(tableName.getName());
    AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(service);
    ProtobufUtil.grant(protocol,NORMAL_USER1.getShortName(),tableName,null,null,Permission.Action.READ);
    ProtobufUtil.grant(protocol,NORMAL_USER2.getShortName(),tableName,null,null,Permission.Action.READ);
  }
  finally {
    acl.close();
  }
  PrivilegedExceptionAction<Void> getAction=new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      Get g=new Get(row1);
      g.setAuthorizations(new Authorizations(SECRET,CONFIDENTIAL));
      HTable t=new HTable(conf,table.getTableName());
      try {
        Result result=t.get(g);
        assertTrue(result.isEmpty());
      }
  finally {
        t.close();
      }
      return null;
    }
  }
;
  NORMAL_USER2.runAs(getAction);
}
