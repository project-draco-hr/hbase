{
  String className=conf.get(MobConstants.MOB_FILE_COMPACTOR_CLASS_KEY,PartitionedMobFileCompactor.class.getName());
  MobFileCompactor compactor=null;
  try {
    compactor=ReflectionUtils.instantiateWithCustomCtor(className,new Class[]{Configuration.class,FileSystem.class,TableName.class,HColumnDescriptor.class,ExecutorService.class},new Object[]{conf,fs,tableName,hcd,pool});
  }
 catch (  Exception e) {
    throw new IOException("Unable to load configured mob file compactor '" + className + "'",e);
  }
  boolean tableLocked=false;
  TableLock lock=null;
  try {
    if (tableLockManager != null) {
      lock=tableLockManager.writeLock(MobUtils.getTableLockName(tableName),"Run MobFileCompaction");
      lock.acquire();
    }
    tableLocked=true;
    compactor.compact(isForceAllFiles);
  }
 catch (  Exception e) {
    LOG.error("Fail to compact the mob files for the column " + hcd.getNameAsString() + " in the table "+ tableName.getNameAsString(),e);
  }
 finally {
    if (lock != null && tableLocked) {
      try {
        lock.release();
      }
 catch (      IOException e) {
        LOG.error("Fail to release the write lock for the table " + tableName.getNameAsString(),e);
      }
    }
  }
}
