{
  LOG.info("START doTestThriftMetrics");
  Configuration conf=UTIL.getConfiguration();
  ThriftMetrics metrics=getMetrics(conf);
  Hbase.Iface handler=getHandlerForMetricsTest(metrics,conf);
  try {
    metricsHelper.assertCounter("createTable_num_ops",2,metrics.getSource());
  }
 catch (  AssertionError e) {
    LOG.info("Got expected assertion error");
  }
  createTestTables(handler);
  dropTestTables(handler);
  metricsHelper.assertCounter("createTable_num_ops",2,metrics.getSource());
  metricsHelper.assertCounter("deleteTable_num_ops",2,metrics.getSource());
  metricsHelper.assertCounter("disableTable_num_ops",2,metrics.getSource());
  handler.getTableNames();
  metricsHelper.assertGaugeGt("getTableNames_avg_time",3L * 1000 * 1000* 1000,metrics.getSource());
  metricsHelper.assertGaugeLt("getTableNames_avg_time",6L * 1000 * 1000* 1000,metrics.getSource());
}
