{
  if (map.isEmpty()) {
    return;
  }
  KeyValue search=candidates.isEmpty() ? kv : candidates.first();
  SortedMap<KeyValue,Object> tail=map.tailMap(search);
  if (!tail.isEmpty() && this.comparator.compareRows(tail.firstKey(),search) <= 0) {
    KeyValue deleted=null;
    KeyValue found=null;
    for (Iterator<Map.Entry<KeyValue,Object>> iterator=tail.entrySet().iterator(); iterator.hasNext() && (found == null || this.comparator.compareRows(found,kv) <= 0); ) {
      found=iterator.next().getKey();
      if (this.comparator.compareRows(found,kv) <= 0) {
        if (found.isDeleteType()) {
          Store.handleDeletes(found,candidates,deletes);
          if (deleted == null) {
            deleted=found;
          }
        }
 else {
          if (Store.notExpiredAndNotInDeletes(this.ttl,found,now,deletes)) {
            candidates.add(found);
          }
 else {
            if (deleted == null) {
              deleted=found;
            }
            iterator.remove();
          }
        }
      }
    }
    if (candidates.isEmpty() && deleted != null) {
      getRowKeyBefore(map,deleted,candidates,deletes,now);
    }
  }
 else {
    getRowKeyBefore(map,search,candidates,deletes,now);
  }
}
