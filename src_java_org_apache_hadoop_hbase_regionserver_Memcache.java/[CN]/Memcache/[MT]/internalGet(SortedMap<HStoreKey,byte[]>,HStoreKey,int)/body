{
  ArrayList<Cell> result=new ArrayList<Cell>();
  long now=System.currentTimeMillis();
  List<HStoreKey> victims=new ArrayList<HStoreKey>();
  SortedMap<HStoreKey,byte[]> tailMap=map.tailMap(key);
  for (  Map.Entry<HStoreKey,byte[]> es : tailMap.entrySet()) {
    HStoreKey itKey=es.getKey();
    if (itKey.matchesRowCol(key)) {
      if (!HLogEdit.isDeleted(es.getValue())) {
        if (ttl == HConstants.FOREVER || now < itKey.getTimestamp() + ttl) {
          result.add(new Cell(tailMap.get(itKey),itKey.getTimestamp()));
        }
 else {
          victims.add(itKey);
          if (LOG.isDebugEnabled()) {
            LOG.debug("internalGet: " + itKey + ": expired, skipped");
          }
        }
      }
    }
    if (numVersions > 0 && result.size() >= numVersions) {
      break;
    }
  }
  for (  HStoreKey v : victims)   map.remove(v);
  return result;
}
