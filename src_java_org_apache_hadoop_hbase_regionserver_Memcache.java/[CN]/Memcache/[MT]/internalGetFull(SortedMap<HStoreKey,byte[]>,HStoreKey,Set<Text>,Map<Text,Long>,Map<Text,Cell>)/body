{
  if (map.isEmpty() || key == null) {
    return;
  }
  List<HStoreKey> victims=new ArrayList<HStoreKey>();
  SortedMap<HStoreKey,byte[]> tailMap=map.tailMap(key);
  long now=System.currentTimeMillis();
  for (  Map.Entry<HStoreKey,byte[]> es : tailMap.entrySet()) {
    HStoreKey itKey=es.getKey();
    Text itCol=itKey.getColumn();
    if (results.get(itCol) == null && key.matchesWithoutColumn(itKey)) {
      byte[] val=tailMap.get(itKey);
      if (columns == null || columns.contains(itKey.getColumn())) {
        if (HLogEdit.isDeleted(val)) {
          if (!deletes.containsKey(itCol) || deletes.get(itCol).longValue() < itKey.getTimestamp()) {
            deletes.put(new Text(itCol),Long.valueOf(itKey.getTimestamp()));
          }
        }
 else         if (!(deletes.containsKey(itCol) && deletes.get(itCol).longValue() >= itKey.getTimestamp())) {
          if (ttl == HConstants.FOREVER || now < itKey.getTimestamp() + ttl) {
            results.put(new Text(itCol),new Cell(val,itKey.getTimestamp()));
          }
 else {
            victims.add(itKey);
            if (LOG.isDebugEnabled()) {
              LOG.debug("internalGetFull: " + itKey + ": expired, skipped");
            }
          }
        }
      }
    }
 else     if (key.getRow().compareTo(itKey.getRow()) < 0) {
      break;
    }
  }
  for (  HStoreKey v : victims)   map.remove(v);
}
