{
  this.lock.writeLock().lock();
  try {
    if (this.snapshot != ss) {
      throw new UnexpectedException("Current snapshot is " + this.snapshot + ", was passed "+ ss);
    }
    if (ss.size() != 0) {
      this.snapshot=createSynchronizedSortedMap(this.comparator);
    }
  }
  finally {
    this.lock.writeLock().unlock();
  }
}
