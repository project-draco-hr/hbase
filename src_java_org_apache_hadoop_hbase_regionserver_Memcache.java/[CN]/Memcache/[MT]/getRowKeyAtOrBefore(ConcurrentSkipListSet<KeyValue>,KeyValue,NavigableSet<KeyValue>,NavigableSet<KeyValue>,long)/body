{
  if (set.isEmpty()) {
    return;
  }
  KeyValue search=candidates.isEmpty() ? kv : candidates.first();
  SortedSet<KeyValue> tailset=set.tailSet(search);
  if (!tailset.isEmpty() && this.comparator.compareRows(tailset.first(),search) <= 0) {
    KeyValue deleted=null;
    KeyValue found=null;
    for (Iterator<KeyValue> iterator=tailset.iterator(); iterator.hasNext() && (found == null || this.comparator.compareRows(found,kv) <= 0); ) {
      found=iterator.next();
      if (this.comparator.compareRows(found,kv) <= 0) {
        if (found.isDeleteType()) {
          Store.handleDeletes(found,candidates,deletes);
          if (deleted == null) {
            deleted=found;
          }
        }
 else {
          if (Store.notExpiredAndNotInDeletes(this.ttl,found,now,deletes)) {
            candidates.add(found);
          }
 else {
            if (deleted == null) {
              deleted=found;
            }
            iterator.remove();
          }
        }
      }
    }
    if (candidates.isEmpty() && deleted != null) {
      getRowKeyBefore(set,deleted,candidates,deletes,now);
    }
  }
 else {
    getRowKeyBefore(set,search,candidates,deletes,now);
  }
}
