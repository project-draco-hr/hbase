{
  long ts=EnvironmentEdgeManager.currentTime();
  byte[] key0=Bytes.toBytes("k0");
  byte[] key1=Bytes.toBytes("k1");
  String value="mobValue";
  String newValue="new";
  Put put0=new Put(key0);
  put0.addColumn(Bytes.toBytes(family1),Bytes.toBytes(qf1),ts,Bytes.toBytes(value));
  loadData(admin,bufMut,tableName,new Put[]{put0});
  Put put1=new Put(key1);
  put1.addColumn(Bytes.toBytes(family1),Bytes.toBytes(qf1),ts,Bytes.toBytes(value));
  loadData(admin,bufMut,tableName,new Put[]{put1});
  put1=new Put(key1);
  put1.addColumn(Bytes.toBytes(family1),Bytes.toBytes(qf1),ts,Bytes.toBytes(newValue));
  loadData(admin,bufMut,tableName,new Put[]{put1});
  admin.majorCompact(tableName);
  waitUntilCompactionFinished(tableName);
  admin.majorCompactMob(tableName,hcd1.getName());
  waitUntilMobCompactionFinished(tableName);
  Get get=new Get(key1);
  Result result=hTable.get(get);
  Cell cell=result.getColumnLatestCell(hcd1.getName(),Bytes.toBytes(qf1));
  assertEquals("After compaction: mob value","new",Bytes.toString(CellUtil.cloneValue(cell)));
}
