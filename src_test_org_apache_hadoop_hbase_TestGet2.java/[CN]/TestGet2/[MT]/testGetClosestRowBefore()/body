{
  HRegion region=null;
  HRegionIncommon region_incommon=null;
  try {
    HTableDescriptor htd=createTableDescriptor(getName());
    HRegionInfo hri=new HRegionInfo(htd,null,null);
    region=createNewHRegion(htd,null,null);
    region_incommon=new HRegionIncommon(region);
    Text t10=new Text("010");
    Text t20=new Text("020");
    Text t30=new Text("030");
    Text t40=new Text("040");
    long lockid=region_incommon.startBatchUpdate(t10);
    region_incommon.put(lockid,COLUMNS[0],"t10 bytes".getBytes());
    region_incommon.commit(lockid);
    lockid=region_incommon.startBatchUpdate(t20);
    region_incommon.put(lockid,COLUMNS[0],"t20 bytes".getBytes());
    region_incommon.commit(lockid);
    lockid=region_incommon.startBatchUpdate(t30);
    region_incommon.put(lockid,COLUMNS[0],"t30 bytes".getBytes());
    region_incommon.commit(lockid);
    lockid=region_incommon.startBatchUpdate(t40);
    region_incommon.put(lockid,COLUMNS[0],"t40 bytes".getBytes());
    region_incommon.commit(lockid);
    Text t15=new Text("015");
    Map<Text,byte[]> results=region.getClosestRowBefore(t15,HConstants.LATEST_TIMESTAMP);
    assertEquals(new String(results.get(COLUMNS[0])),"t10 bytes");
    results=region.getClosestRowBefore(t20,HConstants.LATEST_TIMESTAMP);
    assertEquals(new String(results.get(COLUMNS[0])),"t20 bytes");
    Text t50=new Text("050");
    results=region.getClosestRowBefore(t50,HConstants.LATEST_TIMESTAMP);
    assertEquals(new String(results.get(COLUMNS[0])),"t40 bytes");
    region.flushcache();
    results=region.getClosestRowBefore(t15,HConstants.LATEST_TIMESTAMP);
    assertEquals(new String(results.get(COLUMNS[0])),"t10 bytes");
    results=region.getClosestRowBefore(t20,HConstants.LATEST_TIMESTAMP);
    assertEquals(new String(results.get(COLUMNS[0])),"t20 bytes");
    results=region.getClosestRowBefore(t50,HConstants.LATEST_TIMESTAMP);
    assertEquals(new String(results.get(COLUMNS[0])),"t40 bytes");
  }
  finally {
    if (region != null) {
      try {
        region.close();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
      region.getLog().closeAndDelete();
    }
  }
}
