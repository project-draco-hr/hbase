{
  if (LOG.isTraceEnabled()) {
    LOG.trace("Checking directory: " + toCheck);
  }
  FileStatus[] children=FSUtils.listStatus(fs,toCheck);
  if (children == null) {
    try {
      return fs.delete(toCheck,false);
    }
 catch (    IOException e) {
      if (LOG.isTraceEnabled()) {
        LOG.trace("Couldn't delete directory: " + toCheck,e);
      }
    }
    return false;
  }
  boolean canDeleteThis=true;
  for (  FileStatus child : children) {
    Path path=child.getPath();
    if (child.isDir()) {
      if (!checkAndDeleteDirectory(path)) {
        canDeleteThis=false;
      }
    }
 else     if (!checkAndDelete(child)) {
      canDeleteThis=false;
    }
  }
  if (!canDeleteThis)   return false;
  try {
    return fs.delete(toCheck,false);
  }
 catch (  IOException e) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("Couldn't delete directory: " + toCheck,e);
    }
  }
  return false;
}
