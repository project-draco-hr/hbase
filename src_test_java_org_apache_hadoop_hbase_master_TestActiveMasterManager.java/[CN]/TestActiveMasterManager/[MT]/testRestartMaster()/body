{
  ZooKeeperWatcher zk=new ZooKeeperWatcher(TEST_UTIL.getConfiguration(),"testActiveMasterManagerFromZK",null);
  ZKUtil.createAndFailSilent(zk,zk.baseZNode);
  try {
    ZKUtil.deleteNode(zk,zk.masterAddressZNode);
  }
 catch (  KeeperException.NoNodeException nne) {
  }
  HServerAddress master=new HServerAddress("localhost",1);
  DummyMaster dummyMaster=new DummyMaster();
  ActiveMasterManager activeMasterManager=new ActiveMasterManager(zk,master,dummyMaster);
  zk.registerListener(activeMasterManager);
  assertFalse(activeMasterManager.clusterHasActiveMaster.get());
  activeMasterManager.blockUntilBecomingActiveMaster();
  assertTrue(activeMasterManager.clusterHasActiveMaster.get());
  assertMaster(zk,master);
  DummyMaster secondDummyMaster=new DummyMaster();
  ActiveMasterManager secondActiveMasterManager=new ActiveMasterManager(zk,master,secondDummyMaster);
  zk.registerListener(secondActiveMasterManager);
  assertFalse(secondActiveMasterManager.clusterHasActiveMaster.get());
  activeMasterManager.blockUntilBecomingActiveMaster();
  assertTrue(activeMasterManager.clusterHasActiveMaster.get());
  assertMaster(zk,master);
}
