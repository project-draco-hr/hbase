{
  long maxSize=1000000;
  long blockSize=calculateBlockSizeDefault(maxSize,101);
  LruBlockCache cache=new LruBlockCache(maxSize,blockSize);
  CachedItem[] blocks=generateRandomBlocks(100,blockSize);
  long expectedCacheSize=cache.heapSize();
  for (  CachedItem block : blocks) {
    assertTrue(cache.getBlock(block.cacheKey,true,false) == null);
  }
  for (  CachedItem block : blocks) {
    cache.cacheBlock(block.cacheKey,block);
    expectedCacheSize+=block.cacheBlockHeapSize();
  }
  assertEquals(expectedCacheSize,cache.heapSize());
  for (  CachedItem block : blocks) {
    HeapSize buf=cache.getBlock(block.cacheKey,true,false);
    assertTrue(buf != null);
    assertEquals(buf.heapSize(),block.heapSize());
  }
  assertEquals(expectedCacheSize,cache.heapSize());
  for (  CachedItem block : blocks) {
    HeapSize buf=cache.getBlock(block.cacheKey,true,false);
    assertTrue(buf != null);
    assertEquals(buf.heapSize(),block.heapSize());
  }
  assertEquals(0,cache.getEvictionCount());
  Thread t=new LruBlockCache.StatisticsThread(cache);
  t.start();
  t.join();
}
