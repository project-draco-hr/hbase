{
  TEST_UTIL=new HBaseTestingUtility();
  Configuration conf=TEST_UTIL.getConfiguration();
  conf.set("hbase.coprocessor.region.classes",IdentityCoprocessor.class.getName());
  TEST_UTIL.startMiniCluster();
  HRegionServer rs=TEST_UTIL.getMiniHBaseCluster().getRegionServer(0);
  secretManager=new AuthenticationTokenSecretManager(conf,rs.getZooKeeper(),rs.getServerName().toString(),conf.getLong("hbase.auth.key.update.interval",24 * 60 * 60* 1000),conf.getLong("hbase.auth.token.max.lifetime",7 * 24 * 60* 60* 1000));
  secretManager.start();
  while (secretManager.getCurrentKey() == null) {
    Thread.sleep(1);
  }
}
