{
  Preconditions.checkNotNull(server);
  if (server.isStopped()) {
    return;
  }
  try {
    long start=EnvironmentEdgeManager.currentTimeMillis();
    boolean completed=r.compact(this);
    long now=EnvironmentEdgeManager.currentTimeMillis();
    LOG.info(((completed) ? "completed" : "aborted") + " compaction: " + this+ "; duration="+ StringUtils.formatTimeDiff(now,start));
    if (completed) {
      if (s.getCompactPriority() <= 0) {
        server.compactSplitThread.requestCompaction(r,s,"Recursive enqueue");
      }
 else {
        server.compactSplitThread.requestSplit(r);
      }
    }
  }
 catch (  IOException ex) {
    LOG.error("Compaction failed " + this,RemoteExceptionHandler.checkIOException(ex));
    server.checkFileSystem();
  }
catch (  Exception ex) {
    LOG.error("Compaction failed " + this,ex);
    server.checkFileSystem();
  }
 finally {
    s.finishRequest(this);
    LOG.debug("CompactSplitThread Status: " + server.compactSplitThread);
  }
}
