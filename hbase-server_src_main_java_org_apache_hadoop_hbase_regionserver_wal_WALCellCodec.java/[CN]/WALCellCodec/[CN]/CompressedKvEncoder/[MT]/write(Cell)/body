{
  if (!(cell instanceof KeyValue))   throw new IOException("Cannot write non-KV cells to WAL");
  KeyValue kv=(KeyValue)cell;
  byte[] kvBuffer=kv.getBuffer();
  int offset=kv.getOffset();
  StreamUtils.writeRawVInt32(out,kv.getKeyLength());
  StreamUtils.writeRawVInt32(out,kv.getValueLength());
  StreamUtils.writeRawVInt32(out,kv.getTagsLength());
  write(kvBuffer,kv.getRowOffset(),kv.getRowLength(),compression.rowDict);
  write(kvBuffer,kv.getFamilyOffset(),kv.getFamilyLength(),compression.familyDict);
  write(kvBuffer,kv.getQualifierOffset(),kv.getQualifierLength(),compression.qualifierDict);
  int pos=kv.getTimestampOffset();
  int remainingLength=kv.getLength() + offset - pos;
  out.write(kvBuffer,pos,remainingLength);
}
