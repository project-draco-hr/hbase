{
  if (this.out == null)   return;
  long startTimeNs=System.nanoTime();
  int size=releaseCompressingStream(this.out);
  this.out=null;
  blockKeys.add(firstKeyInBlock);
  blockOffsets.add(Long.valueOf(blockBegin));
  blockDataSizes.add(Integer.valueOf(size));
  this.totalUncompressedBytes+=size;
  HFile.offerWriteLatency(System.nanoTime() - startTimeNs);
  if (cacheConf.shouldCacheDataOnWrite()) {
    baosDos.flush();
    byte[] bytes=baos.toByteArray();
    HFileBlock block=new HFileBlock(BlockType.DATA,(int)(outputStream.getPos() - blockBegin),bytes.length,-1,ByteBuffer.wrap(bytes,0,bytes.length),HFileBlock.FILL_HEADER,blockBegin,MemStore.NO_PERSISTENT_TS,HFileBlock.MINOR_VERSION_NO_CHECKSUM,0,ChecksumType.NULL.getCode(),(int)(outputStream.getPos() - blockBegin) + HFileBlock.HEADER_SIZE_NO_CHECKSUM);
    block=blockEncoder.diskToCacheFormat(block,false);
    cacheConf.getBlockCache().cacheBlock(new BlockCacheKey(name,blockBegin,DataBlockEncoding.NONE,block.getBlockType()),block);
    baosDos.close();
  }
  blockNumber++;
}
