{
  final byte[] FAMILY=Bytes.toBytes("family");
  HTableDescriptor htd=new HTableDescriptor("testMasterCrashDuringMetaMigration");
  HColumnDescriptor hcd=new HColumnDescriptor(FAMILY);
  htd.addFamily(hcd);
  Configuration conf=TEST_UTIL.getConfiguration();
  createMultiRegionsWithPBSerialization(conf,htd.getName(),10);
  createMultiRegionsWithWritableSerialization(conf,htd.getName(),10);
  CatalogTracker ct=TEST_UTIL.getMiniHBaseCluster().getMaster().getCatalogTracker();
  undoVersionInRoot(ct);
  MetaReader.fullScanMetaAndPrint(ct);
  LOG.info("Meta Print completed.testUpdatesOnMetaWithLegacyHRI");
  long numMigratedRows=MetaMigrationConvertingToPB.updateRootAndMetaIfNecessary(TEST_UTIL.getHBaseCluster().getMaster());
  assertEquals(numMigratedRows,10);
  boolean metaUpdated=MetaMigrationConvertingToPB.isMetaHRIUpdated(TEST_UTIL.getMiniHBaseCluster().getMaster().getCatalogTracker());
  assertEquals(true,metaUpdated);
  verifyMetaRowsAreUpdated(ct);
  LOG.info("END testMasterCrashDuringMetaMigration");
}
