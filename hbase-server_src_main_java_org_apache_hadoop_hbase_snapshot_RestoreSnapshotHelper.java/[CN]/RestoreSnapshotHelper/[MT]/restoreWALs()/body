{
  final SnapshotLogSplitter logSplitter=new SnapshotLogSplitter(conf,fs,tableDir,Bytes.toBytes(snapshotDesc.getTable()),regionsMap);
  try {
    SnapshotReferenceUtil.visitRecoveredEdits(fs,snapshotDir,new FSVisitor.RecoveredEditsVisitor(){
      public void recoveredEdits(      final String region,      final String logfile) throws IOException {
        Path path=SnapshotReferenceUtil.getRecoveredEdits(snapshotDir,region,logfile);
        logSplitter.splitRecoveredEdit(path);
      }
    }
);
    SnapshotReferenceUtil.visitLogFiles(fs,snapshotDir,new FSVisitor.LogFileVisitor(){
      public void logFile(      final String server,      final String logfile) throws IOException {
        logSplitter.splitLog(server,logfile);
      }
    }
);
  }
  finally {
    logSplitter.close();
  }
}
