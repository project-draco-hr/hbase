{
  try {
    if (tables.isEmpty() || tables.containsKey(key.getTablename())) {
      TableName targetTable=tables.isEmpty() ? key.getTablename() : tables.get(key.getTablename());
      ImmutableBytesWritable tableOut=new ImmutableBytesWritable(targetTable.getName());
      Put put=null;
      Delete del=null;
      KeyValue lastKV=null;
      for (      KeyValue kv : value.getKeyValues()) {
        if (WALEdit.isMetaEditFamily(kv.getFamily()))         continue;
        if (lastKV == null || lastKV.getType() != kv.getType() || !CellUtil.matchingRow(lastKV,kv)) {
          if (put != null)           context.write(tableOut,put);
          if (del != null)           context.write(tableOut,del);
          if (kv.isDelete()) {
            del=new Delete(kv.getRow());
          }
 else {
            put=new Put(kv.getRow());
          }
        }
        if (kv.isDelete()) {
          del.addDeleteMarker(kv);
        }
 else {
          put.add(kv);
        }
        lastKV=kv;
      }
      if (put != null)       context.write(tableOut,put);
      if (del != null)       context.write(tableOut,del);
    }
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
}
