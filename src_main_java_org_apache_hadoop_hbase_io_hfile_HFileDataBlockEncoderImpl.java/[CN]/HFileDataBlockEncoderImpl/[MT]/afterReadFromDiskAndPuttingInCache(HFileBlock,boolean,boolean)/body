{
  if (ignoreBlock(block)) {
    return block;
  }
  if (dontEncodeBeforeCompaction(isCompaction)) {
    if (block.getBlockType() != BlockType.DATA) {
      return decodeDataBlock(block,true,inCache.getId(),includesMemstoreTS);
    }
    return block;
  }
  if (!encodedSeek) {
    if (block.getBlockType() != BlockType.DATA) {
      return decodeDataBlock(block,true,inCache.getId(),includesMemstoreTS);
    }
    return block;
  }
  if (block.getBlockType() == BlockType.ENCODED_DATA && block.getDataBlockEncodingId() == inCache.getId()) {
    return block;
  }
  if (block.getBlockType() == BlockType.ENCODED_DATA) {
    throw new IllegalStateException("Unexpected encoding");
  }
  if (inCache != DataBlockEncodings.Algorithm.NONE) {
    return encodeDataBlock(block,inCache,includesMemstoreTS);
  }
  return block;
}
