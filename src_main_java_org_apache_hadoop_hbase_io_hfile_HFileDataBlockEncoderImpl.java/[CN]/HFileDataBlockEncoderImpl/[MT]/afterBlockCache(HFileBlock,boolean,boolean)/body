{
  if (block == null || ignoreBlock(block)) {
    return block;
  }
  if (inCache == DataBlockEncodings.Algorithm.NONE) {
    if (block.getBlockType() == BlockType.ENCODED_DATA) {
      throw new IllegalStateException("Expected non-encoded data in cache.");
    }
    return block;
  }
  if (block.getBlockType() != BlockType.ENCODED_DATA) {
    throw new IllegalStateException("Expected encoded data in cache.");
  }
  if (dontEncodeBeforeCompaction(isCompaction)) {
    return null;
  }
  if (encodedSeek) {
    return block;
  }
  return decodeDataBlock(block,true,inCache.getId(),includesMemstoreTS);
}
