{
  regions.removeAll(regions);
  for (int i=0; i < 100; i++) {
    regions.add("region__" + i);
  }
  generateHLogs(1,100,-1);
  fs.initialize(fs.getUri(),conf);
  HLogSplitter logSplitter=HLogSplitter.createLogSplitter(conf,hbaseDir,hlogDir,oldLogDir,fs);
  logSplitter.splitLog();
  fs.rename(oldLogDir,hlogDir);
  Path firstSplitPath=new Path(hbaseDir,Bytes.toString(TABLE_NAME) + ".first");
  Path splitPath=new Path(hbaseDir,Bytes.toString(TABLE_NAME));
  fs.rename(splitPath,firstSplitPath);
  fs.initialize(fs.getUri(),conf);
  logSplitter=HLogSplitter.createLogSplitter(conf,hbaseDir,hlogDir,oldLogDir,fs);
  logSplitter.splitLog();
  assertEquals(0,compareHLogSplitDirs(firstSplitPath,splitPath));
}
