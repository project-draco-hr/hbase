{
  conf.setBoolean(HBASE_SKIP_ERRORS,true);
  Class<?> backupClass=conf.getClass("hbase.regionserver.hlog.reader.impl",Reader.class);
  InstrumentedSequenceFileLogWriter.activateFailure=false;
  HLog.resetLogReaderClass();
  try {
    Path c1=new Path(hlogDir,HLOG_FILE_PREFIX + "0");
    conf.setClass("hbase.regionserver.hlog.reader.impl",FaultySequenceFileLogReader.class,HLog.Reader.class);
    String[] failureTypes={"begin","middle","end"};
    for (    FaultySequenceFileLogReader.FailureType failureType : FaultySequenceFileLogReader.FailureType.values()) {
      conf.set("faultysequencefilelogreader.failuretype",failureType.name());
      generateHLogs(1,ENTRIES,-1);
      fs.initialize(fs.getUri(),conf);
      HLogSplitter logSplitter=HLogSplitter.createLogSplitter(conf);
      logSplitter.splitLog(hbaseDir,hlogDir,oldLogDir,fs,conf);
      FileStatus[] archivedLogs=fs.listStatus(corruptDir);
      assertEquals("expected a different file",c1.getName(),archivedLogs[0].getPath().getName());
      assertEquals(archivedLogs.length,1);
      fs.delete(new Path(oldLogDir,HLOG_FILE_PREFIX + "0"),false);
    }
  }
  finally {
    conf.setClass("hbase.regionserver.hlog.reader.impl",backupClass,Reader.class);
    HLog.resetLogReaderClass();
  }
}
