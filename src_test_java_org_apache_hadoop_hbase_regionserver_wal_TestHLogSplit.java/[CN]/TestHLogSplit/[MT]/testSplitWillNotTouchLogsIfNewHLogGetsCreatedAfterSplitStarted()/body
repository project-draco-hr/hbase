{
  AtomicBoolean stop=new AtomicBoolean(false);
  generateHLogs(-1);
  fs.initialize(fs.getUri(),conf);
  Thread zombie=new ZombieNewLogWriterRegionServer(stop);
  try {
    zombie.start();
    try {
      HLogSplitter logSplitter=HLogSplitter.createLogSplitter(conf);
      logSplitter.splitLog(hbaseDir,hlogDir,oldLogDir,fs,conf);
    }
 catch (    IOException ex) {
    }
    int logFilesNumber=fs.listStatus(hlogDir).length;
    assertEquals("Log files should not be archived if there's an extra file after split",NUM_WRITERS + 1,logFilesNumber);
  }
  finally {
    stop.set(true);
  }
}
