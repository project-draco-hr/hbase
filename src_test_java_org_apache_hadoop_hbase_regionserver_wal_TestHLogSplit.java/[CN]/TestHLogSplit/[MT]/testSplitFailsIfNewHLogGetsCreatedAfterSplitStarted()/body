{
  AtomicBoolean stop=new AtomicBoolean(false);
  generateHLogs(-1);
  fs.initialize(fs.getUri(),conf);
  try {
    (new ZombieNewLogWriterRegionServer(stop)).start();
    HLogSplitter logSplitter=HLogSplitter.createLogSplitter(conf);
    logSplitter.splitLog(hbaseDir,hlogDir,oldLogDir,fs,conf);
  }
  finally {
    stop.set(true);
  }
}
