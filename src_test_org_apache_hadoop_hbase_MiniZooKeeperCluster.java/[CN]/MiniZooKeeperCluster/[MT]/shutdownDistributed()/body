{
  for (  QuorumPeer qp : quorumPeers) {
    qp.shutdown();
    qp.join(CONNECTION_TIMEOUT);
    if (qp.isAlive()) {
      throw new IOException("QuorumPeer " + qp.getId() + " failed to shutdown");
    }
  }
  for (int id=1; id <= quorumPeers.length; ++id) {
    int port=clientPortStart + id;
    if (!waitForServerDown(port,CONNECTION_TIMEOUT)) {
      throw new IOException("Waiting for shutdown of peer " + id);
    }
  }
}
