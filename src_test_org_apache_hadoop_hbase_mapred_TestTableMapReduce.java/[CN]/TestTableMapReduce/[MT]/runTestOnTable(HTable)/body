{
  @SuppressWarnings("deprecation") MiniMRCluster mrCluster=new MiniMRCluster(2,fs.getUri().toString(),1);
  JobConf jobConf=null;
  try {
    LOG.info("Before map/reduce startup");
    jobConf=new JobConf(conf,TestTableMapReduce.class);
    jobConf.setJobName("process column contents");
    jobConf.setNumReduceTasks(1);
    TableMap.initJob(table.getTableName().toString(),INPUT_COLUMN,ProcessContentsMapper.class,Text.class,BatchUpdate.class,jobConf);
    TableReduce.initJob(table.getTableName().toString(),IdentityTableReduce.class,jobConf);
    LOG.info("Started " + table.getTableName());
    JobClient.runJob(jobConf);
    LOG.info("After map/reduce completion");
    verify(table.getTableName().toString());
  }
  finally {
    mrCluster.shutdown();
    if (jobConf != null) {
      FileUtil.fullyDelete(new File(jobConf.get("hadoop.tmp.dir")));
    }
  }
}
