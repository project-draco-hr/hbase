{
  HTableDescriptor desc=new HTableDescriptor(MULTI_REGION_TABLE_NAME);
  desc.addFamily(new HColumnDescriptor(INPUT_COLUMN));
  desc.addFamily(new HColumnDescriptor(OUTPUT_COLUMN));
  HBaseAdmin admin=new HBaseAdmin(this.conf);
  admin.createTable(desc);
  makeMultiRegionTable(conf,hCluster,fs,MULTI_REGION_TABLE_NAME,INPUT_COLUMN);
  HTable table=new HTable(conf,new Text(MULTI_REGION_TABLE_NAME));
  try {
    Text[] startKeys=table.getStartKeys();
    assertTrue(startKeys.length > 1);
    @SuppressWarnings("deprecation") MiniMRCluster mrCluster=new MiniMRCluster(2,fs.getUri().toString(),1);
    try {
      JobConf jobConf=new JobConf(conf,TestTableMapReduce.class);
      jobConf.setJobName("process column contents");
      jobConf.setNumMapTasks(2);
      jobConf.setNumReduceTasks(1);
      TableMap.initJob(MULTI_REGION_TABLE_NAME,INPUT_COLUMN,ProcessContentsMapper.class,jobConf);
      TableReduce.initJob(MULTI_REGION_TABLE_NAME,IdentityTableReduce.class,jobConf);
      LOG.info("Started " + MULTI_REGION_TABLE_NAME);
      JobClient.runJob(jobConf);
      verify(MULTI_REGION_TABLE_NAME);
    }
  finally {
      mrCluster.shutdown();
    }
  }
  finally {
    table.close();
  }
}
