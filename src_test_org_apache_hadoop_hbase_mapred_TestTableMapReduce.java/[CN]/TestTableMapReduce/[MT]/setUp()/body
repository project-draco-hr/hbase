{
  super.setUp();
  conf.setLong("hbase.hregion.max.filesize",256 * 1024);
  dfsCluster=new MiniDFSCluster(conf,1,true,(String[])null);
  try {
    fs=dfsCluster.getFileSystem();
    dir=new Path("/hbase");
    fs.mkdirs(dir);
    hCluster=new MiniHBaseCluster(conf,1,dfsCluster);
    LOG.info("Master is at " + this.conf.get(HConstants.MASTER_ADDRESS));
  }
 catch (  Exception e) {
    if (dfsCluster != null) {
      dfsCluster.shutdown();
      dfsCluster=null;
    }
    throw e;
  }
}
