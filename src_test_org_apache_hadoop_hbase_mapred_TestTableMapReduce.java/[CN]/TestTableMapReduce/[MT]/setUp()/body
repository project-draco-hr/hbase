{
  dfsCluster=new MiniDFSCluster(conf,1,true,(String[])null);
  this.conf.set(HConstants.HBASE_DIR,this.dfsCluster.getFileSystem().getHomeDirectory().toString());
  super.setUp();
  try {
    dir=new Path("/hbase");
    fs.mkdirs(dir);
    hCluster=new MiniHBaseCluster(conf,1,dfsCluster,true);
    LOG.info("Master is at " + this.conf.get(HConstants.MASTER_ADDRESS));
  }
 catch (  Exception e) {
    StaticTestEnvironment.shutdownDfs(dfsCluster);
    throw e;
  }
}
