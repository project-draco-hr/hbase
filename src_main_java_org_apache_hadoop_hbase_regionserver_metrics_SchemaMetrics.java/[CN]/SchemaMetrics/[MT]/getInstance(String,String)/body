{
  if (tableName == null) {
    tableName=UNKNOWN;
  }
  if (!tableName.equals(TOTAL_KEY)) {
    if (useTableNameGlobally == null) {
      throw new IllegalStateException("The value of the " + SHOW_TABLE_NAME_CONF_KEY + " conf option has not been specified "+ "in SchemaMetrics");
    }
    final boolean useTableName=useTableNameGlobally;
    if (!useTableName) {
      tableName=TOTAL_KEY;
    }
  }
  if (cfName == null) {
    cfName=UNKNOWN;
  }
  final String instanceKey=tableName + "\t" + cfName;
  SchemaMetrics schemaMetrics=cfToMetrics.get(instanceKey);
  if (schemaMetrics != null) {
    return schemaMetrics;
  }
  schemaMetrics=new SchemaMetrics(tableName,cfName);
  SchemaMetrics existingMetrics=cfToMetrics.putIfAbsent(instanceKey,schemaMetrics);
  return existingMetrics != null ? existingMetrics : schemaMetrics;
}
