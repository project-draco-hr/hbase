{
  RPCProtos.ConnectionHeader.Builder headerBuilder=RPCProtos.ConnectionHeader.newBuilder().setServiceName(serviceName);
  RPCProtos.UserInformation userInfoPB=buildUserInfo(ticket.getUGI(),authMethod);
  if (userInfoPB != null) {
    headerBuilder.setUserInfo(userInfoPB);
  }
  if (client.codec != null) {
    headerBuilder.setCellBlockCodecClass(client.codec.getClass().getCanonicalName());
  }
  if (client.compressor != null) {
    headerBuilder.setCellBlockCompressorClass(client.compressor.getClass().getCanonicalName());
  }
  headerBuilder.setVersionInfo(ProtobufUtil.getVersionInfo());
  return headerBuilder.build();
}
