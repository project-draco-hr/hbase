{
  HConnection previousConnection=null;
  for (int i=0; i < HConnectionManager.MAX_CACHED_HBASE_INSTANCES + 10; i++) {
    Configuration configuration=TEST_UTIL.getConfiguration();
    configuration.set("some_key",String.valueOf(_randy.nextInt()));
    configuration.set(HConstants.HBASE_CLIENT_INSTANCE_ID,String.valueOf(_randy.nextInt()));
    LOG.info("The hash code of the current configuration is: " + configuration.hashCode());
    HConnection currentConnection=HConnectionManager.getConnection(configuration);
    if (previousConnection != null) {
      assertTrue("Got the same connection even though its key changed!",previousConnection != currentConnection);
    }
    configuration.set("other_key",String.valueOf(_randy.nextInt()));
    previousConnection=currentConnection;
    LOG.info("The current HConnectionManager#HBASE_INSTANCES cache size is: " + getHConnectionManagerCacheSize());
    Thread.sleep(50);
  }
}
