{
  Configuration configuration=TEST_UTIL.getConfiguration();
  configuration.set(HConstants.HBASE_CLIENT_INSTANCE_ID,String.valueOf(_randy.nextInt()));
  HConnection c1=HConnectionManager.createConnection(configuration);
  HConnection c2=HConnectionManager.createConnection(configuration);
  HConnection c3=HConnectionManager.getConnection(configuration);
  HConnection c4=HConnectionManager.getConnection(configuration);
  assertTrue(c3 == c4);
  c1.close();
  assertTrue(c1.isClosed());
  assertFalse(c2.isClosed());
  assertFalse(c3.isClosed());
  c3.close();
  assertFalse(c3.isClosed());
  c3.close();
  assertTrue(c3.isClosed());
  assertTrue(HConnectionManager.getConnection(configuration) != c3);
  assertFalse(c2.isClosed());
}
