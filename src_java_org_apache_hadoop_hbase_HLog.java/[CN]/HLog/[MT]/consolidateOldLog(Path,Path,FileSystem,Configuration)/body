{
  LOG.debug("consolidating log files");
  Path logfiles[]=fs.listPaths(srcDir);
  SequenceFile.Writer newlog=SequenceFile.createWriter(fs,conf,dstFile,HLogKey.class,HLogEdit.class);
  try {
    for (int i=0; i < logfiles.length; i++) {
      SequenceFile.Reader in=new SequenceFile.Reader(fs,logfiles[i],conf);
      try {
        HLogKey key=new HLogKey();
        HLogEdit val=new HLogEdit();
        while (in.next(key,val)) {
          newlog.append(key,val);
        }
      }
  finally {
        in.close();
      }
    }
  }
  finally {
    newlog.close();
  }
  if (fs.exists(srcDir)) {
    if (!fs.delete(srcDir)) {
      LOG.error("Cannot delete: " + srcDir);
      if (!FileUtil.fullyDelete(new File(srcDir.toString()))) {
        throw new IOException("Cannot delete: " + srcDir);
      }
    }
  }
  LOG.debug("log file consolidation completed");
}
