{
  MasterAdminKeepAliveConnection master=connection.getKeepAliveMasterAdmin();
  try {
    SetBalancerRunningRequest req=RequestConverter.buildSetBalancerRunningRequest(on,synchronous);
    return master.setBalancerRunning(null,req).getPrevBalanceValue();
  }
 catch (  ServiceException se) {
    IOException ioe=ProtobufUtil.getRemoteException(se);
    if (ioe instanceof MasterNotRunningException) {
      throw (MasterNotRunningException)ioe;
    }
    if (ioe instanceof ZooKeeperConnectionException) {
      throw (ZooKeeperConnectionException)ioe;
    }
    throw new MasterNotRunningException("Unexpected exception when calling balanceSwitch",se);
  }
 finally {
    master.close();
  }
}
