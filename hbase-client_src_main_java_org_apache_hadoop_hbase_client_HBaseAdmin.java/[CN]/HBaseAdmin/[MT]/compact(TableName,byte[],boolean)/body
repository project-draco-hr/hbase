{
  ZooKeeperWatcher zookeeper=null;
  try {
    checkTableExists(tableName);
    zookeeper=new ZooKeeperWatcher(conf,ZK_IDENTIFIER_PREFIX + connection.toString(),new ThrowableAbortable());
    List<Pair<HRegionInfo,ServerName>> pairs=MetaTableAccessor.getTableRegionsAndLocations(zookeeper,connection,tableName);
    for (    Pair<HRegionInfo,ServerName> pair : pairs) {
      if (pair.getFirst().isOffline())       continue;
      if (pair.getSecond() == null)       continue;
      try {
        compact(pair.getSecond(),pair.getFirst(),major,columnFamily);
      }
 catch (      NotServingRegionException e) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Trying to" + (major ? " major" : "") + " compact "+ pair.getFirst()+ ": "+ StringUtils.stringifyException(e));
        }
      }
    }
  }
  finally {
    if (zookeeper != null) {
      zookeeper.close();
    }
  }
}
