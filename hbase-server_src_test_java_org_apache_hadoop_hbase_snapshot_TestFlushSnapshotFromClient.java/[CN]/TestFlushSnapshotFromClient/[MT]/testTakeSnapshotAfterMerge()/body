{
  int numRows=10000;
  HBaseAdmin admin=UTIL.getHBaseAdmin();
  SnapshotTestingUtils.assertNoSnapshots(admin);
  loadData(new HTable(UTIL.getConfiguration(),TABLE_NAME),numRows,TEST_FAM);
  waitForTableToBeOnline(TABLE_NAME);
  List<HRegionInfo> regions=admin.getTableRegions(TABLE_NAME);
  Collections.sort(regions,new Comparator<HRegionInfo>(){
    public int compare(    HRegionInfo r1,    HRegionInfo r2){
      return Bytes.compareTo(r1.getStartKey(),r2.getStartKey());
    }
  }
);
  int numRegions=admin.getTableRegions(TABLE_NAME).size();
  int numRegionsAfterMerge=numRegions - 2;
  admin.mergeRegions(regions.get(1).getEncodedNameAsBytes(),regions.get(2).getEncodedNameAsBytes(),true);
  admin.mergeRegions(regions.get(5).getEncodedNameAsBytes(),regions.get(6).getEncodedNameAsBytes(),true);
  waitRegionsAfterMerge(numRegionsAfterMerge);
  assertEquals(numRegionsAfterMerge,admin.getTableRegions(TABLE_NAME).size());
  String snapshotName="snapshotAfterMerge";
  admin.snapshot(snapshotName,STRING_TABLE_NAME,SnapshotDescription.Type.FLUSH);
  String cloneName="cloneMerge";
  admin.cloneSnapshot(snapshotName,cloneName);
  waitForTableToBeOnline(Bytes.toBytes(cloneName));
  verifyRowCount(TABLE_NAME,numRows);
  verifyRowCount(Bytes.toBytes(cloneName),numRows);
  UTIL.deleteTable(cloneName);
  admin.deleteSnapshot(snapshotName);
  SnapshotTestingUtils.assertNoSnapshots(admin);
}
