{
  LOG.debug("------- Starting Snapshot test -------------");
  HBaseAdmin admin=UTIL.getHBaseAdmin();
  SnapshotTestingUtils.assertNoSnapshots(admin);
  loadData(new HTable(UTIL.getConfiguration(),TABLE_NAME),10000,TEST_FAM);
  waitForTableToBeOnline(TABLE_NAME);
  String snapshotName="flushSnapshotCreateListDestroy";
  admin.snapshot(snapshotName,STRING_TABLE_NAME,SnapshotDescription.Type.FLUSH);
  logFSTree(FSUtils.getRootDir(UTIL.getConfiguration()));
  List<SnapshotDescription> snapshots=SnapshotTestingUtils.assertOneSnapshotThatMatches(admin,snapshotName,STRING_TABLE_NAME);
  FileSystem fs=UTIL.getHBaseCluster().getMaster().getMasterFileSystem().getFileSystem();
  Path rootDir=UTIL.getHBaseCluster().getMaster().getMasterFileSystem().getRootDir();
  Path snapshotDir=SnapshotDescriptionUtils.getCompletedSnapshotDir(snapshots.get(0),rootDir);
  assertTrue(fs.exists(snapshotDir));
  FSUtils.logFileSystemState(UTIL.getTestFileSystem(),snapshotDir,LOG);
  Path snapshotinfo=new Path(snapshotDir,SnapshotDescriptionUtils.SNAPSHOTINFO_FILE);
  assertTrue(fs.exists(snapshotinfo));
  HTableDescriptor desc=FSTableDescriptors.getTableDescriptor(fs,rootDir,TABLE_NAME);
  HTableDescriptor snapshotDesc=FSTableDescriptors.getTableDescriptor(fs,SnapshotDescriptionUtils.getSnapshotsDir(rootDir),Bytes.toBytes(snapshotName));
  assertEquals(desc,snapshotDesc);
  List<HRegionInfo> regions=admin.getTableRegions(TABLE_NAME);
  assertTrue(regions.size() > 1);
  for (  HRegionInfo info : regions) {
    String regionName=info.getEncodedName();
    Path regionDir=new Path(snapshotDir,regionName);
    HRegionInfo snapshotRegionInfo=HRegionFileSystem.loadRegionInfoFileContent(fs,regionDir);
    assertEquals(info,snapshotRegionInfo);
    Path familyDir=new Path(regionDir,Bytes.toString(TEST_FAM));
    assertTrue(fs.exists(familyDir));
    assertTrue(fs.listStatus(familyDir).length > 0);
  }
  admin.deleteSnapshot(snapshotName);
  FSUtils.logFileSystemState(UTIL.getTestFileSystem(),FSUtils.getRootDir(UTIL.getConfiguration()),LOG);
  SnapshotTestingUtils.assertNoSnapshots(admin);
  LOG.debug("------- Flush-Snapshot Create List Destroy-------------");
}
