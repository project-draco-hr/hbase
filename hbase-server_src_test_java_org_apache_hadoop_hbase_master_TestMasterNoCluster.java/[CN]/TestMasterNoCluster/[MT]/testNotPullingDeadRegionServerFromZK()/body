{
  final Configuration conf=TESTUTIL.getConfiguration();
  final ServerName newServer=ServerName.valueOf("test.sample",1,101);
  final ServerName deadServer=ServerName.valueOf("test.sample",1,100);
  final MockRegionServer rs0=new MockRegionServer(conf,newServer);
  ConsensusProvider cp=ConsensusProviderFactory.getConsensusProvider(TESTUTIL.getConfiguration());
  HMaster master=new HMaster(conf,cp){
    @Override void assignMeta(    MonitoredTask status,    Set<ServerName> previouslyFailedMeatRSs){
    }
    @Override void initializeZKBasedSystemTrackers() throws IOException, InterruptedException, KeeperException {
      super.initializeZKBasedSystemTrackers();
      serverManager.recordNewServerWithLock(newServer,ServerLoad.EMPTY_SERVERLOAD);
      List<ServerName> onlineServers=new ArrayList<ServerName>();
      onlineServers.add(deadServer);
      onlineServers.add(newServer);
      regionServerTracker=Mockito.spy(regionServerTracker);
      Mockito.doReturn(onlineServers).when(regionServerTracker).getOnlineServers();
    }
    @Override protected CatalogTracker createCatalogTracker() throws IOException {
      HConnection connection=HConnectionTestingUtility.getMockedConnectionAndDecorate(TESTUTIL.getConfiguration(),rs0,rs0,rs0.getServerName(),HRegionInfo.FIRST_META_REGIONINFO);
      return new CatalogTracker(getZooKeeper(),getConfiguration(),connection,this);
    }
    @Override void initNamespace(){
    }
  }
;
  master.start();
  try {
    while (!master.initialized)     Threads.sleep(10);
    LOG.info("Master is initialized");
    assertFalse("The dead server should not be pulled in",master.serverManager.isServerOnline(deadServer));
  }
  finally {
    master.stopMaster();
    master.join();
  }
}
