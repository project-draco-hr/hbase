{
  HBaseTestingUtility test_util=new HBaseTestingUtility();
  String root_dir=test_util.getDataTestDir("TestHalfStoreFile").toString();
  Path p=new Path(root_dir,"test");
  Configuration conf=test_util.getConfiguration();
  FileSystem fs=FileSystem.get(conf);
  CacheConfig cacheConf=new CacheConfig(conf);
  HFile.Writer w=HFile.getWriterFactory(conf,cacheConf).withPath(fs,p).withBlockSize(1024).withComparator(KeyValue.KEY_COMPARATOR).create();
  List<KeyValue> items=genSomeKeys();
  for (  KeyValue kv : items) {
    w.append(kv);
  }
  w.close();
  HFile.Reader r=HFile.createReader(fs,p,cacheConf);
  r.loadFileInfo();
  byte[] midkey=r.midkey();
  KeyValue midKV=KeyValue.createKeyValueFromKey(midkey);
  midkey=midKV.getRow();
  Reference bottom=new Reference(midkey,Reference.Range.bottom);
  doTestOfScanAndReseek(p,fs,bottom,cacheConf);
  Reference top=new Reference(midkey,Reference.Range.top);
  doTestOfScanAndReseek(p,fs,top,cacheConf);
  r.close();
}
