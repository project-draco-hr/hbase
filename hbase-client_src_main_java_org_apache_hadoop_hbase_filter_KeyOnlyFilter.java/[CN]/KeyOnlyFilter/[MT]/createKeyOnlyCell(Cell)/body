{
  int dataLen=lenAsVal ? Bytes.SIZEOF_INT : 0;
  int keyOffset=(2 * Bytes.SIZEOF_INT);
  int keyLen=KeyValueUtil.keyLength(c);
  byte[] newBuffer=new byte[keyLen + keyOffset + dataLen];
  Bytes.putInt(newBuffer,0,keyLen);
  Bytes.putInt(newBuffer,Bytes.SIZEOF_INT,dataLen);
  KeyValueUtil.appendKeyTo(c,newBuffer,keyOffset);
  if (lenAsVal) {
    Bytes.putInt(newBuffer,newBuffer.length - dataLen,c.getValueLength());
  }
  return new KeyValue(newBuffer);
}
