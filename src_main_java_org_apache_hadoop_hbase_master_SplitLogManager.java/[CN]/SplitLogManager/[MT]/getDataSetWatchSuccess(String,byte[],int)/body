{
  if (data == null) {
    if (version == Integer.MIN_VALUE) {
      setDone(path,SUCCESS);
      return;
    }
    tot_mgr_null_data.incrementAndGet();
    LOG.fatal("logic error - got null data " + path);
    setDone(path,FAILURE);
    return;
  }
  data=this.watcher.getRecoverableZooKeeper().removeMetaData(data);
  if (TaskState.TASK_UNASSIGNED.equals(data)) {
    LOG.debug("task not yet acquired " + path + " ver = "+ version);
    handleUnassignedTask(path);
  }
 else   if (TaskState.TASK_OWNED.equals(data)) {
    heartbeat(path,version,TaskState.TASK_OWNED.getWriterName(data));
  }
 else   if (TaskState.TASK_RESIGNED.equals(data)) {
    LOG.info("task " + path + " entered state "+ new String(data));
    resubmitOrFail(path,FORCE);
  }
 else   if (TaskState.TASK_DONE.equals(data)) {
    LOG.info("task " + path + " entered state "+ new String(data));
    if (taskFinisher != null && !ZKSplitLog.isRescanNode(watcher,path)) {
      if (taskFinisher.finish(TaskState.TASK_DONE.getWriterName(data),ZKSplitLog.getFileName(path)) == Status.DONE) {
        setDone(path,SUCCESS);
      }
 else {
        resubmitOrFail(path,CHECK);
      }
    }
 else {
      setDone(path,SUCCESS);
    }
  }
 else   if (TaskState.TASK_ERR.equals(data)) {
    LOG.info("task " + path + " entered state "+ new String(data));
    resubmitOrFail(path,CHECK);
  }
 else {
    LOG.fatal("logic error - unexpected zk state for path = " + path + " data = "+ new String(data));
    setDone(path,FAILURE);
  }
}
