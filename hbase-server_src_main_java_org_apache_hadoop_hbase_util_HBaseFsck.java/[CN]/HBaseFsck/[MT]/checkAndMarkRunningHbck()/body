{
  long start=EnvironmentEdgeManager.currentTime();
  try {
    FileSystem fs=FSUtils.getCurrentFileSystem(getConf());
    FsPermission defaultPerms=FSUtils.getFilePermissions(fs,getConf(),HConstants.DATA_FILE_UMASK_KEY);
    Path tmpDir=new Path(FSUtils.getRootDir(getConf()),HConstants.HBASE_TEMP_DIRECTORY);
    fs.mkdirs(tmpDir);
    HBCK_LOCK_PATH=new Path(tmpDir,HBCK_LOCK_FILE);
    final FSDataOutputStream out=FSUtils.create(fs,HBCK_LOCK_PATH,defaultPerms,false);
    out.writeBytes(InetAddress.getLocalHost().toString());
    out.flush();
    return out;
  }
 catch (  RemoteException e) {
    if (AlreadyBeingCreatedException.class.getName().equals(e.getClassName())) {
      return null;
    }
 else {
      throw e;
    }
  }
 finally {
    long duration=EnvironmentEdgeManager.currentTime() - start;
    if (duration > 30000) {
      LOG.warn("Took " + duration + " milliseconds to obtain lock");
      return null;
    }
  }
}
