{
  Path hbaseDir=new Path(conf.get(HConstants.HBASE_DIR));
  FileSystem fs=hbaseDir.getFileSystem(conf);
  Path backupDir=getSidelineDir();
  fs.mkdirs(backupDir);
  sidelineTable(fs,HConstants.ROOT_TABLE_NAME,hbaseDir,backupDir);
  try {
    sidelineTable(fs,HConstants.META_TABLE_NAME,hbaseDir,backupDir);
  }
 catch (  IOException e) {
    LOG.error("Attempt to sideline meta failed, attempt to revert...",e);
    try {
      sidelineTable(fs,HConstants.ROOT_TABLE_NAME,backupDir,hbaseDir);
      LOG.warn("... revert succeed.  -ROOT- and .META. still in " + "original state.");
    }
 catch (    IOException ioe) {
      LOG.fatal("... failed to sideline root and meta and failed to restore " + "prevoius state.  Currently in inconsistent state.  To restore " + "try to rename -ROOT- in " + backupDir.getName() + " to "+ hbaseDir.getName()+ ".",ioe);
    }
    throw e;
  }
  return backupDir;
}
