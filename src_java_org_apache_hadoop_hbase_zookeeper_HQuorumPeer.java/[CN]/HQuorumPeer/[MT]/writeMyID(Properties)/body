{
  HBaseConfiguration conf=new HBaseConfiguration();
  String myAddress=DNS.getDefaultHost(conf.get("hbase.zookeeper.dns.interface","default"),conf.get("hbase.zookeeper.dns.nameserver","default"));
  long myId=-1;
  for (  Entry<Object,Object> entry : properties.entrySet()) {
    String key=entry.getKey().toString().trim();
    String value=entry.getValue().toString().trim();
    if (key.startsWith("server.")) {
      int dot=key.indexOf('.');
      long id=Long.parseLong(key.substring(dot + 1));
      String[] parts=value.split(":");
      String address=parts[0];
      if (myAddress.equals(address)) {
        myId=id;
        break;
      }
    }
  }
  if (myId == -1) {
    throw new IOException("Could not find my address: " + myAddress + " in list of ZooKeeper quorum servers");
  }
  String dataDirStr=properties.get("dataDir").toString().trim();
  File dataDir=new File(dataDirStr);
  if (!dataDir.isDirectory()) {
    if (!dataDir.mkdirs()) {
      throw new IOException("Unable to create data dir " + dataDir);
    }
  }
  File myIdFile=new File(dataDir,"myid");
  PrintWriter w=new PrintWriter(myIdFile);
  w.println(myId);
  w.close();
}
