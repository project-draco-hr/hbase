{
  Class<? extends CoprocessorProtocol> protocol=call.getProtocol();
  if (protocol == null) {
    String protocolName=call.getProtocolName();
    if (LOG.isDebugEnabled()) {
      LOG.debug("Received dynamic protocol exec call with protocolName " + protocolName);
    }
    protocol=protocolHandlerNames.get(protocolName);
    if (protocol == null) {
      throw new HBaseRPC.UnknownProtocolException(null,"No matching handler for protocol " + protocolName + " in region "+ Bytes.toStringBinary(getRegionName()));
    }
  }
  if (!protocolHandlers.containsKey(protocol)) {
    throw new HBaseRPC.UnknownProtocolException(protocol,"No matching handler for protocol " + protocol.getName() + " in region "+ Bytes.toStringBinary(getRegionName()));
  }
  CoprocessorProtocol handler=protocolHandlers.getInstance(protocol);
  Object value;
  try {
    Method method=protocol.getMethod(call.getMethodName(),call.getParameterClasses());
    method.setAccessible(true);
    value=method.invoke(handler,call.getParameters());
  }
 catch (  InvocationTargetException e) {
    Throwable target=e.getTargetException();
    if (target instanceof IOException) {
      throw (IOException)target;
    }
    IOException ioe=new IOException(target.toString());
    ioe.setStackTrace(target.getStackTrace());
    throw ioe;
  }
catch (  Throwable e) {
    if (!(e instanceof IOException)) {
      LOG.error("Unexpected throwable object ",e);
    }
    IOException ioe=new IOException(e.toString());
    ioe.setStackTrace(e.getStackTrace());
    throw ioe;
  }
  return new ExecResult(getRegionName(),value);
}
