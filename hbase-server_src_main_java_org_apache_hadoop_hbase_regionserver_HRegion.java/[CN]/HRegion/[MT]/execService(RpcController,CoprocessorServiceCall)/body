{
  String serviceName=call.getServiceName();
  String methodName=call.getMethodName();
  if (!coprocessorServiceHandlers.containsKey(serviceName)) {
    throw new UnknownProtocolException(null,"No registered coprocessor service found for name " + serviceName + " in region "+ Bytes.toStringBinary(getRegionInfo().getRegionName()));
  }
  Service service=coprocessorServiceHandlers.get(serviceName);
  Descriptors.ServiceDescriptor serviceDesc=service.getDescriptorForType();
  Descriptors.MethodDescriptor methodDesc=serviceDesc.findMethodByName(methodName);
  if (methodDesc == null) {
    throw new UnknownProtocolException(service.getClass(),"Unknown method " + methodName + " called on service "+ serviceName+ " in region "+ Bytes.toStringBinary(getRegionInfo().getRegionName()));
  }
  Message.Builder builder=service.getRequestPrototype(methodDesc).newBuilderForType();
  ProtobufUtil.mergeFrom(builder,call.getRequest());
  Message request=builder.build();
  if (coprocessorHost != null) {
    request=coprocessorHost.preEndpointInvocation(service,methodName,request);
  }
  final Message.Builder responseBuilder=service.getResponsePrototype(methodDesc).newBuilderForType();
  service.callMethod(methodDesc,controller,request,new RpcCallback<Message>(){
    @Override public void run(    Message message){
      if (message != null) {
        responseBuilder.mergeFrom(message);
      }
    }
  }
);
  if (coprocessorHost != null) {
    coprocessorHost.postEndpointInvocation(service,methodName,request,responseBuilder);
  }
  IOException exception=ResponseConverter.getControllerException(controller);
  if (exception != null) {
    throw exception;
  }
  return responseBuilder.build();
}
