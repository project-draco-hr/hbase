{
  Preconditions.checkNotNull(familyPaths);
  startBulkRegionOperation(hasMultipleColumnFamilies(familyPaths));
  try {
    this.writeRequestsCount.increment();
    List<IOException> ioes=new ArrayList<IOException>();
    List<Pair<byte[],String>> failures=new ArrayList<Pair<byte[],String>>();
    for (    Pair<byte[],String> p : familyPaths) {
      byte[] familyName=p.getFirst();
      String path=p.getSecond();
      Store store=getStore(familyName);
      if (store == null) {
        IOException ioe=new org.apache.hadoop.hbase.DoNotRetryIOException("No such column family " + Bytes.toStringBinary(familyName));
        ioes.add(ioe);
      }
 else {
        try {
          store.assertBulkLoadHFileOk(new Path(path));
        }
 catch (        WrongRegionException wre) {
          failures.add(p);
        }
catch (        IOException ioe) {
          ioes.add(ioe);
        }
      }
    }
    if (ioes.size() != 0) {
      IOException e=MultipleIOException.createIOException(ioes);
      LOG.error("There were one or more IO errors when checking if the bulk load is ok.",e);
      throw e;
    }
    if (failures.size() != 0) {
      StringBuilder list=new StringBuilder();
      for (      Pair<byte[],String> p : failures) {
        list.append("\n").append(Bytes.toString(p.getFirst())).append(" : ").append(p.getSecond());
      }
      LOG.warn("There was a recoverable bulk load failure likely due to a" + " split.  These (family, HFile) pairs were not loaded: " + list);
      return false;
    }
    for (    Pair<byte[],String> p : familyPaths) {
      byte[] familyName=p.getFirst();
      String path=p.getSecond();
      Store store=getStore(familyName);
      try {
        String finalPath=path;
        if (bulkLoadListener != null) {
          finalPath=bulkLoadListener.prepareBulkLoad(familyName,path);
        }
        store.bulkLoadHFile(finalPath,assignSeqId ? this.sequenceId.incrementAndGet() : -1);
        if (bulkLoadListener != null) {
          bulkLoadListener.doneBulkLoad(familyName,path);
        }
      }
 catch (      IOException ioe) {
        LOG.error("There was a partial failure due to IO when attempting to" + " load " + Bytes.toString(p.getFirst()) + " : "+ p.getSecond(),ioe);
        if (bulkLoadListener != null) {
          try {
            bulkLoadListener.failedBulkLoad(familyName,path);
          }
 catch (          Exception ex) {
            LOG.error("Error while calling failedBulkLoad for family " + Bytes.toString(familyName) + " with path "+ path,ex);
          }
        }
        throw ioe;
      }
    }
    return true;
  }
  finally {
    closeBulkRegionOperation();
  }
}
