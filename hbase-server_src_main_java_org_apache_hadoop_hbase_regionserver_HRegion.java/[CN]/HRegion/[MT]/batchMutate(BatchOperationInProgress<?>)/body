{
  boolean initialized=false;
  while (!batchOp.isDone()) {
    if (!batchOp.isInReplay()) {
      checkReadOnly();
    }
    checkResources();
    long newSize;
    Operation op=Operation.BATCH_MUTATE;
    if (batchOp.isInReplay())     op=Operation.REPLAY_BATCH_MUTATE;
    startRegionOperation(op);
    try {
      if (!initialized) {
        this.writeRequestsCount.add(batchOp.operations.length);
        if (!batchOp.isInReplay()) {
          doPreMutationHook(batchOp);
        }
        initialized=true;
      }
      long addedSize=doMiniBatchMutation(batchOp);
      newSize=this.addAndGetGlobalMemstoreSize(addedSize);
    }
  finally {
      closeRegionOperation(op);
    }
    if (isFlushSize(newSize)) {
      requestFlush();
    }
  }
  return batchOp.retCodeDetails;
}
