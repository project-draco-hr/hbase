{
  HFileBlock block=getSampleHFileBlock();
  HFileBlockEncodingContext context=new HFileBlockDefaultEncodingContext(Compression.Algorithm.NONE,blockEncoder.getEncodingOnDisk(),HConstants.HFILEBLOCK_DUMMY_HEADER);
  blockEncoder.beforeWriteToDisk(block.getBufferWithoutHeader(),includesMemstoreTS,context,block.getBlockType());
  byte[] encodedBytes=context.getUncompressedBytesWithHeader();
  int size=encodedBytes.length - HConstants.HFILEBLOCK_HEADER_SIZE;
  HFileBlock blockOnDisk=new HFileBlock(context.getBlockType(),size,size,-1,ByteBuffer.wrap(encodedBytes),HFileBlock.FILL_HEADER,0,includesMemstoreTS,block.getMinorVersion(),block.getBytesPerChecksum(),block.getChecksumType(),block.getOnDiskDataSizeWithHeader());
  if (blockEncoder.getEncodingOnDisk() != DataBlockEncoding.NONE) {
    assertEquals(BlockType.ENCODED_DATA,blockOnDisk.getBlockType());
    assertEquals(blockEncoder.getEncodingOnDisk().getId(),blockOnDisk.getDataBlockEncodingId());
  }
 else {
    assertEquals(BlockType.DATA,blockOnDisk.getBlockType());
  }
}
