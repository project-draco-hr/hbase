{
  HFileBlock block=getSampleHFileBlock(useTag);
  LruBlockCache blockCache=new LruBlockCache(8 * 1024 * 1024,32 * 1024);
  HFileBlock cacheBlock=blockEncoder.diskToCacheFormat(block,false);
  BlockCacheKey cacheKey=new BlockCacheKey("test",0);
  blockCache.cacheBlock(cacheKey,cacheBlock);
  HeapSize heapSize=blockCache.getBlock(cacheKey,false,false);
  assertTrue(heapSize instanceof HFileBlock);
  HFileBlock returnedBlock=(HFileBlock)heapSize;
  ;
  if (blockEncoder.getEncodingInCache() == DataBlockEncoding.NONE) {
    assertEquals(block.getBufferWithHeader(),returnedBlock.getBufferWithHeader());
  }
 else {
    if (BlockType.ENCODED_DATA != returnedBlock.getBlockType()) {
      System.out.println(blockEncoder);
    }
    assertEquals(BlockType.ENCODED_DATA,returnedBlock.getBlockType());
  }
}
