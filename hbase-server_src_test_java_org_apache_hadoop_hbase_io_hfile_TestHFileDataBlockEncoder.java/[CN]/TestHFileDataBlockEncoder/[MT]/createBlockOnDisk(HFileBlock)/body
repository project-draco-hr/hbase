{
  int size;
  HFileBlockEncodingContext context=new HFileBlockDefaultEncodingContext(Compression.Algorithm.NONE,blockEncoder.getEncodingOnDisk(),HConstants.HFILEBLOCK_DUMMY_HEADER);
  context.setDummyHeader(block.getDummyHeaderForVersion());
  blockEncoder.beforeWriteToDisk(block.getBufferWithoutHeader(),includesMemstoreTS,context,block.getBlockType());
  byte[] encodedBytes=context.getUncompressedBytesWithHeader();
  size=encodedBytes.length - block.getDummyHeaderForVersion().length;
  return new HFileBlock(context.getBlockType(),size,size,-1,ByteBuffer.wrap(encodedBytes),HFileBlock.FILL_HEADER,0,includesMemstoreTS,block.getMinorVersion(),block.getBytesPerChecksum(),block.getChecksumType(),block.getOnDiskDataSizeWithHeader());
}
