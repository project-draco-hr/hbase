{
  int headerSize=HConstants.HFILEBLOCK_HEADER_SIZE_NO_CHECKSUM;
  ByteBuffer keyValues=RedundantKVGenerator.convertKvToByteBuffer(generator.generateTestKeyValues(60,useTags),includesMemstoreTS);
  int size=keyValues.limit();
  ByteBuffer buf=ByteBuffer.allocate(size + headerSize);
  buf.position(headerSize);
  keyValues.rewind();
  buf.put(keyValues);
  HFileContext meta=new HFileContext();
  meta.setUsesHBaseChecksum(false);
  meta.setIncludesMvcc(includesMemstoreTS);
  meta.setIncludesTags(useTags);
  meta.setCompressAlgo(Compression.Algorithm.NONE);
  meta.setBlocksize(0);
  meta.setChecksumType(ChecksumType.NULL);
  HFileBlock block=new HFileBlock(BlockType.DATA,size,size,-1,buf,HFileBlock.FILL_HEADER,0,0,meta);
  HFileBlock cacheBlock=blockEncoder.diskToCacheFormat(createBlockOnDisk(block,useTags),false);
  assertEquals(headerSize,cacheBlock.getDummyHeaderForVersion().length);
}
