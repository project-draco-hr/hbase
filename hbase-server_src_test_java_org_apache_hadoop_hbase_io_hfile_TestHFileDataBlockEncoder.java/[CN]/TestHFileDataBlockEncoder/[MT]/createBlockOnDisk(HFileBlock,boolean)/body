{
  int size;
  HFileBlockEncodingContext context=new HFileBlockDefaultEncodingContext(blockEncoder.getEncodingOnDisk(),HConstants.HFILEBLOCK_DUMMY_HEADER,block.getHFileContext());
  context.setDummyHeader(block.getDummyHeaderForVersion());
  blockEncoder.beforeWriteToDisk(block.getBufferWithoutHeader(),context,block.getBlockType());
  byte[] encodedBytes=context.getUncompressedBytesWithHeader();
  size=encodedBytes.length - block.getDummyHeaderForVersion().length;
  return new HFileBlock(context.getBlockType(),size,size,-1,ByteBuffer.wrap(encodedBytes),HFileBlock.FILL_HEADER,0,block.getOnDiskDataSizeWithHeader(),block.getHFileContext());
}
