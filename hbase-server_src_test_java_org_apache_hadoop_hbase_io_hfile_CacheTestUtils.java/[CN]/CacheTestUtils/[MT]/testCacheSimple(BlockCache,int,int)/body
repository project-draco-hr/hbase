{
  HFileBlockPair[] blocks=generateHFileBlocks(numBlocks,blockSize);
  for (  HFileBlockPair block : blocks) {
    assertNull(toBeTested.getBlock(block.blockName,true));
  }
  for (  HFileBlockPair block : blocks) {
    toBeTested.cacheBlock(block.blockName,block.block);
  }
  for (  HFileBlockPair block : blocks) {
    HFileBlock buf=(HFileBlock)toBeTested.getBlock(block.blockName,true);
    if (buf != null) {
      assertEquals(block.block,buf);
    }
  }
  for (  HFileBlockPair block : blocks) {
    try {
      if (toBeTested.getBlock(block.blockName,true) != null) {
        toBeTested.cacheBlock(block.blockName,block.block);
        fail("Cache should not allow re-caching a block");
      }
    }
 catch (    RuntimeException re) {
    }
  }
}
