{
  this.conf=conf;
  this.rootDir=rootDir;
  this.srcDir=srcDir;
  this.oldLogDir=oldLogDir;
  this.fs=fs;
  this.sequenceIdChecker=idChecker;
  this.watcher=zkw;
  entryBuffers=new EntryBuffers(conf.getInt("hbase.regionserver.hlog.splitlog.buffersize",128 * 1024 * 1024));
  this.minBatchSize=conf.getInt("hbase.regionserver.wal.logreplay.batch.size",512);
  this.distributedLogReplay=this.conf.getBoolean(HConstants.DISTRIBUTED_LOG_REPLAY_KEY,HConstants.DEFAULT_DISTRIBUTED_LOG_REPLAY_CONFIG);
  this.numWriterThreads=conf.getInt("hbase.regionserver.hlog.splitlog.writer.threads",3);
  if (zkw != null && this.distributedLogReplay) {
    outputSink=new LogReplayOutputSink(numWriterThreads);
  }
 else {
    if (this.distributedLogReplay) {
      LOG.info("ZooKeeperWatcher is passed in as NULL so disable distrubitedLogRepaly.");
    }
    this.distributedLogReplay=false;
    outputSink=new LogRecoveredEditsOutputSink(numWriterThreads);
  }
}
