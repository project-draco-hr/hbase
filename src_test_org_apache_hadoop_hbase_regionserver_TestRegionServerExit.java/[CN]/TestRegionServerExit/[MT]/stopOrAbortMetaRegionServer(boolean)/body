{
  List<LocalHBaseCluster.RegionServerThread> regionThreads=cluster.getRegionThreads();
  int server=-1;
  for (int i=0; i < regionThreads.size() && server == -1; i++) {
    HRegionServer s=regionThreads.get(i).getRegionServer();
    Collection<HRegion> regions=s.getOnlineRegions().values();
    for (    HRegion r : regions) {
      if (r.getTableDesc().getName().equals(HConstants.META_TABLE_NAME)) {
        server=i;
      }
    }
  }
  if (server == -1) {
    LOG.fatal("could not find region server serving meta region");
    fail();
  }
  if (abort) {
    this.cluster.abortRegionServer(server);
  }
 else {
    this.cluster.stopRegionServer(server);
  }
  LOG.info(this.cluster.waitOnRegionServer(server) + " has been " + (abort ? "aborted" : "shut down"));
}
