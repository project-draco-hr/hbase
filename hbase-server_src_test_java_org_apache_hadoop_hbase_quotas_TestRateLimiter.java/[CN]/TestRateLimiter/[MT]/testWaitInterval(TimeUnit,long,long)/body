{
  RateLimiter limiter=new RateLimiter();
  limiter.set(limit,timeUnit);
  long nowTs=0;
  long lastTs=0;
  for (int i=0; i < (limit - 1); ++i) {
    assertTrue(limiter.canExecute(nowTs,lastTs));
    limiter.consume();
    long waitInterval=limiter.waitInterval();
    assertEquals(0,waitInterval);
  }
  for (int i=0; i < (limit * 4); ++i) {
    assertTrue(limiter.canExecute(nowTs,lastTs));
    assertEquals(0,limiter.waitInterval());
    limiter.consume();
    lastTs=nowTs;
    long waitInterval=limiter.waitInterval();
    assertEquals(expectedWaitInterval,waitInterval);
    nowTs+=waitInterval;
    assertFalse(limiter.canExecute(nowTs - 500,lastTs));
  }
}
