{
  Configuration conf=HBaseConfiguration.create();
  conf.set("hbase.client.rpc.compressor",GzipCodec.class.getCanonicalName());
  TestRpcServer rpcServer=new TestRpcServer();
  HBaseClient client=new HBaseClient(conf,HConstants.CLUSTER_ID_DEFAULT);
  List<Cell> cells=new ArrayList<Cell>();
  cells.add(CELL);
  try {
    rpcServer.start();
    InetSocketAddress address=rpcServer.getListenerAddress();
    Method m=NothingProtocol.class.getMethod("doNothing");
    client.call(m,null,CellUtil.createCellScanner(cells),address,NothingProtocol.class,User.getCurrent(),0);
  }
  finally {
    client.stop();
    rpcServer.stop();
  }
}
