{
  VersionedProtocol proxy=(VersionedProtocol)Proxy.newProxyInstance(protocol.getClassLoader(),new Class[]{protocol},new Invoker(addr,ticket,conf,factory));
  long serverVersion=proxy.getProtocolVersion(protocol.getName(),clientVersion);
  if (serverVersion == clientVersion) {
    return proxy;
  }
  throw new VersionMismatch(protocol.getName(),clientVersion,serverVersion);
}
