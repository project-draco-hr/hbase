{
  ThriftHBaseServiceHandler handler=createHandler();
  byte[] rowName="testCheckAndDelete".getBytes();
  ByteBuffer table=ByteBuffer.wrap(tableAname);
  List<TColumnValue> columnValuesA=new ArrayList<TColumnValue>();
  TColumnValue columnValueA=new TColumnValue(ByteBuffer.wrap(familyAname),ByteBuffer.wrap(qualifierAname),ByteBuffer.wrap(valueAname));
  columnValuesA.add(columnValueA);
  TPut putA=new TPut(ByteBuffer.wrap(rowName),columnValuesA);
  putA.setColumnValues(columnValuesA);
  List<TColumnValue> columnValuesB=new ArrayList<TColumnValue>();
  TColumnValue columnValueB=new TColumnValue(ByteBuffer.wrap(familyBname),ByteBuffer.wrap(qualifierBname),ByteBuffer.wrap(valueBname));
  columnValuesB.add(columnValueB);
  TPut putB=new TPut(ByteBuffer.wrap(rowName),columnValuesB);
  putB.setColumnValues(columnValuesB);
  handler.put(table,putB);
  TDelete delete=new TDelete(ByteBuffer.wrap(rowName));
  assertFalse(handler.checkAndDelete(table,ByteBuffer.wrap(rowName),ByteBuffer.wrap(familyAname),ByteBuffer.wrap(qualifierAname),ByteBuffer.wrap(valueAname),delete));
  TGet get=new TGet(ByteBuffer.wrap(rowName));
  TResult result=handler.get(table,get);
  assertArrayEquals(rowName,result.getRow());
  assertTColumnValuesEqual(columnValuesB,result.getColumnValues());
  handler.put(table,putA);
  assertTrue(handler.checkAndDelete(table,ByteBuffer.wrap(rowName),ByteBuffer.wrap(familyAname),ByteBuffer.wrap(qualifierAname),ByteBuffer.wrap(valueAname),delete));
  result=handler.get(table,get);
  assertFalse(result.isSetRow());
  assertEquals(0,result.getColumnValuesSize());
}
