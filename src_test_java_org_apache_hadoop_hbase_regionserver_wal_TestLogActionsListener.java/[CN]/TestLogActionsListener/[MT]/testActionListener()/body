{
  DummyLogActionsListener list=new DummyLogActionsListener();
  DummyLogActionsListener laterList=new DummyLogActionsListener();
  HLog hlog=new HLog(fs,logDir,oldLogDir,conf,null,list,null);
  HRegionInfo hri=new HRegionInfo(new HTableDescriptor(SOME_BYTES),SOME_BYTES,SOME_BYTES,false);
  for (int i=0; i < 20; i++) {
    byte[] b=Bytes.toBytes(i + "");
    KeyValue kv=new KeyValue(b,b,b);
    WALEdit edit=new WALEdit();
    edit.add(kv);
    HLogKey key=new HLogKey(b,b,0,0);
    hlog.append(hri,key,edit);
    if (i == 10) {
      hlog.addLogActionsListerner(laterList);
    }
    if (i % 2 == 0) {
      hlog.rollWriter();
    }
  }
  assertEquals(11,list.logRollCounter);
  assertEquals(5,laterList.logRollCounter);
}
