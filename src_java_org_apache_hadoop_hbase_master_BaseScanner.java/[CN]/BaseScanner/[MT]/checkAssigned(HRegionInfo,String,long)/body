{
  if (info.isOffline() || regionManager.isClosing(info.getRegionName())) {
    regionManager.noLongerUnassigned(info);
    regionManager.noLongerPending(info.getRegionName());
    return;
  }
  HServerInfo storedInfo=null;
  boolean deadServer=false;
  if (serverName.length() != 0) {
    if (regionManager.isMarkedToClose(serverName,info.getRegionName())) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("not assigning region (on kill list): " + info.getRegionName());
      }
      return;
    }
    storedInfo=master.serverManager.getServerInfo(serverName);
    deadServer=master.serverManager.isDead(serverName);
  }
  if (!deadServer && !regionManager.isUnassigned(info) && !regionManager.isPending(info.getRegionName())&& (storedInfo == null || storedInfo.getStartCode() != startCode)) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Current assignment of " + info.getRegionName() + " is not valid: storedInfo: "+ storedInfo+ ", startCode: "+ startCode+ ", storedInfo.startCode: "+ ((storedInfo != null) ? storedInfo.getStartCode() : -1)+ ", unassignedRegions: "+ regionManager.isUnassigned(info)+ ", pendingRegions: "+ regionManager.isPending(info.getRegionName()));
    }
    if (!regionManager.isInitialMetaScanComplete() && serverName.length() != 0) {
      StringBuilder dirName=new StringBuilder("log_");
      dirName.append(serverName.replace(":","_"));
      Path logDir=new Path(master.rootdir,dirName.toString());
      try {
        if (master.fs.exists(logDir)) {
          regionManager.splitLogLock.lock();
          try {
            HLog.splitLog(master.rootdir,logDir,master.fs,master.conf);
          }
  finally {
            regionManager.splitLogLock.unlock();
          }
        }
        if (LOG.isDebugEnabled()) {
          LOG.debug("Split " + logDir.toString());
        }
      }
 catch (      IOException e) {
        LOG.warn("unable to split region server log because: ",e);
        throw e;
      }
    }
    regionManager.setUnassigned(info);
  }
}
