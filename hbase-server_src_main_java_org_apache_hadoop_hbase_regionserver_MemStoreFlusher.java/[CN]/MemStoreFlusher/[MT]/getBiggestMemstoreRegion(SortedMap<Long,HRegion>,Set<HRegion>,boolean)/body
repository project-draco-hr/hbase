{
synchronized (regionsInQueue) {
    for (    HRegion region : regionsBySize.values()) {
      if (excludedRegions.contains(region)) {
        continue;
      }
      if (region.writestate.flushing || !region.writestate.writesEnabled) {
        continue;
      }
      if (checkStoreFileCount && isTooManyStoreFiles(region)) {
        continue;
      }
      return region;
    }
  }
  return null;
}
