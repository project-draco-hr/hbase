{
  NavigableMap<byte[],Integer> scopes=entry.getKey().getScopes();
  ArrayList<KeyValue> kvs=entry.getEdit().getKeyValues();
  int size=kvs.size();
  for (int i=size - 1; i >= 0; i--) {
    KeyValue kv=kvs.get(i);
    if (scopes == null || !scopes.containsKey(kv.getFamily())) {
      kvs.remove(i);
    }
  }
  if (kvs.size() < size / 2) {
    kvs.trimToSize();
  }
}
