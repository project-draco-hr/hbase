{
  this.stopper=stopper;
  this.conf=HBaseConfiguration.create(conf);
  decorateConf();
  this.replicationQueueSizeCapacity=this.conf.getLong("replication.source.size.capacity",1024 * 1024 * 64);
  this.replicationQueueNbCapacity=this.conf.getInt("replication.source.nb.capacity",25000);
  this.sleepForRetries=this.conf.getLong("replication.source.sleepforretries",1000);
  this.maxRetriesMultiplier=this.conf.getInt("replication.source.maxretriesmultiplier",300);
  this.queue=new PriorityBlockingQueue<Path>(this.conf.getInt("hbase.regionserver.maxlogs",32),new LogsComparator());
  long bandwidth=this.conf.getLong("replication.source.per.peer.node.bandwidth",0);
  this.throttler=new ReplicationThrottler((double)bandwidth / 10.0);
  this.replicationQueues=replicationQueues;
  this.replicationPeers=replicationPeers;
  this.manager=manager;
  this.fs=fs;
  this.metrics=metrics;
  this.repLogReader=new ReplicationWALReaderManager(this.fs,this.conf);
  this.clusterId=clusterId;
  this.peerClusterZnode=peerClusterZnode;
  this.replicationQueueInfo=new ReplicationQueueInfo(peerClusterZnode);
  this.peerId=this.replicationQueueInfo.getPeerId();
  this.logQueueWarnThreshold=this.conf.getInt("replication.source.log.queue.warn",2);
  this.replicationEndpoint=replicationEndpoint;
  this.replicateContext=new ReplicationEndpoint.ReplicateContext();
}
