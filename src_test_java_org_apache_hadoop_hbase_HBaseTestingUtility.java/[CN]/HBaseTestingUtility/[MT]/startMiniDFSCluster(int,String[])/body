{
  isRunningCluster();
  if (clusterTestDir == null) {
    setupClusterTestDir();
  }
  System.setProperty(TEST_DIRECTORY_KEY,this.clusterTestDir.toString());
  System.setProperty("test.cache.data",this.clusterTestDir.toString());
  this.conf.set("dfs.datanode.data.dir.perm","700");
  this.dfsCluster=new MiniDFSCluster(0,this.conf,servers,true,true,true,null,null,hosts,null);
  FileSystem fs=this.dfsCluster.getFileSystem();
  this.conf.set("fs.defaultFS",fs.getUri().toString());
  this.conf.set("fs.default.name",fs.getUri().toString());
  this.dfsCluster.waitClusterUp();
  return this.dfsCluster;
}
