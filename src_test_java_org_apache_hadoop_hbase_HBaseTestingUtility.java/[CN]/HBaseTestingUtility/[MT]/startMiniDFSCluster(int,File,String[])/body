{
  if (dir == null) {
    this.clusterTestBuildDir=setupClusterTestBuildDir();
  }
 else {
    this.clusterTestBuildDir=dir;
  }
  System.setProperty(TEST_DIRECTORY_KEY,this.clusterTestBuildDir.toString());
  System.setProperty("test.cache.data",this.clusterTestBuildDir.toString());
  this.dfsCluster=new MiniDFSCluster(0,this.conf,servers,true,true,true,null,null,hosts,null);
  FileSystem fs=this.dfsCluster.getFileSystem();
  this.conf.set("fs.defaultFS",fs.getUri().toString());
  this.conf.set("fs.default.name",fs.getUri().toString());
  return this.dfsCluster;
}
