{
  this.passedZkCluster=false;
  if (this.zkCluster != null) {
    throw new IOException("Cluster already running at " + dir);
  }
  this.zkCluster=new MiniZooKeeperCluster();
  int clientPort=this.zkCluster.startup(dir);
  this.conf.set("hbase.zookeeper.property.clientPort",Integer.toString(clientPort));
  return this.zkCluster;
}
