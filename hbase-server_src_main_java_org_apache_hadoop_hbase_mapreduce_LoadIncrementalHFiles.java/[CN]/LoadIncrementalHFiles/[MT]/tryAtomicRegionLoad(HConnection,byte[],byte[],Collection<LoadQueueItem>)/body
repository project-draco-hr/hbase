{
  final List<Pair<byte[],String>> famPaths=new ArrayList<Pair<byte[],String>>(lqis.size());
  for (  LoadQueueItem lqi : lqis) {
    famPaths.add(Pair.newPair(lqi.family,lqi.hfilePath.toString()));
  }
  final ServerCallable<Boolean> svrCallable=new ServerCallable<Boolean>(conn,tableName,first){
    @Override public Boolean call() throws Exception {
      LOG.debug("Going to connect to server " + location + " for row "+ Bytes.toStringBinary(row));
      byte[] regionName=location.getRegionInfo().getRegionName();
      return ProtobufUtil.bulkLoadHFile(server,famPaths,regionName,assignSeqIds);
    }
  }
;
  try {
    List<LoadQueueItem> toRetry=new ArrayList<LoadQueueItem>();
    boolean success=svrCallable.withRetries();
    if (!success) {
      LOG.warn("Attempt to bulk load region containing " + Bytes.toStringBinary(first) + " into table "+ Bytes.toStringBinary(tableName)+ " with files "+ lqis+ " failed.  This is recoverable and they will be retried.");
      toRetry.addAll(lqis);
    }
    return toRetry;
  }
 catch (  IOException e) {
    LOG.error("Encountered unrecoverable error from region server",e);
    throw e;
  }
}
