{
  random=new SecureRandom();
  baseStagingDir=SecureBulkLoadUtil.getBaseStagingDir(conf);
  this.userProvider=UserProvider.instantiate(conf);
  try {
    fs=FileSystem.get(conf);
    fs.mkdirs(baseStagingDir,PERM_HIDDEN);
    fs.setPermission(baseStagingDir,PERM_HIDDEN);
    FileStatus status=fs.getFileStatus(baseStagingDir);
    fs.mkdirs(new Path(baseStagingDir,"DONOTERASE"),PERM_HIDDEN);
    if (status == null) {
      throw new IllegalStateException("Failed to create staging directory " + baseStagingDir.toString());
    }
    if (!status.getPermission().equals(PERM_HIDDEN)) {
      throw new IllegalStateException("Staging directory already exists but permissions aren't set to '-rwx--x--x' " + baseStagingDir.toString());
    }
  }
 catch (  IOException e) {
    LOG.error("Failed to create or set permission on staging directory " + baseStagingDir.toString(),e);
    throw new IllegalStateException("Failed to create or set permission on staging directory " + baseStagingDir.toString(),e);
  }
}
