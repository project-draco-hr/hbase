{
  table=new HTable(conf,"test");
  assertEquals("Test table should have 20 regions",20,table.getStartKeys().length);
  assertRegionsAreBalanced();
  LOG.debug("Adding 2nd region server.");
  LOG.info("Started=" + cluster.startRegionServer().getRegionServer().getServerName());
  cluster.getMaster().balance();
  assertRegionsAreBalanced();
  LOG.debug("Adding 3rd region server.");
  LOG.info("Started=" + cluster.startRegionServer().getRegionServer().getServerName());
  cluster.getMaster().balance();
  assertRegionsAreBalanced();
  LOG.debug("Killing the 3rd region server.");
  LOG.info("Stopped=" + cluster.stopRegionServer(2,false));
  cluster.waitOnRegionServer(2);
  cluster.getMaster().balance();
  assertRegionsAreBalanced();
  LOG.debug("Adding 3rd region server");
  LOG.info("Started=" + cluster.startRegionServer().getRegionServer().getServerName());
  LOG.debug("Adding 4th region server");
  LOG.info("Started=" + cluster.startRegionServer().getRegionServer().getServerName());
  cluster.getMaster().balance();
  assertRegionsAreBalanced();
  for (int i=0; i < 6; i++) {
    LOG.debug("Adding " + (i + 5) + "th region server");
    cluster.startRegionServer();
  }
  cluster.getMaster().balance();
  assertRegionsAreBalanced();
}
