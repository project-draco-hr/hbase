{
  LOG.info("testClientSessionExpired");
  Configuration c=new Configuration(TEST_UTIL.getConfiguration());
  new HTable(c,HConstants.META_TABLE_NAME).close();
  HConnection connection=HConnectionManager.getConnection(c);
  ZooKeeperWatcher connectionZK=connection.getZooKeeperWatcher();
  TEST_UTIL.expireSession(connectionZK);
  LOG.info("Before dump state=" + connectionZK.getRecoverableZooKeeper().getState());
  ZKUtil.dump(connectionZK);
  LOG.info("ZooKeeper should have timed out");
  States state=connectionZK.getRecoverableZooKeeper().getState();
  LOG.info("After dump state=" + state);
  Assert.assertTrue(state == States.CLOSED);
  ZooKeeperWatcher newConnectionZK=connection.getZooKeeperWatcher();
  States state2=newConnectionZK.getRecoverableZooKeeper().getState();
  LOG.info("After new get state=" + state2);
  Assert.assertTrue(state2 == States.CONNECTED || state2 == States.CONNECTING);
}
