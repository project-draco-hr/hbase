{
  LOG.info(TestRegionObserverInterface.class.getName() + ".testRecovery");
  TableName tableName=TEST_TABLE;
  HTable table=util.createTable(tableName,new byte[][]{A,B,C});
  JVMClusterUtil.RegionServerThread rs1=cluster.startRegionServer();
  ServerName sn2=rs1.getRegionServer().getServerName();
  String regEN=table.getRegionLocations().firstEntry().getKey().getEncodedName();
  util.getHBaseAdmin().move(regEN.getBytes(),sn2.getServerName().getBytes());
  while (!sn2.equals(table.getRegionLocations().firstEntry().getValue())) {
    Thread.sleep(100);
  }
  Put put=new Put(ROW);
  put.add(A,A,A);
  put.add(B,B,B);
  put.add(C,C,C);
  table.put(put);
  verifyMethodResult(SimpleRegionObserver.class,new String[]{"hadPreGet","hadPostGet","hadPrePut","hadPostPut","hadPreBatchMutate","hadPostBatchMutate","hadDelete"},TEST_TABLE,new Boolean[]{false,false,true,true,true,true,false});
  verifyMethodResult(SimpleRegionObserver.class,new String[]{"getCtPreWALRestore","getCtPostWALRestore","getCtPrePut","getCtPostPut"},TEST_TABLE,new Integer[]{0,0,1,1});
  cluster.killRegionServer(rs1.getRegionServer().getServerName());
  Threads.sleep(20000);
  util.waitUntilAllRegionsAssigned(tableName);
  verifyMethodResult(SimpleRegionObserver.class,new String[]{"getCtPreWALRestore","getCtPostWALRestore"},TEST_TABLE,new Integer[]{1,1});
  verifyMethodResult(SimpleRegionObserver.class,new String[]{"getCtPrePut","getCtPostPut"},TEST_TABLE,new Integer[]{0,0});
  util.deleteTable(tableName);
  table.close();
}
