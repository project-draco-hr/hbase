{
  if (secretManager == null) {
    throw new IOException("No secret manager configured for token authentication");
  }
  User currentUser=RequestContext.getRequestUser();
  UserGroupInformation ugi=null;
  if (currentUser != null) {
    ugi=currentUser.getUGI();
  }
  if (currentUser == null) {
    throw new AccessDeniedException("No authenticated user for request!");
  }
 else   if (ugi.getAuthenticationMethod() != UserGroupInformation.AuthenticationMethod.KERBEROS) {
    LOG.warn("Token generation denied for user=" + currentUser.getName() + ", authMethod="+ ugi.getAuthenticationMethod());
    throw new AccessDeniedException("Token generation only allowed for Kerberos authenticated clients");
  }
  return secretManager.generateToken(currentUser.getName());
}
