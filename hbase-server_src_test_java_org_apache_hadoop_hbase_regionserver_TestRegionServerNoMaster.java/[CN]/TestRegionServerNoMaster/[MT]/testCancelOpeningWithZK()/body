{
  closeNoZK();
  checkRegionIsClosed();
  getRS().getRegionsInTransitionInRS().put(hri.getEncodedNameAsBytes(),Boolean.TRUE);
  ZKAssign.createNodeClosing(HTU.getZooKeeperWatcher(),hri,getRS().getServerName());
  AdminProtos.CloseRegionRequest crr=RequestConverter.buildCloseRegionRequest(regionName,false);
  try {
    getRS().closeRegion(null,crr);
    Assert.assertTrue(false);
  }
 catch (  ServiceException expected) {
    Assert.assertTrue(expected.getCause() instanceof NotServingRegionException);
  }
  Assert.assertTrue(ZKAssign.deleteNode(getRS().getZooKeeperWatcher(),hri.getEncodedName(),EventType.M_ZK_REGION_CLOSING,0));
  Assert.assertEquals(Boolean.FALSE,getRS().getRegionsInTransitionInRS().get(hri.getEncodedNameAsBytes()));
  HTableDescriptor htd=getRS().tableDescriptors.get(hri.getTableName());
  getRS().service.submit(new OpenRegionHandler(getRS(),getRS(),hri,htd,0));
  checkRegionIsClosed();
  Assert.assertEquals(-1,ZKAssign.getVersion(HTU.getZooKeeperWatcher(),hri));
  reopenRegion();
}
