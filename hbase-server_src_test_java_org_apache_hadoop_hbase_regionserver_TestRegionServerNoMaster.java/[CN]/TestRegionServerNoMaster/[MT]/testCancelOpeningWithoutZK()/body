{
  closeNoZK();
  checkRegionIsClosed();
  ZKAssign.createNodeOffline(HTU.getZooKeeperWatcher(),hri,getRS().getServerName());
  getRS().getRegionsInTransitionInRS().put(hri.getEncodedNameAsBytes(),Boolean.TRUE);
  AdminProtos.CloseRegionRequest crr=RequestConverter.buildCloseRegionRequest(getRS().getServerName(),regionName,false);
  try {
    getRS().closeRegion(null,crr);
    Assert.assertTrue(false);
  }
 catch (  ServiceException expected) {
  }
  Assert.assertEquals(Boolean.FALSE,getRS().getRegionsInTransitionInRS().get(hri.getEncodedNameAsBytes()));
  HTableDescriptor htd=getRS().tableDescriptors.get(hri.getTable());
  getRS().service.submit(new OpenRegionHandler(getRS(),getRS(),hri,htd,0));
  checkRegionIsClosed();
  Assert.assertTrue(ZKAssign.deleteNode(getRS().getZooKeeperWatcher(),hri.getEncodedName(),EventType.RS_ZK_REGION_FAILED_OPEN,1));
  reopenRegion();
}
