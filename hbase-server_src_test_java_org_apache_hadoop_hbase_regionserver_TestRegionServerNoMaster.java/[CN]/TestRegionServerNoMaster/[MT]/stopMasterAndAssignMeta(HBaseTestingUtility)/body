{
  HTU.getHBaseCluster().getMaster().stopMaster();
  Log.info("Waiting until master thread exits");
  while (HTU.getHBaseCluster().getMasterThread() != null && HTU.getHBaseCluster().getMasterThread().isAlive()) {
    Threads.sleep(100);
  }
  HRegionServer hrs=HTU.getHBaseCluster().getRegionServer(0);
  ZooKeeperWatcher zkw=hrs.getZooKeeper();
  ZKAssign.createNodeOffline(zkw,HRegionInfo.FIRST_META_REGIONINFO,hrs.getServerName());
  ProtobufUtil.openRegion(hrs.getRSRpcServices(),hrs.getServerName(),HRegionInfo.FIRST_META_REGIONINFO);
  MetaTableLocator mtl=new MetaTableLocator();
  while (true) {
    ServerName sn=mtl.getMetaRegionLocation(zkw);
    if (sn != null && sn.equals(hrs.getServerName())) {
      break;
    }
    Thread.sleep(100);
  }
}
