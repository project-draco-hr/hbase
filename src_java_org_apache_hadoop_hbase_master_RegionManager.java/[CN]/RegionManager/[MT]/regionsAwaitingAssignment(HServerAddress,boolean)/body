{
  Set<RegionState> regionsToAssign=new HashSet<RegionState>();
  boolean isMetaServer=isMetaServer(addr);
  RegionState rootState=regionsInTransition.get(HRegionInfo.ROOT_REGIONINFO.getRegionNameAsString());
  if (rootState != null && rootState.isUnassigned()) {
    if (!isMetaServer) {
      regionsToAssign.add(rootState);
    }
    return regionsToAssign;
  }
  boolean reassigningMetas=numberOfMetaRegions.get() != onlineMetaRegions.size();
  boolean isMetaOrRoot=isMetaServer || isRootServer(addr);
  if (reassigningMetas && isMetaOrRoot && !isSingleServer) {
    return regionsToAssign;
  }
  for (  RegionState s : regionsInTransition.values()) {
    HRegionInfo i=s.getRegionInfo();
    if (i == null) {
      continue;
    }
    if (reassigningMetas && !i.isMetaRegion()) {
      continue;
    }
    if (s.isUnassigned()) {
      regionsToAssign.add(s);
    }
  }
  return regionsToAssign;
}
