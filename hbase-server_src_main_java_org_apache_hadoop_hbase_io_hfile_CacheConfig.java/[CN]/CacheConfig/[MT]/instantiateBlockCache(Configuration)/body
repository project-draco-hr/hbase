{
  if (GLOBAL_BLOCK_CACHE_INSTANCE != null)   return GLOBAL_BLOCK_CACHE_INSTANCE;
  if (blockCacheDisabled)   return null;
  MemoryUsage mu=ManagementFactory.getMemoryMXBean().getHeapMemoryUsage();
  LruBlockCache l1=getL1(conf,mu);
  if (blockCacheDisabled)   return null;
  BucketCache l2=getL2(conf,mu);
  if (l2 == null) {
    GLOBAL_BLOCK_CACHE_INSTANCE=l1;
  }
 else {
    boolean combinedWithLru=conf.getBoolean(BUCKET_CACHE_COMBINED_KEY,DEFAULT_BUCKET_CACHE_COMBINED);
    if (combinedWithLru) {
      GLOBAL_BLOCK_CACHE_INSTANCE=new CombinedBlockCache(l1,l2);
    }
 else {
      l1.setVictimCache(l2);
      GLOBAL_BLOCK_CACHE_INSTANCE=l1;
    }
  }
  return GLOBAL_BLOCK_CACHE_INSTANCE;
}
