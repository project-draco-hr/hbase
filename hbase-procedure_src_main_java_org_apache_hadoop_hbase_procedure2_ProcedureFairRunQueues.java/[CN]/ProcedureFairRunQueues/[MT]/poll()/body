{
  lock.lock();
  try {
    TQueue queue;
    if (currentQuantum == 0) {
      if (nextObject() == null) {
        return null;
      }
      queue=current.getValue();
      currentQuantum=calculateQuantum(queue) - 1;
    }
 else {
      currentQuantum--;
      queue=current.getValue();
    }
    if (!queue.isAvailable()) {
      Map.Entry<TKey,TQueue> last=current;
      do {
        if (nextObject() == null)         return null;
      }
 while (current.getValue() != last.getValue() && !current.getValue().isAvailable());
      queue=current.getValue();
      currentQuantum=calculateQuantum(queue) - 1;
    }
    return queue;
  }
  finally {
    lock.unlock();
  }
}
