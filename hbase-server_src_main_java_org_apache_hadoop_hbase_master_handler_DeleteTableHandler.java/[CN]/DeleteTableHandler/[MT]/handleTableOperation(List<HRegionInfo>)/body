{
  MasterCoprocessorHost cpHost=((HMaster)this.server).getCoprocessorHost();
  if (cpHost != null) {
    cpHost.preDeleteTableHandler(this.tableName);
  }
  AssignmentManager am=this.masterServices.getAssignmentManager();
  long waitTime=server.getConfiguration().getLong("hbase.master.wait.on.region",5 * 60 * 1000);
  for (  HRegionInfo region : regions) {
    long done=System.currentTimeMillis() + waitTime;
    while (System.currentTimeMillis() < done) {
      if (!am.getRegionStates().isRegionInTransition(region))       break;
      Threads.sleep(waitingTimeForEvents);
      LOG.debug("Waiting on region to clear regions in transition; " + am.getRegionStates().getRegionTransitionState(region));
    }
    if (am.getRegionStates().isRegionInTransition(region)) {
      throw new IOException("Waited hbase.master.wait.on.region (" + waitTime + "ms) for region to leave region "+ region.getRegionNameAsString()+ " in transitions");
    }
  }
  LOG.debug("Deleting regions from META");
  MetaEditor.deleteRegions(this.server.getCatalogTracker(),regions);
  MasterFileSystem mfs=this.masterServices.getMasterFileSystem();
  Path tempTableDir=mfs.moveTableToTemp(tableName);
  this.masterServices.getTableDescriptors().remove(Bytes.toString(tableName));
  am.getZKTable().setDeletedTable(Bytes.toString(tableName));
  FileSystem fs=mfs.getFileSystem();
  for (  HRegionInfo hri : regions) {
    LOG.debug("Deleting region " + hri.getRegionNameAsString() + " from FS");
    HFileArchiver.archiveRegion(fs,mfs.getRootDir(),tempTableDir,new Path(tempTableDir,hri.getEncodedName()));
  }
  fs.delete(tempTableDir,true);
  if (cpHost != null) {
    cpHost.postDeleteTableHandler(this.tableName);
  }
}
