{
  final List<HRegionInfo> regions=new ArrayList<HRegionInfo>();
  MetaScannerVisitor visitor=new BlockingMetaScannerVisitor(conf){
    @Override public boolean processRowInternal(    Result result) throws IOException {
      if (result == null || result.isEmpty()) {
        return true;
      }
      byte[] bytes=result.getValue(HConstants.CATALOG_FAMILY,HConstants.REGIONINFO_QUALIFIER);
      if (bytes == null) {
        LOG.warn("Null REGIONINFO_QUALIFIER: " + result);
        return true;
      }
      HRegionInfo regionInfo=Writables.getHRegionInfo(bytes);
      if (regionInfo.isOffline() && !offlined)       return true;
      regions.add(regionInfo);
      return true;
    }
  }
;
  metaScan(conf,visitor);
  return regions;
}
