{
  HeartbeatsThread prog=new HeartbeatsThread();
  try {
    prog.start();
    if (indexConf.doOptimize()) {
      if (LOG.isInfoEnabled()) {
        LOG.info("Optimizing index.");
      }
      writer.optimize();
    }
    writer.close();
    if (LOG.isInfoEnabled()) {
      LOG.info("Done indexing " + docCount + " docs.");
    }
    fs.completeLocalOutput(perm,temp);
    if (LOG.isInfoEnabled()) {
      LOG.info("Copy done.");
    }
  }
  finally {
    prog.setClosed();
  }
}
