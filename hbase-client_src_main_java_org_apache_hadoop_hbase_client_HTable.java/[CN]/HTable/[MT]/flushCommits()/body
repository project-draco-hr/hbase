{
  Object[] results=new Object[writeBuffer.size()];
  boolean success=false;
  try {
    this.connection.processBatch(writeBuffer,tableName,pool,results);
    success=true;
  }
 catch (  InterruptedException e) {
    throw new InterruptedIOException(e.getMessage());
  }
 finally {
    currentWriteBufferSize=0;
    if (success || clearBufferOnFail) {
      writeBuffer.clear();
    }
 else {
      for (int i=results.length - 1; i >= 0; i--) {
        if (results[i] instanceof Result) {
          writeBuffer.remove(i);
        }
 else {
          currentWriteBufferSize+=writeBuffer.get(i).heapSize();
        }
      }
    }
  }
}
