{
  FileSystem fs=FileSystem.get(conf);
  conf.set(MobConstants.MOB_FILE_CACHE_SIZE_KEY,TEST_CACHE_SIZE);
  mobFileCache=new MobFileCache(conf);
  Path file1Path=createMobStoreFile(FAMILY1);
  Path file2Path=createMobStoreFile(FAMILY2);
  Path file3Path=createMobStoreFile(FAMILY3);
  assertEquals(EXPECTED_CACHE_SIZE_ZERO,mobFileCache.getCacheSize());
  CachedMobFile cachedMobFile1=(CachedMobFile)mobFileCache.openFile(fs,file1Path,mobCacheConf);
  assertEquals(EXPECTED_CACHE_SIZE_ONE,mobFileCache.getCacheSize());
  assertNotNull(cachedMobFile1);
  assertEquals(EXPECTED_REFERENCE_TWO,cachedMobFile1.getReferenceCount());
  mobFileCache.evict();
  assertEquals(EXPECTED_CACHE_SIZE_ONE,mobFileCache.getCacheSize());
  assertEquals(EXPECTED_REFERENCE_TWO,cachedMobFile1.getReferenceCount());
  mobFileCache.evictFile(file1Path.getName());
  assertEquals(EXPECTED_CACHE_SIZE_ZERO,mobFileCache.getCacheSize());
  assertEquals(EXPECTED_REFERENCE_ONE,cachedMobFile1.getReferenceCount());
  cachedMobFile1.close();
  cachedMobFile1=(CachedMobFile)mobFileCache.openFile(fs,file1Path,mobCacheConf);
  assertEquals(EXPECTED_CACHE_SIZE_ONE,mobFileCache.getCacheSize());
  CachedMobFile cachedMobFile2=(CachedMobFile)mobFileCache.openFile(fs,file2Path,mobCacheConf);
  assertEquals(EXPECTED_CACHE_SIZE_TWO,mobFileCache.getCacheSize());
  CachedMobFile cachedMobFile3=(CachedMobFile)mobFileCache.openFile(fs,file3Path,mobCacheConf);
  assertEquals(EXPECTED_CACHE_SIZE_THREE,mobFileCache.getCacheSize());
  assertEquals(EXPECTED_REFERENCE_TWO,cachedMobFile1.getReferenceCount());
  assertEquals(EXPECTED_REFERENCE_TWO,cachedMobFile2.getReferenceCount());
  assertEquals(EXPECTED_REFERENCE_TWO,cachedMobFile3.getReferenceCount());
  mobFileCache.evict();
  assertEquals(EXPECTED_CACHE_SIZE_ONE,mobFileCache.getCacheSize());
  assertEquals(EXPECTED_REFERENCE_ONE,cachedMobFile1.getReferenceCount());
  assertEquals(EXPECTED_REFERENCE_ONE,cachedMobFile2.getReferenceCount());
  assertEquals(EXPECTED_REFERENCE_TWO,cachedMobFile3.getReferenceCount());
}
