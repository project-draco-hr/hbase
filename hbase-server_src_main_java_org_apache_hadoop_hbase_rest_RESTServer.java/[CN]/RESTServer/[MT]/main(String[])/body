{
  Log LOG=LogFactory.getLog("RESTServer");
  VersionInfo.logVersion();
  Configuration conf=HBaseConfiguration.create();
  if (User.isSecurityEnabled() && User.isHBaseSecurityEnabled(conf)) {
    String machineName=Strings.domainNamePointerToHostName(DNS.getDefaultHost(conf.get("hbase.rest.dns.interface","default"),conf.get("hbase.rest.dns.nameserver","default")));
    User.login(conf,"hbase.rest.keytab.file","hbase.rest.kerberos.principal",machineName);
  }
  RESTServlet servlet=RESTServlet.getInstance(conf);
  Options options=new Options();
  options.addOption("p","port",true,"Port to bind to [default: 8080]");
  options.addOption("ro","readonly",false,"Respond only to GET HTTP " + "method requests [default: false]");
  options.addOption(null,"infoport",true,"Port for web UI");
  CommandLine commandLine=null;
  try {
    commandLine=new PosixParser().parse(options,args);
  }
 catch (  ParseException e) {
    LOG.error("Could not parse: ",e);
    printUsageAndExit(options,-1);
  }
  if (commandLine != null && commandLine.hasOption("port")) {
    String val=commandLine.getOptionValue("port");
    servlet.getConfiguration().setInt("hbase.rest.port",Integer.valueOf(val));
    LOG.debug("port set to " + val);
  }
  if (commandLine != null && commandLine.hasOption("readonly")) {
    servlet.getConfiguration().setBoolean("hbase.rest.readonly",true);
    LOG.debug("readonly set to true");
  }
  if (commandLine != null && commandLine.hasOption("infoport")) {
    String val=commandLine.getOptionValue("infoport");
    servlet.getConfiguration().setInt("hbase.rest.info.port",Integer.valueOf(val));
    LOG.debug("Web UI port set to " + val);
  }
  @SuppressWarnings("unchecked") List<String> remainingArgs=commandLine != null ? commandLine.getArgList() : new ArrayList<String>();
  if (remainingArgs.size() != 1) {
    printUsageAndExit(options,1);
  }
  String command=remainingArgs.get(0);
  if ("start".equals(command)) {
  }
 else   if ("stop".equals(command)) {
    System.exit(1);
  }
 else {
    printUsageAndExit(options,1);
  }
  ServletHolder sh=new ServletHolder(ServletContainer.class);
  sh.setInitParameter("com.sun.jersey.config.property.resourceConfigClass",ResourceConfig.class.getCanonicalName());
  sh.setInitParameter("com.sun.jersey.config.property.packages","jetty");
  Server server=new Server();
  Connector connector=new SelectChannelConnector();
  connector.setPort(servlet.getConfiguration().getInt("hbase.rest.port",8080));
  connector.setHost(servlet.getConfiguration().get("hbase.rest.host","0.0.0.0"));
  server.addConnector(connector);
  int maxThreads=servlet.getConfiguration().getInt("hbase.rest.threads.max",100);
  int minThreads=servlet.getConfiguration().getInt("hbase.rest.threads.min",2);
  QueuedThreadPool threadPool=new QueuedThreadPool(maxThreads);
  threadPool.setMinThreads(minThreads);
  server.setThreadPool(threadPool);
  server.setSendServerVersion(false);
  server.setSendDateHeader(false);
  server.setStopAtShutdown(true);
  Context context=new Context(server,"/",Context.SESSIONS);
  context.addServlet(sh,"/*");
  context.addFilter(GzipFilter.class,"/*",0);
  int port=conf.getInt("hbase.rest.info.port",8085);
  if (port >= 0) {
    conf.setLong("startcode",System.currentTimeMillis());
    String a=conf.get("hbase.rest.info.bindAddress","0.0.0.0");
    InfoServer infoServer=new InfoServer("rest",a,port,false,conf);
    infoServer.setAttribute("hbase.conf",conf);
    infoServer.start();
  }
  server.start();
  server.join();
}
