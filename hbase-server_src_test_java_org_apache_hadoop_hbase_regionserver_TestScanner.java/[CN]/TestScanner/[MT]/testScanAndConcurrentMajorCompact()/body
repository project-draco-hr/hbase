{
  HTableDescriptor htd=TEST_UTIL.createTableDescriptor(name.getMethodName());
  this.r=TEST_UTIL.createLocalHRegion(htd,null,null);
  HRegionIncommon hri=new HRegionIncommon(r);
  try {
    HBaseTestCase.addContent(hri,Bytes.toString(fam1),Bytes.toString(col1),firstRowBytes,secondRowBytes);
    HBaseTestCase.addContent(hri,Bytes.toString(fam2),Bytes.toString(col1),firstRowBytes,secondRowBytes);
    Delete dc=new Delete(firstRowBytes);
    dc.deleteColumns(fam1,col1);
    r.delete(dc);
    r.flushcache();
    HBaseTestCase.addContent(hri,Bytes.toString(fam1),Bytes.toString(col1),secondRowBytes,thirdRowBytes);
    HBaseTestCase.addContent(hri,Bytes.toString(fam2),Bytes.toString(col1),secondRowBytes,thirdRowBytes);
    r.flushcache();
    InternalScanner s=r.getScanner(new Scan());
    r.compactStores(true);
    List<Cell> results=new ArrayList<Cell>();
    s.next(results);
    assertTrue("result is not correct, keyValues : " + results,results.size() == 1);
    assertTrue(CellUtil.matchingRow(results.get(0),firstRowBytes));
    assertTrue(CellUtil.matchingFamily(results.get(0),fam2));
    results=new ArrayList<Cell>();
    s.next(results);
    assertTrue(results.size() == 2);
    assertTrue(CellUtil.matchingRow(results.get(0),secondRowBytes));
    assertTrue(CellUtil.matchingFamily(results.get(0),fam1));
    assertTrue(CellUtil.matchingFamily(results.get(1),fam2));
  }
  finally {
    HBaseTestingUtility.closeRegionAndWAL(this.r);
  }
}
