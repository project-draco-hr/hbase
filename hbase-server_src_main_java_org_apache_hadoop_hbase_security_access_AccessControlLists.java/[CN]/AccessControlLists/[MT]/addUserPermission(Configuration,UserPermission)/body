{
  Permission.Action[] actions=userPerm.getActions();
  Put p=new Put(userPerm.isGlobal() ? ACL_GLOBAL_NAME : userPerm.getTable());
  byte[] key=userPermissionKey(userPerm);
  if ((actions == null) || (actions.length == 0)) {
    String msg="No actions associated with user '" + Bytes.toString(userPerm.getUser()) + "'";
    LOG.warn(msg);
    throw new IOException(msg);
  }
  byte[] value=new byte[actions.length];
  for (int i=0; i < actions.length; i++) {
    value[i]=actions[i].code();
  }
  p.add(ACL_LIST_FAMILY,key,value);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Writing permission for table " + Bytes.toString(userPerm.getTable()) + " "+ Bytes.toString(key)+ ": "+ Bytes.toStringBinary(value));
  }
  HTable acls=null;
  try {
    acls=new HTable(conf,ACL_TABLE_NAME);
    acls.put(p);
  }
  finally {
    if (acls != null)     acls.close();
  }
}
