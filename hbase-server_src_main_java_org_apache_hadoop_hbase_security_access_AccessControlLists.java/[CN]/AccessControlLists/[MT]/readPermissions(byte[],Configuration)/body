{
  if (ProtobufUtil.isPBMagicPrefix(data)) {
    int pblen=ProtobufUtil.lengthOfPBMagic();
    try {
      AccessControlProtos.UserTablePermissions perms=AccessControlProtos.UserTablePermissions.newBuilder().mergeFrom(data,pblen,data.length - pblen).build();
      return ProtobufUtil.toUserTablePermissions(perms);
    }
 catch (    InvalidProtocolBufferException e) {
      throw new DeserializationException(e);
    }
  }
 else {
    ListMultimap<String,TablePermission> perms=ArrayListMultimap.create();
    try {
      DataInput in=new DataInputStream(new ByteArrayInputStream(data));
      int length=in.readInt();
      for (int i=0; i < length; i++) {
        String user=Text.readString(in);
        List<TablePermission> userPerms=(List)HbaseObjectWritable.readObject(in,conf);
        perms.putAll(user,userPerms);
      }
    }
 catch (    IOException e) {
      throw new DeserializationException(e);
    }
    return perms;
  }
}
