{
  boolean printResults=false;
  if (printResults) {
    LOG.info("Print table contents before map/reduce");
  }
  scanTable(printResults);
  MiniMRCluster mrCluster=new MiniMRCluster(2,fs.getUri().toString(),1);
  conf.set("hbase.index.conf",createIndexConfContent());
  try {
    jobConf=new JobConf(conf,DisabledTestTableIndex.class);
    jobConf.setJobName("index column contents");
    jobConf.setNumMapTasks(2);
    jobConf.setNumReduceTasks(1);
    IdentityTableMap.initJob(TABLE_NAME,INPUT_COLUMN,IdentityTableMap.class,jobConf);
    jobConf.setReducerClass(IndexTableReduce.class);
    FileOutputFormat.setOutputPath(jobConf,new Path(INDEX_DIR));
    jobConf.setOutputFormat(IndexOutputFormat.class);
    JobClient.runJob(jobConf);
  }
  finally {
    mrCluster.shutdown();
  }
  if (printResults) {
    LOG.info("Print table contents after map/reduce");
  }
  scanTable(printResults);
  verify();
}
