{
  final HRegionInterface implementation=Mockito.mock(HRegionInterface.class);
  HConnection connection=mockConnection(implementation);
  try {
    Mockito.when(implementation.getRegionInfo((byte[])Mockito.any())).thenThrow(new IOException("Server not running, aborting")).thenReturn(new HRegionInfo());
    Mockito.when(connection.getRegionServerWithRetries((ServerCallable<Result>)Mockito.any())).thenReturn(getMetaTableRowResult());
    final CatalogTracker ct=constructAndStartCatalogTracker(connection);
    try {
      RootLocationEditor.setRootLocation(this.watcher,SN);
      ct.setMetaLocation(SN);
      Assert.assertFalse(ct.waitForMetaServerConnectionDefault() == null);
    }
  finally {
      ct.resetMetaLocation();
      RootLocationEditor.deleteRootLocation(this.watcher);
    }
  }
  finally {
    HConnectionManager.deleteConnection(UTIL.getConfiguration(),true);
  }
}
