{
  for (int i=0; i < regions.length; i++) {
    for (int j=0; j < rows[i].length; j++) {
      byte[] bytes=regions[i].get(rows[i][j],COLUMN_NAME).getValue();
      assertNotNull(bytes);
      Text value=new Text(bytes);
      assertTrue(value.equals(rows[i][j]));
    }
    regions[i].close();
    regions[i].getLog().closeAndDelete();
  }
  Path logPath=new Path("/tmp",HConstants.HREGION_LOGDIR_NAME + "_" + System.currentTimeMillis());
  LOG.info("Creating log " + logPath.toString());
  HLog log=new HLog(this.fs,logPath,this.conf,null);
  try {
    HRegion merged=mergeAndVerify("merging regions 0 and 1",this.sourceRegions[0].getRegionName().toString(),this.sourceRegions[1].getRegionName().toString(),log,2);
    merged=mergeAndVerify("merging regions 0+1 and 2",merged.getRegionInfo().getRegionName().toString(),this.sourceRegions[2].getRegionName().toString(),log,3);
    merged=mergeAndVerify("merging regions 0+1+2 and 3",merged.getRegionInfo().getRegionName().toString(),this.sourceRegions[3].getRegionName().toString(),log,4);
    merged=mergeAndVerify("merging regions 0+1+2+3 and 4",merged.getRegionInfo().getRegionName().toString(),this.sourceRegions[4].getRegionName().toString(),log,rows.length);
  }
  finally {
    log.closeAndDelete();
  }
}
