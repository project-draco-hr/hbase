{
  List<String> rackList=new ArrayList<String>(rackToRegionServerMap.size());
  rackList.addAll(rackToRegionServerMap.keySet());
  Map<String,Integer> currentProcessIndexMap=new HashMap<String,Integer>();
  int rackIndex=0;
  for (  HRegionInfo regionInfo : regions) {
    String rackName=rackList.get(rackIndex);
    int serverIndex=0;
    Integer currentProcessIndex=currentProcessIndexMap.get(rackName);
    if (currentProcessIndex != null) {
      serverIndex=currentProcessIndex.intValue();
    }
    List<ServerName> currentServerList=rackToRegionServerMap.get(rackName);
    ServerName currentServer=currentServerList.get(serverIndex);
    primaryRSMap.put(regionInfo,currentServer);
    List<HRegionInfo> regionsForServer=assignmentMap.get(currentServer);
    if (regionsForServer == null) {
      regionsForServer=new ArrayList<HRegionInfo>();
      assignmentMap.put(currentServer,regionsForServer);
    }
    regionsForServer.add(regionInfo);
    if ((++serverIndex) >= currentServerList.size()) {
      serverIndex=0;
    }
    currentProcessIndexMap.put(rackName,serverIndex);
    if ((++rackIndex) >= rackList.size()) {
      rackIndex=0;
    }
  }
}
