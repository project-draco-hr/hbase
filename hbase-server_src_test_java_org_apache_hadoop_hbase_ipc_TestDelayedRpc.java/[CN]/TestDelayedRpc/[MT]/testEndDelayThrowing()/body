{
  Configuration conf=HBaseConfiguration.create();
  InetSocketAddress isa=new InetSocketAddress("localhost",0);
  rpcServer=HBaseRPC.getServer(new FaultyTestRpc(),new Class<?>[]{TestRpcImpl.class},isa.getHostName(),isa.getPort(),1,0,true,conf,0);
  rpcServer.start();
  TestRpc client=(TestRpc)HBaseRPC.getProxy(TestRpc.class,0,rpcServer.getListenerAddress(),conf,1000);
  int result=0xDEADBEEF;
  try {
    result=client.test(false);
  }
 catch (  Exception e) {
    fail("No exception should have been thrown.");
  }
  assertEquals(result,UNDELAYED);
  boolean caughtException=false;
  try {
    result=client.test(true);
  }
 catch (  Exception e) {
    if (e.getCause().getMessage().startsWith("java.lang.Exception: Something went wrong"))     caughtException=true;
  }
  assertTrue(caughtException);
}
