{
  if (this.migrationNeeded) {
    return;
  }
  boolean needed=false;
  MetaUtils utils=new MetaUtils(this.conf);
  try {
    List<HRegionInfo> metas=utils.getMETARows(HConstants.META_TABLE_NAME);
    for (    HRegionInfo meta : metas) {
      if (meta.getTableDesc().getFamily(HConstants.COLUMN_FAMILY_HISTORIAN) == null) {
        needed=true;
        break;
      }
    }
    if (needed && this.readOnly) {
      this.migrationNeeded=true;
    }
 else {
      utils.addColumn(HConstants.META_TABLE_NAME,new HColumnDescriptor(HConstants.COLUMN_FAMILY_HISTORIAN,HConstants.ALL_VERSIONS,HColumnDescriptor.CompressionType.NONE,false,false,Integer.MAX_VALUE,HConstants.FOREVER,false));
      LOG.info("Historian family added to .META.");
    }
  }
  finally {
    utils.shutdown();
  }
}
