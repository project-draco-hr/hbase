{
  if (this.readOnly && this.migrationNeeded) {
    return;
  }
  if (!allMajorCompacted()) {
    String msg="All tables must be major compacted before the migration can begin." + MIGRATION_LINK;
    System.out.println(msg);
    throw new IOException(msg);
  }
  final MetaUtils utils=new MetaUtils(this.conf);
  try {
    updateVersions(utils.getRootRegion().getRegionInfo());
    enableBlockCache(utils.getRootRegion().getRegionInfo());
    utils.scanRootRegion(new MetaUtils.ScannerListener(){
      public boolean processRow(      HRegionInfo info) throws IOException {
        if (readOnly && !migrationNeeded) {
          migrationNeeded=true;
          return false;
        }
        updateVersions(utils.getRootRegion(),info);
        enableBlockCache(utils.getRootRegion(),info);
        return true;
      }
    }
);
    LOG.info("TODO: Note on make sure not using old hbase-default.xml");
    LOG.info("TODO: Note on zookeeper config. before starting:");
  }
  finally {
    utils.shutdown();
  }
}
