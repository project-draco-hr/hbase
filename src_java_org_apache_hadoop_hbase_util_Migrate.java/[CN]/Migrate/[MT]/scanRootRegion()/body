{
  final MetaUtils utils=new MetaUtils(this.conf);
  try {
    utils.scanRootRegion(new MetaUtils.ScannerListener(){
      public boolean processRow(      HRegionInfo info) throws IOException {
        migrateRegionDir(HConstants.META_TABLE_NAME,OLD_PREFIX + info.getEncodedName());
        utils.scanMetaRegion(info,new MetaUtils.ScannerListener(){
          public boolean processRow(          HRegionInfo tableInfo) throws IOException {
            migrateRegionDir(tableInfo.getTableDesc().getName(),OLD_PREFIX + tableInfo.getEncodedName());
            return true;
          }
        }
);
        return true;
      }
    }
);
  }
  finally {
    utils.shutdown();
  }
}
