{
  if (this.readOnly && this.migrationNeeded) {
    return;
  }
  final org.apache.hadoop.hbase.util.migration.v5.MetaUtils utils=new org.apache.hadoop.hbase.util.migration.v5.MetaUtils(this.conf);
  try {
    utils.scanRootRegion(new org.apache.hadoop.hbase.util.migration.v5.MetaUtils.ScannerListener(){
      public boolean processRow(      org.apache.hadoop.hbase.util.migration.v5.HRegionInfo info) throws IOException {
        final org.apache.hadoop.hbase.util.migration.v5.HRegion metaRegion=utils.getMetaRegion(info);
        if (readOnly && !migrationNeeded) {
          migrationNeeded=true;
          return false;
        }
        updateHRegionInfo(utils.getRootRegion(),info);
        utils.scanMetaRegion(info,new org.apache.hadoop.hbase.util.migration.v5.MetaUtils.ScannerListener(){
          public boolean processRow(          org.apache.hadoop.hbase.util.migration.v5.HRegionInfo hri) throws IOException {
            updateHRegionInfo(metaRegion,hri);
            return true;
          }
        }
);
        return true;
      }
    }
);
  }
 catch (  Exception e) {
    LOG.error("",e);
  }
 finally {
    utils.shutdown();
  }
}
