{
  while (running.get()) {
    boolean isBigPayload=random.nextBoolean();
    String message=isBigPayload ? BIG_PAYLOAD : id + numCalls;
    EchoRequestProto param=EchoRequestProto.newBuilder().setMessage(message).build();
    EchoResponseProto ret;
    TestRpcServer server=cluster.getRandomServer();
    try {
      User user=User.getCurrent();
      InetSocketAddress address=server.getListenerAddress();
      if (address == null) {
        throw new IOException("Listener channel is closed");
      }
      sending.set(true);
      BlockingInterface stub=newBlockingStub(rpcClient,address,user);
      ret=stub.echo(null,param);
    }
 catch (    Exception e) {
      LOG.warn(e);
      continue;
    }
    try {
      assertNotNull(ret);
      assertEquals(message,ret.getMessage());
    }
 catch (    Throwable t) {
      exception.compareAndSet(null,t);
    }
    numCalls++;
  }
}
