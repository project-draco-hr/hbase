{
  byte[] TABLENAME=Bytes.toBytes("testScanMetrics");
  Configuration conf=TEST_UTIL.getConfiguration();
  TEST_UTIL.createTable(TABLENAME,FAMILY);
  HTable ht=new HTable(conf,TABLENAME);
  int numOfRegions=TEST_UTIL.createMultiRegions(ht,FAMILY);
  Scan scan1=new Scan();
  for (  Result result : ht.getScanner(scan1)) {
  }
  assertEquals(null,scan1.getAttribute(Scan.SCAN_ATTRIBUTES_METRICS_DATA));
  Scan scan=new Scan();
  scan.setAttribute(Scan.SCAN_ATTRIBUTES_METRICS_ENABLE,Bytes.toBytes(Boolean.TRUE));
  for (  Result result : ht.getScanner(scan)) {
  }
  byte[] serializedMetrics=scan.getAttribute(Scan.SCAN_ATTRIBUTES_METRICS_DATA);
  DataInputBuffer in=new DataInputBuffer();
  in.reset(serializedMetrics,0,serializedMetrics.length);
  ScanMetrics scanMetrics=new ScanMetrics();
  scanMetrics.readFields(in);
  assertEquals(numOfRegions,scanMetrics.countOfRegions.getCurrentIntervalValue());
}
