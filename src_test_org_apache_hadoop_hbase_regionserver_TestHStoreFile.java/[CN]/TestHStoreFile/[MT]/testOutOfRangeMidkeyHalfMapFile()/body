{
  MapFile.Reader top=null;
  MapFile.Reader bottom=null;
  HStoreKey key=new HStoreKey();
  ImmutableBytesWritable value=new ImmutableBytesWritable();
  Path p=writeMapFile(getName());
  try {
    try {
      HStoreKey midkey=new HStoreKey("   ");
      bottom=new HalfMapFileReader(this.fs,p.toString(),this.conf,Reference.Range.bottom,midkey,null);
      assertFalse(bottom.next(key,value));
      top=new HalfMapFileReader(this.fs,p.toString(),this.conf,Reference.Range.top,midkey,null);
      boolean first=true;
      while (top.next(key,value)) {
        assertTrue(key.compareTo(midkey) >= 0);
        if (first) {
          first=false;
          LOG.info("First top when key < bottom: " + key.toString());
          assertEquals("aa",Bytes.toString(key.getRow()));
        }
      }
      LOG.info("Last top when key < bottom: " + key.toString());
      assertEquals("zz",Bytes.toString(key.getRow()));
      midkey=new HStoreKey("|||");
      bottom=new HalfMapFileReader(this.fs,p.toString(),this.conf,Reference.Range.bottom,midkey,null);
      first=true;
      while (bottom.next(key,value)) {
        if (first) {
          first=false;
          LOG.info("First bottom when key > top: " + key.toString());
          assertEquals("aa",Bytes.toString(key.getRow()));
        }
      }
      LOG.info("Last bottom when key > top: " + key.toString());
      assertEquals("zz",Bytes.toString(key.getRow()));
      top=new HalfMapFileReader(this.fs,p.toString(),this.conf,Reference.Range.top,midkey,null);
      assertFalse(top.next(key,value));
    }
  finally {
      if (top != null) {
        top.close();
      }
      if (bottom != null) {
        bottom.close();
      }
      fs.delete(p,true);
    }
  }
  finally {
    this.fs.delete(p,true);
  }
}
