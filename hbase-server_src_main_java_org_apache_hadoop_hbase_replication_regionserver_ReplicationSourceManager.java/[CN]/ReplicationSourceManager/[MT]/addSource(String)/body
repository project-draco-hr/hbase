{
  ReplicationPeerConfig peerConfig=replicationPeers.getReplicationPeerConfig(id);
  ReplicationPeer peer=replicationPeers.getPeer(id);
  ReplicationSourceInterface src=getReplicationSource(this.conf,this.fs,this,this.replicationQueues,this.replicationPeers,server,id,this.clusterId,peerConfig,peer);
synchronized (this.hlogsById) {
    this.sources.add(src);
    this.hlogsById.put(id,new TreeSet<String>());
    if (this.latestPath != null) {
      String name=this.latestPath.getName();
      this.hlogsById.get(id).add(name);
      try {
        this.replicationQueues.addLog(src.getPeerClusterZnode(),name);
      }
 catch (      ReplicationException e) {
        String message="Cannot add log to queue when creating a new source, queueId=" + src.getPeerClusterZnode() + ", filename="+ name;
        server.stop(message);
        throw e;
      }
      src.enqueueLog(this.latestPath);
    }
  }
  src.startup();
  return src;
}
