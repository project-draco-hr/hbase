{
  HTableDescriptor desc=new HTableDescriptor(TABLE_NAME);
  desc.addFamily(new HColumnDescriptor(FAM1));
  desc.addFamily(new HColumnDescriptor(FAM2));
  HBaseAdmin admin=new HBaseAdmin(conf);
  admin.createTable(desc);
  HTable table=new HTable(conf,TABLE_NAME);
  Put put=new Put(ROW);
  put.add(FAM1,Bytes.toBytes("letters"),Bytes.toBytes("abcdefg"));
  table.put(put);
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException i) {
  }
  put=new Put(ROW);
  put.add(FAM1,Bytes.toBytes("numbers"),Bytes.toBytes("123456"));
  table.put(put);
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException i) {
  }
  put=new Put(ROW);
  put.add(FAM2,Bytes.toBytes("letters"),Bytes.toBytes("hijklmnop"));
  table.put(put);
  long times[]=new long[3];
  Scan scan=new Scan();
  scan.addFamily(FAM1);
  scan.addFamily(FAM2);
  ResultScanner s=table.getScanner(scan);
  try {
    int index=0;
    Result r=null;
    while ((r=s.next()) != null) {
      for (      KeyValue key : r.sorted()) {
        times[index++]=key.getTimestamp();
      }
    }
  }
  finally {
    s.close();
  }
  for (int i=0; i < times.length - 1; i++) {
    for (int j=i + 1; j < times.length; j++) {
      assertTrue(times[j] > times[i]);
    }
  }
  cluster.flushcache();
  for (int i=0; i < times.length; i++) {
    times[i]=0;
  }
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException i) {
  }
  scan=new Scan();
  scan.addFamily(FAM1);
  scan.addFamily(FAM2);
  s=table.getScanner(scan);
  try {
    int index=0;
    Result r=null;
    while ((r=s.next()) != null) {
      for (      KeyValue key : r.sorted()) {
        times[index++]=key.getTimestamp();
      }
    }
  }
  finally {
    s.close();
  }
  for (int i=0; i < times.length - 1; i++) {
    for (int j=i + 1; j < times.length; j++) {
      assertTrue(times[j] > times[i]);
    }
  }
}
