{
  List<Path> logsToArchive=null;
  for (  Map.Entry<Path,Map<byte[],Long>> e : this.byWalRegionSequenceIds.entrySet()) {
    Path log=e.getKey();
    Map<byte[],Long> sequenceNums=e.getValue();
    if (this.sequenceIdAccounting.areAllLower(sequenceNums)) {
      if (logsToArchive == null) {
        logsToArchive=new ArrayList<Path>();
      }
      logsToArchive.add(log);
      if (LOG.isTraceEnabled()) {
        LOG.trace("WAL file ready for archiving " + log);
      }
    }
  }
  if (logsToArchive != null) {
    for (    Path p : logsToArchive) {
      this.totalLogSize.addAndGet(-this.fs.getFileStatus(p).getLen());
      archiveLogFile(p);
      this.byWalRegionSequenceIds.remove(p);
    }
  }
}
