{
  ManualEnvironmentEdge mee=new ManualEnvironmentEdge();
  EnvironmentEdgeManagerTestHelper.injectEdge(mee);
  this.region=initHRegion(tableName,getName(),fam1);
  try {
    long value=42L;
    long incr=44L;
    Put put=new Put(row);
    put.add(fam1,qual1,Bytes.toBytes(value));
    region.put(put);
    HStore s=(HStore)region.getStore(fam1);
    s.snapshot();
    long newVal=region.incrementColumnValue(row,fam1,qual1,incr,false);
    assertEquals(value + incr,newVal);
    Get get=new Get(row);
    get.setMaxVersions();
    get.addColumn(fam1,qual1);
    Result r=region.get(get,null);
    assertEquals(2,r.size());
    KeyValue first=r.raw()[0];
    KeyValue second=r.raw()[1];
    assertTrue("ICV failed to upgrade timestamp",first.getTimestamp() != second.getTimestamp());
  }
  finally {
    HRegion.closeHRegion(this.region);
    this.region=null;
  }
}
