{
  this.region=initHRegion(tableName,getName(),fam1);
  try {
    long value=1L;
    long amount=3L;
    long now=EnvironmentEdgeManager.currentTimeMillis();
    ManualEnvironmentEdge mock=new ManualEnvironmentEdge();
    mock.setValue(now);
    EnvironmentEdgeManagerTestHelper.injectEdge(mock);
    Put put=new Put(row);
    put.add(fam1,qual1,now,Bytes.toBytes(value));
    region.put(put);
    long result=region.incrementColumnValue(row,fam1,qual1,amount,true);
    assertEquals(value + amount,result);
    Store store=(Store)region.getStore(fam1);
    assertEquals(1,store.memstore.kvset.size());
    assertTrue(store.memstore.snapshot.isEmpty());
    assertICV(row,fam1,qual1,value + amount);
    put=new Put(row);
    put.add(fam1,qual2,now + 1,Bytes.toBytes(value));
    region.put(put);
    result=region.incrementColumnValue(row,fam1,qual2,amount,true);
    assertEquals(value + amount,result);
    store=(Store)region.getStore(fam1);
    assertEquals(2,store.memstore.kvset.size());
    assertTrue(store.memstore.snapshot.isEmpty());
    assertICV(row,fam1,qual2,value + amount);
    EnvironmentEdgeManagerTestHelper.reset();
  }
  finally {
    HRegion.closeHRegion(this.region);
    this.region=null;
  }
}
