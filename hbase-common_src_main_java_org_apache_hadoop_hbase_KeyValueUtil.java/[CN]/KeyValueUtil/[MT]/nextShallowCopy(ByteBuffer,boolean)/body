{
  if (bb.isDirect()) {
    throw new IllegalArgumentException("only supports heap buffers");
  }
  if (bb.remaining() < 1) {
    return null;
  }
  int underlyingArrayOffset=bb.arrayOffset() + bb.position();
  int keyLength=bb.getInt();
  int valueLength=bb.getInt();
  int kvLength=KeyValue.KEYVALUE_INFRASTRUCTURE_SIZE + keyLength + valueLength;
  KeyValue keyValue=new KeyValue(bb.array(),underlyingArrayOffset,kvLength);
  ByteBufferUtils.skip(bb,keyLength + valueLength);
  if (includesMvccVersion) {
    long mvccVersion=ByteBufferUtils.readVLong(bb);
    keyValue.setMvccVersion(mvccVersion);
  }
  return keyValue;
}
