{
  prepareToTakeSnapshot(snapshot);
  snapshot=snapshot.toBuilder().setType(Type.DISABLED).build();
  DisabledTableSnapshotHandler handler;
  try {
    handler=new DisabledTableSnapshotHandler(snapshot,this.master,this.master);
    this.handler=handler;
    this.pool.submit(handler);
  }
 catch (  IOException e) {
    Path workingDir=SnapshotDescriptionUtils.getWorkingSnapshotDir(snapshot,rootDir);
    try {
      if (this.master.getMasterFileSystem().getFileSystem().delete(workingDir,true)) {
        LOG.error("Couldn't delete working directory (" + workingDir + " for snapshot:"+ snapshot);
      }
    }
 catch (    IOException e1) {
      LOG.error("Couldn't delete working directory (" + workingDir + " for snapshot:"+ snapshot);
    }
    throw new SnapshotCreationException("Could not build snapshot handler",e,snapshot);
  }
}
