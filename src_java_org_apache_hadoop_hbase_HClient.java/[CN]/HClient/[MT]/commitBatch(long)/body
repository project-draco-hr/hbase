{
  if (batch == null) {
    throw new IllegalStateException("no batch update in progress");
  }
  try {
    batch.commit(timestamp);
  }
  finally {
    batch=null;
  }
}
