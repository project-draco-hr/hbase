{
  String n=Thread.currentThread().getName();
  UncaughtExceptionHandler handler=new UncaughtExceptionHandler(){
    public void uncaughtException(    Thread t,    Throwable e){
      abort("Uncaught exception in service thread " + t.getName(),e);
    }
  }
;
  this.service=new ExecutorService(getServerName());
  this.service.startExecutorService(ExecutorType.RS_OPEN_REGION,conf.getInt("hbase.regionserver.executor.openregion.threads",5));
  this.service.startExecutorService(ExecutorType.RS_OPEN_ROOT,conf.getInt("hbase.regionserver.executor.openroot.threads",1));
  this.service.startExecutorService(ExecutorType.RS_OPEN_META,conf.getInt("hbase.regionserver.executor.openmeta.threads",1));
  this.service.startExecutorService(ExecutorType.RS_CLOSE_REGION,conf.getInt("hbase.regionserver.executor.closeregion.threads",5));
  this.service.startExecutorService(ExecutorType.RS_CLOSE_ROOT,conf.getInt("hbase.regionserver.executor.closeroot.threads",1));
  this.service.startExecutorService(ExecutorType.RS_CLOSE_META,conf.getInt("hbase.regionserver.executor.closemeta.threads",1));
  Threads.setDaemonThreadRunning(this.hlogRoller,n + ".logRoller",handler);
  Threads.setDaemonThreadRunning(this.cacheFlusher,n + ".cacheFlusher",handler);
  Threads.setDaemonThreadRunning(this.compactSplitThread,n + ".compactor",handler);
  Threads.setDaemonThreadRunning(this.majorCompactionChecker,n + ".majorCompactionChecker",handler);
  this.leases.setName(n + ".leaseChecker");
  this.leases.start();
  int port=this.conf.getInt("hbase.regionserver.info.port",60030);
  if (port >= 0) {
    String addr=this.conf.get("hbase.regionserver.info.bindAddress","0.0.0.0");
    boolean auto=this.conf.getBoolean("hbase.regionserver.info.port.auto",false);
    while (true) {
      try {
        this.infoServer=new InfoServer("regionserver",addr,port,false);
        this.infoServer.setAttribute("regionserver",this);
        this.infoServer.start();
        break;
      }
 catch (      BindException e) {
        if (!auto) {
          throw e;
        }
        LOG.info("Failed binding http info server to port: " + port);
        port++;
        this.serverInfo=new HServerInfo(this.serverInfo.getServerAddress(),this.serverInfo.getStartCode(),port,this.serverInfo.getHostname());
      }
    }
  }
  if (this.replicationHandler != null) {
    this.replicationHandler.startReplicationServices();
  }
  this.server.start();
}
