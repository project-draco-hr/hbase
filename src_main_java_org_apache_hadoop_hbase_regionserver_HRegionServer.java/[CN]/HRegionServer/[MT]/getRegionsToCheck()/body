{
  HashSet<HRegion> regionsToCheck=new HashSet<HRegion>();
  lock.readLock().lock();
  try {
synchronized (this.onlineRegions) {
      regionsToCheck.addAll(this.onlineRegions.values());
    }
  }
  finally {
    lock.readLock().unlock();
  }
  for (final Iterator<HRegion> i=regionsToCheck.iterator(); i.hasNext(); ) {
    HRegion r=i.next();
    if (r.isClosed()) {
      i.remove();
    }
  }
  return regionsToCheck;
}
