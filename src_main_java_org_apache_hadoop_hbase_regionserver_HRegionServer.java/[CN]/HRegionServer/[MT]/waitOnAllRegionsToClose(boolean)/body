{
  int lastCount=-1;
  long previousLogTime=0;
  while (!isOnlineRegionsEmpty()) {
    int count=getNumberOfOnlineRegions();
    if (count != lastCount) {
      if (System.currentTimeMillis() > (previousLogTime + 1000)) {
        previousLogTime=System.currentTimeMillis();
        lastCount=count;
        LOG.info("Waiting on " + count + " regions to close");
        if (count < 10 && LOG.isDebugEnabled()) {
          LOG.debug(this.onlineRegions);
        }
      }
    }
    for (    Map.Entry<String,HRegion> e : this.onlineRegions.entrySet()) {
      HRegionInfo hri=e.getValue().getRegionInfo();
      if (!this.regionsInTransitionInRS.containsKey(hri.getEncodedNameAsBytes())) {
        closeRegion(hri,abort,false);
      }
    }
    Threads.sleep(200);
  }
}
