{
  final Path oldLogDir=new Path(rootDir,HConstants.HREGION_OLDLOGDIR_NAME);
  Path logdir=new Path(rootDir,HLog.getHLogDirectoryName(this.serverInfo));
  if (LOG.isDebugEnabled()) {
    LOG.debug("Log dir " + logdir);
  }
  if (fs.exists(logdir)) {
    throw new RegionServerRunningException("region server already " + "running at " + this.serverInfo.getServerName() + " because logdir "+ logdir.toString()+ " exists");
  }
  this.replicationHandler=new Replication(this.conf,this.serverInfo,this.fs,oldLogDir,stopRequested);
  HLog log=instantiateHLog(logdir,oldLogDir);
  this.replicationHandler.addLogEntryVisitor(log);
  return log;
}
