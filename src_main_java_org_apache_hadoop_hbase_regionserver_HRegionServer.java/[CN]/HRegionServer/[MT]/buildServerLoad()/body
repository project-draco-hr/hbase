{
  Collection<HRegion> regions=getOnlineRegionsLocalContext();
  MemoryUsage memory=ManagementFactory.getMemoryMXBean().getHeapMemoryUsage();
  HBaseProtos.ServerLoad.Builder serverLoad=HBaseProtos.ServerLoad.newBuilder();
  serverLoad.setRequestsPerSecond((int)metrics.getRequests());
  serverLoad.setTotalNumberOfRequests(requestCount.get());
  serverLoad.setUsedHeapMB((int)(memory.getUsed() / 1024 / 1024));
  serverLoad.setMaxHeapMB((int)(memory.getMax() / 1024 / 1024));
  Set<String> coprocessors=this.hlog.getCoprocessorHost().getCoprocessors();
  for (  String coprocessor : coprocessors) {
    serverLoad.addCoprocessors(Coprocessor.newBuilder().setName(coprocessor).build());
  }
  for (  HRegion region : regions) {
    serverLoad.addRegionLoads(createRegionLoad(region));
  }
  return serverLoad.build();
}
