{
  while (!stopped && !getMaster()) {
    sleeper.sleep();
    LOG.warn("Unable to get master for initialization");
  }
  MapWritable result=null;
  long lastMsg=0;
  while (!stopped) {
    try {
      this.requestCount.set(0);
      lastMsg=System.currentTimeMillis();
      ZKUtil.setAddressAndWatch(zooKeeper,ZKUtil.joinZNode(zooKeeper.rsZNode,ZKUtil.getNodeName(serverInfo)),this.serverInfo.getServerAddress());
      this.serverInfo.setLoad(buildServerLoad());
      result=this.hbaseMaster.regionServerStartup(this.serverInfo);
      break;
    }
 catch (    IOException e) {
      LOG.warn("error telling master we are up",e);
    }
catch (    KeeperException e) {
      LOG.warn("error putting up ephemeral node in zookeeper",e);
    }
    sleeper.sleep(lastMsg);
  }
  return result;
}
