{
  MiniHBaseCluster cluster=UTIL.getHBaseCluster();
  HMaster master=cluster.getMaster();
  MasterCoprocessorHost host=master.getCoprocessorHost();
  CPMasterObserver cp=(CPMasterObserver)host.findCoprocessor(CPMasterObserver.class.getName());
  assertFalse("No table created yet",cp.wasCreateTableCalled());
  HTableDescriptor htd=new HTableDescriptor(TEST_TABLE);
  htd.addFamily(new HColumnDescriptor(TEST_FAMILY));
  HBaseAdmin admin=UTIL.getHBaseAdmin();
  admin.createTable(htd);
  assertTrue("Test table should be created",cp.wasCreateTableCalled());
  assertFalse(cp.wasDisableTableCalled());
  admin.disableTable(TEST_TABLE);
  assertTrue(admin.isTableDisabled(TEST_TABLE));
  assertTrue("Coprocessor should have been called on table disable",cp.wasDisableTableCalled());
  htd.setMaxFileSize(512 * 1024 * 1024);
  admin.modifyTable(TEST_TABLE,htd);
  assertTrue("Test table should have been modified",cp.wasModifyTableCalled());
  admin.addColumn(TEST_TABLE,new HColumnDescriptor(TEST_FAMILY2));
  assertTrue("New column family should have been added to test table",cp.wasAddColumnCalled());
  HColumnDescriptor hcd=new HColumnDescriptor(TEST_FAMILY2);
  hcd.setMaxVersions(25);
  admin.modifyColumn(TEST_TABLE,hcd);
  assertTrue("Second column family should be modified",cp.wasModifyColumnCalled());
  assertFalse(cp.wasEnableTableCalled());
  admin.enableTable(TEST_TABLE);
  assertTrue(admin.isTableEnabled(TEST_TABLE));
  assertTrue("Coprocessor should have been called on table enable",cp.wasEnableTableCalled());
  admin.disableTable(TEST_TABLE);
  assertTrue(admin.isTableDisabled(TEST_TABLE));
  assertFalse("No column family deleted yet",cp.wasDeleteColumnCalled());
  admin.deleteColumn(TEST_TABLE,TEST_FAMILY2);
  HTableDescriptor tableDesc=admin.getTableDescriptor(TEST_TABLE);
  assertNull("'" + Bytes.toString(TEST_FAMILY2) + "' should have been removed",tableDesc.getFamily(TEST_FAMILY2));
  assertTrue("Coprocessor should have been called on column delete",cp.wasDeleteColumnCalled());
  assertFalse("No table deleted yet",cp.wasDeleteTableCalled());
  admin.deleteTable(TEST_TABLE);
  assertFalse("Test table should have been deleted",admin.tableExists(TEST_TABLE));
  assertTrue("Coprocessor should have been called on table delete",cp.wasDeleteTableCalled());
}
