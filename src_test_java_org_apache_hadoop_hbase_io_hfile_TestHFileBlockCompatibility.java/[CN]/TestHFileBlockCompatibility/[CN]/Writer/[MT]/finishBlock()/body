{
  userDataStream.flush();
  uncompressedBytesWithHeader=baosInMemory.toByteArray();
  LOG.warn("Writer.finishBlock user data size with header before compression " + uncompressedBytesWithHeader.length);
  prevOffset=prevOffsetByType[blockType.getId()];
  state=State.BLOCK_READY;
  encodeDataBlockForDisk();
  doCompression();
  putHeader(uncompressedBytesWithHeader,0,onDiskBytesWithHeader.length,uncompressedBytesWithHeader.length);
}
