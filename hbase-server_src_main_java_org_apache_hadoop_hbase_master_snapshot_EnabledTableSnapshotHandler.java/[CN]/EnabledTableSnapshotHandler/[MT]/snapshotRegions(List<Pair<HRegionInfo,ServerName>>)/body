{
  Set<String> regionServers=new HashSet<String>(regions.size());
  for (  Pair<HRegionInfo,ServerName> region : regions) {
    regionServers.add(region.getSecond().toString());
  }
  Procedure proc=coordinator.startProcedure(this.monitor,this.snapshot.getName(),this.snapshot.toByteArray(),Lists.newArrayList(regionServers));
  if (proc == null) {
    String msg="Failed to submit distributed procedure for snapshot '" + snapshot.getName() + "'";
    LOG.error(msg);
    throw new HBaseSnapshotException(msg);
  }
  try {
    proc.waitForCompleted();
    LOG.info("Done waiting - snapshot finished!");
  }
 catch (  InterruptedException e) {
    ForeignException ee=new ForeignException("Interrupted while waiting for snapshot to finish",e);
    monitor.receive(ee);
    Thread.currentThread().interrupt();
  }
catch (  ForeignException e) {
    monitor.receive(e);
  }
}
