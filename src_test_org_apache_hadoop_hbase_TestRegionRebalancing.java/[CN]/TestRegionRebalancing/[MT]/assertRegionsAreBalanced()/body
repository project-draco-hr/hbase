{
  boolean success=false;
  for (int i=0; i < 5; i++) {
    success=true;
    waitForAllRegionsAssigned();
    int regionCount=getRegionCount();
    List<HRegionServer> servers=getOnlineRegionServers();
    double avg=Math.ceil((double)regionCount / (double)servers.size());
    LOG.debug("There are " + servers.size() + " servers and "+ regionCount+ " regions. Load Average: "+ avg);
    for (    HRegionServer server : servers) {
      int serverLoad=server.getOnlineRegions().size();
      LOG.debug(server.hashCode() + " Avg: " + avg+ " actual: "+ serverLoad);
      if (!(serverLoad <= avg + 2 && serverLoad >= avg - 2)) {
        success=false;
      }
    }
    if (!success) {
      try {
        Thread.sleep(10000);
      }
 catch (      InterruptedException e) {
      }
      continue;
    }
    return;
  }
  fail("After 5 attempts, region assignments were not balanced.");
}
