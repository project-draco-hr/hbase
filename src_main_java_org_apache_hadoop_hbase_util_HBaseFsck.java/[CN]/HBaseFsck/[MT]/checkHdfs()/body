{
  Path rootDir=new Path(conf.get(HConstants.HBASE_DIR));
  FileSystem fs=rootDir.getFileSystem(conf);
  List<FileStatus> tableDirs=Lists.newArrayList();
  boolean foundVersionFile=false;
  FileStatus[] files=fs.listStatus(rootDir);
  for (  FileStatus file : files) {
    String dirName=file.getPath().getName();
    if (dirName.equals(HConstants.VERSION_FILE_NAME)) {
      foundVersionFile=true;
    }
 else {
      if (!checkMetaOnly || dirName.equals("-ROOT-") || dirName.equals(".META.")) {
        tableDirs.add(file);
      }
    }
  }
  if (!foundVersionFile) {
    errors.reportError(ERROR_CODE.NO_VERSION_FILE,"Version file does not exist in root dir " + rootDir);
  }
  WorkItemHdfsDir[] dirs=new WorkItemHdfsDir[tableDirs.size()];
  int num=0;
  for (  FileStatus tableDir : tableDirs) {
    dirs[num]=new WorkItemHdfsDir(this,fs,errors,tableDir);
    executor.execute(dirs[num]);
    num++;
  }
  for (int i=0; i < num; i++) {
synchronized (dirs[i]) {
      while (!dirs[i].isDone()) {
        dirs[i].wait();
      }
    }
  }
}
