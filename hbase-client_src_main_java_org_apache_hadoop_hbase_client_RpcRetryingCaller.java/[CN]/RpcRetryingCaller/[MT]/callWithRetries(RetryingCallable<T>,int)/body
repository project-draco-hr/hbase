{
  List<RetriesExhaustedException.ThrowableWithExtraContext> exceptions=new ArrayList<RetriesExhaustedException.ThrowableWithExtraContext>();
  this.globalStartTime=EnvironmentEdgeManager.currentTimeMillis();
  for (int tries=0; ; tries++) {
    long expectedSleep;
    try {
      callable.prepare(tries != 0);
      return callable.call(getRemainingTime(callTimeout));
    }
 catch (    Throwable t) {
      ExceptionUtil.rethrowIfInterrupt(t);
      if (LOG.isTraceEnabled()) {
        LOG.trace("Call exception, tries=" + tries + ", retries="+ retries+ ", started="+ (EnvironmentEdgeManager.currentTimeMillis() - this.globalStartTime)+ " ms ago, "+ "cancelled="+ cancelled.get(),t);
      }
      t=translateException(t);
      callable.throwable(t,retries != 1);
      RetriesExhaustedException.ThrowableWithExtraContext qt=new RetriesExhaustedException.ThrowableWithExtraContext(t,EnvironmentEdgeManager.currentTimeMillis(),toString());
      exceptions.add(qt);
      if (tries >= retries - 1) {
        throw new RetriesExhaustedException(tries,exceptions);
      }
      expectedSleep=callable.sleep(pause,tries + 1);
      long duration=singleCallDuration(expectedSleep);
      if (duration > callTimeout) {
        String msg="callTimeout=" + callTimeout + ", callDuration="+ duration+ ": "+ callable.getExceptionMessageAdditionalDetail();
        throw (SocketTimeoutException)(new SocketTimeoutException(msg).initCause(t));
      }
    }
    try {
      if (expectedSleep > 0) {
synchronized (cancelled) {
          if (cancelled.get())           return null;
          cancelled.wait(expectedSleep);
        }
      }
      if (cancelled.get())       return null;
    }
 catch (    InterruptedException e) {
      throw new InterruptedIOException("Interrupted after " + tries + " tries  on "+ retries);
    }
  }
}
