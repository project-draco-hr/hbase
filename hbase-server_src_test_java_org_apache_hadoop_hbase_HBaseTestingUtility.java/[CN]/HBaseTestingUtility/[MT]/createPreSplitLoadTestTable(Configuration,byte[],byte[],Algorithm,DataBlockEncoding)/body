{
  HTableDescriptor desc=new HTableDescriptor(tableName);
  HColumnDescriptor hcd=new HColumnDescriptor(columnFamily);
  hcd.setDataBlockEncoding(dataBlockEncoding);
  hcd.setCompressionType(compression);
  desc.addFamily(hcd);
  int totalNumberOfRegions=0;
  try {
    HBaseAdmin admin=new HBaseAdmin(conf);
    int numberOfServers=admin.getClusterStatus().getServers().size();
    if (numberOfServers == 0) {
      throw new IllegalStateException("No live regionservers");
    }
    totalNumberOfRegions=numberOfServers * DEFAULT_REGIONS_PER_SERVER;
    LOG.info("Number of live regionservers: " + numberOfServers + ", "+ "pre-splitting table into "+ totalNumberOfRegions+ " regions "+ "(default regions per server: "+ DEFAULT_REGIONS_PER_SERVER+ ")");
    byte[][] splits=new RegionSplitter.HexStringSplit().split(totalNumberOfRegions);
    admin.createTable(desc,splits);
    admin.close();
  }
 catch (  MasterNotRunningException e) {
    LOG.error("Master not running",e);
    throw new IOException(e);
  }
catch (  TableExistsException e) {
    LOG.warn("Table " + Bytes.toStringBinary(tableName) + " already exists, continuing");
  }
  return totalNumberOfRegions;
}
