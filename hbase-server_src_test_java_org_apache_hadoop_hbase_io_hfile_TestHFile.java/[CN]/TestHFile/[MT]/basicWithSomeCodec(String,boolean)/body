{
  if (useTags) {
    conf.setInt("hfile.format.version",3);
  }
  if (cacheConf == null)   cacheConf=new CacheConfig(conf);
  Path ncTFile=new Path(ROOT_DIR,"basic.hfile." + codec.toString() + useTags);
  FSDataOutputStream fout=createFSOutput(ncTFile);
  HFileContext meta=new HFileContextBuilder().withBlockSize(minBlockSize).withCompression(AbstractHFileWriter.compressionByName(codec)).build();
  Writer writer=HFile.getWriterFactory(conf,cacheConf).withOutputStream(fout).withFileContext(meta).withComparator(new KeyValue.RawBytesComparator()).create();
  LOG.info(writer);
  writeRecords(writer,useTags);
  fout.close();
  FSDataInputStream fin=fs.open(ncTFile);
  Reader reader=HFile.createReaderFromStream(ncTFile,fs.open(ncTFile),fs.getFileStatus(ncTFile).getLen(),cacheConf,conf);
  System.out.println(cacheConf.toString());
  reader.loadFileInfo();
  HFileScanner scanner=reader.getScanner(true,false);
  scanner.seekTo();
  readAllRecords(scanner);
  scanner.seekTo(getSomeKey(50));
  assertTrue("location lookup failed",scanner.seekTo(getSomeKey(50)) == 0);
  ByteBuffer readKey=scanner.getKey();
  assertTrue("seeked key does not match",Arrays.equals(getSomeKey(50),Bytes.toBytes(readKey)));
  scanner.seekTo(new byte[0]);
  ByteBuffer val1=scanner.getValue();
  scanner.seekTo(new byte[0]);
  ByteBuffer val2=scanner.getValue();
  assertTrue(Arrays.equals(Bytes.toBytes(val1),Bytes.toBytes(val2)));
  reader.close();
  fin.close();
  fs.delete(ncTFile,true);
}
