{
  client.removeConnection(ConnectionId.hashCode(ticket,serviceName,address));
  channel.eventLoop().execute(new Runnable(){
    @Override public void run(){
      if (shouldCloseConnection) {
        return;
      }
      shouldCloseConnection=true;
      if (e != null) {
        if (e instanceof IOException) {
          closeException=(IOException)e;
        }
 else {
          closeException=new IOException(e);
        }
      }
      if (LOG.isDebugEnabled() && closeException != null) {
        LOG.debug(name + ": closing ipc connection to " + address+ ": "+ closeException.getMessage());
      }
      cleanupCalls(true);
      channel.disconnect().addListener(ChannelFutureListener.CLOSE);
      if (LOG.isDebugEnabled()) {
        LOG.debug(name + ": closed");
      }
    }
  }
);
}
