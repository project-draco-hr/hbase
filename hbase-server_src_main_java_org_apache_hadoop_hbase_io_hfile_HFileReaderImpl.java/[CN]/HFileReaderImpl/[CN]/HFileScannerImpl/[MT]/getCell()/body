{
  if (!isSeeked())   return null;
  Cell ret;
  int cellBufSize=getCellBufSize();
  long seqId=0l;
  if (this.reader.shouldIncludeMemstoreTS()) {
    seqId=currMemstoreTS;
  }
  if (blockBuffer.hasArray()) {
    if (currTagsLen > 0) {
      if (this.curBlock.usesSharedMemory()) {
        ret=new ShareableMemoryKeyValue(blockBuffer.array(),blockBuffer.arrayOffset() + blockBuffer.position(),getCellBufSize(),seqId);
      }
 else {
        ret=new SizeCachedKeyValue(blockBuffer.array(),blockBuffer.arrayOffset() + blockBuffer.position(),cellBufSize,seqId);
      }
    }
 else {
      if (this.curBlock.usesSharedMemory()) {
        ret=new ShareableMemoryNoTagsKeyValue(blockBuffer.array(),blockBuffer.arrayOffset() + blockBuffer.position(),getCellBufSize(),seqId);
      }
 else {
        ret=new SizeCachedNoTagsKeyValue(blockBuffer.array(),blockBuffer.arrayOffset() + blockBuffer.position(),cellBufSize,seqId);
      }
    }
  }
 else {
    ByteBuffer buf=blockBuffer.asSubByteBuffer(cellBufSize);
    if (buf.isDirect()) {
      if (this.curBlock.usesSharedMemory()) {
        ret=new ShareableMemoryOffheapKeyValue(buf,buf.position(),cellBufSize,currTagsLen > 0,seqId);
      }
 else {
        ret=new OffheapKeyValue(buf,buf.position(),cellBufSize,currTagsLen > 0,seqId);
      }
    }
 else {
      if (this.curBlock.usesSharedMemory()) {
        if (currTagsLen > 0) {
          ret=new ShareableMemoryKeyValue(buf.array(),buf.arrayOffset() + buf.position(),cellBufSize,seqId);
        }
 else {
          ret=new ShareableMemoryNoTagsKeyValue(buf.array(),buf.arrayOffset() + buf.position(),cellBufSize,seqId);
        }
      }
 else {
        if (currTagsLen > 0) {
          ret=new SizeCachedKeyValue(buf.array(),buf.arrayOffset() + buf.position(),cellBufSize,seqId);
        }
 else {
          ret=new SizeCachedNoTagsKeyValue(buf.array(),buf.arrayOffset() + buf.position(),cellBufSize,seqId);
        }
      }
    }
  }
  return ret;
}
