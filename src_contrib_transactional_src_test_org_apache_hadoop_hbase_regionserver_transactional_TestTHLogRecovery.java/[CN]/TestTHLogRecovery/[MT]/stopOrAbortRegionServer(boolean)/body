{
  List<LocalHBaseCluster.RegionServerThread> regionThreads=cluster.getRegionThreads();
  int server=-1;
  for (int i=0; i < regionThreads.size(); i++) {
    HRegionServer s=regionThreads.get(i).getRegionServer();
    Collection<HRegion> regions=s.getOnlineRegions();
    LOG.info("server: " + regionThreads.get(i).getName());
    for (    HRegion r : regions) {
      LOG.info("region: " + r.getRegionInfo().getRegionNameAsString());
      if (Bytes.equals(r.getTableDesc().getName(),Bytes.toBytes(TABLE_NAME))) {
        server=i;
      }
    }
  }
  if (server == -1) {
    LOG.fatal("could not find region server serving table region");
    fail();
  }
  if (abort) {
    this.cluster.abortRegionServer(server);
  }
 else {
    this.cluster.stopRegionServer(server,false);
  }
  LOG.info(this.cluster.waitOnRegionServer(server) + " has been " + (abort ? "aborted" : "shut down"));
}
