{
  injectTestFailure(context,inputPath);
  FSDataInputStream in=openSourceFile(inputPath);
  if (in == null) {
    context.getCounter(Counter.MISSING_FILES).increment(1);
    throw new FileNotFoundException(inputPath.toString());
  }
  try {
    FileStatus inputStat=getFileStatus(inputFs,inputPath);
    if (inputStat == null) {
      context.getCounter(Counter.MISSING_FILES).increment(1);
      throw new FileNotFoundException(inputPath.toString());
    }
    if (outputFs.exists(outputPath)) {
      FileStatus outputStat=outputFs.getFileStatus(outputPath);
      if (sameFile(inputStat,outputStat)) {
        LOG.info("Skip copy " + inputPath + " to "+ outputPath+ ", same file.");
        return;
      }
    }
    context.getCounter(Counter.BYTES_EXPECTED).increment(inputStat.getLen());
    outputFs.mkdirs(outputPath.getParent());
    FSDataOutputStream out=outputFs.create(outputPath,true);
    try {
      copyData(context,inputPath,in,outputPath,out,inputStat.getLen());
    }
  finally {
      out.close();
    }
    preserveAttributes(outputPath,inputStat);
  }
  finally {
    in.close();
  }
}
