{
  injectTestFailure(context,inputPath);
  FileStatus inputStat=getSourceFileStatus(context,inputPath);
  if (outputFs.exists(outputPath)) {
    FileStatus outputStat=outputFs.getFileStatus(outputPath);
    if (outputStat != null && sameFile(inputStat,outputStat)) {
      LOG.info("Skip copy " + inputPath + " to "+ outputPath+ ", same file.");
      return;
    }
  }
  FSDataInputStream in=openSourceFile(context,inputPath);
  try {
    context.getCounter(Counter.BYTES_EXPECTED).increment(inputStat.getLen());
    outputFs.mkdirs(outputPath.getParent());
    FSDataOutputStream out=outputFs.create(outputPath,true);
    try {
      copyData(context,inputPath,in,outputPath,out,inputStat.getLen());
    }
  finally {
      out.close();
    }
    if (!preserveAttributes(outputPath,inputStat)) {
      LOG.warn("You may have to run manually chown on: " + outputPath);
    }
  }
  finally {
    in.close();
  }
}
