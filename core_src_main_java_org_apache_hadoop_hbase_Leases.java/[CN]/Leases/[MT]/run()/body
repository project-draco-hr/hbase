{
  while (!stopRequested || (stopRequested && leaseQueue.size() > 0)) {
    Lease lease=null;
    try {
      lease=leaseQueue.poll(leaseCheckFrequency,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException e) {
      continue;
    }
catch (    ConcurrentModificationException e) {
      continue;
    }
catch (    Throwable e) {
      LOG.fatal("Unexpected exception killed leases thread",e);
      break;
    }
    if (lease == null) {
      continue;
    }
synchronized (leaseQueue) {
      if (lease.getExpirationTime() <= System.currentTimeMillis()) {
        leaseQueue.add(lease);
        continue;
      }
      if (lease.getListener() == null) {
        LOG.error("lease listener is null for lease " + lease.getLeaseName());
      }
 else {
        lease.getListener().leaseExpired();
      }
      leases.remove(lease.getLeaseName());
    }
  }
  close();
}
