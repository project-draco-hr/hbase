{
  KeyValueScanner[] scanners=new KeyValueScanner[filesToCompact.size()];
  for (int i=0; i < filesToCompact.size(); ++i) {
    scanners[i]=new StoreFileScanner(filesToCompact.get(i).getReader().getScanner());
  }
  InternalScanner scanner;
  if (majorCompaction) {
    Scan scan=new Scan();
    scan.setMaxVersions(family.getMaxVersions());
    scanner=new StoreScanner(this,scan,null);
  }
 else {
    scanner=new MinorCompactingStoreScanner(this,scanners);
  }
  ArrayList<KeyValue> row=new ArrayList<KeyValue>();
  boolean more=true;
  while (more) {
    more=scanner.next(row);
    for (    KeyValue kv : row) {
      writer.append(kv);
    }
    row.clear();
  }
  scanner.close();
}
