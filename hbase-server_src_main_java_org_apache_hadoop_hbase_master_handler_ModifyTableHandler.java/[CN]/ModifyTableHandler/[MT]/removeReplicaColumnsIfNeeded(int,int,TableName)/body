{
  if (newReplicaCount >= oldReplicaCount)   return;
  Set<byte[]> tableRows=new HashSet<byte[]>();
  Scan scan=MetaTableAccessor.getScanForTableName(table);
  scan.addColumn(HConstants.CATALOG_FAMILY,HConstants.REGIONINFO_QUALIFIER);
  HTable htable=null;
  try {
    htable=new HTable(masterServices.getConfiguration(),TableName.META_TABLE_NAME);
    ResultScanner resScanner=htable.getScanner(scan);
    for (    Result result : resScanner) {
      tableRows.add(result.getRow());
    }
    MetaTableAccessor.removeRegionReplicasFromMeta(tableRows,newReplicaCount,oldReplicaCount - newReplicaCount,masterServices.getShortCircuitConnection());
  }
  finally {
    if (htable != null) {
      htable.close();
    }
  }
}
