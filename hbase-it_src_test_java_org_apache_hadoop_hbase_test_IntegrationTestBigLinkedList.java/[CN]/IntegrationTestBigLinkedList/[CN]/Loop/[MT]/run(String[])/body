{
  if (args.length < 5) {
    System.err.println("Usage: Loop <num iterations> <num mappers> <num nodes per mapper> <output dir> <num reducers> [<width> <wrap multiplier>]");
    return 1;
  }
  LOG.info("Running Loop with args:" + Arrays.deepToString(args));
  int numIterations=Integer.parseInt(args[0]);
  int numMappers=Integer.parseInt(args[1]);
  long numNodes=Long.parseLong(args[2]);
  String outputDir=args[3];
  int numReducers=Integer.parseInt(args[4]);
  Integer width=(args.length < 6) ? null : Integer.parseInt(args[5]);
  Integer wrapMuplitplier=(args.length < 7) ? null : Integer.parseInt(args[6]);
  long expectedNumNodes=0;
  if (numIterations < 0) {
    numIterations=Integer.MAX_VALUE;
  }
  for (int i=0; i < numIterations; i++) {
    LOG.info("Starting iteration = " + i);
    runGenerator(numMappers,numNodes,outputDir,width,wrapMuplitplier);
    expectedNumNodes+=numMappers * numNodes;
    if (!runVerify(outputDir,numReducers,expectedNumNodes)) {
      if (it.monkey != null && !(it.monkey instanceof CalmChaosMonkey)) {
        LOG.info("Verify.verify failed, let's stop CM and verify again");
        it.cleanUpMonkey("Stop monkey before verify again after verify failed");
        if (!runVerify(outputDir,numReducers,expectedNumNodes)) {
          LOG.info("Verify.verify failed even without CM, verify one more");
          runVerify(outputDir,numReducers,expectedNumNodes);
        }
      }
      throw new RuntimeException("Verify.verify failed");
    }
  }
  return 0;
}
