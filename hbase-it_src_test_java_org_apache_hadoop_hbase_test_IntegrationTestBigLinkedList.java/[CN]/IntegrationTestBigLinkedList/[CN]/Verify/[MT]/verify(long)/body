{
  if (job == null) {
    throw new IllegalStateException("You should call run() first");
  }
  Counters counters=job.getCounters();
  Counter referenced=counters.findCounter(Counts.REFERENCED);
  Counter unreferenced=counters.findCounter(Counts.UNREFERENCED);
  Counter undefined=counters.findCounter(Counts.UNDEFINED);
  Counter multiref=counters.findCounter(Counts.EXTRAREFERENCES);
  Counter lostfamilies=counters.findCounter(Counts.LOST_FAMILIES);
  boolean success=true;
  if (expectedReferenced != referenced.getValue()) {
    LOG.error("Expected referenced count does not match with actual referenced count. " + "expected referenced=" + expectedReferenced + " ,actual="+ referenced.getValue());
    success=false;
  }
  if (unreferenced.getValue() > 0) {
    boolean couldBeMultiRef=(multiref.getValue() == unreferenced.getValue());
    LOG.error("Unreferenced nodes were not expected. Unreferenced count=" + unreferenced.getValue() + (couldBeMultiRef ? "; could be due to duplicate random numbers" : ""));
    success=false;
  }
  if (undefined.getValue() > 0) {
    LOG.error("Found an undefined node. Undefined count=" + undefined.getValue());
    success=false;
  }
  if (lostfamilies.getValue() > 0) {
    LOG.error("Found nodes which lost big or tiny families, count=" + lostfamilies.getValue());
    success=false;
  }
  if (!success) {
    handleFailure(counters);
  }
  return success;
}
