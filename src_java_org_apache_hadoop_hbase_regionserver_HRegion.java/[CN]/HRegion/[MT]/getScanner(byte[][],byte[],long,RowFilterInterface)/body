{
  splitsAndClosesLock.readLock().lock();
  try {
    if (this.closed.get()) {
      throw new IOException("Region " + this + " closed");
    }
    TreeSet<byte[]> families=new TreeSet<byte[]>(Bytes.BYTES_COMPARATOR);
    for (int i=0; i < cols.length; i++) {
      families.add(HStoreKey.getFamily(cols[i]));
    }
    List<HStore> storelist=new ArrayList<HStore>();
    for (    byte[] family : families) {
      HStore s=stores.get(Bytes.mapKey(family));
      if (s == null) {
        continue;
      }
      storelist.add(s);
    }
    return new HScanner(cols,firstRow,timestamp,storelist.toArray(new HStore[storelist.size()]),filter);
  }
  finally {
    splitsAndClosesLock.readLock().unlock();
  }
}
