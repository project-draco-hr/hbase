{
  splitsAndClosesLock.readLock().lock();
  try {
    if (this.closed.get()) {
      throw new IOException("Region " + this.getRegionName().toString() + " closed");
    }
    TreeSet<Text> families=new TreeSet<Text>();
    for (int i=0; i < cols.length; i++) {
      families.add(HStoreKey.extractFamily(cols[i]));
    }
    List<HStore> storelist=new ArrayList<HStore>();
    for (    Text family : families) {
      HStore s=stores.get(family);
      if (s == null) {
        continue;
      }
      storelist.add(stores.get(family));
    }
    return new HScanner(cols,firstRow,timestamp,storelist.toArray(new HStore[storelist.size()]),filter);
  }
  finally {
    splitsAndClosesLock.readLock().unlock();
  }
}
