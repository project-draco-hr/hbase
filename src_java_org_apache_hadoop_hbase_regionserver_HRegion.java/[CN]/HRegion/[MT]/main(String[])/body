{
  if (args.length < 1) {
    printUsageAndExit(null);
  }
  boolean majorCompact=false;
  if (args.length > 1) {
    if (!args[1].toLowerCase().startsWith("major")) {
      printUsageAndExit("ERROR: Unrecognized option <" + args[1] + ">");
    }
    majorCompact=true;
  }
  Path tableDir=new Path(args[0]);
  Configuration c=HBaseConfiguration.create();
  FileSystem fs=FileSystem.get(c);
  Path logdir=new Path(c.get("hbase.tmp.dir"),"hlog" + tableDir.getName() + System.currentTimeMillis());
  Path oldLogDir=new Path(c.get("hbase.tmp.dir"),HREGION_OLDLOGDIR_NAME);
  HLog log=new HLog(fs,logdir,oldLogDir,c,null);
  try {
    processTable(fs,tableDir,log,c,majorCompact);
  }
  finally {
    log.close();
    BlockCache bc=StoreFile.getBlockCache(c);
    if (bc != null)     bc.shutdown();
  }
}
