{
  this.filter=filter;
  this.scanners=new InternalScanner[stores.length];
  try {
    for (int i=0; i < stores.length; i++) {
      List<byte[]> columns=new ArrayList<byte[]>();
      for (int j=0; j < cols.length; j++) {
        if (Bytes.equals(HStoreKey.getFamily(cols[j]),stores[i].getFamily().getName())) {
          columns.add(cols[j]);
        }
      }
      RowFilterInterface f=filter;
      if (f != null) {
        f=(RowFilterInterface)WritableUtils.clone(filter,conf);
      }
      scanners[i]=stores[i].getScanner(timestamp,columns.toArray(new byte[columns.size()][]),firstRow,f);
    }
  }
 catch (  IOException e) {
    for (int i=0; i < this.scanners.length; i++) {
      if (scanners[i] != null) {
        closeScanner(i);
      }
    }
    throw e;
  }
  this.resultSets=new TreeMap[scanners.length];
  this.keys=new HStoreKey[scanners.length];
  for (int i=0; i < scanners.length; i++) {
    keys[i]=new HStoreKey(HConstants.EMPTY_BYTE_ARRAY,regionInfo);
    resultSets[i]=new TreeMap<byte[],Cell>(Bytes.BYTES_COMPARATOR);
    if (scanners[i] != null && !scanners[i].next(keys[i],resultSets[i])) {
      closeScanner(i);
    }
  }
  activeScannerCount.incrementAndGet();
}
