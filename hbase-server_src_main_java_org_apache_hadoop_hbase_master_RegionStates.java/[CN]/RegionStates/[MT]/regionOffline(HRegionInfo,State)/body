{
  Preconditions.checkArgument(expectedState == null || RegionState.isUnassignable(expectedState),"Offlined region should not be " + expectedState);
  String encodedName=hri.getEncodedName();
  State newState=expectedState == null ? State.OFFLINE : expectedState;
  updateRegionState(hri,newState);
  regionsInTransition.remove(encodedName);
  ServerName oldServerName=regionAssignments.remove(hri);
  if (oldServerName != null) {
    LOG.info("Offlined " + hri.getShortNameToLog() + " from "+ oldServerName);
    Set<HRegionInfo> oldRegions=serverHoldings.get(oldServerName);
    oldRegions.remove(hri);
    if (oldRegions.isEmpty()) {
      serverHoldings.remove(oldServerName);
    }
  }
}
