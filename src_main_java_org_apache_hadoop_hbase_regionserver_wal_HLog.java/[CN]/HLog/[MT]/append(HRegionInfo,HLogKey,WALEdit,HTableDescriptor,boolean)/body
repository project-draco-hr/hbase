{
  if (this.closed) {
    throw new IOException("Cannot append; log is closed");
  }
  long seqNum;
synchronized (updateLock) {
    seqNum=obtainSeqNum();
    logKey.setLogSeqNum(seqNum);
    this.lastSeqWritten.putIfAbsent(regionInfo.getEncodedNameAsBytes(),Long.valueOf(seqNum));
    doWrite(regionInfo,logKey,logEdit,htd);
    this.numEntries.incrementAndGet();
    if (htd.isDeferredLogFlush()) {
      lastDeferredTxid=seqNum;
    }
  }
  if (doSync && (regionInfo.isMetaRegion() || !htd.isDeferredLogFlush())) {
    this.sync(seqNum);
  }
  return seqNum;
}
