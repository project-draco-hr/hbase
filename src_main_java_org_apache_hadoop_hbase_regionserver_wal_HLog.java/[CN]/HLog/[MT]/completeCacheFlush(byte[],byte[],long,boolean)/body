{
  try {
    if (this.closed) {
      return;
    }
    long seqNumOfCompletionEdit;
synchronized (updateLock) {
      seqNumOfCompletionEdit=obtainSeqNum();
      long now=System.currentTimeMillis();
      WALEdit edit=completeCacheFlushLogEdit(logSeqId);
      HLogKey key=makeKey(encodedRegionName,tableName,seqNumOfCompletionEdit,System.currentTimeMillis(),HConstants.DEFAULT_CLUSTER_ID);
      logSyncerThread.append(new Entry(key,edit));
      writeTime.inc(System.currentTimeMillis() - now);
      long len=0;
      for (      KeyValue kv : edit.getKeyValues()) {
        len+=kv.getLength();
      }
      writeSize.inc(len);
      this.numEntries.incrementAndGet();
    }
    this.sync(seqNumOfCompletionEdit);
  }
  finally {
    this.lastSeqWritten.remove(getSnapshotName(encodedRegionName));
    this.cacheFlushLock.unlock();
  }
}
