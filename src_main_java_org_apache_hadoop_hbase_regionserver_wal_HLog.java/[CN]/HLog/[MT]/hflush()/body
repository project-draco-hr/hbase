{
synchronized (this.updateLock) {
    if (this.closed) {
      return;
    }
    boolean logRollRequested=false;
    if (this.forceSync || this.unflushedEntries.get() >= this.flushlogentries) {
      try {
        long now=System.currentTimeMillis();
        this.writer.sync();
        syncTime+=System.currentTimeMillis() - now;
        syncOps++;
        this.forceSync=false;
        this.unflushedEntries.set(0);
        try {
          int numCurrentReplicas=getLogReplication();
          if (numCurrentReplicas != 0 && numCurrentReplicas < this.initialReplication) {
            LOG.warn("HDFS pipeline error detected. " + "Found " + numCurrentReplicas + " replicas but expecting "+ this.initialReplication+ " replicas. "+ " Requesting close of hlog.");
            requestLogRoll();
            logRollRequested=true;
          }
        }
 catch (        Exception e) {
          LOG.warn("Unable to invoke DFSOutputStream.getNumCurrentReplicas" + e + " still proceeding ahead...");
        }
      }
 catch (      IOException e) {
        LOG.fatal("Could not append. Requesting close of hlog",e);
        requestLogRoll();
        throw e;
      }
    }
    if (!logRollRequested && (this.writer.getLength() > this.logrollsize)) {
      requestLogRoll();
    }
  }
}
