{
  final int PROC_TIMEOUT_MSEC=2500;
  List<String> state=new ArrayList<String>();
  Procedure proc=new TestWaitingProcedure("wproc",state,false);
  proc.setTimeout(PROC_TIMEOUT_MSEC);
  long startTime=EnvironmentEdgeManager.currentTime();
  long rootId=ProcedureTestingUtility.submitAndWait(procExecutor,proc);
  long execTime=EnvironmentEdgeManager.currentTime() - startTime;
  LOG.info(state);
  assertTrue("we didn't wait enough execTime=" + execTime,execTime >= PROC_TIMEOUT_MSEC);
  ProcedureResult result=procExecutor.getResult(rootId);
  LOG.info(result.getException());
  assertTrue(state.toString(),result.isFailed());
  assertTrue(result.getException().toString(),result.getException().getCause() instanceof TimeoutException);
  assertEquals(state.toString(),2,state.size());
  assertEquals("wproc-execute",state.get(0));
  assertEquals("wproc-rollback",state.get(1));
}
