{
  FixedFileTrailer trailer=null;
  try {
    trailer=FixedFileTrailer.readFromStream(fsdis,size);
  }
 catch (  IllegalArgumentException iae) {
    throw new CorruptHFileException("Problem reading HFile Trailer from file " + path,iae);
  }
switch (trailer.getMajorVersion()) {
case 1:
    return new HFileReaderV1(path,trailer,fsdis,size,closeIStream,cacheConf);
case 2:
  return new HFileReaderV2(path,trailer,fsdis,fsdisNoFsChecksum,size,closeIStream,cacheConf,preferredEncodingInCache,hfs);
default :
throw new CorruptHFileException("Invalid HFile version " + trailer.getMajorVersion());
}
}
