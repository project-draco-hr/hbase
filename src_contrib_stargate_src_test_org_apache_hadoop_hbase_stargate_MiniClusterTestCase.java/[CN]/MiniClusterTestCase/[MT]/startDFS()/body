{
  if (dfsCluster != null) {
    LOG.error("MiniDFSCluster already running");
    return;
  }
  Path path=new Path(conf.get("test.build.data",System.getProperty("test.build.data","build/test/data")));
  FileSystem testFS=FileSystem.get(conf);
  if (testFS.exists(path)) {
    testFS.delete(path,true);
  }
  testDir=new File(path.toString());
  dfsCluster=new MiniDFSCluster(conf,2,true,(String[])null);
  FileSystem filesystem=dfsCluster.getFileSystem();
  conf.set("fs.default.name",filesystem.getUri().toString());
  Path parentdir=filesystem.getHomeDirectory();
  conf.set(HConstants.HBASE_DIR,parentdir.toString());
  filesystem.mkdirs(parentdir);
  FSUtils.setVersion(filesystem,parentdir);
  LOG.info("started MiniDFSCluster in " + testDir.toString());
}
