{
  final ReentrantLock lock=this.lock;
  lock.lock();
  try {
    CallRunner cr;
    while (true) {
      if (((double)queue.size() / this.maxCapacity) > lifoThreshold) {
        numLifoModeSwitches.incrementAndGet();
        cr=queue.takeLast();
      }
 else {
        cr=queue.takeFirst();
      }
      if (needToDrop(cr)) {
        numGeneralCallsDropped.incrementAndGet();
      }
 else {
        return cr;
      }
    }
  }
  finally {
    lock.unlock();
  }
}
