{
  util=getTestingUtil(null);
  Configuration conf=util.getConfiguration();
  if (conf.getBoolean(HConstants.DISTRIBUTED_LOG_REPLAY_KEY,HConstants.DEFAULT_DISTRIBUTED_LOG_REPLAY_CONFIG)) {
    conf.setInt("hbase.log.replay.retries.number",2);
    conf.setBoolean(HConstants.DISALLOW_WRITES_IN_RECOVERING,true);
  }
  if (!util.isDistributedCluster()) {
    NUM_SLAVES_BASE=5;
  }
  super.setUp(NUM_SLAVES_BASE);
  Action[] actions1=new Action[]{new CompactTable(tableName,0.5f),new CompactRandomRegionOfTable(tableName,0.6f),new FlushTable(tableName),new FlushRandomRegionOfTable(tableName),new MoveRandomRegionOfTable(tableName)};
  Action[] actions2=new Action[]{new SplitRandomRegionOfTable(tableName),new MergeRandomAdjacentRegionsOfTable(tableName),new SnapshotTable(tableName),new MoveRegionsOfTable(tableName),new AddColumnAction(tableName),new RemoveColumnAction(tableName),new ChangeEncodingAction(tableName),new ChangeVersionsAction(tableName)};
  monkey=new ChaosMonkey(util,new PeriodicRandomActionPolicy(30 * 1000,actions1),new PeriodicRandomActionPolicy(60 * 1000,actions2),ChaosMonkey.getPolicyByName(ChaosMonkey.EVERY_MINUTE_RANDOM_ACTION_POLICY));
  monkey.start();
}
