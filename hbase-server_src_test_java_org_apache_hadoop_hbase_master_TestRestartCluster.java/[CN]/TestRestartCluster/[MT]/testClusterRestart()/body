{
  UTIL.startMiniCluster(3);
  LOG.info("\n\nCreating tables");
  for (  byte[] TABLE : TABLES) {
    UTIL.createTable(TABLE,FAMILY);
  }
  for (  byte[] TABLE : TABLES) {
    UTIL.waitTableAvailable(TABLE,30000);
  }
  List<HRegionInfo> allRegions=MetaScanner.listAllRegions(UTIL.getConfiguration());
  assertEquals(3,allRegions.size());
  LOG.info("\n\nShutting down cluster");
  UTIL.shutdownMiniHBaseCluster();
  LOG.info("\n\nSleeping a bit");
  Thread.sleep(2000);
  LOG.info("\n\nStarting cluster the second time");
  UTIL.restartHBaseCluster(3);
  allRegions=MetaScanner.listAllRegions(new Configuration(UTIL.getConfiguration()));
  assertEquals(3,allRegions.size());
  LOG.info("\n\nWaiting for tables to be available");
  for (  byte[] TABLE : TABLES) {
    try {
      UTIL.createTable(TABLE,FAMILY);
      assertTrue("Able to create table that should already exist",false);
    }
 catch (    TableExistsException tee) {
      LOG.info("Table already exists as expected");
    }
    UTIL.waitTableAvailable(TABLE,30000);
  }
}
