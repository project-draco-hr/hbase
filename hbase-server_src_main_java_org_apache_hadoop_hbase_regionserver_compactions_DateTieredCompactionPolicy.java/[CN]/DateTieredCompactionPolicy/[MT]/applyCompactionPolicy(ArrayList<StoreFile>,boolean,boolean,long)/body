{
  Iterable<StoreFile> candidatesInWindow=filterOldStoreFiles(Lists.newArrayList(candidates),comConf.getMaxStoreFileAgeMillis(),now);
  List<ArrayList<StoreFile>> buckets=partitionFilesToBuckets(candidatesInWindow,comConf.getBaseWindowMillis(),comConf.getWindowsPerTier(),now);
  LOG.debug("Compaction buckets are: " + buckets);
  if (buckets.size() >= storeConfigInfo.getBlockingFileCount()) {
    LOG.warn("Number of compaction buckets:" + buckets.size() + ", exceeds blocking file count setting: "+ storeConfigInfo.getBlockingFileCount()+ ", either increase hbase.hstore.blockingStoreFiles or "+ "reduce the number of tiered compaction windows");
  }
  return newestBucket(buckets,comConf.getIncomingWindowMin(),now,comConf.getBaseWindowMillis(),mayUseOffPeak);
}
