{
  if (!fs.exists(dir)) {
    fs.mkdirs(dir);
  }
  Path path=getUniqueFile(fs,dir);
  if (!BloomFilterFactory.isGeneralBloomEnabled(conf)) {
    bloomType=BloomType.NONE;
  }
  if (compressAlgo == null) {
    compressAlgo=HFile.DEFAULT_COMPRESSION_ALGORITHM;
  }
  if (comparator == null) {
    comparator=KeyValue.COMPARATOR;
  }
  return new Writer(fs,path,blocksize,compressAlgo,dataBlockEncoder,conf,cacheConf,comparator,bloomType,maxKeyCount);
}
