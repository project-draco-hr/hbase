{
  if ((dir == null ? 0 : 1) + (filePath == null ? 0 : 1) != 1) {
    throw new IllegalArgumentException("Either specify parent directory " + "or file path");
  }
  if (dir == null) {
    dir=filePath.getParent();
  }
  if (!fs.exists(dir)) {
    fs.mkdirs(dir);
  }
  if (filePath == null) {
    filePath=getUniqueFile(fs,dir);
    if (!BloomFilterFactory.isGeneralBloomEnabled(conf)) {
      bloomType=BloomType.NONE;
    }
  }
  if (compressAlgo == null) {
    compressAlgo=HFile.DEFAULT_COMPRESSION_ALGORITHM;
  }
  if (comparator == null) {
    comparator=KeyValue.COMPARATOR;
  }
  return new Writer(fs,filePath,blockSize,compressAlgo,dataBlockEncoder,conf,cacheConf,comparator,bloomType,maxKeyCount);
}
