{
  if (this.bloomFilter != null) {
    boolean newKey=true;
    if (this.lastKv != null) {
switch (bloomType) {
case ROW:
        newKey=!kvComparator.matchingRows(kv,lastKv);
      break;
case ROWCOL:
    newKey=!kvComparator.matchingRowColumn(kv,lastKv);
  break;
case NONE:
newKey=false;
}
}
if (newKey) {
switch (bloomType) {
case ROW:
this.bloomFilter.add(kv.getBuffer(),kv.getRowOffset(),kv.getRowLength());
break;
case ROWCOL:
int ro=kv.getRowOffset();
int rl=kv.getRowLength();
int qo=kv.getQualifierOffset();
int ql=kv.getQualifierLength();
byte[] result=new byte[rl + ql];
System.arraycopy(kv.getBuffer(),ro,result,0,rl);
System.arraycopy(kv.getBuffer(),qo,result,rl,ql);
this.bloomFilter.add(result);
break;
default :
}
this.lastKv=kv;
}
}
writer.append(kv);
}
