{
  boolean haveBloom=bloomFilterWriter != null && bloomFilterWriter.getKeyCount() > 0;
  if (haveBloom) {
    bloomFilterWriter.compactBloom();
    writer.addBloomFilter(bloomFilterWriter);
    writer.appendFileInfo(BLOOM_FILTER_TYPE_KEY,Bytes.toBytes(bloomType.toString()));
    if (lastBloomKey != null) {
      writer.appendFileInfo(LAST_BLOOM_KEY,Arrays.copyOfRange(lastBloomKey,lastBloomKeyOffset,lastBloomKeyOffset + lastBloomKeyLen));
    }
  }
  writer.close();
  if (haveBloom && bloomFilterWriter.getMaxKeys() > 0) {
    StoreFile.LOG.info("Bloom added to HFile (" + getPath() + "): "+ bloomFilterWriter.toString().replace("\n","; "));
  }
}
