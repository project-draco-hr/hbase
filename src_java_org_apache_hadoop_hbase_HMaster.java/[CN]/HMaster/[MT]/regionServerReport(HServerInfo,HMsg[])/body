{
  String s=serverInfo.getServerAddress().toString().trim();
  long serverLabel=getServerLabel(s);
  if (msgs.length > 0 && msgs[0].getMsg() == HMsg.MSG_REPORT_EXITING) {
    if (cancelLease(s,serverLabel)) {
      LOG.info("Region server " + s + ": MSG_REPORT_EXITING");
      if (!closed) {
        for (int i=1; i < msgs.length; i++) {
          HRegionInfo info=msgs[i].getRegionInfo();
          if (info.tableDesc.getName().equals(ROOT_TABLE_NAME)) {
            rootRegionLocation=null;
          }
 else           if (info.tableDesc.getName().equals(META_TABLE_NAME)) {
            onlineMetaRegions.remove(info.getStartKey());
          }
          unassignedRegions.put(info.regionName,info);
          assignAttempts.put(info.regionName,Long.valueOf(0L));
        }
      }
    }
    return new HMsg[0];
  }
  if (closed) {
    return new HMsg[]{new HMsg(HMsg.MSG_REGIONSERVER_STOP)};
  }
  HServerInfo storedInfo=serversToServerInfo.get(s);
  if (storedInfo == null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("received server report from unknown server: " + s);
    }
    return new HMsg[]{new HMsg(HMsg.MSG_CALL_SERVER_STARTUP)};
  }
 else   if (storedInfo.getStartCode() != serverInfo.getStartCode()) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("region server race condition detected: " + s);
    }
    return new HMsg[]{new HMsg(HMsg.MSG_REGIONSERVER_STOP)};
  }
 else {
    serverLeases.renewLease(serverLabel,serverLabel);
    serversToServerInfo.put(s,serverInfo);
    return processMsgs(serverInfo,msgs);
  }
}
