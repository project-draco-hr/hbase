{
  String server=serverInfo.getServerAddress().toString().trim();
  Text serverLabel=new Text(server);
  if (closed || (msgs.length == 1 && msgs[0].getMsg() == HMsg.MSG_REPORT_EXITING)) {
    serversToServerInfo.remove(server);
    serverLeases.cancelLease(serverLabel,serverLabel);
    HMsg returnMsgs[]={new HMsg(HMsg.MSG_REGIONSERVER_STOP)};
    return returnMsgs;
  }
  HServerInfo storedInfo=serversToServerInfo.get(server);
  if (storedInfo == null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("received server report from unknown server: " + server);
    }
    HMsg returnMsgs[]=new HMsg[1];
    returnMsgs[0]=new HMsg(HMsg.MSG_CALL_SERVER_STARTUP);
    return returnMsgs;
  }
 else   if (storedInfo.getStartCode() != serverInfo.getStartCode()) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("region server race condition detected: " + server);
    }
    HMsg returnMsgs[]={new HMsg(HMsg.MSG_REGIONSERVER_STOP)};
    return returnMsgs;
  }
 else {
    serverLeases.renewLease(serverLabel,serverLabel);
    serversToServerInfo.put(server,serverInfo);
    return processMsgs(serverInfo,msgs);
  }
}
