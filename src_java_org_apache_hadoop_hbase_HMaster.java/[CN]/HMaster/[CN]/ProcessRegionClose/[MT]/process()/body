{
  for (int tries=0; tries < numRetries; tries++) {
    if (closed.get()) {
      return true;
    }
    LOG.info("region closed: " + regionInfo.getRegionName());
    if (!metaRegionAvailable()) {
      return true;
    }
    HRegionInterface server=getMetaServer();
    try {
      BatchUpdate b=new BatchUpdate(rand.nextLong());
      long lockid=b.startUpdate(regionInfo.getRegionName());
      if (deleteRegion) {
        b.delete(lockid,COL_REGIONINFO);
      }
 else       if (!reassignRegion) {
        regionInfo.setOffline(true);
        b.put(lockid,COL_REGIONINFO,Writables.getBytes(regionInfo));
      }
      b.delete(lockid,COL_SERVER);
      b.delete(lockid,COL_STARTCODE);
      server.batchUpdate(metaRegionName,System.currentTimeMillis(),b);
      break;
    }
 catch (    IOException e) {
      if (tries == numRetries - 1) {
        throw RemoteExceptionHandler.checkIOException(e);
      }
      continue;
    }
  }
  if (reassignRegion) {
    LOG.info("reassign region: " + regionInfo.getRegionName());
    unassignedRegions.put(regionInfo,ZERO_L);
  }
 else   if (deleteRegion) {
    try {
      HRegion.deleteRegion(fs,rootdir,regionInfo);
    }
 catch (    IOException e) {
      e=RemoteExceptionHandler.checkIOException(e);
      LOG.error("failed delete region " + regionInfo.getRegionName(),e);
      throw e;
    }
  }
  return true;
}
