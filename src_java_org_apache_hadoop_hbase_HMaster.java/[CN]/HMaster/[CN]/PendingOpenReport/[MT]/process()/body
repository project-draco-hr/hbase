{
  for (int tries=0; tries < numRetries; tries++) {
    LOG.info(region.getRegionName() + " open on " + this.serverAddress.toString());
    Text metaRegionName;
    HRegionInterface server;
    if (closed) {
      return true;
    }
    if (rootRegion) {
      if (rootRegionLocation == null || !rootScanned) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("root region=" + rootRegionLocation.toString() + ", rootScanned="+ rootScanned);
        }
        return false;
      }
      metaRegionName=HGlobals.rootRegionInfo.regionName;
      server=client.getHRegionConnection(rootRegionLocation);
    }
 else {
      if (!rootScanned || numberOfMetaRegions.get() != onlineMetaRegions.size()) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("rootScanned=" + rootScanned + ", numberOfMetaRegions="+ numberOfMetaRegions.get()+ ", onlineMetaRegions.size()="+ onlineMetaRegions.size());
        }
        return false;
      }
      MetaRegion r=null;
      if (onlineMetaRegions.containsKey(region.getRegionName())) {
        r=onlineMetaRegions.get(region.getRegionName());
      }
 else {
        r=onlineMetaRegions.get(onlineMetaRegions.headMap(region.getRegionName()).lastKey());
      }
      metaRegionName=r.regionName;
      server=client.getHRegionConnection(r.server);
    }
    LOG.info("updating row " + region.getRegionName() + " in table "+ metaRegionName);
    long clientId=rand.nextLong();
    try {
      long lockid=server.startUpdate(metaRegionName,clientId,region.getRegionName());
      server.put(metaRegionName,clientId,lockid,COL_SERVER,serverAddress.toString().getBytes(UTF8_ENCODING));
      server.put(metaRegionName,clientId,lockid,COL_STARTCODE,startCode);
      server.commit(metaRegionName,clientId,lockid,System.currentTimeMillis());
      if (region.tableDesc.getName().equals(META_TABLE_NAME)) {
        MetaRegion m=new MetaRegion(serverAddress,region.regionName,region.startKey);
        if (!initialMetaScanComplete) {
          try {
            metaRegionsToScan.put(m);
          }
 catch (          InterruptedException e) {
            throw new RuntimeException("Putting into metaRegionsToScan was interrupted.",e);
          }
        }
 else {
          onlineMetaRegions.put(region.startKey,m);
        }
      }
      break;
    }
 catch (    IOException e) {
      if (tries == numRetries - 1) {
        if (e instanceof RemoteException) {
          e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
        }
        throw e;
      }
    }
    pendingRegions.remove(region.getRegionName());
  }
  return true;
}
