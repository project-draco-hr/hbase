{
  for (int tries=0; tries < numRetries; tries++) {
    if (closed.get()) {
      return true;
    }
    LOG.info(region.toString() + " open on " + this.serverAddress.toString());
    Text metaRegionName;
    HRegionInterface server;
    if (this.rootRegion) {
      if (rootRegionLocation.get() == null || !rootScanned) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("root region: " + ((rootRegionLocation.get() != null) ? rootRegionLocation.get().toString() : "null") + ", rootScanned: "+ rootScanned);
        }
        return false;
      }
      metaRegionName=HGlobals.rootRegionInfo.regionName;
      server=connection.getHRegionConnection(rootRegionLocation.get());
    }
 else {
      if (!rootScanned || numberOfMetaRegions.get() != onlineMetaRegions.size()) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Requeuing open because rootScanned: " + rootScanned + ", numberOfMetaRegions: "+ numberOfMetaRegions.get()+ ", onlineMetaRegions.size(): "+ onlineMetaRegions.size());
        }
        return false;
      }
      MetaRegion r=onlineMetaRegions.containsKey(region.getRegionName()) ? onlineMetaRegions.get(region.getRegionName()) : onlineMetaRegions.get(onlineMetaRegions.headMap(region.getRegionName()).lastKey());
      metaRegionName=r.getRegionName();
      server=connection.getHRegionConnection(r.getServer());
    }
    LOG.info("updating row " + region.getRegionName() + " in table "+ metaRegionName+ " with startcode "+ Writables.bytesToLong(this.startCode)+ " and server "+ serverAddress.toString());
    try {
      BatchUpdate b=new BatchUpdate(rand.nextLong());
      long lockid=b.startUpdate(region.getRegionName());
      b.put(lockid,COL_SERVER,Writables.stringToBytes(serverAddress.toString()));
      b.put(lockid,COL_STARTCODE,startCode);
      server.batchUpdate(metaRegionName,System.currentTimeMillis(),b);
      if (region.tableDesc.getName().equals(META_TABLE_NAME)) {
        MetaRegion m=new MetaRegion(this.serverAddress,this.region.regionName,this.region.startKey);
        if (!initialMetaScanComplete) {
          try {
            LOG.debug("Adding " + m.toString() + " to regions to scan");
            metaRegionsToScan.put(m);
          }
 catch (          InterruptedException e) {
            throw new RuntimeException("Putting into metaRegionsToScan was interrupted.",e);
          }
        }
 else {
          LOG.debug("Adding to onlineMetaRegions: " + m.toString());
          onlineMetaRegions.put(this.region.startKey,m);
        }
      }
      pendingRegions.remove(region.getRegionName());
      break;
    }
 catch (    IOException e) {
      if (tries == numRetries - 1) {
        throw RemoteExceptionHandler.checkIOException(e);
      }
    }
  }
  return true;
}
