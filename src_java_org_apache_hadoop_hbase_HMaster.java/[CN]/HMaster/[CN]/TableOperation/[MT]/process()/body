{
  for (int tries=0; tries < numRetries; tries++) {
    boolean tableExists=false;
    try {
synchronized (metaScannerLock) {
        for (        MetaRegion m : metaRegions) {
          HRegionInterface server=client.getHRegionConnection(m.server);
          long scannerId=server.openScanner(m.regionName,METACOLUMNS,tableName);
          try {
            DataInputBuffer inbuf=new DataInputBuffer();
            while (true) {
              HRegionInfo info=new HRegionInfo();
              String serverName=null;
              long startCode=-1L;
              KeyedData[] values=null;
              values=server.next(scannerId);
              if (values == null || values.length == 0) {
                break;
              }
              boolean haveRegionInfo=false;
              for (int i=0; i < values.length; i++) {
                if (values[i].getData().length == 0) {
                  break;
                }
                Text column=values[i].getKey().getColumn();
                if (column.equals(COL_REGIONINFO)) {
                  haveRegionInfo=true;
                  inbuf.reset(values[i].getData(),values[i].getData().length);
                  info.readFields(inbuf);
                }
 else                 if (column.equals(COL_SERVER)) {
                  try {
                    serverName=new String(values[i].getData(),UTF8_ENCODING);
                  }
 catch (                  UnsupportedEncodingException e) {
                    assert(false);
                  }
                }
 else                 if (column.equals(COL_STARTCODE)) {
                  try {
                    startCode=Long.valueOf(new String(values[i].getData(),UTF8_ENCODING)).longValue();
                  }
 catch (                  UnsupportedEncodingException e) {
                    assert(false);
                  }
                }
              }
              if (!haveRegionInfo) {
                throw new IOException(COL_REGIONINFO + " not found");
              }
              if (info.tableDesc.getName().compareTo(tableName) > 0) {
                break;
              }
              tableExists=true;
              if (!isBeingServed(serverName,startCode)) {
                unservedRegions.add(info);
              }
              processScanItem(serverName,startCode,info);
            }
          }
  finally {
            if (scannerId != -1L) {
              try {
                server.close(scannerId);
              }
 catch (              IOException e) {
                LOG.error(e);
              }
            }
            scannerId=-1L;
          }
          if (!tableExists) {
            throw new IOException(tableName + " does not exist");
          }
          postProcessMeta(m,server);
          unservedRegions.clear();
        }
      }
    }
 catch (    NotServingRegionException e) {
      if (tries == numRetries - 1) {
        throw e;
      }
      continue;
    }
    break;
  }
}
