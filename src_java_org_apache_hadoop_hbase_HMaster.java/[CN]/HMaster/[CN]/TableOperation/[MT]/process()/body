{
  for (int tries=0; tries < numRetries; tries++) {
    boolean tableExists=false;
    try {
synchronized (metaScannerLock) {
        for (        MetaRegion m : metaRegions) {
          HRegionInterface server=connection.getHRegionConnection(m.server);
          long scannerId=server.openScanner(m.regionName,COLUMN_FAMILY_ARRAY,tableName,System.currentTimeMillis(),null);
          try {
            while (true) {
              HRegionInfo info=new HRegionInfo();
              String serverName=null;
              long startCode=-1L;
              KeyedData[] values=server.next(scannerId);
              if (values == null || values.length == 0) {
                break;
              }
              boolean haveRegionInfo=false;
              for (int i=0; i < values.length; i++) {
                if (values[i].getData().length == 0) {
                  break;
                }
                Text column=values[i].getKey().getColumn();
                if (column.equals(COL_REGIONINFO)) {
                  haveRegionInfo=true;
                  info=(HRegionInfo)Writables.getWritable(values[i].getData(),info);
                }
 else                 if (column.equals(COL_SERVER)) {
                  try {
                    serverName=Writables.bytesToString(values[i].getData());
                  }
 catch (                  UnsupportedEncodingException e) {
                    assert(false);
                  }
                }
 else                 if (column.equals(COL_STARTCODE)) {
                  try {
                    startCode=Writables.bytesToLong(values[i].getData());
                  }
 catch (                  UnsupportedEncodingException e) {
                    assert(false);
                  }
                }
              }
              if (!haveRegionInfo) {
                throw new IOException(COL_REGIONINFO + " not found");
              }
              if (info.tableDesc.getName().compareTo(tableName) > 0) {
                break;
              }
              tableExists=true;
              if (!isBeingServed(serverName,startCode)) {
                unservedRegions.add(info);
              }
              processScanItem(serverName,startCode,info);
            }
          }
  finally {
            if (scannerId != -1L) {
              try {
                server.close(scannerId);
              }
 catch (              IOException e) {
                if (e instanceof RemoteException) {
                  e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
                }
                LOG.error("",e);
              }
            }
            scannerId=-1L;
          }
          if (!tableExists) {
            throw new IOException(tableName + " does not exist");
          }
          postProcessMeta(m,server);
          unservedRegions.clear();
        }
      }
    }
 catch (    IOException e) {
      if (tries == numRetries - 1) {
        if (e instanceof RemoteException) {
          e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
        }
        throw e;
      }
      continue;
    }
    break;
  }
}
