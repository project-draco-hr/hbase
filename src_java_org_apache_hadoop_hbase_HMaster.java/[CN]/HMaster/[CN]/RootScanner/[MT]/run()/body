{
  while ((!closed)) {
    rootScanned=false;
    waitForRootRegion();
    rootServer=null;
    long scannerId=-1L;
    try {
      rootServer=client.getHRegionConnection(rootRegionLocation);
      scannerId=rootServer.openScanner(HGlobals.rootRegionInfo.regionName,cols,firstRow);
    }
 catch (    IOException iex) {
      try {
        iex.printStackTrace();
        if (scannerId != -1L) {
          rootServer.close(scannerId);
        }
      }
 catch (      IOException iex2) {
      }
      closed=true;
      break;
    }
    try {
      LOG.debug("starting root region scan");
      DataInputBuffer inbuf=new DataInputBuffer();
      while (true) {
        TreeMap<Text,byte[]> results=new TreeMap<Text,byte[]>();
        HStoreKey key=new HStoreKey();
        LabelledData[] values=rootServer.next(scannerId,key);
        if (values.length == 0) {
          break;
        }
        for (int i=0; i < values.length; i++) {
          results.put(values[i].getLabel(),values[i].getData().get());
        }
        byte[] bytes=results.get(ROOT_COL_REGIONINFO);
        if (bytes == null || bytes.length == 0) {
          LOG.fatal("no value for " + ROOT_COL_REGIONINFO);
          stop();
        }
        inbuf.reset(bytes,bytes.length);
        HRegionInfo info=new HRegionInfo();
        info.readFields(inbuf);
        String serverName=null;
        bytes=results.get(ROOT_COL_SERVER);
        if (bytes != null && bytes.length != 0) {
          serverName=new String(bytes,UTF8_ENCODING);
        }
        long startCode=-1L;
        bytes=results.get(ROOT_COL_STARTCODE);
        if (bytes != null && bytes.length != 0) {
          startCode=Long.valueOf(new String(bytes,UTF8_ENCODING));
        }
        HServerInfo storedInfo=null;
        if (serverName != null) {
          serversToServerInfo.get(serverName);
        }
        if (storedInfo == null || storedInfo.getStartCode() != startCode) {
          unassignedRegions.put(info.regionName,info);
          assignAttempts.put(info.regionName,0L);
          LOG.debug("region unassigned: " + info.regionName);
        }
        numMetaRegions+=1;
      }
    }
 catch (    Exception iex) {
      iex.printStackTrace();
    }
 finally {
      try {
        if (scannerId != -1L) {
          rootServer.close(scannerId);
        }
      }
 catch (      IOException iex2) {
      }
      scannerId=-1L;
    }
  }
  rootScanned=true;
  try {
    Thread.sleep(metaRescanInterval);
  }
 catch (  InterruptedException e) {
  }
}
