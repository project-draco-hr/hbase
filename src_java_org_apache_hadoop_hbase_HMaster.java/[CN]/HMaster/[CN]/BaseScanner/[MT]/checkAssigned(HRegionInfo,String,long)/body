{
  if (info.offLine || killedRegions.contains(info.regionName) || regionsToDelete.contains(info.regionName)) {
    unassignedRegions.remove(info.regionName);
    assignAttempts.remove(info.regionName);
    return;
  }
  HServerInfo storedInfo=null;
  if (serverName.length() != 0) {
    Map<Text,HRegionInfo> regionsToKill=killList.get(serverName);
    if (regionsToKill != null && regionsToKill.containsKey(info.regionName)) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("not assigning region (on kill list): " + info.regionName);
      }
      return;
    }
synchronized (serversToServerInfo) {
      storedInfo=serversToServerInfo.get(serverName);
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Checking " + info.regionName + " is assigned");
  }
  if (!(unassignedRegions.containsKey(info.regionName) || pendingRegions.contains(info.regionName)) && (storedInfo == null || storedInfo.getStartCode() != startCode)) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Current assignment of " + info.regionName + " is no good");
    }
    if (serverName.length() != 0) {
      StringBuilder dirName=new StringBuilder("log_");
      dirName.append(serverName.replace(":","_"));
      Path logDir=new Path(dir,dirName.toString());
      try {
        if (fs.exists(logDir)) {
          splitLogLock.lock();
          try {
            HLog.splitLog(dir,logDir,fs,conf);
          }
  finally {
            splitLogLock.unlock();
          }
        }
        if (LOG.isDebugEnabled()) {
          LOG.debug("Split " + logDir.toString());
        }
      }
 catch (      IOException e) {
        LOG.warn("unable to split region server log because: ",e);
        throw e;
      }
    }
    unassignedRegions.put(info.regionName,info);
    assignAttempts.put(info.regionName,Long.valueOf(0L));
  }
}
