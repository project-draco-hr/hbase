{
  LOG.info("process shutdown of server " + deadServer + ": logSplit: "+ this.logSplit+ ", rootChecked: "+ this.rootChecked+ ", rootRescanned: "+ this.rootRescanned+ ", numberOfMetaRegions: "+ numberOfMetaRegions.get()+ ", onlineMetaRegions.size(): "+ onlineMetaRegions.size());
  if (!logSplit) {
    HLog.splitLog(dir,new Path(dir,"log" + "_" + deadServer.getBindAddress() + "_"+ deadServer.getPort()),fs,conf);
    logSplit=true;
  }
  if (!rootChecked) {
    if (rootRegionLocation != null && deadServer.equals(rootRegionLocation)) {
      rootRegionLocation=null;
      unassignedRegions.put(HGlobals.rootRegionInfo.regionName,HGlobals.rootRegionInfo);
      assignAttempts.put(HGlobals.rootRegionInfo.regionName,Long.valueOf(0L));
    }
    rootChecked=true;
  }
  if (!rootRescanned) {
    HRegionInterface server=null;
    long scannerId=-1L;
    for (int tries=0; tries < numRetries; tries++) {
      if (closed) {
        return true;
      }
      if (rootRegionLocation == null || !rootScanned) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("process server shutdown scanning root region " + "cancelled because rootRegionLocation is null");
        }
        return false;
      }
      server=connection.getHRegionConnection(rootRegionLocation);
      scannerId=-1L;
      try {
        if (LOG.isDebugEnabled()) {
          LOG.debug("process server shutdown scanning root region on " + rootRegionLocation.getBindAddress());
        }
        scannerId=server.openScanner(HGlobals.rootRegionInfo.regionName,columns,startRow,System.currentTimeMillis(),null);
        scanMetaRegion(server,scannerId,HGlobals.rootRegionInfo.regionName);
        break;
      }
 catch (      IOException e) {
        if (tries == numRetries - 1) {
          if (e instanceof RemoteException) {
            e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
          }
          throw e;
        }
      }
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("process server shutdown scanning root region on " + rootRegionLocation.getBindAddress() + " finished "+ Thread.currentThread().getName());
    }
    rootRescanned=true;
  }
  for (int tries=0; tries < numRetries; tries++) {
    try {
      if (closed) {
        return true;
      }
      if (!rootScanned || numberOfMetaRegions.get() != onlineMetaRegions.size()) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Requeuing shutdown because rootScanned: " + rootScanned + ", numberOfMetaRegions: "+ numberOfMetaRegions.get()+ ", onlineMetaRegions.size(): "+ onlineMetaRegions.size());
        }
        return false;
      }
      for (      MetaRegion r : onlineMetaRegions.values()) {
        HRegionInterface server=null;
        long scannerId=-1L;
        if (LOG.isDebugEnabled()) {
          LOG.debug("process server shutdown scanning " + r.regionName + " on "+ r.server+ " "+ Thread.currentThread().getName());
        }
        server=connection.getHRegionConnection(r.server);
        scannerId=server.openScanner(r.regionName,columns,startRow,System.currentTimeMillis(),null);
        scanMetaRegion(server,scannerId,r.regionName);
        if (LOG.isDebugEnabled()) {
          LOG.debug("process server shutdown finished scanning " + r.regionName + " on "+ r.server+ " "+ Thread.currentThread().getName());
        }
      }
      break;
    }
 catch (    IOException e) {
      if (tries == numRetries - 1) {
        if (e instanceof RemoteException) {
          e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
        }
        throw e;
      }
    }
  }
  return true;
}
