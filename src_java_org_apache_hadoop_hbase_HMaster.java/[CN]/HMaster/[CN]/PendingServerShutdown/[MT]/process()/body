{
  if (LOG.isDebugEnabled()) {
    LOG.debug("server shutdown: " + deadServerName);
  }
  HLog.splitLog(dir,new Path(dir,"log" + "_" + deadServer.getBindAddress() + "_"+ deadServer.getPort()),fs,conf);
  if (rootRegionLocation != null && deadServerName.equals(rootRegionLocation.toString())) {
    rootRegionLocation=null;
    unassignedRegions.put(HGlobals.rootRegionInfo.regionName,HGlobals.rootRegionInfo);
    assignAttempts.put(HGlobals.rootRegionInfo.regionName,Long.valueOf(0L));
  }
  HRegionInterface server=null;
  long scannerId=-1L;
  for (int tries=0; tries < numRetries; tries++) {
    if (waitForRootRegionOrClose()) {
      return;
    }
    server=client.getHRegionConnection(rootRegionLocation);
    scannerId=-1L;
    try {
      LOG.debug("scanning root region");
      scannerId=server.openScanner(HGlobals.rootRegionInfo.regionName,columns,startRow,System.currentTimeMillis(),null);
      scanMetaRegion(server,scannerId,HGlobals.rootRegionInfo.regionName);
      break;
    }
 catch (    IOException e) {
      if (tries == numRetries - 1) {
        if (e instanceof RemoteException) {
          e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
        }
        throw e;
      }
    }
  }
  for (int tries=0; tries < numRetries; tries++) {
    try {
      if (metaScanner.waitForMetaScanOrClose()) {
        return;
      }
      for (Iterator<MetaRegion> i=knownMetaRegions.values().iterator(); i.hasNext(); ) {
        server=null;
        scannerId=-1L;
        MetaRegion r=i.next();
        server=client.getHRegionConnection(r.server);
        scannerId=server.openScanner(r.regionName,columns,startRow,System.currentTimeMillis(),null);
        scanMetaRegion(server,scannerId,r.regionName);
      }
      break;
    }
 catch (    IOException e) {
      if (tries == numRetries - 1) {
        if (e instanceof RemoteException) {
          e=RemoteExceptionHandler.decodeRemoteException((RemoteException)e);
        }
        throw e;
      }
    }
  }
}
