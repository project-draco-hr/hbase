{
  if (!isPrepareCalled) {
    throw new RuntimeException("Implementation should have called prepare() first");
  }
  try {
    LOG.info("Handling table operation " + eventType + " on table "+ tableName);
    List<HRegionInfo> hris;
    if (TableName.META_TABLE_NAME.equals(tableName)) {
      hris=new MetaTableLocator().getMetaRegions(server.getZooKeeper());
    }
 else {
      hris=MetaTableAccessor.getTableRegions(server.getConnection(),tableName);
    }
    handleTableOperation(hris);
    if (eventType.isOnlineSchemaChangeSupported() && this.masterServices.getAssignmentManager().getTableStateManager().isTableState(tableName,TableState.State.ENABLED)) {
      if (reOpenAllRegions(hris)) {
        LOG.info("Completed table operation " + eventType + " on table "+ tableName);
      }
 else {
        LOG.warn("Error on reopening the regions");
      }
    }
    completed(null);
  }
 catch (  IOException e) {
    LOG.error("Error manipulating table " + tableName,e);
    completed(e);
  }
catch (  CoordinatedStateException e) {
    LOG.error("Error manipulating table " + tableName,e);
    completed(e);
  }
 finally {
    releaseTableLock();
  }
}
