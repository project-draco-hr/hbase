{
  final Writer realWriter=new Writer();
  writers.add(realWriter);
  StoreFile.Writer writer=mock(StoreFile.Writer.class);
  doAnswer(new Answer<Object>(){
    public Object answer(    InvocationOnMock invocation){
      return realWriter.kvs.add((KeyValue)invocation.getArguments()[0]);
    }
  }
).when(writer).append(any(KeyValue.class));
  doAnswer(new Answer<Object>(){
    public Object answer(    InvocationOnMock invocation){
      Object[] args=invocation.getArguments();
      return realWriter.data.put((byte[])args[0],(byte[])args[1]);
    }
  }
).when(writer).appendFileInfo(any(byte[].class),any(byte[].class));
  return writer;
}
