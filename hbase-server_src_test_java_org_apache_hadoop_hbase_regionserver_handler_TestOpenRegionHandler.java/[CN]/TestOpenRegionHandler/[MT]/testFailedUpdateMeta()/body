{
  Server server=new MockServer(HTU);
  RegionServerServices rsServices=HTU.createMockRegionServerService();
  ZKAssign.createNodeOffline(server.getZooKeeper(),TEST_HRI,server.getServerName());
  ZkCoordinatedStateManager csm=new ZkCoordinatedStateManager();
  csm.initialize(server);
  csm.start();
  ZkOpenRegionCoordination.ZkOpenRegionDetails zkCrd=new ZkOpenRegionCoordination.ZkOpenRegionDetails();
  zkCrd.setServerName(server.getServerName());
  OpenRegionHandler handler=new OpenRegionHandler(server,rsServices,TEST_HRI,TEST_HTD,csm.getOpenRegionCoordination(),zkCrd){
    @Override boolean updateMeta(    final HRegion r){
      return false;
    }
  }
;
  rsServices.getRegionsInTransitionInRS().put(TEST_HRI.getEncodedNameAsBytes(),Boolean.TRUE);
  handler.process();
  RegionTransition rt=RegionTransition.parseFrom(ZKAssign.getData(server.getZooKeeper(),TEST_HRI.getEncodedName()));
  assertEquals(EventType.RS_ZK_REGION_FAILED_OPEN,rt.getEventType());
}
