{
  Container container=containerRef.get();
  Cell[] cells=container.cells;
  int index=hash() & (cells.length - 1);
  Cell cell=cells[index];
  if (cell.addAndIsCongested(delta) && cells.length < MAX_CELLS_LENGTH && container.demoted.compareAndSet(false,true)) {
    if (containerRef.get() == container) {
      Cell[] newCells=new Cell[cells.length * 2];
      System.arraycopy(cells,0,newCells,0,cells.length);
      for (int i=cells.length; i < newCells.length; i++) {
        newCells[i]=new Cell();
      }
      containerRef.compareAndSet(container,new Container(newCells));
    }
  }
}
